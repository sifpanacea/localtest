<?php
//ini_set ( 'memory_limit', '256M' );
ini_set ( 'memory_limit',"2G");
if (! defined ( 'BASEPATH' ))
	exit ( 'No direct script access allowed' );
class Ttwreis_common_model extends CI_Model {
	/**
	 * error message (uses lang file)
	 *
	 * @var string
	 */
	protected $errors;
	
	/**
	 * error start delimiter
	 *
	 * @var string
	 */
	protected $error_start_delimiter;
	
	/**
	 * error end delimiter
	 *
	 * @var string
	 */
	protected $error_end_delimiter;
	function __construct() {
		parent::__construct ();
		
		$this->load->config ( 'ion_auth', TRUE );
		$this->load->config ( 'mongodb', TRUE );
		
		// Initialize MongoDB collection names
		$this->collections = $this->config->item ( 'collections', 'ion_auth' );
		$this->_configvalue = $this->config->item ( 'default' );
		$this->common_db = $this->config->item ( 'default' );
		
		$this->store_salt = $this->config->item ( 'store_salt', 'ion_auth' );
		$this->salt_length = $this->config->item ( 'salt_length', 'ion_auth' );
		
		// Initialize hash method directives (Bcrypt)
		$this->hash_method = $this->config->item ( 'hash_method', 'ion_auth' );
		
		// $this->common_db = $this->config->item('default');
		
		$this->screening_app_col = "healthcare201671115519757";
		$this->screening_app_col_screening = "healthcare201671115519757_screening_final";
		
		$this->absent_app_col = "healthcare20161015173311279";
		$this->bmi_app_col = "healthcare2017619153715384";
		$this->request_app_col = "healthcare2016108181933756";
		$this->request_app_col_static_html = "healthcare2016108181933756_static_html";
		$this->hb_app_col = "ttwreis_himglobin_report_col";
		$this->sanitation_infrastructure_app_col = "";
		$this->sanitation_app_col = "healthcare20171211809800";
		$this->sanitation_app_col_v2 = "healthcare20171211809800_version_2";
		$this->notes_col = "ttwreis_ehr_notes";
		$this->today_date = date ( 'Y-m-d' );

		// For 2020-2021 academic year collections
		$this->screening_app_col_sw_2020_2021 = "tswreis_screening_report_col_2020-2021";
		$this->screening_app_col_tt_2020_2021 = "ttwreis_screening_report_col_2020-2021";
		$this->screening_app_col_bc_2020_2021 = "bcwelfare_screening_report_col_2020-2021";

		// For 2021-2022 academic year collections
		$this->screening_app_col_sw_2021_2022 = "tswreis_screening_report_col_2021-2022";
		$this->screening_app_col_tt_2021_2022 = "ttwreis_screening_report_col_2021-2022";
		$this->screening_app_col_tt_2022_2023 = "ttwreis_screening_report_col_2022-2023";
		$this->screening_app_col_bc_2021_2022 = "bcwelfare_screening_report_col_2021-2022";

	}
	public function statescount() {
		$count = $this->mongo_db->count ( 'ttwreis_states' );
		return $count;
	}
	public function get_states($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_states' );
		return $query;
	}
	public function get_all_states() {
		$query = $this->mongo_db->get ( 'ttwreis_states' );
		return $query;
	}
	
	// =================================================
	public function distcount() {
		$count = $this->mongo_db->count ( 'ttwreis_district' );
		return $count;
	}
	public function get_district($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_district' );
		foreach ( $query as $distlist => $dist ) {
			$st_name = $this->mongo_db->where ( '_id', new MongoId ( $dist ['st_name'] ) )->get ( 'ttwreis_states' );
			if (isset ( $dist ['st_name'] )) {
				$query [$distlist] ['st_name'] = $st_name [0] ['st_name'];
			} else {
				$query [$distlist] ['st_name'] = "No state selected";
			}
		}
		return $query;
	}
	public function get_all_district($dt_name = "All") {
		if ($dt_name == "All") {
			$query = $this->mongo_db->orderBy ( array (
					'dt_name' => 1 
			) )->get ( 'ttwreis_district' );
		} else {
			$query = $this->mongo_db->where ( 'dt_name', $dt_name )->orderBy ( array (
					'dt_name' => 1 
			) )->get ( 'ttwreis_district' );
		}
		
		return $query;
	}
	public function health_supervisorscount() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$count = $this->mongo_db->count ( $this->collections ['ttwreis_health_supervisors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $count;
	}
	public function get_health_supervisors($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( $this->collections ['ttwreis_health_supervisors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function create_health_supervisors($post) {
		$this->load->config ( 'ion_auth', TRUE );
		
		$email = strtolower ( $post ['health_supervisors_email'] );
		$password = $post ['health_supervisors_password'];
		
		// Check if email already exists
		if ($this->user_exists ( $email )) {
			$this->set_error ( 'account_creation_duplicate_email' );
			return FALSE;
		}
		
		// IP address
		$ip_address = $this->_prepare_ip ( $this->input->ip_address () );
		$salt = $this->store_salt ? $this->salt () : FALSE;
		$password = $this->hash_password ( $password, $salt );
		
		// New user document
		$data = array (
				"school_code" => intval($post ['school_code']),
				"hs_name" => $post ['health_supervisors_name'],
				"hs_mob" => $post ['health_supervisors_mob'],
				"hs_ph" => $post ['health_supervisors_ph'],
				"password" => $password,
				"email" => $email,
				"hs_addr" => $post ['health_supervisors_addr'],
				"username" => $post ['health_supervisors_name'],
				'ip_address' => $ip_address,
				'created_on' => time (),
				'registered_on' => date ( "Y-m-d" ),
				'last_login' => date ( "Y-m-d H:i:s" ),
				// 'active' => ($admin_manual_activation === FALSE ? 1 : 0),
				'active' => 1,
				'company' => $this->session->userdata ( "customer" )['company'] 
		);
		
		// Store salt in document?
		if ($this->store_salt) {
			$data ['salt'] = $salt;
		}
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->insert ( $this->collections ['ttwreis_health_supervisors'], $data );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		// Return new document _id or FALSE on failure
		return isset ( $query ) ? $query : FALSE;
	}
	
	// ///////////////////////////////////////////////////////////
	public function cc_users_count() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$count = $this->mongo_db->count ( $this->collections ['ttwreis_cc'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $count;
	}
	public function get_cc_users($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( $this->collections ['ttwreis_cc'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function create_cc_user($post) {
		$this->load->config ( 'ion_auth', TRUE );
		
		$email = strtolower ( $post ['email'] );
		$password = $post ['password'];
		
		// Check if email already exists
		if ($this->cc_user_exists ( $email )) {
			$this->set_error ( 'account_creation_duplicate_email' );
			return FALSE;
		}
		
		// IP address
		$ip_address = $this->_prepare_ip ( $this->input->ip_address () );
		$salt = $this->store_salt ? $this->salt () : FALSE;
		$password = $this->hash_password ( $password, $salt );
		
		// New user document
		$data = array (
				"name" => $post ['cc_user_name'],
				"mobile_number" => $post ['cc_user_mob'],
				"phone_number" => $post ['cc_user_ph'],
				"password" => $password,
				"email" => $email,
				"company_address" => $post ['cc_user_addr'],
				
				"username" => $post ['cc_user_name'],
				'ip_address' => $ip_address,
				'created_on' => time (),
				'registered_on' => date ( "Y-m-d" ),
				'last_login' => date ( "Y-m-d H:i:s" ),
				// 'active' => ($admin_manual_activation === FALSE ? 1 : 0),
				'active' => 1,
				'company_name' => $this->session->userdata ( "customer" )['company'] 
		);
		
		// Store salt in document?
		if ($this->store_salt) {
			$data ['salt'] = $salt;
		}
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->insert ( $this->collections ['ttwreis_cc'], $data );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		// Return new document _id or FALSE on failure
		return isset ( $query ) ? $query : FALSE;
	}
	public function delete_cc_user($cc_id) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( array (
				"_id" => new MongoId ( $cc_id ) 
		) )->delete ( $this->collections ['ttwreis_cc'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	
	// ////////////////////////////////////////////////////////////
	public function doctorscount() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$count = $this->mongo_db->count ( $this->collections ['ttwreis_doctors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $count;
	}
	public function get_doctors($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( $this->collections ['ttwreis_doctors'] );
     $this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}

    public function get_all_doctors() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_doctors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	
	// ///////////////////////////////////////////////////////////////////
	public function schoolscount() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$count = $this->mongo_db->count ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $count;
	}
	public function get_schools($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		foreach ( $query as $schools => $school ) {
			$dt_name = $this->mongo_db->where ( '_id', new MongoId ( $school ['dt_name'] ) )->get ( 'ttwreis_district' );
			if (isset ( $school ['dt_name'] )) {
				$query [$schools] ['dt_name'] = $dt_name [0] ['dt_name'];
			} else {
				$query [$schools] ['dt_name'] = "No state selected";
			}
		}
		return $query;
	}
	public function create_school($post) {
		$this->load->config ( 'ion_auth', TRUE );
		
		$email = strtolower ( $post ['school_email'] );
		$password = $post ['school_password'];
		
		// Check if email already exists
		if ($this->school_exists ( $email )) {
			$this->set_error ( 'account_creation_duplicate_email' );
			return FALSE;
		}
		
		// IP address
		$ip_address = $this->_prepare_ip ( $this->input->ip_address () );
		$salt = $this->store_salt ? $this->salt () : FALSE;
		$password = $this->hash_password ( $password, $salt );
		
		$data = array (
				"dt_name" => $post ['dt_name'],
				"school_code" => intval($post ['school_code']),
				"school_name" => $post ['school_name'],
				"school_addr" => $post ['school_addr'],
				"password" => $password,
				"email" => $email,
				"school_ph" => $post ['school_ph'],
				"school_mob" => $post ['school_mob'],
				"contact_person_name" => $post ['contact_person_name'],
				
				"username" => $post ['school_name'],
				'ip_address' => $ip_address,
				'created_on' => time (),
				'registered_on' => date ( "Y-m-d" ),
				'last_login' => date ( "Y-m-d H:i:s" ),
				// 'active' => ($admin_manual_activation === FALSE ? 1 : 0),
				'active' => 1,
				'company' => $this->session->userdata ( "customer" )['company'] 
		);
		// Store salt in document?
		if ($this->store_salt) {
			$data ['salt'] = $salt;
		}
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->insert ( $this->collections ['ttwreis_schools'], $data );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		// Return new document _id or FALSE on failure
		return isset ( $query ) ? $query : FALSE;
	}
	public function get_all_schools() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		foreach ( $query as $schools => $school ) {
			$dt_name = $this->mongo_db->where ( '_id', new MongoId ( $school ['dt_name'] ) )->get ( 'ttwreis_district' );
			log_message("debug","dt_nnnnnnnnnnnnnnnnnnnnnnnnnnnnnn".print_r($dt_name,true));
			log_message("debug","schoollllllllllllllllllllllll".print_r($school,true));
			if (isset ( $school ['dt_name'] )) {
				$query [$schools] ['dt_name'] = $dt_name [0] ['dt_name'];
			} else {
				$query [$schools] ['dt_name'] = "No state selected";
			}
		}
		return $query;
	}
	public function classescount() {
		$count = $this->mongo_db->count ( 'ttwreis_classes' );
		return $count;
	}
	public function get_classes($per_page, $page) 	{

		  /*subjective_refraction_attachments ocular_diagnosis_attachments
		$unique_ids = ["TSWREIS NAZEERABAD(G),RANGAREDDY"];
		
		for($ind_modi=0;$ind_modi <= count($unique_ids)-1;$ind_modi++)
	  	{
			
			$unique_id = $unique_ids[$ind_modi];

			$docs = $this->mongo_db->select(array('doc_data.subjective_refraction_attachments.file_path'),array('_id'))->where(array('doc_data.widget_data.page2.Personal Information.School Name' => $unique_id, 'doc_data.subjective_refraction_attachments' => array('$ne' => "[]")))->get('healthcare2016226112942701');
			
			if(!empty($docs) && isset($docs))
			{
				foreach($docs as $doc)
				{
					if(!empty($doc['doc_data']['subjective_refraction_attachments']))
					{
						$org_image = $doc['doc_data']['subjective_refraction_attachments']['0']['file_path'];
						$destination = './uploaddir/public/prescritions_imgs';
						$img_name = basename($org_image);

						if( copy( $org_image , $destination.'/'.$img_name ))
						{
						 echo 'copied!';
						} else {
						 echo 'failed';
						}
					}					
				}
				
			}
		}
			exit();*/


			
		/*$unique_ids = ["TMBBD_2223_", "TADB_2302_", "TADB_2303_", "TADB_2305_", "TBDD_2101_", "TBDD_2102_", "TBDD_2106_", "TBDD_2108_", "TBDD_2109_", "TBDD_2110_", "TBDD_2112_", "TBDD_2114_", "TBDD_2131_", "TBDD_2134_", "THYD_2401_", "TJGN_2228_", "TKMM_2116_", "TKMM_2129_", "TKMM_2132_", "TKMM_2133_", "TKMR_2002_", "TMBBD_2206_", "TMBBD_2207_", "TMBNR_1404_", "TMBNR_1405_", "TMDK_1601_", "TMDK_1602_", "TMDK_1612_", "TMDK_1617_", "TMDK_1618_", "TNGKL_1401_", "TNGKL_1403_", "TNGKL_1422_", "TNLG_1501_", "TNLG_1514_", "TNLG_1518_", "TNLG_1523_", "TNZD_2011_", "TRJN_1702_", "TRJN_1714_", "TRR_1426_", "TRR_1814_", "TSRD_1613_", "TVKRD_1425_", "TVKRD_1813_", "TWGLR_2229_", "TWNPY_1402_", "ktmm_2130_"];

		$correct_ids = ["TMBBD_2223_", "TADB_2302_", "TADB_2303_", "TADB_2305_", "TBDD_2101_", "TBDD_2102_", "TBDD_2106_", "TBDD_2108_", "TBDD_2109_", "TBDD_2110_", "TBDD_2112_", "TBDD_2114_", "TBDD_2131_", "TBDD_2134_", "THYD_2401_", "TJGN_2228_", "TKMM_2116_", "TKMM_2129_", "TKMM_2132_", "TKMM_2133_", "TKMR_2002_", "TMBBD_2206_", "TMBBD_2207_", "TMBNR_1404_", "TMBNR_1405_", "TMDK_1601_", "TMDK_1602_", "TMDK_1612_", "TMDK_1617_", "TMDK_1618_", "TNGKL_1401_", "TNGKL_1403_", "TNGKL_1422_", "TNLG_1501_", "TNLG_1514_", "TNLG_1518_", "TNLG_1523_", "TNZD_2011_", "TRJN_1702_", "TRJN_1714_", "TRR_1426_", "TRR_1814_", "TSRD_1613_", "TVKRD_1425_", "TVKRD_1813_", "TWGLR_2229_", "TWNPY_1402_", "TKMM_2130_"];

		$new_schools_names = ["TTWREIS KURAVI(RJC-G),MAHABOOBABAD","TTWREIS ADILABAD(B),ADILABAD","TTWREIS ADILABAD(RJC-B),ADILABAD","TTWREIS ECHODA(G),ADILABAD","TTWREIS BHADRACHALAM(RJC-G),BHADRADRI","TTWREIS GUNDALA(RJC-B),BHADRADRI","TTWREIS DAMMAPETA(RJC-B),BHADRADRI","TTWREIS SUDIMALLA(RJC-G),BHADRADRI","TTWREIS ANKAMPALEM(RJC-G),BHADRADRI","TTWREIS GUNDALA(B),BHADRADRI","TTWREIS DAMMAPETA(B),BHADRADRI","TTWREIS SUDIMALLA(G),BHADRADRI","TTWREIS MANUGURU(G),BHADRADRI","TTWREIS KOTHAGUDEM(G),BHADRADRI","TTWREIS JANGAMMET(G),HYDERABAD","TTWREIS PALAKURTHY(G),JANGAON","TTWREIS KANIKALA(B),KHAMMAM","TTWREIS ANAPREDDYPALLI(G),KHAMMAM","TTWREIS SINGARENI(B),KHAMMAM","TTWREIS WYRA(G),KHAMMAM","TTWREIS GANDHARI(B),KAMAREDDY","TTWREIS KURAVI(G),MAHABOOBABAD","TTWREIS KOTHAGUDA(G),MAHABOOBABAD","TTWREIS BALANAGAR(RJC-B),MAHABUBNAGAR","TTWREIS BALANAGAR(B),MAHABUBNAGAR","TTWREIS NARSAPUR(RJC-B),MEDAK","TTWREIS NARSAPUR(B),MEDAK","TTWREIS CHEGUNTA(G),MEDAK","TTWREIS NARSAPUR(G),MEDAK","TTWREIS KOWDIPALLY(B),MEDAK","TTWREIS MANNANOOR(B),NAGARKURNOOL","TTWREIS KALWAKURTHY(G),NAGARKURNOOL","TTWREIS ACHAMPET(G),NAGARKURNOOL","TTWREIS MIRYALAGUDA(B),NALGONDA","TTWREIS PEDAVURA(MG-G),NALGONDA","TTWREIS MIRYALGUDA(RJC-B),NALGONDA","TTWREIS DAMARCHARLA(B),NALGONDA","TTWREIS INDALVAI(G),NIZAMABAD","TTWREIS YELLAREDDYPETA(RJC-G),RAJANNA","TTWREIS MARRIMANDLA(RJC-B),RAJANNA","TTWREIS KOTHUR(B),RANGAREDDY","TTWREIS KANDUKUR(B),RANGAREDDY","TTWREIS NARAYANKHED(B),SANGAREDDY","TTWREIS KODANGAL(B),VIKARABAD","TTWREIS TANDUR(G),VIKARABAD","TTWREIS PARVATHAGIR(G),WARANGAL RURAL","TTWREIS WANAPARTHY(G),WANAPARTHY","TTWREIS THIRUMALAYAPALEM(B),KHAMMAM"];

		$districts = ["MAHABOOBABAD", "ADILABAD", "ADILABAD", "ADILABAD", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "BHADRADRI", "HYDERABAD", "JANGAON", "KHAMMAM", "KHAMMAM", "KHAMMAM", "KHAMMAM", "KAMAREDDY", "MAHABOOBABAD", "MAHABOOBABAD", "MAHABUBNAGAR", "MAHABUBNAGAR", "MEDAK", "MEDAK", "MEDAK", "MEDAK", "MEDAK", "NAGARKURNOOL", "NAGARKURNOOL", "NAGARKURNOOL", "NALGONDA", "NALGONDA", "NALGONDA", "NALGONDA", "NIZAMABAD", "RAJANNA", "RAJANNA", "RANGAREDDY", "RANGAREDDY", "SANGAREDDY", "VIKARABAD", "VIKARABAD", "WARANGAL RURAL", "WANAPARTHY", "KHAMMAM"];



      for($ind_modi=0;$ind_modi <= count($unique_ids)-1;$ind_modi++)
	  {
			
			$unique_id = $unique_ids[$ind_modi];
			$correct_id = $correct_ids[$ind_modi];
			//$old_school_name = $old_school_names[$ind_modi];
			$correct_school_name = $new_schools_names[$ind_modi];
			$district = $districts[$ind_modi];
			//$email = $emails[$ind_modi];
			//$new_email = $new_emails[$ind_modi];
			//$dt_name = $dt_names[$ind_modi];

		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Student Details.Hospital Unique ID',$unique_id)->get($this->bmi_app_col );
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID'])){
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID'], $unique_id);
			
			if($nlg_pos !== false){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID']));

				$new_id = $correct_id.$unique_cut;
				
				
				
		$doc['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID'] = $new_id;
		$doc['doc_data']['school_details']['District'] = $district;
		$doc['doc_data']['school_details']['School Name'] = $correct_school_name;
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->bmi_app_col  );
		//echo print_r($doc["_id"],true);
		//echo print_r($doc,true);
		//exit();
		}
		}
		}
		}*/
		
		/* $unique_id    = "TADB_2326_";
		 $correct_id   = "TADB_2328_";
		 //$email        = "tkmm.2112.";
		 //$new_email    = "tbdd.2112.";
		 
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$unique_id)->get($this->screening_app_col);
			foreach ($query as $doc){
			if(isset($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'])){
				$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'], $unique_id);
				
				if($nlg_pos !== false){
					$nlg_end = $nlg_pos + strlen ($unique_id);
					$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID']));
					log_message("debug","unique ------------------ beforeeeeeeeeeee--------".print_r($unique_cut,true));
					$new_id = $correct_id.$unique_cut;
					echo print_r($new_id,true);
					//exit();
					log_message("debug","unique ------------------ aftertttttttttttttttt--------".print_r($new_id,true));
			$doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'] = $new_id;
			$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
			}
			}
			}  
			*/
			/* //======================== request collection		
		
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Student Info.Unique ID',$unique_id)->get("healthcare2016108181933756");

		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']))
		{
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'], $unique_id);
			
			if($nlg_pos == 0){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']));
			
			$new_id = $correct_id.$unique_cut;
			echo print_r($new_id,true);
			//exit();
			$doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'] = $new_id;
		}
		}
		
		if(isset($doc['history'][0]['submitted_by'])){		
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail";
		}
		
		if(isset($doc['history']["last_stage"]['submitted_by'])){	
			$doc['history']["last_stage"]['submitted_by'] = $new_email."hs#gmail.com";
		}
		
		if($doc['doc_data']['user_name'] == $email."hs#gmail.com")
		{	
			$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		}
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare2016108181933756");
		}
		echo print_r($query,true);
		
		
		//shadow ==========================================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Student Info.Unique ID',$unique_id)->get("healthcare2016108181933756_shadow");

		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']))
		{
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'], $unique_id);
			
			if($nlg_pos == 0){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']));

				$new_id = $correct_id.$unique_cut;

		$doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'] = $new_id;
		}
		}
		
		if(isset($doc['history'][0]['submitted_by']) && ($doc['history'][0]['submitted_by'] == $email."hs#gmail.com")){		
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail";
		}
		
		if($doc['doc_data']['user_name'] == $email."hs#gmail.com")
		{	
			$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		}
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare2016108181933756_shadow");
		} */
			/*
			$school_id = 'tadb.2305.hs#gmail.com,tadb.2304.hs#gmail.com,tadb.2310.hs#gmail.com,tadb.2308.hs#gmail.com,tadb.2301.hs#gmail.com,tadb.2309.hs#gmail.com,tpdpl.1707.hs#gmail.com,tjgtl.1709.hs#gmail.com,tjgtl.1708.hs#gmail.com,tjskr.1701.hs#gmail.com,trjn.1703.hs#gmail.com,trjn.1704.hs#gmail.com,trjn.1702.hs#gmail.com,tbdd.2112.hs#gmail.com,tbdd.2110.hs#gmail.com,tbdd.2113.hs#gmail.com,tbdd.2111.hs#gmail.com,tbdd.2114.hs#gmail.com,tbdd.2106.hs#gmail.com,tbdd.2102.hs#gmail.com,tbdd.2107.hs#gmail.com,tbdd.2115.hs#gmail.com,tbdd.2109.hs#gmail.com,tbdd.2101.hs#gmail.com,tbdd.2108.hs#gmail.com,tjskr.2127.hs#gmail.com,tkmm.2126.hs#gmail.com,tmbnr.1405.hs#gmail.com,tngkl.1403.hs#gmail.com,tmbnr.1419.hs#gmail.com,twnpy.1402.hs#gmail.com,twnpy.1420.hs#gmail.com,tngkl.1415.hs#gmail.com,tngkl.1416.hs#gmail.com,tmbnr.1414.hs#gmail.com,tngkl.1417.hs#gmail.com,tmbnr.1404.hs#gmail.com,tngkl.1401.hs#gmail.com,tmdk.1612.hs#gmail.com,tsrd.1603.hs#gmail.com,tmdk.1602.hs#gmail.com,tnlg.1501.hs#gmail.com,tnlg.1515.hs#gmail.com,tnlg.1514.hs#gmail.com,tnlg.1517.hs#gmail.com,tnlg.1504.hs#gmail.com,tsrpt.1502.hs#gmail.com,tnlg.1505.hs#gmail.com,tnlg.1518.hs#gmail.com,tnlg.1503.hs#gmail.com,tnzd.2009.hs#gmail.com,tkmr.2008.hs#gmail.com,tkmr.2002.hs#gmail.com,tkmr.2001.hs#gmail.com,tvkrd.1801.hs#gmail.com,tmbnr.1807.hs#gmail.com,trr.1808.hs#gmail.com,tvkrd.1809.hs#gmail.com,tadb.2302.hs#gmail.com,tadb.2326.hs#gmail.com,tadb.2306.hs#gmail.com,tadb.2329.hs#gmail.com,tnml.2327.hs#gmail.com,tadb.2307.hs#gmail.com,tadb.2328.hs#gmail.com,tadb.2312.hs#gmail.com,tadb.2311.hs#gmail.com,tmdk.1610.hs#gmail.com,tmdk.1609.hs#gmail.com,tmdk.1611.hs#gmail.com,tmdk.1601.hs#gmail.com,tsrpt.1516.hs#gmail.com,trr.1810.hs#gmail.com,twglr.2208.hs#gmail.com,twglr.2202.hs#gmail.com,tkmm.2116.hs#gmail.com,tkmm.2128.hs#gmail.com,tkmm.2129.hs#gmail.com,tmbbd.2201.hs#gmail.com,tjskr.2203.hs#gmail.com,tjskr.2204.hs#gmail.com,tjskr.2211.hs#gmail.com,tmbbd.2219.hs#gmail.com,tmbbd.2207.hs#gmail.com,tmbbd.2206.hs#gmail.com,tmbbd.2223.hs#gmail.com,tmbbd.2205.hs#gmail.com,tmbbd.2220.hs#gmail.com,tjskr.2221.hs#gmail.com,tmbbd.2224.hs#gmail.com,twgl.2209.hs#gmail.com,twglu.2210.hs#gmail.com,tvkrd.1813.hs#gmail.com,tvkrd.1811.hs#gmail.com,trr.1814.hs#gmail.com,tadb.2330.hs#gmail.com,tadb.2331.hs#gmail.com,tadb.2332.hs#gmail.com,tadb.2336.hs#gmail.com,tadb.2335.hs#gmail.com,tkmm.2130.hs#gmail.com,tbdd.2131.hs#gmail.com,tkmm.2132.hs#gmail.com,tkmm.2133.hs#gmail.com,tbdd.2134.hs#gmail.com,tngkl.1422.hs#gmail.com,tmbnr.1423.hs#gmail.com,tvkrd.1425.hs#gmail.com,trr.1426.hs#gmail.com,tmbnr.1427.hs#gmail.com,tsrd.1613.hs#gmail.com,tsrd.1614.hs#gmail.com,tsrd.1615.hs#gmail.com,tsrd.1616.hs#gmail.com,tmdk.1617.hs#gmail.com,tmdk.1618.hs#gmail.com,tsrd.1619.hs#gmail.com,tmdk.1620.hs#gmail.com,tnlg.1520.hs#gmail.com,tnlg.1521.hs#gmail.com,tnlg.1522.hs#gmail.com,tnlg.1523.hs#gmail.com,tnlg.1524.hs#gmail.com,tsrpt.1525.hs#gmail.com,tjskr.1711.hs#gmail.com,tsdpt.1712.hs#gmail.com,trjn.1713.hs#gmail.com,tnzd.2011.hs#gmail.com,tnzd.2012.hs#gmail.com,tkmr.2013.hs#gmail.com,tkmr.2014.hs#gmail.com,tjskr.2225.hs#gmail.com,tmbbd.2226.hs#gmail.com,tmbbd.2227.hs#gmail.com,tjgn.2228.hs#gmail.com,twglr.2229.hs#gmail.com,twglu.2230.hs#gmail.com,tadb.2303.hs#gmail.com,twgl.1418.hs#gmail.com,trr.1812.hs#gmail.com,trjn.1714.hs#gmail.com,thyd.2401.hs#gmail.com,tsrpt.25437.hs#gmail.com,tkmr.2010.hs#gmail.com,tjskr.2222.hs#gmail.com,tkmr.2015.hs#gmail.com,tnml.2334.hs#gmail.com,trjn.2016.hs#gmail.com';
		$schoolObj = explode(",",$school_id); 
		
		foreach($schoolObj as $id){
			//================================================================== HS app evaluation-=======================================================
			$app_coll = $id."_apps";
			echo print_r($app_coll,true);
			$data = json_decode('{     "app_template" : {"pages" : {    "1" : {"Student Info" : {   "Unique ID" : {"type" : "retriever","order" : 1,"coll_ref" : "healthcare201671115519757","field_ref" : "page1_Personal Information_Hospital Unique ID","properties" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1,"notify" : "false","parent" : "retriever"},"retrieve_list" : ["page1_Personal Information_Name","page2_Personal Information_District","page2_Personal Information_School Name","page2_Personal Information_Class","page2_Personal Information_Section"]   },   "Name" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 2,"field_ref" : "page1_Personal Information_Name","properties" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "true","parent" : "mapper"}   },   "District" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 3,"field_ref" : "page2_Personal Information_District","properties" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false","parent" : "mapper"}   },   "School Name" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 4,"field_ref" : "page2_Personal Information_School Name","properties" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false","parent" : "mapper"}   },   "Class" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 5,"field_ref" : "page2_Personal Information_Class","properties" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false","parent" : "mapper"}   },   "Section" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 6,"field_ref" : "page2_Personal Information_Section","properties" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6,"notify" : "false","parent" : "mapper"}   },   "dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1   }},"Problem Info" : {   "Identifier" : {"type" : "checkbox","required" : "FALSE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{    "label" : "Bites",    "value" : "Bites"},{    "label" : "Body pains",    "value" : "Body pains"},{    "label" : "Breath less ness",    "value" : "Breath less ness"},{    "label" : "Burning micturition",    "value" : "Burning micturition"},{    "label" : "Burning sensation in the chest",    "value" : "Burning sensation in the chest"},{    "label" : "Chest pain",    "value" : "Chest pain"},{    "label" : "Chickenpox",    "value" : "Chickenpox"},{    "label" : "Cold",    "value" : "Cold"},{    "label" : "Constipation",    "value" : "Constipation"},{    "label" : "Cough",    "value" : "Cough"},{    "label" : "Cracks feet",    "value" : "Cracks feet"},{    "label" : "Cramps",    "value" : "Cramps"},{    "label" : "Defective hearing",    "value" : "Defective hearing"},{    "label" : "DeHydration",    "value" : "DeHydration"},{    "label" : "Delayed periods",    "value" : "Delayed periods"},{    "label" : "Dental periods",    "value" : "Dental periods"},{    "label" : "Dental problems",    "value" : "Dental problems"},{    "label" : "Diarrhea",    "value" : "Diarrhea"},{    "label" : "Discharge from ear",    "value" : "Discharge from ear"},{    "label" : "Dyspepsia",    "value" : "Dyspepsia"},{    "label" : "Ear pain",    "value" : "Ear pain"},{    "label" : "Fever",    "value" : "Fever"},{    "label" : "Frequent urination",    "value" : "Frequent urination"},{    "label" : "Headache",    "value" : "Headache"},{    "label" : "Indigestion",    "value" : "Indigestion"},{    "label" : "Irregular periods",    "value" : "Irregular periods"}]   },   "dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2   }}    },    "2" : {"Problem Info" : {   "Description" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"   },   "dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2   }},"Diagnosis Info" : {   "Doctor Summary" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1,"notify" : "false"   },   "Doctor Advice" : {"type" : "select","size" : "1","required" : "FALSE","key" : "TRUE","description" : "","option_choose_one" : "TRUE","with_translations" : "FALSE","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{    "text" : "Prescription",    "selected" : "TRUE",    "value" : "Prescription"},{    "text" : "Advice",    "selected" : "FALSE",    "value" : "Advice"},{    "text" : "Refer 2 Hospital",    "selected" : "FALSE",    "value" : "Refer 2 Hospital"}]   },   "Prescription" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"   },   "dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3   }},"Review Info" : {   "Request Type" : {"type" : "select","size" : "1","required" : "FALSE","key" : "TRUE","description" : "","option_choose_one" : "TRUE","with_translations" : "FALSE","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{    "text" : "Normal",    "selected" : "TRUE",    "value" : "Normal"},{    "text" : "Emergency",    "selected" : "FALSE",    "value" : "Emergency"},{    "text" : "Chronic",    "selected" : "FALSE",    "value" : "Chronic"}]   },   "Status" : {"type" : "select","size" : "1","required" : "FALSE","key" : "TRUE","description" : "","option_choose_one" : "TRUE","with_translations" : "FALSE","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{    "text" : "Initiated",    "selected" : "TRUE",    "value" : "Initiated"},{    "text" : "Prescribed",    "selected" : "FALSE",    "value" : "Prescribed"},{    "text" : "Under Medication",    "selected" : "FALSE",    "value" : "Under Medication"},{    "text" : "Follow-up",    "selected" : "FALSE",    "value" : "Follow-up"},{    "text" : "Cured",    "selected" : "FALSE",    "value" : "Cured"}]   },   "dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4   }}    }},"permissions" : {    "HS 1" : {"View_Permissions" : [   "Student Info",   "Problem Info",   "Diagnosis Info",   "Review Info"],"Edit_Permissions" : [   "Student Info",   "Problem Info",   "Review Info"],"index" : 1    },    "HS 2" : {"View_Permissions" : [   "Student Info",   "Problem Info",   "Diagnosis Info",   "Review Info"],"Edit_Permissions" : [   "Student Info",   "Problem Info",   "Review Info"],"index" : 3    }},"notification_parameters" : [    {"field" : "Name","page" : "1","section" : "Student Info"    }],"application_header" : {    "header_details" : {"companyname" : "TTWREIS","address" : "401s,secbad,india","logo" : "./uploaddir/public/app_header/healthcare2016108181933756.png"    }}     },     "app_id" : "healthcare2016108181933756",     "app_description" : "For TTWREIS",     "status" : "processed",     "app_name" : "Health Supervisor Request App",     "app_created" : "2016-10-08 14:12:06",     "app_expiry" : "2019-09-12",     "_version" : 1,     "stages" : ["HS 1","Doctor","HS 2"     ],     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			//echo print_r($data,true);
			//exit();
			$this->mongo_db->insert ( $app_coll, $data );
			
			
			$app_coll = $id."_applist";
			$data = json_decode('{"app_id" : "healthcare2016108181933756","app_description" : "For TTWREIS","app_name" : "Health Supervisor Request App", "app_created" : "2016-10-08 14:12:06"}',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ( $app_coll, $data );
			
			$app_coll = $id."_web_apps";
			$data = json_decode('{"permissions" : {"HS 1" : {"View_Permissions" : [    "Student Info",    "Problem Info",    "Diagnosis Info",    "Review Info"],"Edit_Permissions" : [    "Student Info",    "Problem Info",    "Review Info"],"index" : 1}     },     "app_id" : "healthcare2016108181933756",     "app_description" : "For TTWREIS",     "status" : "new",     "app_name" : "Health Supervisor Request App",     "app_created" : "2016-10-08 14:12:06",     "app_expiry" : "2019-09-12",     "application_header" : {"header_details" : {"companyname" : "TTWREIS","address" : "401s,secbad,india","logo" : "./uploaddir/public/app_header/healthcare2016108181933756.png"}     },     "_version" : 1,     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			$this->mongo_db->insert ($app_coll,$data);
			//====================================================================================================================================
			
			//==================================================================== Attendence app  ===============================================
			
			$app_coll = $id."_apps";
			$data = json_decode('{"app_template" : { "pages" : {"1" : {"Attendence Details" : {"District" : {"type" : "select","size" : "1","required" : "TRUE","key" : "TRUE","description" : "","option_choose_one" : "TRUE","with_translations" : "FALSE","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{"text" : "ADILABAD","selected" : "TRUE","value" : "ADILABAD"},{"text" : "BHADRADRI","selected" : "FALSE","value" : "BHADRADRI"},{"text" : "GADWAL","selected" : "FALSE","value" : "GADWAL"},{"text" : "HYDERABAD","selected" : "FALSE","value" : "HYDERABAD"},{"text" : "JAGTIAL","selected" : "FALSE","value" : "JAGTIAL"},{"text" : "JANGOAN","selected" : "FALSE","value" : "JANGOAN"},{"text" : "JAYASHANKAR","selected" : "FALSE","value" : "JAYASHANKAR"},{"text" : "KAMAREDDY","selected" : "FALSE","value" : "KAMAREDDY"},{"text" : "KARIMNAGAR","selected" : "FALSE","value" : "KARIMNAGAR"},{"text" : "KHAMMAM","selected" : "FALSE","value" : "KHAMMAM"},{"text" : "KOMARAM BHEEM","selected" : "FALSE","value" : "KOMARAM BHEEM"},{"text" : "MAHABUBNAGAR","selected" : "FALSE","value" : "MAHABUBNAGAR"},{"text" : "MAHABOOBABAD","selected" : "FALSE","value" : "MAHABOOBABAD"},{"text" : "MANCHERIAL","selected" : "FALSE","value" : "MANCHERIAL"},{"text" : "MEDAK","selected" : "FALSE","value" : "MEDAK"},{"text" : "MEDCHAL","selected" : "FALSE","value" : "MEDCHAL"},{"text" : "NAGARKURNOOL","selected" : "FALSE","value" : "NAGARKURNOOL"},{"text" : "NALGONDA","selected" : "FALSE","value" : "NALGONDA"},{"text" : "NIRMAL","selected" : "FALSE","value" : "NIRMAL"},{"text" : "NIZAMABAD","selected" : "FALSE","value" : "NIZAMABAD"},{"text" : "PEDDAPALLY","selected" : "FALSE","value" : "PEDDAPALLY"},{"text" : "RAJANNA","selected" : "FALSE","value" : "RAJANNA"},{"text" : "RANGAREDDY","selected" : "FALSE","value" : "RANGAREDDY"},{"text" : "SANGAREDDY","selected" : "FALSE","value" : "SANGAREDDY"},{"text" : "SIDDIPET","selected" : "FALSE","value" : "SIDDIPET"},{"text" : "SURYAPET","selected" : "FALSE","value" : "SURYAPET"},{"text" : "VIKARABAD","selected" : "FALSE","value" : "VIKARABAD"},{"text" : "WANAPARTHY","selected" : "FALSE","value" : "WANAPARTHY"},{"text" : "WARANGAL","selected" : "FALSE","value" : "WARANGAL"},{"text" : "WARANGAL RURAL","selected" : "FALSE","value" : "WARANGAL RURAL"},{"text" : "WARANGAL URBAN","selected" : "FALSE","value" : "WARANGAL URBAN"},{"text" : "YADADRI","selected" : "FALSE","value" : "YADADRI"}]},"Select School" : {"type" : "select","size" : "1","required" : "TRUE","key" : "TRUE","description" : "","option_choose_one" : "TRUE","with_translations" : "FALSE","order" : 2,"multilanguage" : "FALSE","notify" : "true","options" : [{"text" : "TTWREIS ADILABAD(B),ADILABAD","selected" : "TRUE","value" : "TTWREIS ADILABAD(B),ADILABAD"},{"text" : "TTWREIS ADILABAD(RJC-B),ADILABAD","selected" : "FALSE","value" : "TTWREIS ADILABAD(RJC-B),ADILABAD"},{"text" : "TTWREIS ASIFABAD(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS ASIFABAD(G),ADILABAD"},{"text" : "TTWREIS ASIFABAD(RJC-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS ASIFABAD(RJC-G),ADILABAD"},{"text" : "TTWREIS BELA(MG-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS BELA(MG-G),ADILABAD"},{"text" : "TTWREIS BUGGARAM(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS BUGGARAM(G),ADILABAD"},{"text" : "TTWREIS ECHODA(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS ECHODA(G),ADILABAD"},{"text" : "TTWREIS ECHODA(B),ADILABAD","selected" : "FALSE","value" : "TTWREIS ECHODA(B),ADILABAD"},{"text" : "TTWREIS ECHODA(RJC-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS ECHODA(RJC-G),ADILABAD"},{"text" : "TTWREIS INDRAVALLI(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS INDRAVALLI(G),ADILABAD"},{"text" : "TTWREIS JANIOOR(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS JANIOOR(G),ADILABAD"},{"text" : "TTWREIS KERAMERI(B),ADILABAD","selected" : "FALSE","value" : "TTWREIS KERAMERI(B),ADILABAD"},{"text" : "TTWREIS LOKARI(MG-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS LOKARI(MG-G),ADILABAD"},{"text" : "TTWREIS MAMDA(MG-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS MAMDA(MG-G),ADILABAD"},{"text" : "TTWREIS NARNOOR(RJC-B),ADILABAD","selected" : "FALSE","value" : "TTWREIS NARNOOR(RJC-B),ADILABAD"},{"text" : "TTWREIS NEREDIGUNDA(MG-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS NEREDIGUNDA(MG-G),ADILABAD"},{"text" : "TTWREIS SIRPUR(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS SIRPUR(G),ADILABAD"},{"text" : "TTWREIS TIRYANI(G),ADILABAD","selected" : "FALSE","value" : "TTWREIS TIRYANI(G),ADILABAD"},{"text" : "TTWREIS UTNOOR(B),ADILABAD","selected" : "FALSE","value" : "TTWREIS UTNOOR(B),ADILABAD"},{"text" : "TTWREIS UTNOOR(RJC-G),ADILABAD","selected" : "FALSE","value" : "TTWREIS UTNOOR(RJC-G),ADILABAD"},{"text" : "TTWREIS UTNOOR(RJC-B),ADILABAD","selected" : "FALSE","value" : "TTWREIS UTNOOR(RJC-B),ADILABAD"},{"text" : "TTWREIS ANKAMPALEM(RJC-G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS ANKAMPALEM(RJC-G),BHADRADRI"},{"text" : "TTWREIS BHADRACHALAM(G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS BHADRACHALAM(G),BHADRADRI"},{"text" : "TTWREIS BHADRACHALAM(RJC-G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS BHADRACHALAM(RJC-G),BHADRADRI"},{"text" : "TTWREIS DAMMAPETA(B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS DAMMAPETA(B),BHADRADRI"},{"text" : "TTWREIS DAMMAPETA(RJC-B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS DAMMAPETA(RJC-B),BHADRADRI"},{"text" : "TTWREIS GUNDALA(B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS GUNDALA(B),BHADRADRI"},{"text" : "TTWREIS GUNDALA(RJC-B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS GUNDALA(RJC-B),BHADRADRI"},{"text" : "TTWREIS K.S.D.SITE(B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS K.S.D.SITE(B),BHADRADRI"},{"text" : "TTWREIS K.S.D.SITE(RJC-B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS K.S.D.SITE(RJC-B),BHADRADRI"},{"text" : "TTWREIS KOTHAGUDEM(G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS KOTHAGUDEM(G),BHADRADRI"},{"text" : "TTWREIS KRISHNASAGAR(RJC-B),BHADRADRI","selected" : "FALSE","value" : "TTWREIS KRISHNASAGAR(RJC-B),BHADRADRI"},{"text" : "TTWREIS MANUGURU(G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS MANUGURU(G),BHADRADRI"},{"text" : "TTWREIS SUDIMALLA(G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS SUDIMALLA(G),BHADRADRI"},{"text" : "TTWREIS SUDIMALLA(RJC-G),BHADRADRI","selected" : "FALSE","value" : "TTWREIS SUDIMALLA(RJC-G),BHADRADRI"},{"text" : "TTWREIS JANGAMMET(G),HYDERABAD","selected" : "FALSE","value" : "TTWREIS JANGAMMET(G),HYDERABAD"},{"text" : "TTWREIS MALLAPUR(MG-G),JAGTIAL","selected" : "FALSE","value" : "TTWREIS MALLAPUR(MG-G),JAGTIAL"},{"text" : "TTWREIS ODDILINGAPUR(MG-G),JAGTIAL","selected" : "FALSE","value" : "TTWREIS ODDILINGAPUR(MG-G),JAGTIAL"},{"text" : "TTWREIS PALAKURTHY(G),JANGOAN","selected" : "FALSE","value" : "TTWREIS PALAKURTHY(G),JANGOAN"},{"text" : "TTWREIS ETURUNAGARAM(B),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS ETURUNAGARAM(B),JAYASHANKAR"},{"text" : "TTWREIS ETURUNAGARAM(RJC-B),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS ETURUNAGARAM(RJC-B),JAYASHANKAR"},{"text" : "TTWREIS ETURUNAGARAM(RJC-G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS ETURUNAGARAM(RJC-G),JAYASHANKAR"},{"text" : "TTWREIS KATARAM(B),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS KATARAM(B),JAYASHANKAR"},{"text" : "TTWREIS KATARAM(G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS KATARAM(G),JAYASHANKAR"},{"text" : "TTWREIS MULUGU(B),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS MULUGU(B),JAYASHANKAR"},{"text" : "TTWREIS MULUGU(MG-G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS MULUGU(MG-G),JAYASHANKAR"},{"text" : "TTWREIS POCHAMPUR(MG-G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS POCHAMPUR(MG-G),JAYASHANKAR"},{"text" : "TTWREIS WAZEEDU(MG-G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS WAZEEDU(MG-G),JAYASHANKAR"},{"text" : "TTWREIS WYRA(G),JAYASHANKAR","selected" : "FALSE","value" : "TTWREIS WYRA(G),JAYASHANKAR"},{"text" : "TTWREIS BANSWADA(B),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS BANSWADA(B),KAMAREDDY"},{"text" : "TTWREIS GANDHARI(B),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS GANDHARI(B),KAMAREDDY"},{"text" : "TTWREIS GANDHARI(RJC-B),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS GANDHARI(RJC-B),KAMAREDDY"},{"text" : "TTWREIS MACHAREDDY(MG-G),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS MACHAREDDY(MG-G),KAMAREDDY"},{"text" : "TTWREIS NAGIREDDYPET(B),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS NAGIREDDYPET(B),KAMAREDDY"},{"text" : "TTWREIS NACHUPALLY(MG-G),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS NACHUPALLY(MG-G),KAMAREDDY"},{"text" : "TTWREIS YELLAREDDY(G),KAMAREDDY","selected" : "FALSE","value" : "TTWREIS YELLAREDDY(G),KAMAREDDY"},{"text" : "TTWREIS ANAPREDDYPALLI(G),KHAMMAM","selected" : "FALSE","value" : "TTWREIS ANAPREDDYPALLI(G),KHAMMAM"},{"text" : "TTWREIS KANIKALA(B),KHAMMAM","selected" : "FALSE","value" : "TTWREIS KANIKALA(B),KHAMMAM"},{"text" : "TTWREIS KANIKALA(RJC-B),KHAMMAM","selected" : "FALSE","value" : "TTWREIS KANIKALA(RJC-B),KHAMMAM"},{"text" : "TTWREIS PINAPAKA(MG-G),KHAMMAM","selected" : "FALSE","value" : "TTWREIS PINAPAKA(MG-G),KHAMMAM"},{"text" : "TTWREIS SINGARENI(B),KHAMMAM","selected" : "FALSE","value" : "TTWREIS SINGARENI(B),KHAMMAM"},{"text" : "TTWREIS THIRUMALAYAPALEM(B),KHAMMAM","selected" : "FALSE","value" : "TTWREIS THIRUMALAYAPALEM(B),KHAMMAM"},{"text" : "TTWREIS BALANAGAR(B),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS BALANAGAR(B),MAHABUBNAGAR"},{"text" : "TTWREIS GANDEED(MG-G),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS GANDEED(MG-G),MAHABUBNAGAR"},{"text" : "TTWREIS JADCHERLA(G),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS JADCHERLA(G),MAHABUBNAGAR"},{"text" : "TTWREIS JADCHERLA(MG-G),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS JADCHERLA(MG-G),MAHABUBNAGAR"},{"text" : "TTWREIS KONDAPUR(B),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS KONDAPUR(B),MAHABUBNAGAR"},{"text" : "TTWREIS MAHABUBNAGAR(G),MAHABUBNAGAR","selected" : "FALSE","value" : "TTWREIS MAHABUBNAGAR(G),MAHABUBNAGAR"},{"text" : "TTWREIS DAMARAVANCHA(B),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS DAMARAVANCHA(B),MAHABOOBABAD"},{"text" : "TTWREIS GOVINDAPUR(MG-G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS GOVINDAPUR(MG-G),MAHABOOBABAD"},{"text" : "TTWREIS KURAVI(G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS KURAVI(G),MAHABOOBABAD"},{"text" : "TTWREIS KOTHAGUDA(G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS KOTHAGUDA(G),MAHABOOBABAD"},{"text" : "TTWREIS KURAVI(RJC-G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS KURAVI(RJC-G),MAHABOOBABAD"},{"text" : "TTWREIS KESAMUDRAM(G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS KESAMUDRAM(G),MAHABOOBABAD"},{"text" : "TTWREIS MARRIPEDA(B),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS MARRIPEDA(B),MAHABOOBABAD"},{"text" : "TTWREIS MAHABUBABAD(B),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS MAHABUBABAD(B),MAHABOOBABAD"},{"text" : "TTWREIS MARRIPEDA(MG-G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS MARRIPEDA(MG-G),MAHABOOBABAD"},{"text" : "TTWREIS SEEROLU(G),MAHABOOBABAD","selected" : "FALSE","value" : "TTWREIS SEEROLU(G),MAHABOOBABAD"},{"text" : "TTWREIS CHEGUNTA(G),MEDAK","selected" : "FALSE","value" : "TTWREIS CHEGUNTA(G),MEDAK"},{"text" : "TTWREIS KALHER(MG-G),MEDAK","selected" : "FALSE","value" : "TTWREIS KALHER(MG-G),MEDAK"},{"text" : "TTWREIS KOWDIPALLY(B),MEDAK","selected" : "FALSE","value" : "TTWREIS KOWDIPALLY(B),MEDAK"},{"text" : "TTWREIS KOWDIPALLY(MG-G),MEDAK","selected" : "FALSE","value" : "TTWREIS KOWDIPALLY(MG-G),MEDAK"},{"text" : "TTWREIS MEDAK(G),MEDAK","selected" : "FALSE","value" : "TTWREIS MEDAK(G),MEDAK"},{"text" : "TTWREIS MEDAK(MG-G),MEDAK","selected" : "FALSE","value" : "TTWREIS MEDAK(MG-G),MEDAK"},{"text" : "TTWREIS NARSAPUR(B),MEDAK","selected" : "FALSE","value" : "TTWREIS NARSAPUR(B),MEDAK"},{"text" : "TTWREIS NARSAPUR(G),MEDAK","selected" : "FALSE","value" : "TTWREIS NARSAPUR(G),MEDAK"},{"text" : "TTWREIS NARSAPUR(RJC-B),MEDAK","selected" : "FALSE","value" : "TTWREIS NARSAPUR(RJC-B),MEDAK"},{"text" : "TTWREIS ACHAMPET(G),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS ACHAMPET(G),NAGARKURNOOL"},{"text" : "TTWREIS AMRABAD(MG-G),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS AMRABAD(MG-G),NAGARKURNOOL"},{"text" : "TTWREIS BEJINEPALLY(MG-G),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS BEJINEPALLY(MG-G),NAGARKURNOOL"},{"text" : "TTWREIS KALWAKURTHY(G),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS KALWAKURTHY(G),NAGARKURNOOL"},{"text" : "TTWREIS LINGALA(MG-G),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS LINGALA(MG-G),NAGARKURNOOL"},{"text" : "TTWREIS MANNANOOR(B),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS MANNANOOR(B),NAGARKURNOOL"},{"text" : "TTWREIS MANNANOOR(RJC-B),NAGARKURNOOL","selected" : "FALSE","value" : "TTWREIS MANNANOOR(RJC-B),NAGARKURNOOL"},{"text" : "TTWREIS CHANDAMPETA(MG-G),NALGONDA","selected" : "FALSE","value" : "TTWREIS CHANDAMPETA(MG-G),NALGONDA"},{"text" : "TTWREIS DAMARACHERLA(B),NALGONDA","selected" : "FALSE","value" : "TTWREIS DAMARACHERLA(B),NALGONDA"},{"text" : "TTWREIS DAMARACHERLA(G),NALGONDA","selected" : "FALSE","value" : "TTWREIS DAMARACHERLA(G),NALGONDA"},{"text" : "TTWREIS DAMARACHERLA(RJC-G),NALGONDA","selected" : "FALSE","value" : "TTWREIS DAMARACHERLA(RJC-G),NALGONDA"},{"text" : "TTWREIS DEVARAKONDA(G),NALGONDA","selected" : "FALSE","value" : "TTWREIS DEVARAKONDA(G),NALGONDA"},{"text" : "TTWREIS DEVARAKONDA(B),NALGONDA","selected" : "FALSE","value" : "TTWREIS DEVARAKONDA(B),NALGONDA"},{"text" : "TTWREIS KONDAMALLEPALLY(G),NALGONDA","selected" : "FALSE","value" : "TTWREIS KONDAMALLEPALLY(G),NALGONDA"},{"text" : "TTWREIS MIRYALAGUDA(B),NALGONDA","selected" : "FALSE","value" : "TTWREIS MIRYALAGUDA(B),NALGONDA"},{"text" : "TTWREIS MIRYALAGUDA(G),NALGONDA","selected" : "FALSE","value" : "TTWREIS MIRYALAGUDA(G),NALGONDA"},{"text" : "TTWREIS MIRYALGUDA(RJC-B),NALGONDA","selected" : "FALSE","value" : "TTWREIS MIRYALGUDA(RJC-B),NALGONDA"},{"text" : "TTWREIS PEDAVURA(MG-G),NALGONDA","selected" : "FALSE","value" : "TTWREIS PEDAVURA(MG-G),NALGONDA"},{"text" : "TTWREIS PEDDAVOORA(B),NALGONDA","selected" : "FALSE","value" : "TTWREIS PEDDAVOORA(B),NALGONDA"},{"text" : "TTWREIS TRIPURARAM(MG-G),NALGONDA","selected" : "FALSE","value" : "TTWREIS TRIPURARAM(MG-G),NALGONDA"},{"text" : "TTWREIS BHAINSA(G),NIRMAL","selected" : "FALSE","value" : "TTWREIS BHAINSA(G),NIRMAL"},{"text" : "TTWREIS CHEEMANPALLY(B),NIZAMABAD","selected" : "FALSE","value" : "TTWREIS CHEEMANPALLY(B),NIZAMABAD"},{"text" : "TTWREIS INDALVAI(G),NIZAMABAD","selected" : "FALSE","value" : "TTWREIS INDALVAI(G),NIZAMABAD"},{"text" : "TTWREIS MAKLOOR(MG-G),NIZAMABAD","selected" : "FALSE","value" : "TTWREIS MAKLOOR(MG-G),NIZAMABAD"},{"text" : "TTWREIS DHARMARAM(MG-G),PEDDAPALLY","selected" : "FALSE","value" : "TTWREIS DHARMARAM(MG-G),PEDDAPALLY"},{"text" : "TTWREIS BALANAGAR(RJC-B),RAJANNA","selected" : "FALSE","value" : "TTWREIS BALANAGAR(RJC-B),RAJANNA"},{"text" : "TTWREIS MARRIMADLA(B),RAJANNA","selected" : "FALSE","value" : "TTWREIS MARRIMADLA(B),RAJANNA"},{"text" : "TTWREIS MARRIMADLA(RJC-B),RAJANNA","selected" : "FALSE","value" : "TTWREIS MARRIMADLA(RJC-B),RAJANNA"},{"text" : "TTWREIS MANALA(G),RAJANNA","selected" : "FALSE","value" : "TTWREIS MANALA(G),RAJANNA"},{"text" : "TTWREIS SIRICILLA TOWN(G),RAJANNA","selected" : "FALSE","value" : "TTWREIS SIRICILLA TOWN(G),RAJANNA"},{"text" : "TTWREIS YELLAREDDYPETA(G),RAJANNA","selected" : "FALSE","value" : "TTWREIS YELLAREDDYPETA(G),RAJANNA"},{"text" : "TTWREIS YELLAREDDYPETA(RJC-G),RAJANNA","selected" : "FALSE","value" : "TTWREIS YELLAREDDYPETA(RJC-G),RAJANNA"},{"text" : "TTWREIS IBRAHIMPATNAM(B),RANGAREDDY","selected" : "FALSE","value" : "TTWREIS IBRAHIMPATNAM(B),RANGAREDDY"},{"text" : "TTWREIS IIT RAJENDRANAGAR(B),RANGAREDDY","selected" : "FALSE","value" : "TTWREIS IIT RAJENDRANAGAR(B),RANGAREDDY"},{"text" : "TTWREIS KOTHUR(B),RANGAREDDY","selected" : "FALSE","value" : "TTWREIS KOTHUR(B),RANGAREDDY"},{"text" : "TTWREIS KANDUKUR(B),RANGAREDDY","selected" : "FALSE","value" : "TTWREIS KANDUKUR(B),RANGAREDDY"},{"text" : "TTWREIS RANGAPUR(MG-G),RANGAREDDY","selected" : "FALSE","value" : "TTWREIS RANGAPUR(MG-G),RANGAREDDY"},{"text" : "TTWREIS JINNARAM(B),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS JINNARAM(B),SANGAREDDY"},{"text" : "TTWREIS KALHER(G),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS KALHER(G),SANGAREDDY"},{"text" : "TTWREIS KANGTI(B),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS KANGTI(B),SANGAREDDY"},{"text" : "TTWREIS MANUR(G),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS MANUR(G),SANGAREDDY"},{"text" : "TTWREIS NARAYANKHED(B),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS NARAYANKHED(B),SANGAREDDY"},{"text" : "TTWREIS ZAHEERABAD(G),SANGAREDDY","selected" : "FALSE","value" : "TTWREIS ZAHEERABAD(G),SANGAREDDY"},{"text" : "TTWREIS HUSNABAD(B),SIDDIPET","selected" : "FALSE","value" : "TTWREIS HUSNABAD(B),SIDDIPET"},{"text" : "TTWREIS CHIVVEMLA(G),SURYAPET","selected" : "FALSE","value" : "TTWREIS CHIVVEMLA(G),SURYAPET"},{"text" : "TTWREIS CHIVVEMLA(MG-G),SURYAPET","selected" : "FALSE","value" : "TTWREIS CHIVVEMLA(MG-G),SURYAPET"},{"text" : "TTWREIS THUNGATHURTHY(G),SURYAPET","selected" : "FALSE","value" : "TTWREIS THUNGATHURTHY(G),SURYAPET"},{"text" : "TTWREIS THUNGATHURTHY(RJC-G),SURYAPET","selected" : "FALSE","value" : "TTWREIS THUNGATHURTHY(RJC-G),SURYAPET"},{"text" : "TTWREIS KODANGAL(B),VIKARABAD","selected" : "FALSE","value" : "TTWREIS KODANGAL(B),VIKARABAD"},{"text" : "TTWREIS KULAKACHERLA(B),VIKARABAD","selected" : "FALSE","value" : "TTWREIS KULAKACHERLA(B),VIKARABAD"},{"text" : "TTWREIS KULAKACHERLA(RJC-B),VIKARABAD","selected" : "FALSE","value" : "TTWREIS KULAKACHERLA(RJC-B),VIKARABAD"},{"text" : "TTWREIS PARGI(G),VIKARABAD","selected" : "FALSE","value" : "TTWREIS PARGI(G),VIKARABAD"},{"text" : "TTWREIS TANDUR(G),VIKARABAD","selected" : "FALSE","value" : "TTWREIS TANDUR(G),VIKARABAD"},{"text" : "TTWREIS PEDDAMANDADI(B),WANAPARTHY","selected" : "FALSE","value" : "TTWREIS PEDDAMANDADI(B),WANAPARTHY"},{"text" : "TTWREIS WANAPARTHY(G),WANAPARTHY","selected" : "FALSE","value" : "TTWREIS WANAPARTHY(G),WANAPARTHY"},{"text" : "TTWREIS YAKUBPURA(B),WARANGAL","selected" : "FALSE","value" : "TTWREIS YAKUBPURA(B),WARANGAL"},{"text" : "TTWREIS ASHOKNAGAR(B),WARANGAL RURAL","selected" : "FALSE","value" : "TTWREIS ASHOKNAGAR(B),WARANGAL RURAL"},{"text" : "TTWREIS ASHOKNAGAR(RJC-B),WARANGAL RURAL","selected" : "FALSE","value" : "TTWREIS ASHOKNAGAR(RJC-B),WARANGAL RURAL"},{"text" : "TTWREIS PARVATHAGIR(G),WARANGAL RURAL","selected" : "FALSE","value" : "TTWREIS PARVATHAGIR(G),WARANGAL RURAL"},{"text" : "TTWREIS HANAMKONDA(G),WARANGAL URBAN","selected" : "FALSE","value" : "TTWREIS HANAMKONDA(G),WARANGAL URBAN"},{"text" : "TTWREIS WARANGAL(CO),WARANGAL URBAN","selected" : "FALSE","value" : "TTWREIS WARANGAL(CO),WARANGAL URBAN"}]},"Attended" : {"type" : "number","minlength" : "1","maxlength" : "3","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Sick" : {"type" : "number","minlength" : "1","maxlength" : "3","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"Sick UID" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false"},"R2H" : {"type" : "number","minlength" : "1","maxlength" : "3","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6,"notify" : "false"},"R2H UID" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 7,"notify" : "false"},"Absent" : {"type" : "number","minlength" : "1","maxlength" : "3","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 8,"notify" : "false"},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1}}},"2" : {"Attendence Details" : {"Absent UID" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 9,"notify" : "false"},"RestRoom" : {"type" : "number","minlength" : "1","maxlength" : "3","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 10,"notify" : "false"},"RestRoom UID" : {"type" : "textarea","minlength" : "1","maxlength" : "123","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 11,"notify" : "false"},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1}}}         },         "permissions" : {"HS 1" : {"View_Permissions" : ["Attendence Details"],"Edit_Permissions" : ["Attendence Details"],"index" : 1}         },         "notification_parameters" : [{"field" : "Select School","page" : "1","section" : "Attendence Details"}         ],         "application_header" : {"header_details" : {"companyname" : "Healthcare","address" : "401s,secbad,india","logo" : ""}         }     },     "app_id" : "healthcare20161015173311279",     "app_description" : "For TTWREIS",     "status" : "new",     "app_name" : "Attendence App",     "app_created" : "2016-11-01 09:15:55",     "app_expiry" : "2019-09-18",     "_version" : 7,     "stages" : [         "HS 1"     ],     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ( $app_coll, $data );
			
			$app_coll = $id."_applist";
			$data = json_decode('{ "app_id" : "healthcare20161015173311279","app_description" : "For TTWREIS","app_name" : "Attendance App",  "app_created" : "2016-10-15 13:48:37"}',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ($app_coll, $data);
			
			$app_coll = $id."_web_apps";
			$data = json_decode('{ "permissions" : {"HS 1" : {"View_Permissions" : [    "Attendence Details"],"Edit_Permissions" : [    "Attendence Details"],"index" : 1 }     },     "app_id" : "healthcare20161015173311279",     "app_description" : "For TTWREIS",     "status" : "new",     "app_name" : "Attendence App",     "app_created" : "2016-11-01 09:15:55",     "app_expiry" : "2019-09-18",     "application_header" : {         "header_details" : {"companyname" : "Healthcare","address" : "401s,secbad,india","logo" : "" }     },     "_version" : 7,     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			$this->mongo_db->insert ($app_coll,$data);
			
			//==================================================================== Sanitation app ===============================================
			
			$app_coll = $id."_apps";
			$data = json_decode('{     "app_template" : {         "pages" : {             "1" : {"Hand Wash" : {"Hand sanitizers/soap used" : {"type" : "radio","required" : "TRUE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "true","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1}},"Kitchen" : {"Food stored and served with tight containers" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"Availabilities of storage of perishable products" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2}}             },             "2" : {"Cleanliness" : {"Dormitories" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Kitchen" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Dining Halls" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 3,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Class Rooms" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 4,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Sick Rooms" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 5,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Staff Rooms" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 6,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3}}             },             "3" : {"Cleanliness" : {"Water Tanks" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 7,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Dust Bins" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 8,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Toilets" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 9,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"Kitchen Utensils" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 10,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Once","value" : "Once"},{"label" : "Twice","value" : "Twice"},{"label" : "Thrice","value" : "Thrice"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3}},"Food" : {"Food prepared according to the days menu" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"Kitchen staff wears gloves ans caps while serving" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"Every meal is tasted by a staff members before serving" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 3,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4}}             },             "4" : {"Waste Management" : {"Separate dumping of Inorganic waste" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"Separate dumping of Organic waste" : {"type" : "radio","required" : "FALSE","key" : "TRUE","description" : "","order" : 2,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5}},"Declaration Information" : {"Declaration:" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "I here by declare i would render all the responsibilities as mentioned above","description" : "","multilanguage" : "FALSE","order" : 1},"Place:" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Date:" : {"type" : "date","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"newline4" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 4},"Signature:" : {"type" : "text","minlength" : "","maxlength" : "","required" : "FALSE","key" : "FALSE","description" : "","multilanguage" : "FALSE","order" : 5},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6}}             }         },         "permissions" : {             "Stage Name1" : {"View_Permissions" : ["Hand Wash","Kitchen","Cleanliness","Food","Waste Management","Declaration Information"],"Edit_Permissions" : ["Hand Wash","Kitchen","Cleanliness","Food","Waste Management","Declaration Information"],"index" : 1             }         },         "notification_parameters" : [             {"field" : "Hand sanitizers/soap used","page" : "1","section" : "Hand Wash"             }         ],         "application_header" : {             "header_details" : {"companyname" : "Healthcare","address" : "401s,secbad,india","logo" : ""             }         }     },     "app_id" : "healthcare20171211809800",     "app_description" : "TTWREIS Sanitation report",     "status" : "new",     "app_name" : "Sanitation Report",     "app_created" : "2017-01-21 12:30:37",     "app_expiry" : "2020-06-19",     "_version" : 1,     "stages" : [         "Stage Name1"     ],     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ( $app_coll, $data );
			
			$app_coll = $id."_applist";
			$data = json_decode('{   "app_id" : "healthcare20171211809800",    "app_description" : "TTWREIS Sanitation report",    "app_name" : "Sanitation Report",    "app_created" : "2017-01-21 12:30:37"}',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ($app_coll, $data);
			
			$app_coll = $id."_web_apps";
			$data = json_decode('{       "permissions" : {"Stage Name1" : {    "View_Permissions" : [        "Hand Wash",        "Kitchen",        "Cleanliness",        "Food",        "Waste Management",        "Declaration Information"    ],    "Edit_Permissions" : [        "Hand Wash",        "Kitchen",        "Cleanliness",        "Food",        "Waste Management",        "Declaration Information"    ],    "index" : 1}     },     "app_id" : "healthcare20171211809800",     "app_description" : "TTWREIS Sanitation report",     "status" : "new",     "app_name" : "Sanitation Report",     "app_created" : "2017-01-21 12:30:37",     "app_expiry" : "2020-06-19",     "application_header" : {"header_details" : {    "companyname" : "Healthcare",    "address" : "401s,secbad,india",    "logo" : ""}     },     "_version" : 1,     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			$this->mongo_db->insert ($app_coll,$data);
			
			//==================================================================== Sanitation infrastructure app ===============================================
			
			$app_coll = $id."_apps";
			$data = json_decode('{     "app_template" : {         "pages" : {             "1" : {                 "Dormitories" : {"Separate Dormitory" : {"type" : "radio","required" : "TRUE","key" : "TRUE","description" : "","order" : 1,"multilanguage" : "FALSE","notify" : "true","options" : [{"label" : "Yes","value" : "Yes"},{"label" : "No","value" : "No"}]},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1}                 },                 "Toilets" : {"Water Source" : {"type" : "text","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1,"notify" : "false"},"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "in numbers","description" : "","multilanguage" : "FALSE","order" : 2},"Buckets" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Mugs" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"Dust Bins" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false"},"Soap" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6,"notify" : "false"},"Incinerator" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 7,"notify" : "false"},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2}                 }             },             "2" : {                 "Hand Wash" : {"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "in numbers","description" : "","multilanguage" : "FALSE","order" : 1},"Dining Halls" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Kitchen" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Class Rooms" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"Dormitories" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false"},"Kitchen consists of" : {"type" : "checkbox","required" : "FALSE","key" : "TRUE","description" : "","order" : 6,"multilanguage" : "FALSE","notify" : "false","options" : [{"label" : "Gas facility","value" : "Gas facility"},{"label" : "Kerosene Stove","value" : "Kerosene Stove"},{"label" : "Made on wood","value" : "Made on wood"}]},"newline7" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 7},"newline8" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 8},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3}                 }             },             "3" : {                 "Waste Management" : {"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "Disposable Bins (in numbers)","description" : "","multilanguage" : "FALSE","order" : 1},"Dining Halls" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Kitchen" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Class Rooms" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"Dormitories" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false"},"newline6" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 6},"newline7" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 7},"newline8" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 8},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4}                 }             },             "4" : {                 "Water Facility" : {"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "Availability of Water in Toiltes (in numbers)","description" : "","multilanguage" : "FALSE","order" : 1},"Dining Halls" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Kitchen" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Class Rooms" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"Dormitories" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "false"},"Running water(number of taps)" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6,"notify" : "false"},"Store water" : {"type" : "number","minlength" : "1","maxlength" : "123","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 7,"notify" : "false"},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5}                 }             },             "5" : {                 "Dining Hall" : {"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "Children sit on (in numbers)","description" : "","multilanguage" : "FALSE","order" : 1},"Floor" : {"type" : "number","minlength" : "1","maxlength" : "10","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Table and Chairs" : {"type" : "number","minlength" : "1","maxlength" : "10","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"Benches" : {"type" : "number","minlength" : "1","maxlength" : "10","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 4,"notify" : "false"},"newline5" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 5},"newline6" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 6},"newline7" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 7},"newline8" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 8},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6}                 }             },             "6" : {                 "Declaration" : {"Note:-" : {"type" : "instruction","required" : "FALSE","key" : "TRUE","instructions" : "I here by declare i would render all the responsibilities as mentioned above","description" : "","multilanguage" : "FALSE","order" : 1},"Place" : {"type" : "text","minlength" : "1","maxlength" : "55","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 2,"notify" : "false"},"Date" : {"type" : "date","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 3,"notify" : "false"},"newline4" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 4},"newline5" : {"type" : "newline","key" : "FALSE","multilanguage" : "FALSE","order" : 5},"Signature" : {"type" : "text","minlength" : "","maxlength" : "","required" : "FALSE","key" : "FALSE","description" : "","multilanguage" : "FALSE","order" : 6},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 7}                 }             }         },         "permissions" : {             "Stage 1" : {                 "View_Permissions" : ["Dormitories","Toilets","Hand Wash","Waste Management","Water Facility","Dining Hall","Declaration"                 ],                 "Edit_Permissions" : ["Dormitories","Toilets","Hand Wash","Waste Management","Water Facility","Dining Hall","Declaration"                 ],                 "index" : 1             }         },         "notification_parameters" : [             {                 "field" : "Separate Dormitory",                 "page" : "1",                 "section" : "Dormitories"             }         ],         "application_header" : {             "header_details" : {                 "companyname" : "Healthcare",                 "address" : "401s,secbad,india",                 "logo" : ""             }         }     },     "app_id" : "healthcare201712719524850",     "app_description" : "TTWREIS Sanitation Infrastructure Form",     "status" : "new",     "app_name" : "Sanitation Infrastructure Form",     "app_created" : "2017-01-27 14:22:21",     "app_expiry" : "2020-05-21",     "_version" : 1,     "stages" : [         "Stage 1"     ],     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ( $app_coll, $data );
			
			$app_coll = $id."_applist";
			$data = json_decode('{    "app_id" : "healthcare201712719524850",    "app_description" : "TTWREIS Sanitation Infrastructure Form",    "app_name" : "Sanitation Infrastructure Form",    "app_created" : "2017-01-27 14:22:21"}',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ($app_coll, $data);
			
			$app_coll = $id."_web_apps";
			$data = json_decode('{     "permissions" : {         "Stage 1" : {"View_Permissions" : ["Dormitories","Toilets","Hand Wash","Waste Management","Water Facility","Dining Hall","Declaration"],"Edit_Permissions" : ["Dormitories","Toilets","Hand Wash","Waste Management","Water Facility","Dining Hall","Declaration"],"index" : 1         }     },     "app_id" : "healthcare201712719524850",     "app_description" : "TTWREIS Sanitation Infrastructure Form",     "status" : "new",     "app_name" : "Sanitation Infrastructure Form",     "app_created" : "2017-01-27 14:22:21",     "app_expiry" : "2020-05-21",     "application_header" : {         "header_details" : {"companyname" : "Healthcare","address" : "401s,secbad,india","logo" : ""         }     },     "_version" : 1,     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			$this->mongo_db->insert ($app_coll,$data);
			
			//==================================================================== BMI app ===============================================
			
			$app_coll = $id."_apps";
			$data = json_decode('{     "app_template" : {         "pages" : {"1" : {    "Student Details" : {"Hospital Unique ID" : {"type" : "retriever","order" : 1,"coll_ref" : "healthcare201671115519757","field_ref" : "page1_Personal Information_Hospital Unique ID","properties" : {    "type" : "text",    "minlength" : "1",    "maxlength" : "123",    "required" : "TRUE",    "key" : "TRUE",    "description" : "",    "multilanguage" : "FALSE",    "order" : 1,    "notify" : "false",    "parent" : "retriever"},"retrieve_list" : [    "page1_Personal Information_Name",    "page2_Personal Information_Class",    "page2_Personal Information_Section"]},"Name" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 2,"field_ref" : "page1_Personal Information_Name","properties" : {    "type" : "text",    "minlength" : "1",    "maxlength" : "123",    "required" : "FALSE",    "key" : "TRUE",    "description" : "",    "multilanguage" : "FALSE",    "order" : 2,    "notify" : "true",    "parent" : "mapper"}},"Class" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 3,"field_ref" : "page2_Personal Information_Class","properties" : {    "type" : "number",    "minlength" : "1",    "maxlength" : "123",    "required" : "FALSE",    "key" : "TRUE",    "description" : "",    "multilanguage" : "FALSE",    "order" : 3,    "notify" : "false",    "parent" : "mapper"}},"Section" : {"type" : "mapper","coll_ref" : "healthcare201671115519757","order" : 4,"field_ref" : "page2_Personal Information_Section","properties" : {    "type" : "text",    "minlength" : "1",    "maxlength" : "123",    "required" : "FALSE",    "key" : "TRUE",    "description" : "",    "multilanguage" : "FALSE",    "order" : 4,    "notify" : "false",    "parent" : "mapper"}},"Height cms" : {"type" : "number","minlength" : "1","maxlength" : "4","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 5,"notify" : "true"},"Weight kgs" : {"type" : "number","minlength" : "1","maxlength" : "4","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 6,"notify" : "false"},"BMI" : {"type" : "number","minlength" : "1","maxlength" : "4","required" : "FALSE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 7,"notify" : "false"},"Date" : {"type" : "date","required" : "TRUE","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 8,"notify" : "false"},"dont_use_this_name" : {"type" : "SBreak","key" : "TRUE","description" : "","multilanguage" : "FALSE","order" : 1}    }}         },         "permissions" : {"TTWREIS BMI" : {    "View_Permissions" : ["Student Details"    ],    "Edit_Permissions" : ["Student Details"    ],    "index" : 1}         },         "notification_parameters" : [{    "field" : "Height cms",    "page" : "1",    "section" : "Student Details"}         ],         "application_header" : {"header_details" : {    "companyname" : "Healthcare",    "address" : "401s,secbad,india",    "logo" : ""}         }     },     "app_id" : "healthcare2017619153715384",     "app_description" : "Based on Height and Weight ",     "status" : "new",     "app_name" : "TTWREIS BMI App",     "app_created" : "2017-06-20 10:00:43",     "app_expiry" : "2024-08-23",     "_version" : 4,     "stages" : [         "TTWREIS BMI"     ],     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ( $app_coll, $data );
			
			$app_coll = $id."_applist";
			$data = json_decode('{    "app_id" : "healthcare2017619153715384",    "app_description" : "Based on Height and Weight ",
			"app_name" : "TTWREIS BMI App",    "app_created" : "2017-06-19 10:08:21"}',true);
			////log_message("debug","dataaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa".print_r($data,true));
			$this->mongo_db->insert ($app_coll, $data);
			
			$app_coll = $id."_web_apps";
			$data = json_decode('{     "permissions" : {         "TTWREIS BMI" : {             "View_Permissions" : [                 "Student Details"             ],             "Edit_Permissions" : [                 "Student Details"             ],             "index" : 1         }     },     "app_id" : "healthcare2017619153715384",     "app_description" : "Based on Height and Weight ",     "status" : "new",     "app_name" : "TTWREIS BMI App",     "app_created" : "2017-06-20 10:00:43",     "app_expiry" : "2024-08-23",     "application_header" : {         "header_details" : {             "companyname" : "Healthcare",             "address" : "401s,secbad,india",             "logo" : ""         }     },     "_version" : 4,     "created_by" : "tlstec.primary2@gmail.com",     "use_profile_header" : "no",     "blank_app" : "no" }',true);
			$this->mongo_db->insert ($app_coll,$data);
		}
		*/
		/*
		//============================Start Modifications In collections================
		
		$unique_ids = ["TKMNR_1701_","TKMNR_1703_","TKMNR_1704_","TKMM_2111_","TKMM_2112_","TKMM_2110_","TKMM_2113_","TKMM_2114_","TWGL_2208_","TWGL_2203_","TWGL_2201_","TWGL_2207_","TWGL_2205_","TWGL_2206_","TWGL_2224_","TMBNR_1401_","TMBNR_1403_","TMBNR_1402_","TMBNR_1420_","TMDK_1603_","TNLG_1502_","TNZD_2002_","TRR_1801_","TKMNR_1714_","TKMNR_1702_","TKMM_2106_","TKMM_2102_","TKMM_2115_","TKMM_2109_","TKMM_2101_","TKMM_2108_","TWGL_2202_","TWGL_2210_","TWGL_2204_","TWGL_2211_","TWGL_2223_","TMBNR_1418_","TNLG_25437_","TNZD_2001_","TRR_1809_","TKMM_2107_","TRR_1807_","TMBNR_1415_","TMBNR_1416_","TMBNR_1417_","TKMM_2127_","TWGL_2221_","TWGL_2219_","TWGL_2220_","TWGL_2222_","TADB_2327_","TKMNR_1707_","TKMNR_1708_","TKMNR_1709_","TNZD_2008_","TNZD_2010_","TNLG_1516_","TKMM_2134_","TKMM_2131_","TWGL_2229_","TWGL_2230_","TWGL_2226_","TWGL_2227_","TWGL_2228_","TWGL_2225_","TKMNR_1711_","TMBNR_1422_","TMDK_1613_","TMDK_1614_","TMDK_1615_","TMDK_1616_","TMDK_1619_","TKMNR_1712_","TNLG_1525_","TNZD_2016_","TNZD_2013_","TNZD_2014_","TNZD_2015_","TMBNR_1425_","TRR_1811_","TRR_1813_","TMBNR_1426_","TADB_2334_","TKMNR_1713_"];
		
		$correct_ids = ["TJSKR_1701_","TRJN_1703_","TRJN_1704_","TBDD_2111_","TBDD_2112_","TBDD_2110_","TBDD_2113_","TBDD_2114_","TWGLR_2208_","TJSKR_2203_","TMBBD_2201_","TMBBD_2207_","TMBBD_2205_","TMBBD_2206_","TMBBD_2224_","TNGKL_1401_","TNGKL_1403_","TWNPY_1402_","TWNPY_1420_","TSRD_1603_","TSRPT_1502_","TKMR_2002_","TVKRD_1801_","TRJN_1714_","TRJN_1702_","TBDD_2106_","TBDD_2102_","TBDD_2115_","TBDD_2109_","TBDD_2101_","TBDD_2108_","TWGLR_2202_","TWGLU_2210_","TJSKR_2204_","TJSKR_2211_","TMBBD_2223_","TNGKL_1418_","TSRPT_25437_","TKMR_2001_","TVKRD_1809_","TBDD_2107_","TMBNR_1807_","TNGKL_1415_","TNGKL_1416_","TNGKL_1417_","TJSKR_2127_","TJSKR_2221_","TMBBD_2219_","TMBBD_2220_","TJSKR_2222_","TNML_2327_","TPDPL_1707_","TJGTL_1708_","TJGTL_1709_","TKMR_2008_","TKMR_2010_","TSRPT_1516_","TBDD_2134_","TBDD_2131_","TWGLR_2229_","TWGLU_2230_","TMBBD_2226_","TMBBD_2227_","TJGN_2228_","TJSKR_2225_","TJSKR_1711_","TNGKL_1422_","TSRD_1613_","TSRD_1614_","TSRD_1615_","TSRD_1616_","TSRD_1619_","TSDPT_1712_","TSRPT_1525_","TRJN_2016_","TKMR_2013_","TKMR_2014_","TKMR_2015_","TVKRD_1425_","TVKRD_1811_","TVKRD_1813_","TRR_1426_","TNML_2334_","TRJN_1713_"];
		
		$old_school_names = ["TTWREIS KATARAM(B),KARIMNAGAR","TTWREIS MARRIMADLA(B),KARIMNAGAR","TTWREIS YELLAREDDYPETA(G),KARIMNAGAR","TTWREIS BHADRACHALAM(B),KHAMMAM","TTWREIS DAMMAPETA(B),KHAMMAM","TTWREIS GUNDALA(B),KHAMMAM","TTWREIS K.S.D.SITE(B),KHAMMAM","TTWREIS SUDIMALLA(G),KHAMMAM","TTWREIS ASHOKNAGAR(B),WARANGAL","TTWREIS ETURUNAGARAM(B),WARANGAL","TTWREIS DAMARAVANCHA(B),WARANGAL","TTWREIS KOTHAGUDA(G),WARANGAL","TTWREIS MARRIPEDA(B),WARANGAL","TTWREIS KURAVI(G),WARANGAL","TTWREIS SEEROLU(G),WARANGAL","TTWREIS MANNANOOR(B),MAHABUBNAGAR","TTWREIS KALWAKURTHY(G),MAHABUBNAGAR","TTWREIS WANAPARTHY(G),MAHABUBNAGAR","TTWREIS PEDDAMANDADI(B),MAHABUBNAGAR","TTWREIS JINNARAM(B),MEDAK","TTWREIS THUNGATHURTHY(G),NALGONDA","TTWREIS GANDHARI(B),NIZAMABAD","TTWREIS KULAKACHERLA(B),RANGAREDDY","TTWREIS MARRIMADLA(RJC-B),KARIMNAGAR","TTWREIS YELLAREDDYPETA(RJC-G),KARIMNAGAR","TTWREIS DAMMAPETA(RJC-B),KHAMMAM","TTWREIS GUNDALA(RJC-B),KHAMMAM","TTWREIS KRISHNASAGAR(RJC-B),KHAMMAM","TTWREIS ANKAMPALEM(RJC-G),KHAMMAM","TTWREIS BHADRACHALAM(RJC-G),KHAMMAM","TTWREIS SUDIMALLA(RJC-G),KHAMMAM","TTWREIS ASHOKNAGAR(RJC-B),WARANGAL","TTWREIS WARANGAL(CO),WARANGAL","TTWREIS ETURUNAGARAM(RJC-B),WARANGAL","TTWREIS ETURUNAGARAM(RJC-G),WARANGAL","TTWREIS KURAVI(RJC-G),WARANGAL","TTWREIS MANNANOOR(RJC-B),MAHABUBNAGAR","TTWREIS THUNGATHURTHY(RJC-G),NALGONDA","TTWREIS GANDHARI(RJC-B),NIZAMABAD","TTWREIS KULAKACHERLA(RJC-B),RANGAREDDY","TTWREIS K.S.D.SITE(RJC-B),KHAMMAM","TTWREIS GANDEED(MG-G),RANGAREDDY","TTWREIS AMRABAD(MG-G),MAHABUBNAGAR","TTWREIS LINGALA(MG-G),MAHABUBNAGAR","TTWREIS BEJINEPALLY(MG-G),MAHABUBNAGAR","TTWREIS WAZEEDU(MG-G),KHAMMAM","TTWREIS MULUGU(MG-G),WARANGAL","TTWREIS GOVINDAPUR(MG-G),WARANGAL","TTWREIS MARRIPEDA(MG-G),WARANGAL","TTWREIS POCHAMPUR(MG-G),WARANGAL","TTWREIS MAMDA(MG-G),ADILABAD","TTWREIS DHARMARAM(MG-G),KARIMNAGAR","TTWREIS MALLAPUR(MG-G),KARIMNAGAR","TTWREIS ODDILINGAPUR(MG-G),KARIMNAGAR","TTWREIS MACHAREDDY(MG-G),NIZAMABAD","TTWREIS NACHUPALLY(MG-G),NIZAMABAD","TTWREIS CHIVEMLA(MG-G),NALGONDA","TTWREIS KOTHAGUDEM(G),KHAMMAM","TTWREIS MANUGURU(G),KHAMMAM","TTWREIS PARVATHAGIR(G),WARANGAL","TTWREIS HANAMKONDA(G),WARANGAL","TTWREIS KESAMUDRAM(G),WARANGAL","TTWREIS MAHABUBABAD(B),WARANGAL","TTWREIS PALAKURTHY(G),WARANGAL","TTWREIS MULUGU(B),WARANGAL","TTWREIS KATARAM(G),KARIMNAGAR","TTWREIS ACHAMPET(G),MAHABUBNAGAR","TTWREIS NARAYANKHED(B),MEDAK","TTWREIS MANUR(G),MEDAK","TTWREIS KANGTI(B),MEDAK","TTWREIS KALHER(G),MEDAK","TTWREIS ZAHEERABAD(G),MEDAK","TTWREIS HUSNABAD(B),KARIMNAGAR","TTWREIS CHIVVEMLA(G),NALGONDA","TTWREIS MANALA(G),NIZAMBAD","TTWREIS NAGIREDDYPET(B),NIZAMBAD","TTWREIS YELLAREDDY(G),NIZAMBAD","TTWREIS BANSWADA(B),NIZAMBAD","TTWREIS KONDAGAL(B),MAHABUBNAGAR","TTWREIS PARGI(G),RANGAREDDY","TTWREIS TANDUR(G),RANGAREDDY","TTWREIS KOTHUR(B),MAHABUBNAGAR","TTWREIS BHAINSA(G),ADILABAD","TTWREIS SIRICILLA TOWN(G),KARIMNAGAR"];
		
		$new_schools_names = ["TTWREIS KATARAM(B),JAYASHANKAR","TTWREIS MARRIMADLA(B),RAJANNA","TTWREIS YELLAREDDYPETA(G),RAJANNA","TTWREIS BHADRACHALAM(G),BHADRADRI","TTWREIS DAMMAPETA(B),BHADRADRI","TTWREIS GUNDALA(B),BHADRADRI","TTWREIS K.S.D.SITE(B),BHADRADRI","TTWREIS SUDIMALLA(G),BHADRADRI","TTWREIS ASHOKNAGAR(B),WARANGAL RURAL","TTWREIS ETURUNAGARAM(B),JAYASHANKAR","TTWREIS DAMARAVANCHA(B),MAHABOOBABAD","TTWREIS KOTHAGUDA(G),MAHABOOBABAD","TTWREIS MARRIPEDA(B),MAHABOOBABAD","TTWREIS KURAVI(G),MAHABOOBABAD","TTWREIS SEEROLU(G),MAHABOOBABAD","TTWREIS MANNANOOR(B),NAGARKURNOOL","TTWREIS KALWAKURTHY(G),NAGARKURNOOL","TTWREIS WANAPARTHY(G),WANAPARTHY","TTWREIS PEDDAMANDADI(B),WANAPARTHY","TTWREIS JINNARAM(B),SANGAREDDY","TTWREIS THUNGATHURTHY(G),SURYAPET","TTWREIS GANDHARI(B),KAMAREDDY","TTWREIS KULAKACHERLA(B),VIKARABAD","TTWREIS MARRIMANDLA(RJC-B),RAJANNA","TTWREIS YELLAREDDYPETA(RJC-G),RAJANNA","TTWREIS DAMMAPETA(RJC-B),BHADRADRI","TTWREIS GUNDALA(RJC-B),BHADRADRI","TTWREIS KRISHNASAGAR(RJC-B),BHADRADRI","TTWREIS ANKAMPALEM(RJC-G),BHADRADRI","TTWREIS BHADRACHALAM(RJC-G),BHADRADRI","TTWREIS SUDIMALLA(RJC-G),BHADRADRI","TTWREIS ASHOK NAGAR(RJC-B),WARANGAL RURAL","TTWREIS WARANGAL(CO),WARANGAL URBAN","TTWREIS ETURUNAGARAM(RJC-B),JAYASHANKAR","TTWREIS ETURUNAGARAM(RJC-G),JAYASHANKAR","TTWREIS KURAVI(RJC-G),MAHABOOBABAD","TTWREIS MANNANOOR(RJC-B),NAGARKURNOOL","TTWREIS THUNGATHURTHY(RJC-G),SURYAPET","TTWREIS GANDHARI(RJC-B),KAMAREDDY","TTWREIS KULAKACHERLA(RJC-B),VIKARABAD","TTWREIS K.S.D.SITE(RJC-B),BHADRADRI","TTWREIS GANDEED(MG-G),MAHABUBNAGAR","TTWREIS AMRABAD(MG-G),NAGARKURNOOL","TTWREIS LINGALA(MG-G),NAGARKURNOOL","TTWREIS BEJINEPALLY(MG-G),NAGARKURNOOL","TTWREIS WAZEEDU(MG-G),JAYASHANKAR","TTWREIS MULUGU(MG-G),JAYASHANKAR","TTWREIS GOVINDAPUR(MG-G),MAHABOOBABAD","TTWREIS MARRIPEDA(MG-G),MAHABOOBABAD","TTWREIS POCHAMPUR(MG-G),JAYASHANKAR","TTWREIS MAMDA(MG-G),NIRMAL","TTWREIS DHARMARAM(MG-G),PEDDAPALLI","TTWREIS MALLAPUR(MG-G),JAGTIAL","TTWREIS ODDILINGAPUR(MG-G),JAGTIAL","TTWREIS MACHAREDDY(MG-G),KAMAREDDY","TTWREIS NACHUPALLY(MG-G),KAMAREDDY","TTWREIS CHIVEMLA(MG-G),SURYAPET","TTWREIS KOTHAGUDEM(G),BHADRADRI","TTWREIS MANUGURU(G),BHADRADRI","TTWREIS PARVATHAGIR(G),WARANGAL RURAL","TTWREIS HANAMKONDA(G),WARANGAL URBAN","TTWREIS KESAMUDRAM(G),MAHABOOBABAD","TTWREIS MAHABUBABAD(B),MAHABOOBABAD","TTWREIS PALAKURTHY(G),JANGOAN","TTWREIS MULUGU(B),JAYASHANKAR","TTWREIS KATARAM(G),JAYASHANKAR","TTWREIS ACHAMPET(G),NAGARKURNOOL","TTWREIS NARAYANKHED(B),SANGAREDDY","TTWREIS MANUR(G),SANGAREDDY","TTWREIS KANGTI(B),SANGAREDDY","TTWREIS KALHER(G),SANGAREDDY","TTWREIS ZAHEERABAD(G),SANGAREDDY","TTWREIS HUSNABAD(B),SIDDIPET","TTWREIS CHIVVEMLA(G),SURYAPET","TTWREIS MANALA(G),RAJANNA","TTWREIS NAGIREDDYPET(B),KAMAREDDY","TTWREIS YELLAREDDY(G),KAMAREDDY","TTWREIS BANSWADA(B),KAMAREDDY","TTWREIS KONDAGAL(B),VIKARABAD","TTWREIS PARGI(G),VIKARABAD","TTWREIS TANDUR(G),VIKARABAD","TTWREIS KOTHUR(B),RANGAREDDY","TTWREIS BHAINSA(G),NIRMAL","TTWREIS SIRICILLA TOWN(G),RAJANNA"];
		
		$districts = ["JAYASHANKAR","RAJANNA","RAJANNA","BHADRADRI","BHADRADRI","BHADRADRI","BHADRADRI","BHADRADRI",
"WARANGAL RURAL","JAYASHANKAR","MAHABOOBABAD","MAHABOOBABAD","MAHABOOBABAD","MAHABOOBABAD","MAHABOOBABAD","NAGARKURNOOL","NAGARKURNOOL","WANAPARTHY","WANAPARTHY","SANGAREDDY","SURYAPET","KAMAREDDY","VIKARABAD","RAJANNA","RAJANNA","BHADRADRI","BHADRADRI","BHADRADRI","BHADRADRI","BHADRADRI","BHADRADRI","WARANGAL RURAL","WARANGAL URBAN","JAYASHANKAR","JAYASHANKAR","MAHABOOBABAD","NAGARKURNOOL","SURYAPET","KAMAREDDY","VIKARABAD","BHADRADRI","MAHABUBNAGAR","NAGARKURNOOL","NAGARKURNOOL","NAGARKURNOOL","JAYASHANKAR","JAYASHANKAR","MAHABOOBABAD","MAHABOOBABAD","JAYASHANKAR","NIRMAL","PEDDAPALLI","JAGTIAL","JAGTIAL","KAMAREDDY","KAMAREDDY","SURYAPET","BHADRADRI","BHADRADRI","WARANGAL RURAL","WARANGAL URBAN","MAHABOOBABAD","MAHABOOBABAD","JANGOAN","JAYASHANKAR","JAYASHANKAR","NAGARKURNOOL","SANGAREDDY","SANGAREDDY","SANGAREDDY","SANGAREDDY","SANGAREDDY","SIDDIPET","SURYAPET","RAJANNA","KAMAREDDY","KAMAREDDY","KAMAREDDY","VIKARABAD","VIKARABAD","VIKARABAD","RANGAREDDY","NIRMAL","RAJANNA"];

		$emails = ["tkmnr.1701.","tkmnr.1703.","tkmnr.1704.","tkmm.2111.","tkmm.2112.","tkmm.2110.","tkmm.2113.","tkmm.2114.","twgl.2208.","twgl.2203.","twgl.2201.","twgl.2207.","twgl.2205.","twgl.2206.","twgl.2224.","tmbnr.1401.","tmbnr.1403.","tmbnr.1402.","tmbnr.1420.","tmdk.1603.","tnlg.1502.","tnzd.2002.","trr.1801.","tkmnr.1714.","tkmnr.1702.","tkmm.2106.","tkmm.2102.","tkmm.2115.","tkmm.2109.","tkmm.2101.","tkmm.2108.","twgl.2202.","twgl.2210.","twgl.2204.","twgl.2211.","twgl.2223.","tmbnr.1418.","tnlg.25437.","tnzd.2001.","trr.1809.","tkmm.2107.","trr.1807.","tmbnr.1415.","tmbnr.1416.","tmbnr.1417.","tkmm.2127.","twgl.2221.","twgl.2219.","twgl.2220.","twgl.2222.","tadb.2327.","tkmnr.1707.","tkmnr.1708.","tkmnr.1709.","tnzd.2008.","tnzd.2010.","tnlg.1516.","tkmm.2134.","tkmm.2131.","twgl.2229.","twgl.2230.","twgl.2226.","twgl.2227.","twgl.2228.","twgl.2225.","tkmnr.1711.","tmbnr.1422.","tmdk.1613.","tmdk.1614.","tmdk.1615.","tmdk.1616.","tmdk.1619.","tkmnr.1712.","tnlg.1525.","tnzd.2016.","tnzd.2013.","tnzd.2014.","tnzd.2015.","tmbnr.1425.","trr.1811.","trr.1813.","tmbnr.1426.","tadb.2334.","tkmnr.1713."];
		
		$new_emails = ["tjskr.1701.","trjn.1703.","trjn.1704.","tbdd.2111.","tbdd.2112.","tbdd.2110.","tbdd.2113.","tbdd.2114.","twglr.2208.","tjskr.2203.","tmbbd.2201.","tmbbd.2207.","tmbbd.2205.","tmbbd.2206.","tmbbd.2224.","tngkl.1401.","tngkl.1403.","twnpy.1402.","twnpy.1420.","tsrd.1603.","tsrpt.1502.","tkmr.2002.","tvkrd.1801.","trjn.1714.","trjn.1702.","tbdd.2106.","tbdd.2102.","tbdd.2115.","tbdd.2109.","tbdd.2101.","tbdd.2108.","twglr.2202.","twglu.2210.","tjskr.2204.","tjskr.2211.","tmbbd.2223.","tngkl.1418.","tsrpt.25437.","tkmr.2001.","tvkrd.1809.","tbdd.2107.","tmbnr.1807.","tngkl.1415.","tngkl.1416.","tngkl.1417.","tjskr.2127.","tjskr.2221.","tmbbd.2219.","tmbbd.2220.","tjskr.2222.","tnml.2327.","tpdpl.1707.","tjgtl.1708.","tjgtl.1709.","tkmr.2008.","tkmr.2010.","tsrpt.1516.","tbdd.2134.","tbdd.2131.","twglr.2229.","twglu.2230.","tmbbd.2226.","tmbbd.2227.","tjgn.2228.","tjskr.2225.","tjskr.1711.","tngkl.1422.","tsrd.1613.","tsrd.1614.","tsrd.1615.","tsrd.1616.","tsrd.1619.","tsdpt.1712.","tsrpt.1525.","trjn.2016.","tkmr.2013.","tkmr.2014.","tkmr.2015.","tvkrd.1425.","tvkrd.1811.","tvkrd.1813.","trr.1426.","tnml.2334.","trjn.1713."];
		
		$dt_names = ["592677f3210552bc62d43321","592678a9210552bd62d4331d","592678a9210552bd62d4331d","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","5926798d210552e504d4330f","592677f3210552bc62d43321","592679dd210552c062d43317","592679dd210552c062d43317","592679dd210552c062d43317","592679dd210552c062d43317","592679dd210552c062d43317","5926785c2105526875d43317","5926785c2105526875d43317","59267901210552b362d4331a","59267901210552b362d4331a","592678bb210552e304d4330f","592678e02105526675d43311","59267820210552c962d43327","592678ef210552a56ad43323","592678a9210552bd62d4331d","592678a9210552bd62d4331d","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","592677ca210552bc62d43320","5926798d210552e504d4330f","59267998210552e504d43310","592677f3210552bc62d43321","592677f3210552bc62d43321","592679dd210552c062d43317","5926785c2105526875d43317","592678e02105526675d43311","59267820210552c962d43327","592678ef210552a56ad43323","592677ca210552bc62d43320","578336e0dbe782d22868098e","5926785c2105526875d43317","5926785c2105526875d43317","5926785c2105526875d43317","592677f3210552bc62d43321","592677f3210552bc62d43321","592679dd210552c062d43317","592679dd210552c062d43317","592677f3210552bc62d43321","592678752105526475d43312","5926789a2105526d75d43320","5926796d210552f462d43320","5926796d210552f462d43320","59267820210552c962d43327","59267820210552c962d43327","592678e02105526675d43311","592677ca210552bc62d43320","592677ca210552bc62d43320","5926798d210552e504d4330f","59267998210552e504d43310","592679dd210552c062d43317","592679dd210552c062d43317","5926780e210552e304d4330e","592677f3210552bc62d43321","592677f3210552bc62d43321","5926785c2105526875d43317","592678bb210552e304d4330f","592678bb210552e304d4330f","592678bb210552e304d4330f","592678bb210552e304d4330f","592678bb210552e304d4330f","592678c8210552bd08d4330c","592678e02105526675d43311","592678a9210552bd62d4331d","59267820210552c962d43327","59267820210552c962d43327","59267820210552c962d43327","592678ef210552a56ad43323","592678ef210552a56ad43323","592678ef210552a56ad43323","5783370bdbe782272968098e","592678752105526475d43312","592678a9210552bd62d4331d"];
		
		//$nareshhh = count($unique_ids)-1;
		
		for($ind_modi=0;$ind_modi <= count($unique_ids)-1;$ind_modi++)
		{
			echo $ind_modi;
			
			echo "/////////////";
			//echo $unique_ids[$ind_modi];
			
			$unique_id = $unique_ids[$ind_modi];
			$correct_id = $correct_ids[$ind_modi];
			$old_school_name = $old_school_names[$ind_modi];
			$correct_school_name = $new_schools_names[$ind_modi];
			$district = $districts[$ind_modi];
			$email = $emails[$ind_modi];
			$new_email = $new_emails[$ind_modi];
			$dt_name = $dt_names[$ind_modi];
			
			 //=======================ttwreis_chronic_cases==================
			
			$query = $this->mongo_db->whereLike("school_name",$old_school_name)->get("ttwreis_chronic_cases");
			foreach ($query as $doc){
				if(isset($doc['school_name'])){
					$doc['school_name'] = $correct_school_name;
					$doc['student_unique_id'] = str_replace($unique_id,$correct_id,$doc['student_unique_id']);
				}
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis_chronic_cases");
			}
			
			//========================================= 
			
		
		

		//====================screening collection ==============
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$unique_id)->get($this->screening_app_col );
		
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'])){
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'], $unique_id);
			
			if($nlg_pos !== false){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID']));

				$new_id = $correct_id.$unique_cut;
				
		$doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'] = $new_id;
		$doc['doc_data']['widget_data']['page2']['Personal Information']['School Name'] = $correct_school_name;
		$doc['doc_data']['widget_data']['page2']['Personal Information']['District'] = $district;
		echo print_r($doc,true);
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col );
		echo print_r($doc["_id"],true);
		echo print_r($doc,true);
		
		}
		}
		}
		
		
		//shadow ==================================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$unique_id)->get($this->screening_app_col."shadow" );
		
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'])){
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'], $unique_id);
			
			if($nlg_pos !== false){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID']));

				$new_id = $correct_id.$unique_cut;
				
		$doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'] = $new_id;
		$doc['doc_data']['widget_data']['page2']['Personal Information']['School Name'] = $correct_school_name;
		$doc['doc_data']['widget_data']['page2']['Personal Information']['District'] = $district;
		 echo print_r($doc["_id"],true);
		 echo print_r($doc,true);
		 exit();
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col."shadow" );
		}
		}
		}

		
		//======================== request collection		
		
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Student Info.Unique ID',$unique_id)->get("healthcare2016108181933756");

		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']))
		{
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'], $unique_id);
			
			if($nlg_pos == 0){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']));
			
			$new_id = $correct_id.$unique_cut;
			echo print_r($new_id,true);
			//exit();
			$doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'] = $new_id;
		}
		}
		
		if(isset($doc['history'][0]['submitted_by'])){		
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail";
		}
		
		if(isset($doc['history']["last_stage"]['submitted_by'])){	
			$doc['history']["last_stage"]['submitted_by'] = $new_email."hs#gmail.com";
		}
		
		if($doc['doc_data']['user_name'] == $email."hs#gmail.com")
		{	
			$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		}
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare2016108181933756");
		}
		echo print_r($query,true);
		
		
		//shadow ==========================================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Student Info.Unique ID',$unique_id)->get("healthcare2016108181933756_shadow");

		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']))
		{
			$nlg_pos = strpos ( $doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'], $unique_id);
			
			if($nlg_pos == 0){
				$nlg_end = $nlg_pos + strlen ($unique_id);
				$unique_cut = substr($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'],$nlg_end,strlen ($doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID']));

				$new_id = $correct_id.$unique_cut;

		$doc['doc_data']['widget_data']['page1']['Student Info']['Unique ID'] = $new_id;
		}
		}
		
		if(isset($doc['history'][0]['submitted_by']) && ($doc['history'][0]['submitted_by'] == $email."hs#gmail.com")){		
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail";
		}
		
		if($doc['doc_data']['user_name'] == $email."hs#gmail.com")
		{	
			$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		}
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare2016108181933756_shadow");
		}
		

		//======================== attendence collection
		
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Attendence Details.Select School',$old_school_name)->get("healthcare20161015173311279");
		
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Attendence Details']['Select School']))
		{		
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['Select School'] = $correct_school_name;
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['District'] = $district;
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['Sick UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page1']['Attendence Details']['Sick UID']);
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['R2H UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page1']['Attendence Details']['R2H UID']);
		$doc['doc_data']['widget_data']['page2']['Attendence Details']['Absent UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page2']['Attendence Details']['Absent UID']);
		$doc['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom UID']);
		
		
		if(isset($doc['history']['last_stage']['submitted_by']))
		{	
			$doc['history']["last_stage"]['submitted_by'] = $new_email."hs#gmail.com";
		}
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare20161015173311279");
		}
		}
		echo print_r($query,true);
		//shadow ========================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page1.Attendence Details.Select School',$old_school_name)->get("healthcare20161015173311279_shadow");
		
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page1']['Attendence Details']['Select School']))
		{
			
				
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['Select School'] = $correct_school_name;
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['District'] = $district;
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['Sick UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page1']['Attendence Details']['Sick UID']);
		$doc['doc_data']['widget_data']['page1']['Attendence Details']['R2H UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page1']['Attendence Details']['R2H UID']);
		$doc['doc_data']['widget_data']['page2']['Attendence Details']['Absent UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page2']['Attendence Details']['Absent UID']);
		$doc['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom UID'] = str_replace($unique_id,$correct_id,$doc['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom UID']);
		
		
		if((isset($doc['history'][0]['submitted_by'])) && ($doc['history'][0]['submitted_by'] == $email."hs#gmail.com"))
		{	
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail.com";
		}
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare20161015173311279_shadow");
		}
		}
		

		//======================== 'Sanitation report' collection
		
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page4.School Information.School Name',$old_school_name)->get("healthcare20171211809800" );
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page4']['School Information']['School Name'])){
			$doc['doc_data']['widget_data']['page4']['School Information']['School Name'] = $correct_school_name;
			$doc['doc_data']['widget_data']['page4']['School Information']['District'] = $district;
		}
		
		if((isset($doc['history']['last_stage']['submitted_by'])) && ($doc['history']["last_stage"]['submitted_by'] == $email."hs#gmail.com")){
			$doc['history']["last_stage"]['submitted_by'] = $new_email."hs#gmail.com";
		}
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare20171211809800" );
		}
		
		
		//shadow =====================================================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page4.School Information.School Name',$old_school_name)->get("healthcare20171211809800_shadow" );
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page4']['School Information']['School Name'])){
			$doc['doc_data']['widget_data']['page4']['School Information']['School Name'] = $correct_school_name;
			$doc['doc_data']['widget_data']['page4']['School Information']['District'] = $district;
		}
		
		if((isset($doc['history'][0]['submitted_by'])) && ($doc['history'][0]['submitted_by'] == $email."hs#gmail.com")){
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail.com";
		}
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare20171211809800_shadow" );
		}
		
		
		//======================== 'Sanitation infrastructure' collection
		
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page6.School Information.School Name',$old_school_name)->get("healthcare201712719524850" );
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page6']['School Information']['School Name'])){
			$doc['doc_data']['widget_data']['page6']['School Information']['School Name'] = $correct_school_name;
			$doc['doc_data']['widget_data']['page6']['School Information']['District'] = $district;	
		}
		
		if((isset($doc['history']["last_stage"]['submitted_by'])) && ($doc['history']["last_stage"]['submitted_by'] == $email."hs#gmail.com")){
			$doc['history']["last_stage"]['submitted_by'] = $new_email."hs#gmail.com";
		}
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare201712719524850" );
		}
		
		
		//shadow =============================================================
		$query = $this->mongo_db->whereLike('doc_data.widget_data.page6.School Information.School Name',$old_school_name)->get("healthcare201712719524850_shadow" );
		foreach ($query as $doc){
		if(isset($doc['doc_data']['widget_data']['page6']['School Information']['School Name'])){
			$doc['doc_data']['widget_data']['page6']['School Information']['School Name'] = $correct_school_name;
			$doc['doc_data']['widget_data']['page6']['School Information']['District'] = $district;
		}
		
		if((isset($doc['history'][0]['submitted_by'])) && ($doc['history'][0]['submitted_by'] == $email."hs#gmail.com")){
			$doc['history'][0]['submitted_by'] = $new_email."hs#gmail.com";
		}
		$doc['doc_data']['user_name'] = $new_email."hs#gmail.com";
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("healthcare201712719524850_shadow" );
		}
		
		
		//======================== ttwreis_ehr_notes collection
		
		$query = $this->mongo_db->whereLike('uid',$unique_id)->get("ttwreis_ehr_notes" );
		foreach ($query as $doc){
			if(isset($doc['uid']))
			{
				$nlg_pos = strpos ( $doc['uid'], $unique_id);
				
				if($nlg_pos == 0){
					$nlg_end = $nlg_pos + strlen ($unique_id);
					$unique_cut = substr($doc['uid'],$nlg_end,strlen ($doc['uid']));

					$new_id = $correct_id.$unique_cut;

			$doc['uid'] = $new_id;
			}
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis_ehr_notes" );
			}
		}
		
		//======================== TTWREIS_messages collection
		
		$query = $this->mongo_db->whereLike('message',$unique_id)->get("ttwreis_messages" );
		foreach ($query as $doc){
		if(isset($doc['message'])){
			
			$doc['message'] = str_replace($unique_id,$correct_id,$doc['message']);
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis_messages" );
		}}
		
		
		//======================== ttwreis_health_supervisors collection
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->whereLike('email',$email)->get("ttwreis_health_supervisors" );
		foreach ($query as $doc){
		if(isset($doc['email'])){
			
			$doc['email'] = $new_email."hs@gmail.com";
			$doc['hs_addr'] = $correct_school_name;
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis_health_supervisors" );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		}
		}
		
		
		//======================== ttwreis_schools collection
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->whereLike('school_name',$old_school_name)->get("ttwreis_schools" );
		foreach ($query as $doc){
		if(isset($doc['school_name'])){
			
			$doc['school_name'] = $correct_school_name;
			$doc['username'] = $correct_school_name;
			$doc['school_addr'] = $correct_school_name;
			$doc['dt_name'] = $dt_name;
		
		$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis_schools" );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		}
		}
		
		//TTWREIS rename user collection================================================================
			$query = $this->mongo_db->get($email."hs#gmail.com_applist" );
			foreach ($query as $doc){
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_applist", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_applist");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_apps" );
			foreach ($query as $doc){
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_apps", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_apps");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_apps" );
			foreach ($query as $doc){
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_apps", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_apps");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_web_apps" );
			foreach ($query as $doc){
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_web_apps", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_web_apps");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_docs", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_docs");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_docs", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_docs");
			
			$query = $this->mongo_db->get($email."hs#gmail.com_web_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$query = $this->mongo_db->insert ( $new_email."hs#gmail.com_web_docs", $doc );
			}
			$query = $this->mongo_db->dropCollection ( $email."hs#gmail.com_web_docs");
		//=============================================================
		
		//===========TTWREIS doctor collections================
		
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr1#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr1#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr2#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr2#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr3#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr3#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr4#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr4#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr5#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr5#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr6#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr6#gmail.com_docs" );
			}
			
		$query = $this->mongo_db->where("from_user",$email."hs#gmail.com")->get("ttwreis.dr7#gmail.com_docs" );
			foreach ($query as $doc){
				if(isset($doc['notification_param']['Unique ID'])){
					$doc['notification_param']['Unique ID'] = str_replace($unique_id,$correct_id,$doc['notification_param']['Unique ID']);
				}
				$doc["from_user"] = $new_email."hs#gmail.com";
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update("ttwreis.dr7#gmail.com_docs" );
			}
				//echo print_r($query,true);
		
		//============================
			
		}  
		
		//=========================end of modification========
		
		//======================================================= END OF HS
		*/
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_classes' );
		return $query;
	}
	public function sectionscount() {
		$count = $this->mongo_db->count ( 'ttwreis_sections' );
		return $count;
	}
	public function get_sections($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_sections' );
		return $query;
	}
	public function symptomscount() {
		$count = $this->mongo_db->count ( 'ttwreis_symptoms' );
		return $count;
	}
	public function get_symptoms($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_symptoms' );
		return $query;
	}
	public function get_reports_ehr($ad_no) {
		$query = $this->mongo_db->select ( array (
				'doc_data.widget_data',
				'doc_data.chart_data',
				'doc_data.external_attachments',
				'history' 
		) )->whereLike ( "doc_data.widget_data.page2.Personal Information.AD No", $ad_no )->get ( $this->screening_app_col );
		if ($query) {
			$query_request = $this->mongo_db->where ( "doc_data.widget_data.page1.Student Info.Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->request_app_col );
			$result ['screening'] = $query;
			$result ['request'] = $query_request;
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['request'] = false;
			return $result;
		}
	}
	public function get_reports_ehr_uid($uid) {
		
		$query = $this->mongo_db->select ( array ('doc_data.widget_data','doc_data.chart_data','doc_data.external_attachments','history') )->whereLike ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get ( "ttwreis_screening_report_col_2021-2022" );
		if ($query) {
			$query_request = $this->mongo_db->orderBy(array("history.0.time"=> -1))->where( "doc_data.widget_data.page1.Student Info.Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->request_app_col_static_html );
						
			if(count($query_request) > 0){
				foreach($query_request as $req_ind => $req){
					unset($query_request[$req_ind]['doc_data']["notes_data"]);
					$notes_data = $this->mongo_db->where ("req_doc_id", $req['doc_properties']['doc_id'])->get ( $this->collections['ttwreis_req_notes'] );
					
					
					if(count($notes_data) > 0){
						$query_request[$req_ind]['doc_data']['notes_data'] = $notes_data[0]['notes_data'];
					}
				}
				
			}
			
			$query_notes = $this->mongo_db->orderBy(array('datetime' => 1))->where ( "uid", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->notes_col );
			
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$school_details = $this->mongo_db->where ( "school_name", $query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'] )->get ( $this->collections ['ttwreis_schools'] );
			$query_hs = $this->mongo_db->where ( "school_code", $school_details[0]['school_code'] )->get ( $this->collections ['ttwreis_health_supervisors'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

			$bmi_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->bmi_app_col);
            
            
            $hb_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->hb_app_col);
			
			$result ['screening'] = $query;
			$result ['request'] = $query_request;
			$result ['notes'] = $query_notes;
			$result ['hs'] = $query_hs[0];
			 $result ['BMI_report'] = $bmi_value_table_addto_ehr;
            $result ['hb_report'] = $hb_value_table_addto_ehr;
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['request'] = false;
			$result ['notes'] = false;
			$result ['hs'] = false;
			$result ['BMI_report'] = false;
            $result ['hb_report'] = false;
			return $result;
		}
	}

	public function drill_down_screening_to_students_load_ehr_panacea_new_dashboard($_id) 
	{
		ini_set ( 'memory_limit', '2G' );
		$query = $this->mongo_db->select ( array ('doc_data','history','doctors_medical_reports') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( $this->screening_app_col_tt_2020_2021 );
		
		//where ( "_id", new MongoID ( $_id ) ) 
		if(empty($query))
		{
			$query = $this->mongo_db->select ( array ('doc_data','history') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( 'ttwreis_other_classes_screening_data_2019-2020' );
		}

	/* Second year 2020 screening info */
	$query_second = $this->mongo_db->select ( array ('doc_data','history','doctors_medical_reports') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( $this->screening_app_col_tt_2020_2021 );

	if(empty($query_second))
	{
		$query_second = $this->mongo_db->select ( array ('doc_data','history','doctors_medical_reports') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( 'ttwreis_screening_report_col_2020-2021_passed_out' );

		if(empty($query_second))
		{
			$query_second = $this->mongo_db->select ( array ('doc_data','history','doctors_medical_reports') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( 'ttwreis_other_classes_screening_data_2019-2020' );
		}
	}

	/* 2021-22 Screeing Info */

	$screen_2021_22 = $this->mongo_db->select ( array ('doc_data','history') )->whereLike('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $_id)->get ( $this->screening_app_col_tt_2021_2022 );
		
		if ($query) {
			$query_request = $this->mongo_db->select(array("doc_data","doc_properties","history","regular_follow_up"))->orderBy(array("history.0.time"=> -1))->where( "doc_data.widget_data.page1.Student Info.Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ($this->request_app_col_static_html);

			$query_request_old_dash = $this->mongo_db->select(array("doc_data.widget_data","doc_data.notes_data","doc_data.external_attachments","doc_properties","history"))->orderBy(array("history.0.time"=> -1))->where( "doc_data.widget_data.page1.Student Info.Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->request_app_col );			
			
			
			if(count($query_request) > 0){
				foreach($query_request as $req_ind => $req){
					unset($query_request[$req_ind]['doc_data']["notes_data"]);
					$notes_data = $this->mongo_db->whereLike ("req_doc_id", new MongoId($req['_id']))->get ( 'ttwreis_req_notes' );
					
					
					if(count($notes_data) > 0){
						$query_request[$req_ind]['doc_data']['notes_data'] = $notes_data[0]['notes_data'];
					}

					//for Field Officer data
						$followups_data = $this->mongo_db->whereLike("follow_up_request_doc_id", $req['doc_properties']['doc_id'])->get('ttwreis_field_officer_report');

						if(count($followups_data) > 0){
							foreach ($followups_data as $follow) {
								$get_user = $follow['history']['last_stage']['submitted_by'];
								if(!empty($get_user))
								{
									if(preg_match("/cc/i", $get_user))
									{
										$query_request_new[$req_ind]['doc_data']['field_officer_followup'] = $follow;
									}
									else
									{
										$query_request_new[$req_ind]['doc_data']['rhso_followup'] = $follow;
									}
								}
								
							}
						}
						else
						{
							$query_request_new[$req_ind]['doc_data']['field_officer_followup'] = [];

							$query_request_new[$req_ind]['doc_data']['rhso_followup'] = [];
						}
				}
				
			}
			
			$bmi_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->bmi_app_col);
			

			$hb_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->hb_app_col);

			$fo_report_table_add_ehr =$this->mongo_db->orderBy(array('history.last_stage.time' => 1))->where("doc_data.widget_data.Student Details.Hospital Unique ID", $query[0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get("ttwreis_field_officer_report");
			

			$query_notes = $this->mongo_db->orderBy(array('datetime' => 1))->where ( "uid", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->notes_col );

			$request_notes = $this->mongo_db->orderBy(array('datetime' => -1))->where ( "uid", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get('ttwreis_ehr_notes');
		

			/* Field Officer Report and RHhso not doc id existed */
			//for Field Officer data
				
				if(count($fo_report_table_add_ehr) > 0){
					foreach ($fo_report_table_add_ehr as $follow) {
						$get_user = $follow['history']['last_stage']['submitted_by'];
						if(!empty($get_user))
						{
							if(preg_match("/cc/i", $get_user))
							{
								$field_officer_followup_without_doc[] = $follow;
							}
							else
							{
								$rhso_followup_without_doc[] = $follow;
							}
						}
						
					}
				}
				else
				{
					$field_officer_followup_without_doc = [];

					$rhso_followup_without_doc = [];
				}

			//log_message("debug","EHR======notes".print_r($query_notes,true));
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$school_details = $this->mongo_db->whereLike ( "school_name", $query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'] )->get ( $this->collections ['ttwreis_schools'] );
			//echo print_r($school_details,TRUE);exit();
			$query_hs = $this->mongo_db->where ( "school_code", $school_details[0]['school_code'] )->get ( $this->collections ['ttwreis_health_supervisors'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			
			$result ['screening'] = isset($query) ? $query : $query_second;
			$result ['screening_2020'] = $query_second;
			$result ['screening_2021_22'] = isset($screen_2021_22) ? $screen_2021_22 : $screen_2021_22;
			$result ['request'] = array_merge_recursive($query_request, $query_request_old_dash);
			//$result ['request'] = $query_request;
			$result ['notes'] = $query_notes;
			$result ['hs'] = $query_hs[0];
			$result ['BMI_report'] = $bmi_value_table_addto_ehr;
			$result ['hb_report'] = $hb_value_table_addto_ehr;
			$result ['fo_report'] = $fo_report_table_add_ehr;
			$result ['fo_report_without_id'] = isset($field_officer_followup_without_doc) ? $field_officer_followup_without_doc :false;
			$result ['rhso_report_without_id'] = isset($rhso_followup_without_doc) ? $rhso_followup_without_doc :false;
			$result ['notes_data'] = $request_notes;
			$result ['doctors_visitings'] = isset($doctor_visitings) ? $doctor_visitings :false;
			
			//log_message("debug","result ==========notes".print_r($result ['notes'],true));
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['screening_2020'] = false;
			$result ['screening_2021_22'] = false;
			$result ['request'] = false;
			$result ['notes'] = false;
			$result ['hs'] = false;
			$result ['BMI_report'] = false;
			$result ['hb_report'] = false;
			$result ['fo_report'] = false;
			$result ['fo_report_without_id'] = false;
			$result ['rhso_report_without_id'] = false;
			$result ['notes_data'] = false;
			$result ['doctors_visitings'] = false;
			return $result;
		}
	}

	public function get_students_uid($uid) {
		$query = $this->mongo_db->where ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get($this->screening_app_col_tt_2021_2022 );
		if ($query) {
			return $query [0];
		} else {
			return false;
		}
	}
	public function create_diagnostic($post) {
		$data = array (
				"dt_name" => $post ['dt_name'],
				"diagnostic_code" => $post ['diagnostic_code'],
				"diagnostic_name" => $post ['diagnostic_name'],
				"diagnostic_ph" => $post ['diagnostic_ph'],
				"diagnostic_mob" => $post ['diagnostic_mob'],
				"diagnostic_addr" => $post ['diagnostic_addr'] 
		);
		$query = $this->mongo_db->insert ( 'ttwreis_diagnostics', $data );
		return $query;
	}
	public function create_hospital($post) {
		$data = array (
				"dt_name" => $post ['dt_name'],
				"hospital_code" => $post ['hospital_code'],
				"hospital_name" => $post ['hospital_name'],
				"hospital_ph" => $post ['hospital_ph'],
				"hospital_mob" => $post ['hospital_mob'],
				"hospital_addr" => $post ['hospital_addr'] 
		);
		$query = $this->mongo_db->insert ( 'ttwreis_hospitals', $data );
		return $query;
	}
	public function update_student_data($doc, $doc_id) {
		// $query = $this->mongo_db->where ( "_id", $doc_id )->set ( $doc )->update ( "yogaaaaaa" );
		$query = $this->mongo_db->where ( "_id", $doc_id )->set ( $doc )->update ( $this->screening_app_col_tt_2021_2022 );
		
		return $query;
	}
	public function studentscount() {
		$count = $this->mongo_db->count ( $this->screening_app_col_tt_2021_2022 );
		return $count;
	}
	public function get_students($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->orderBy ( array (
				'doc_data.widget_data.page1.Personal Information.Name' => 1 
		) )->select ( array (
				"doc_data.widget_data" 
		) )->limit ( $per_page )->offset ( $page - 1 )->get ( $this->screening_app_col );
		return $query;
	}
	public function get_all_students() {
		ini_set ( 'memory_limit', '1G' );
		
		// $merged_array = array("doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array('$in'=>array("Over Weight","Under Weight")));
		$count = $this->mongo_db->count ( $this->screening_app_col );
		// log_message("debug","cccccccccccccccccccccccccccccccccccccccc".print_r($count,true));
		$per_page = 1000;
		$loop = $count / $per_page;
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			// log_message("debug","ppppppppppppppppppppppppppppppppppppppppp".print_r($page,true));
			// log_message("debug","oooooooooooooooooooooooooooooooooooooooooo".print_r($offset,true));
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true 
							) 
					),
					// array('$match' => $merged_array)
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$result = array_merge ( $result, $response ['result'] );
			// log_message("debug","response=====1643==".print_r($response,true));
			// log_message("debug","response=====1643==".print_r(count($response['result']),true));
			// log_message("debug","ppppppppppppppppppppppppppppppppppppppppp".print_r($result,true));
		}
		//
		// log_message("debug","response=====1643==".print_r(count($response['result']),true));
		//log_message ( "debug", "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffff" . print_r ( $result, true ) );
		
		// $query = $this->mongo_db->select(array("doc_data.widget_data"))->get($this->screening_app_col);
		// return $query;
		return $result;
	}
	public function hospitalscount() {
		$count = $this->mongo_db->count ( 'ttwreis_hospitals' );
		return $count;
	}
	public function get_hospitals($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_hospitals' );
		foreach ( $query as $hospitals => $hospital ) {
			$dt_name = $this->mongo_db->where ( '_id', new MongoId ( $hospital ['dt_name'] ) )->get ( 'ttwreis_district' );
			if (isset ( $hospital ['dt_name'] )) {
				$query [$hospitals] ['dt_name'] = $dt_name [0] ['dt_name'];
			} else {
				$query [$hospitals] ['dt_name'] = "No state selected";
			}
		}
		
		return $query;
	}
	public function diagnosticscount() {
		$count = $this->mongo_db->count ( 'ttwreis_diagnostics' );
		return $count;
	}
	public function get_diagnostics($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_diagnostics' );
		foreach ( $query as $diagnostics => $dia ) {
			$dt_name = $this->mongo_db->where ( '_id', new MongoId ( $dia ['dt_name'] ) )->get ( 'ttwreis_district' );
			if (isset ( $dia ['dt_name'] )) {
				$query [$diagnostics] ['dt_name'] = $dt_name [0] ['dt_name'];
			} else {
				$query [$diagnostics] ['dt_name'] = "No state selected";
			}
		}
		return $query;
	}
	public function empcount() {
		$count = $this->mongo_db->count ( 'ttwreis_emp' );
		return $count;
	}
	public function get_emp($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_emp' );
		return $query;
	}
	public function insert_student_data($doc_data, $history, $doc_properties) {
		
		$query = $this->mongo_db->getWhere ( $this->screening_app_col_tt_2021_2022, array (
				'doc_data.widget_data.page2.Personal Information.AD No' => $doc_data ['widget_data'] ['page2'] ['Personal Information'] ['AD No'],
				'doc_data.widget_data.page2.Personal Information.School Name' => $doc_data ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] 
		) );
		
		// $query = $this->mongo_db->getWhere("form_data_sample_copy_1", array('doc_data.widget_data.page2.Physical Info.ID number' => $doc_data['widget_data']['page2']['Physical Info']['ID number'],'doc_data.widget_data.page2.Physical Info.School'=>'TSWRS/JC(G)-JADCHERLA'));
		
		$result = json_decode ( json_encode ( $query ), FALSE );
		if (! $result) {
			$form_data = array ();
			$form_data ['doc_data'] = $doc_data;
			$form_data ['doc_properties'] = $doc_properties;
			$form_data ['history'] = $history;
			
			// $this->mongo_db->insert("naresh",$form_data);
			
			$this->mongo_db->insert ( $this->screening_app_col_tt_2021_2022, $form_data );
			// $this->mongo_db->insert("form_data_sample_copy_1",$form_data);
		} else {
			$form_data = array ();
			$form_data ['doc_data'] = $doc_data;
			$form_data ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['AD No'] = $doc_data ['widget_data'] ['page2'] ['Personal Information'] ['AD No'] . 'A';
			$form_data ['doc_properties'] = $doc_properties;
			$form_data ['history'] = $history;
			
			// $this->mongo_db->insert("naresh",$form_data);
			$this->mongo_db->insert ( $this->screening_app_col_tt_2021_2022, $form_data );
			// $this->mongo_db->insert("form_data_sample_copy_1",$form_data);
		}
	}
	public function get_all_symptoms($date = false, $request_duration = "Daily", $dt_name = "All", $school_name = "All",$request_pie_status = "All",$student_type = false,$student_age = false) {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'],false,$request_pie_status,$student_type,$student_age );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		$prob_arr = [ ];
		foreach ( $query as $doc ) {
			if (isset ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'] )) {
				$problems = $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'];
				 /*if ( $problems != " ")
				{*/
					foreach ( $problems as $problem ) {
						if (isset ( $prob_arr [$problem] )) {
							$prob_arr [$problem] ++;
						} else {
							$prob_arr [$problem] = 1;
						}
				} 
			}
		}
		
		// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob_arr,true));
		$final_values = [ ];
		foreach ( $prob_arr as $prob => $count ) {
			// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob,true));
			// //log_message("debug","ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc".print_r($count,true));
			$result ['label'] = $prob;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		// //log_message("debug","fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff".print_r($final_values,true));
		
		return $final_values;
	}

	public function get_all_symptoms_old_dash($date = false, $request_duration = "Monthly", $dt_name = "All", $school_name = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs_old_dash ( $dates ['today_date'], $dates ['end_date'] );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref']) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref']) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		$prob_arr = [ ];
		foreach ( $query as $doc ) {
			if (isset ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'] )) {
				$problems = $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'];
				foreach ( $problems as $problem ) {
					if (isset ( $prob_arr [$problem] )) {
						$prob_arr [$problem] ++;
					} else {
						$prob_arr [$problem] = 1;
					}
				}
			}
		}
		
		// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob_arr,true));
		$final_values = [ ];
		foreach ( $prob_arr as $prob => $count ) {
			// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob,true));
			// //log_message("debug","ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc".print_r($count,true));
			$result ['label'] = $prob;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		// //log_message("debug","fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff".print_r($final_values,true));
		
		return $final_values;
	}
	
	public function get_absent_pie_schools_data($date = FALSE, $dt_name = "All")
	{
		// Variables
		$all_schools               = array();
		$all_schools_district      = array();
		$all_schools_name      	   = array();
		
		$submitted_schools 	       = array();
		$submitted_school_district = array();
		$submitted_school_name     = array();
		$not_submitted_schools	   = array();
		$schools_data              = array();
		$not_submitted_dist        = array();
		
		$all_schools_mobile        = array();
		$all_schools_cpn      	   = array();
		$submitted_school_mob 	   = array();
		$submitted_school_person   = array();
		$not_submitted_school_mob 	   = array();
		$not_submitted_school_person   = array();
		
		$schools_list = $this->get_all_schools();
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
			$all_schools_mobile[$school_data['school_name']] = $school_data['school_mob'];
			$all_schools_cpn[$school_data['school_name']] = $school_data['contact_person_name'];
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
		
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====716=='.print_r($query,true));
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====717=='.print_r($today_date,true));
		
		foreach ( $query as $doc ) {
			    if(!in_array($doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'],$submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] );
					array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] );
					if(isset($all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School']])){
						array_push ( $submitted_school_mob,$all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School']] );
						array_push ( $submitted_school_person,$all_schools_cpn[$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School']] );
					}else{
						array_push ( $submitted_school_mob,"" );
						array_push ( $submitted_school_person,"" );
					}
					
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		$submitted_schools['mobile']       = $submitted_school_mob;
		$submitted_schools['person_name']  = $submitted_school_person;
		
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		  
		   $dist_array    = explode(",",$school_name);
		   
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		if(isset($all_schools_mobile[$school_name])){
				array_push ( $not_submitted_school_mob,$all_schools_mobile[$school_name] );
				array_push ( $not_submitted_school_person,$all_schools_cpn[$school_name] );
			}else{
				array_push ( $not_submitted_school_mob,"" );
				array_push ( $not_submitted_school_person,"" );
			}
		   
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		$not_submitted_schools['mobile']       = $not_submitted_school_mob;
		$not_submitted_schools['person_name']  = $not_submitted_school_person;
		
		
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		return $schools_data;
	}
	
	public function get_all_absent_data($date = FALSE, $dt_name = "All", $school_name = "All") {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
						array_push ( $doc_query, $doc );
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
					array_push ( $doc_query, $doc );
				}
			}
			$query = $doc_query;
		}
		
		$absent = 0;
		$sick = 0;
		$restRoom = 0;
		$r2h = 0;
		$attended = 0;
		foreach ( $query as $report ) {
			$absent = $absent + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Absent'] );
			$sick = $sick + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Sick'] );
			$restRoom = $restRoom + intval ( $report ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] ['RestRoom'] );
			$r2h = $r2h + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['R2H'] );
			$attended = $attended + intval($report['doc_data']['widget_data']['page1']['Attendence Details']['Attended']);
		}
		
		$requests = [ ];
		
		$request['label'] = 'ATTENDED';
		 $request['value'] = $attended;
		 array_push($requests,$request);
		
		$request ['label'] = 'ABSENT REPORT';
		$request ['value'] = $absent;
		array_push ( $requests, $request );
		
		$request ['label'] = 'SICK CUM ATTENDED';
		$request ['value'] = $sick;
		array_push ( $requests, $request );
		
		$request ['label'] = 'REST ROOM IN MEDICATION';
		$request ['value'] = $restRoom;
		array_push ( $requests, $request );
		
		$request ['label'] = 'REFER TO HOSPITAL';
		$request ['value'] = $r2h;
		array_push ( $requests, $request );
		
		return $requests;
	}
	
	
	public function get_all_sanitation_report_data($date = FALSE, $dt_name = "All", $school_name = "All") {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'history.last_stage.time', $today_date )->get ($this->sanitation_report_app_col );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page6'] ['School Information'] ['District'] ) == strtolower ( $dt_name )) {
						array_push ( $doc_query, $doc );
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page6'] ['School Information'] ['School Name'] ) == strtolower ( $school_name )) {
					array_push ( $doc_query, $doc );
				}
			}
			$query = $doc_query;
		}
		
		$handwash         = 0;
		$kitchen          = 0;
		$waste_management = 0;
		$cleanliness      = 0;
		$food             = 0;
		// $attended = 0;
		foreach ( $query as $report ) {
			$absent = $absent + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Absent'] );
			$sick = $sick + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Sick'] );
			$restRoom = $restRoom + intval ( $report ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] ['RestRoom'] );
			$r2h = $r2h + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['R2H'] );
			// $attended = $attended + intval($report['doc_data']['widget_data']['page1']['Attendence Details']['Attended']);
		}
		
		$requests = [ ];
		
		$request ['label'] = 'Handwash';
		$request ['value'] = $absent;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Kitchen';
		$request ['value'] = $sick;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Waste Management';
		$request ['value'] = $restRoom;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Cleanliness';
		$request ['value'] = $r2h;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Food';
		$request ['value'] = $r2h;
		array_push ( $requests, $request );
		
		return $requests;
	}
	
	public function drilldown_absent_to_districts($data, $date, $dt_name = "All", $school_name = "All") {
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		switch ($type) {
			case "ABSENT REPORT" :
				
				ini_set ( 'memory_limit', '1G' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") 
				{
					if ($dt_name != "All") 
					{
						foreach ( $query as $doc ) 
						{
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) 
							{
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} 
					else 
					{
						
					}
				} 
				else 
				{
					foreach ( $query as $doc ) 
					{
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) 
						{
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_attendance_districts_prepare_pie_array ($query,"Absent");
				break;
			
			case "SICK CUM ATTENDED" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_attendance_districts_prepare_pie_array ($query,"Sick");
				break;
			
			case "REST ROOM IN MEDICATION" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_attendance_districts_prepare_pie_array ($query,"RestRoom");
				break;
			
			case "REFER TO HOSPITAL" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_attendance_districts_prepare_pie_array ($query,"R2H");
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_absent_schools($data, $date, $dt_name = "All", $school_name = "All") {
		$obj_data = json_decode ( $data, true );
		// //log_message("debug","aaaaaaaaaaaaasfsdadsvadsfvdfvfdvfdvfd".print_r($obj_data,true));
		
		$type = $obj_data [0];
		$dist = strtolower ( $obj_data [1] );
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		// //log_message("debug","tttttttttttttttttttttttttttttttttttttttttttttt".print_r($type,true));
		switch ($type) {
			case "ABSENT REPORT" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_schools_prepare_pie_array ( $query, $dist,"Absent");
				
				break;
			case "SICK CUM ATTENDED" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_schools_prepare_pie_array ( $query, $dist,"Sick");
				
				break;
			
			case "REST ROOM IN MEDICATION" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_schools_prepare_pie_array ( $query, $dist,"RestRoom" );
				
				break;
			
			case "REFER TO HOSPITAL" :
				
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_schools_prepare_pie_array ( $query, $dist,"R2H");
				
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_absent_students($data, $date, $dt_name = "All", $school_name = "All") {
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['0'];
		$school_name = strtolower ( $obj_data ['1'] );
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		ini_set ( 'memory_limit', '10G' );
		
		switch ($type) {
			case "ABSENT REPORT" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_students_prepare_pie_array ( $query, $school_name, $type );
				
				break;
			case "SICK CUM ATTENDED" :
				$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_students_prepare_pie_array ( $query, $school_name, $type );
				
				break;
			
			case "REST ROOM IN MEDICATION" :
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_students_prepare_pie_array ( $query, $school_name, $type );
				
				break;
			
			case "REFER TO HOSPITAL" :
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereLike ( 'history.last_stage.time', $today_date )->get ( $this->absent_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($dt_name != "All") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dt_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_absent_students_prepare_pie_array ( $query, $school_name, $type );
				
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_absent_students_docs($_id_array) {
		$docs = [ ];
		
		ini_set ( 'memory_limit', '512M' );
		
		foreach ( $_id_array as $_id ) {
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where/* Like */ ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $_id )->get ( $this->screening_app_col );
			if ($query)
				array_push ( $docs, $query [0] );
		}
		
		// //log_message("debug","abbbbbbbbbbbbbbbbbbbbbbbbbb____________arrrrrrrrrrrrrrrrrrrrrrrrr".print_r($_id_array,true));
		// $query = $this->mongo_db->select(array('doc_data.widget_data.page1','doc_data.widget_data.page2'))->whereIn("doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $_id_array)->get($this->screening_app_col);
		// //log_message("debug","qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq".print_r($query,true));
		return $docs;
	}
	public function get_drilling_attendance_districts_prepare_pie_array($query,$category) {
		$requests = [ ];
		
		$dist_list = $this->get_all_district ();
		
		$dist_arr = [ ];
		foreach ( $dist_list as $dist ) {
			array_push ( $dist_arr, $dist ['dt_name'] );
		}
		
		foreach ( $dist_arr as $districts ) {
			$request ['label'] = $districts;
			$count = 0;
			if ($query) {
				foreach ( $query as $dist ) {
					if (isset ( $dist ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] )) {
						if (strtolower ( $dist ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $districts )) {
							//$count ++;
							if($category=="RestRoom")
							{
								$count = $count + (int) $dist ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] [$category];
							}
							else
							{
								$count = $count + (int) $dist ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] [$category];
							}
							
						}
					}
				}
			}
			$request ['value'] = $count;
			array_push ( $requests, $request );
		}
		
		return $requests;
	}
	public function get_drilling_absent_schools_prepare_pie_array($query, $dist,$category) {
		// ////log_message("debug","2222222222222222222222222222222222222222222222222".print_r($query,true));
		$search_result = [ ];
		$count = 0;
		if ($query) {
			foreach ( $query as $doc ) {
				// //log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddd".print_r($doc,true));
				if (isset ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] )) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == $dist) {
						array_push ( $search_result, $doc );
					}
				}
			}
			// //log_message("debug","sssssssssssssssssssssssssssssssssssssssssssssssssssssssssss".print_r($search_result,true));
			$request = [ ];
			foreach ( $search_result as $doc ) 
			{
				if($category=="RestRoom")
				{
					$request[$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School']] = (int) $doc ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] [$category];
				}
				else
				{
					$request[$doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School']] = (int) $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] [$category];
				}
			}
			
			
			$final_values = [ ];
			foreach ( $request as $school => $count ) 
			{
				$result ['label'] = $school;
				$result ['value'] = $count;
				array_push ( $final_values, $result );
			}
			
			
			
			return $final_values;
		}
	}
	public function get_drilling_absent_students_prepare_pie_array($query, $school_name, $type) {
		$search_result = [ ];
		$count = 0;
		if ($query) {
			foreach ( $query as $doc ) {
				// //log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddd".print_r($doc,true));
				if (isset ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] )) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Select School'] ) == $school_name) {
						array_push ( $search_result, $doc );
					}
				}
			}
			// //log_message("debug","sssssssssssssssssssssssssssssssssssssssssssssssssssssssssss".print_r($search_result,true));
			$request = [ ];
			$UI_arr = [ ];
			foreach ( $search_result as $doc ) {
				switch ($type) {
					case "ABSENT REPORT" :
						$absent_id_arr = explode ( ",", $doc ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] ['Absent UID'] );
						// //log_message("debug","aaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbarrrrrrrrrrrrrrrrrrrrrrr".print_r($absent_id_arr,true));
						$UI_arr = array_merge ( $UI_arr, $absent_id_arr );
						//log_message("error","mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm".print_r($UI_arr,true));
						
						break;
					case "SICK CUM ATTENDED" :
						
						$absent_id_arr = explode ( ",", $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Sick UID'] );
						// //log_message("debug","aaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbarrrrrrrrrrrrrrrrrrrrrrr".print_r($absent_id_arr,true));
						$UI_arr = array_merge ( $UI_arr, $absent_id_arr );
						
						break;
					
					case "REST ROOM IN MEDICATION" :
						
						$absent_id_arr = explode ( ",", $doc ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] ['RestRoom UID'] );
						// log_message("debug","aaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbarrrrrrrrrrrrrrrrrrrrrrr".print_r($absent_id_arr,true));
						$UI_arr = array_merge ( $UI_arr, $absent_id_arr );
						
						break;
					
					case "REFER TO HOSPITAL" :
						
						$absent_id_arr = explode ( ",", $doc ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['R2H UID'] );
						// log_message("debug","aaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbarrrrrrrrrrrrrrrrrrrrrrr".print_r($absent_id_arr,true));
						$UI_arr = array_merge ( $UI_arr, $absent_id_arr );
						
						break;
					
					default :
						;
						break;
				}
			}
			
			return $UI_arr;
		}
	}
	public function get_all_symptoms_docs($start_date, $end_date, $id_for_school = false,$request_pie_status = "All",$student_type = false,$student_age = false) {
		
		ini_set ( 'max_execution_time', 0 );
		ini_set('memory_limit', '100G');
		//log_message('error','id_for_school==========2433'.print_r($id_for_school,TRUE));
		if ($id_for_school) {
			$query = $this->mongo_db->whereIn ( "doc_data.widget_data.page1.Problem Info.Identifier", array (
					$id_for_school 
			) )->get ($this->request_app_col_static_html);//$this->request_app_col
		} else {
			
			/*$query = $this->mongo_db->select ( array (
					"doc_data.widget_data",
					"history" 
			) )->get ($this->request_app_col_static_html );// $this->request_app_col
		}*/
		if(isset($student_type) && !empty($student_type))
			{
				$search_query = array('doc_data.widget_data.page1.Student Info.Gender' => $student_type,'doc_data.widget_data.page1.Student Info.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => false));
				$query = $this->mongo_db->select ( array (
					"doc_data.widget_data",
					"history" 
				) )->where($search_query)->whereBetween('history.0.time',$end_date,$start_date)->get ($this->request_app_col_static_html );// $this->request_app_col
				
			}
			else
			{
				//$search_query = array('doc_data.widget_data.page1.Student Info.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => false));
				$query = $this->mongo_db->select ( array (
					"doc_data.widget_data",
					"history" 
				) )->whereBetween('history.0.time',$end_date,$start_date)->get ($this->request_app_col_static_html );// $this->request_app_col
				
			}
			
		}
		log_message('error','request_pie_statusrequest_pie_status==========2444'.print_r($request_pie_status,TRUE));
		$result = [ ];
		foreach ( $query as $doc ) {
			
			if($request_pie_status == "All"){
				if($doc['doc_data']['widget_data']['page2']['Review Info']['Status'] != "Cured"){
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];
				
				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					
					break;
				}
				}
			}
			}else if($request_pie_status == "Cured"){
				if($doc['doc_data']['widget_data']['page2']['Review Info']['Status'] == "Cured"){
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];
				
				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					break;
				}
				}
			}
			}
		}
		$query = $result;
		return $query;
	}

	public function get_all_symptoms_docs_old_dash($start_date, $end_date, $id_for_school = false) {
		ini_set ( 'max_execution_time', 0 );
		if ($id_for_school) {
			$query = $this->mongo_db->whereIn ( "doc_data.widget_data.page1.Problem Info.Identifier", array (
					$id_for_school 
			) )->get ( $this->request_app_col );
		} else {
			$query = $this->mongo_db->select ( array (
					"doc_data.widget_data",
					"history" 
			) )->get ( $this->request_app_col );
		}
		
		$result = [ ];
		foreach ( $query as $doc ) {
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];
				
				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					break;
				}
			}
		}
		$query = $result;
		return $query;
	}

	public function get_start_end_date($today_date, $request_duration) {
		if ($request_duration == "Daily") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "0 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Weekly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-6 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Bi Weekly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-13 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Monthly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-1 month" ) );
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date . "1 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Bi Monthly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-2 month" ) );
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date . "1 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Quarterly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-3 month" ) );
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date . "1 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "Half Yearly") {
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "-6 month" ) );
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date . "1 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		} else if ($request_duration == "2015-16 Academic Year"){
			$today_date = "2016-05-31";
			$date = new DateTime ( $today_date );
			$today_date = $date->format ('Y-m-d H:i:s');
			$end_date = date ("Y-m-d H:i:s", strtotime ( $today_date . "-12 month"));
			$end_date = date ("Y-m-d H:i:s", strtotime ( $end_date . "1 day"));
			
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		}else if ($request_duration == "2016-17 Academic Year"){
			$today_date = "2017-05-31";
			$date = new DateTime ( $today_date );
			$today_date = $date->format ('Y-m-d H:i:s');
			$end_date = date ("Y-m-d H:i:s", strtotime ( $today_date . "-12 month"));
			$end_date = date ("Y-m-d H:i:s", strtotime ( $end_date . "1 day"));
			
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			return $dates;
		}
		else if ($request_duration == "2017-18 Academic Year"){
			$today_date = "2018-04-25";
			$date = new DateTime ( $today_date );
			$today_date = $date->format ('Y-m-d H:i:s');
			$end_date = date ("Y-m-d H:i:s", strtotime ( $today_date . "-12 month"));
			$end_date = date ("Y-m-d H:i:s", strtotime ( $end_date . "1 day"));
			
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			
			return $dates;
		}
		else if ($request_duration == "Yearly") {
			$end_date = "2018-04-26";
			$date = new DateTime ( $today_date );
			$today_date = $date->format ( 'Y-m-d H:i:s' );
			//$month = explode("-",$today_date);
			//$month_final = "-".$month[1]." month";
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date ) );
			//$end_date = date ( "Y-m-d H:i:s", strtotime ( $end_date . "1 day" ) );
			$today_date = date ( "Y-m-d H:i:s", strtotime ( $today_date . "1 day" ) );
			$dates ['today_date'] = $today_date;
			$dates ['end_date'] = $end_date;
			//echo print_r($dates,TRUE);exit();
			return $dates;
		}
	}
	public function get_all_requests($date = false, $request_duration = "Daily", $dt_name = "All", $school_name = "All",$request_pie_status = "All", $student_type = false,$student_age = false) {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'],false,$request_pie_status,$student_type,$student_age );
	
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					/*$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
					$dist_code = explode("_", $unique_id);
					$doc = $this->mongo_db->select(array('dt_name'))->where('dt_code',$dist_code[0])->get('ttwreis_district');
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc [0] ['dt_name'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				/*$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
				$dist_codes = explode("_", $unique_id);
				$dist_code = intval($dist_codes[1]);
				if(isset($dist_code) && !empty($dist_code))
				{
					$this->mongo_db->switchDatabase($this->common_db['common_db']);
					$doc_data = $this->mongo_db->select(array('school_name'))->where('school_code',$dist_code)->get('ttwreis_schools');
					$this->mongo_db->switchDatabase($this->common_db['dsn']);
				}				
				if (isset ( $doc_data ) && ! empty ( $doc_data ) && (count ( $doc_data ) > 0)) {
					if (strtolower ( $doc_data [0] ['school_name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
			log_message("debug","query query======2286".print_r($query,true));
		}
		
		// $query = $this->mongo_db->select(array("doc_data.widget_data","history"))->get($this->request_app_col);
		
		$device_initiated = 0;
		$web_initiated = 0;
		$screening_initiated = 0;
		$prescribed = 0;
		$medication = 0;
		$followUp = 0;
		$cured = 0;
		$hospitalized = 0;
		// $attended = 0;
		
		$req_normal = 0;
		$req_emergency = 0;
		$req_chronic = 0;
		
		foreach ( $query as $report ) {
			$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
			
			/*if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if (($user_type == "CCUSER")) {
						$web_initiated ++;
					}else if(($user_type == "TADMIN")){
						$screening_initiated ++;
					} else {
						$device_initiated ++;
					}
				} else {
					$device_initiated ++;
				}*/
			
			if ($status == "Initiated") {
				// if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					// $user_type = $report ['history'] [0] ['submitted_user_type'];
					// if (($user_type == "CCUSER")) {
						// $web_initiated ++;
					// }else if(($user_type == "TADMIN")){
						// $screening_initiated ++;
					// } else {
						// $device_initiated ++;
					// }
				// } else {
					// $device_initiated ++;
				// }
			} else if ($status == "Prescribed") {
				$prescribed ++;
			} else if ($status == "Under Medication") {
				$medication ++;
			} else if ($status == "Follow-up") {
				$followUp ++;
			} else if ($status == "Cured") {
				$cured ++;
			} else if ($status == "Hospitalized") {
				$hospitalized ++;
			}
			
			$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
			
			if ($request_type == "Normal") {
				$req_normal ++;
			} else if ($request_type == "Emergency") {
				$req_emergency ++;
			} else if ($request_type == "Chronic") {
				$req_chronic ++;
			}
		}
		
		$requests = [ ];
		
		$request ['label'] = 'Device Initiated';
		$request ['value'] = $device_initiated;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Web Initiated';
		$request ['value'] = $web_initiated;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Screening Initiated';
		$request ['value'] = $screening_initiated;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Prescribed';
		$request ['value'] = $prescribed;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Under Medication';
		$request ['value'] = $medication;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Follow-up';
		$request ['value'] = $followUp;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Cured';
		$request ['value'] = $cured;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Hospitalized';
		$request ['value'] = $hospitalized;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Normal Req';
		$request ['value'] = $req_normal;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Emergency Req';
		$request ['value'] = $req_emergency;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Chronic Req';
		$request ['value'] = $req_chronic;
		array_push ( $requests, $request );
		
		return $requests;
	}

	public function get_all_requests_old_dash($date = false, $request_duration = "Yearly", $dt_name = "All", $school_name = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		
		$dates ['today_date'] = "2018-11-01";
		$dates ['end_date'] = "2016-01-01";
		$query = $this->get_all_symptoms_docs_old_dash ( $dates ['today_date'], $dates ['end_date'] );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
		
				//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
		
				if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref']) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		// $query = $this->mongo_db->select(array("doc_data.widget_data","history"))->get($this->request_app_col);
		
		$device_initiated = 0;
		$web_initiated = 0;
		$prescribed = 0;
		$medication = 0;
		$followUp = 0;
		$cured = 0;
		// $attended = 0;
		
		$req_normal = 0;
		$req_emergency = 0;
		$req_chronic = 0;
		
		foreach ( $query as $report ) {
			$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
			if ($status == "Initiated") {
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type == "CCUSER") {
						$web_initiated ++;
					} else {
						$device_initiated ++;
					}
				} else {
					$device_initiated ++;
				}
			} else if ($status == "Prescribed") {
				$prescribed ++;
			} else if ($status == "Under Medication") {
				$medication ++;
			} else if ($status == "Follow-up") {
				$followUp ++;
			} else if ($status == "Cured") {
				$cured ++;
			}
			
			$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
			if ($request_type == "Normal") {
				$req_normal ++;
			} else if ($request_type == "Emergency") {
				$req_emergency ++;
			} else if ($request_type == "Chronic") {
				$req_chronic ++;
			}
		}
		
		$requests = [ ];
		
		/*$request ['label'] = 'Device Initiated';
		$request ['value'] = $device_initiated;
		array_push ( $requests, $request );*/
		
		/*$request ['label'] = 'Web Initiated';
		$request ['value'] = $web_initiated;
		array_push ( $requests, $request );*/
		
		$request ['label'] = 'Prescribed';
		$request ['value'] = $prescribed;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Under Medication';
		$request ['value'] = $medication;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Follow-up';
		$request ['value'] = $followUp;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Cured';
		$request ['value'] = $cured;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Normal Req';
		$request ['value'] = $req_normal;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Emergency Req';
		$request ['value'] = $req_emergency;
		array_push ( $requests, $request );
		
		$request ['label'] = 'Chronic Req';
		$request ['value'] = $req_chronic;
		array_push ( $requests, $request );
		
		return $requests;
	}
	
	// ======================================================================
	public function get_all_requests_docs($start_date, $end_date, $type = false, $dt_name = "All", $school_name = "All",$request_pie_status = "All")
	 {
		/*if ($type == "Initiated") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Status' => $type,
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured") 
			) )->get ( $this->request_app_col );
		}else if ($type == "Screening") {
			$query = $this->mongo_db->where ( array (
					'history.0.submitted_user_type' => "TADMIN",
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured") 
			) )->get ( $this->request_app_col );
		} else if ($type == "Normal") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Normal",
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured") 
			) )->get ( $this->request_app_col );
		} else if ($type == "Emergency") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Emergency",
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured") 
			) )->get ( $this->request_app_col );
		} else if ($type == "Chronic") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Chronic",
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured") 
			) )->get ( $this->request_app_col );
		} else {
			$query = $this->mongo_db->where ( array('doc_data.widget_data.page2.Review Info.Status'=> $type,
				"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")) )->get ( $this->request_app_col );
		}
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		$result = [ ];
		foreach ( $query as $doc ) {
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];
				
				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					break;
				}
			}
		}
		$query = $result;
		return $query;*/

		if($request_pie_status == "All")
		{
			$and_merged_array_condition = array();
			if ($type == "Initiated") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Status' => $type,
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")
				);
			}else if ($type == "Screening") {
				
				$and_merged_array_condition = array (
					'history.0.submitted_user_type' => "PADMIN",
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")
				);
				
				
			} else if ($type == "Normal") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Normal",
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")				
				);
			} else if ($type == "Emergency") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Emergency",
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")
				);
				
				
			} else if ($type == "Chronic") {
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Chronic",
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")
				);
			} else {
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Status' => $type,
					"doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured")
				);
				
			}
		}
		else if ($request_pie_status == "Cured"){
			
			$and_merged_array_condition = array();
			if ($type == "Initiated") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Status' => $type,
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
			}else if ($type == "Screening") {
				
				$and_merged_array_condition = array (
					'history.0.submitted_user_type' => "PADMIN",
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
				
				
			} else if ($type == "Normal") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Normal",
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
			} else if ($type == "Emergency") {
				
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Emergency",
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
				
				
			} else if ($type == "Chronic") {
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Chronic",
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
			} else {
				$and_merged_array_condition = array (
					'doc_data.widget_data.page2.Review Info.Status' => $type,
					"doc_data.widget_data.page2.Review Info.Status" => "Cured"
				);
				
			}
			
		}
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn vvvvvvvvvvvvvvvvvvvvvvvvvvvv11111111111111111111111111111111111--".print_r($and_merged_array_condition,true));
		
		$his_0_lte = array (
				"history.0.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_0_gte = array (
				"history.0.time" => array (
						'$gte' => $end_date 
				) 
		);
		$his_1_lte = array (
				"history.1.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_1_gte = array (
				"history.1.time" => array (
						'$gte' => $end_date 
				) 
		);
		$his_last_lte = array (
				"history.last_stage.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_last_gte = array (
				"history.last_stage.time" => array (
						'$gte' => $end_date 
				) 
		);
		
		//$and_merged_array_condition = array();
		$and_merged_array_0 = array();
		$and_merged_array_1 = array();
		$and_merged_array_last = array();
		
		array_push ( $and_merged_array_0, $his_0_lte );
		array_push ( $and_merged_array_0, $his_0_gte );
		array_push ( $and_merged_array_0, $and_merged_array_condition );
		
		
		array_push ( $and_merged_array_1, $his_1_lte );
		array_push ( $and_merged_array_1, $his_1_gte );
		array_push ( $and_merged_array_1, $and_merged_array_condition );

		array_push ( $and_merged_array_last, $his_last_lte );
		array_push ( $and_merged_array_last, $his_last_gte );
		array_push ( $and_merged_array_last, $and_merged_array_condition );
		
		
		// ////log_message("debug","response=====1665==".print_r($merged_array,true));
		$result = [ ];
			
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$or' => array (
										array('$and' => $and_merged_array_0),
										array('$and' => $and_merged_array_1),
										array('$and' => $and_merged_array_last),
								)									
							) 
					)
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline 
			) );
			//$this->request_app_col,
			//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn vvvvvvvvvvvvvvvvvvvvvvvvvvvv11111111111111111111111111111111111--".print_r($response,true));
			
			//=============================================vjhbdhdsuhyvsuyhvuyv
			$query = array();
			if($response['ok']){
				$query = $response["result"];
			}
			
		
		
		
		// if ($type == "Initiated") {
			// $query = $this->mongo_db->where ( array (
					// 'doc_data.widget_data.page2.Review Info.Status' => $type 
			// ) )->get ( $this->request_app_col );
		// }else if ($type == "Screening") {
			// $query = $this->mongo_db->where ( array (
					// 'history.0.submitted_user_type' => "PADMIN" 
			// ) )->get ( $this->request_app_col );
		// } else if ($type == "Normal") {
			// $query = $this->mongo_db->where ( array (
					// 'doc_data.widget_data.page2.Review Info.Request Type' => "Normal" 
			// ) )->get ( $this->request_app_col );
		// } else if ($type == "Emergency") {
			// $query = $this->mongo_db->where ( array (
					// 'doc_data.widget_data.page2.Review Info.Request Type' => "Emergency" 
			// ) )->get ( $this->request_app_col );
		// } else if ($type == "Chronic") {
			// $query = $this->mongo_db->where ( array (
					// 'doc_data.widget_data.page2.Review Info.Request Type' => "Chronic" 
			// ) )->get ( $this->request_app_col );
		// } else {
			// $query = $this->mongo_db->whereLike ( 'doc_data.widget_data.page2.Review Info.Status', $type )->get ( $this->request_app_col );
		// }
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}*/
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					if(isset($unique_id) && !empty($unique_id))
					{
						if(strtolower($doc ['doc_data'] ['widget_data'] ['page1']['Student Info']['District']['field_ref']) == strtolower ( $dt_name ))
						{
							array_push ( $doc_query, $doc );
						}
					}


				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}*/
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					if(isset($unique_id) && !empty($unique_id))
					{
						if(strtolower($doc ['doc_data'] ['widget_data'] ['page1']['Student Info']['School Name']['field_ref']) == strtolower ( $dt_name ))
						{
							array_push ( $doc_query, $doc );
						}
					}
			}
			$query = $doc_query;
		}
		
		// $result = [ ];
		// foreach ( $query as $doc ) {
			
			// foreach ( $doc ['history'] as $date ) {
				// $time = $date ['time'];
				
				// if (($time <= $start_date) && ($time >= $end_date)) {
					// array_push ( $result, $doc );
					// break;
				// }
			// }
		// }
		//log_message("error","innnnnnnnnnnnnnnnnnnnnn fn vvvvvvvvvvvvvvvvvvvvvvvvvvvv11111111111111111111111111111111111qqq--".print_r($query,true));
		//$query = $result;
		return $query;
	}
	public function drilldown_request_to_districts($data, $date = false, $request_duration = "Daily", $dt_name = "All", $school_name = "All",$request_pie_status = "All",$student_type = false,$student_age = false) {
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn 2222222222222222222222222222222222222222222222222222222222");
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		if(isset($student_age) && isset($student_type))
		{

		}else
		{

		}

		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query_temp = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'],false,$request_pie_status,$student_type,$student_age );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query_temp as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					/*$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
					$dist_code = explode("_", $unique_id);
					$doc = $this->mongo_db->select(array('dt_name'))->where('dt_code',$dist_code[0])->get('ttwreis_district');
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc [0] ['dt_name']) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query_temp = $doc_query;
			} else {
			}
		} else {
			foreach ( $query_temp as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				/*$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
				$dist_code = explode("_", $unique_id);

				$this->mongo_db->switchDatabase($this->common_db['common_db']);
				$doc = $this->mongo_db->select(array('school_name'))->where('school_code',$dist_code[1])->get('ttwreis_schools');
				$this->mongo_db->switchDatabase($this->common_db['dsn']);

				if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc [0] ['school_name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query_temp = $doc_query;
		}
		
		if ($type == "Device Initiated") {
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				
					if ($status == "Initiated") {
						
						if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						} else {
							array_push ( $query, $report );
						}
					} else {
						array_push ( $query, $report );
					}	
				} 
			}
		
		} else if ($type == "Screening Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Screening", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {				
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
			
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						}else if(($user_type == "PADMIN")){
							array_push ( $query, $report );
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
				
			}
		} else if ($type == "Web Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							array_push ( $query, $report );							
						}else if(($user_type == "PADMIN")){
							//$screening_initiated ++;
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Normal") {
					array_push ( $query, $report );	
				}
			}	
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Emergency") {
					array_push ( $query, $report );	
				}
			}
			
			
			
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Chronic") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Prescribed") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Prescribed") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Under Medication") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Under Medication") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Follow-up") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Follow-up") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Cured") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Cured") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Hospitalized") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Hospitalized") {
					array_push ( $query, $report );	
				}
			}
			
			
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name,$request_pie_status );
		}
		
		$dist_list = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			$dist_code = explode("_", $unique_id);
			$doc = $this->mongo_db->select(array('dt_name'))->where('dt_code',$dist_code[0])->get('ttwreis_district');
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$district = $doc [0] ["dt_name"];
				if (isset ( $dist_list [$district] )) {
					$dist_list [$district] ++;					
				} else {
					$dist_list [$district] = 1;
				}
			}
		}
		
		$final_values = [ ];
		foreach ( $dist_list as $dicsts => $count ) {
			$result ['label'] = $dicsts;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn 333333333333333333333333333333333333333333333333333333");
		return $final_values;
	}

	public function drilldown_request_to_districts_old_dash($data, $date = false, $request_duration = "Yearly", $dt_name = "All", $school_name = "All") {
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$dates ['today_date'] = "2018-11-01";
		$dates ['end_date'] = "2016-01-01";
		
		// ini_set('memory_limit', '512M');
		
		if ($type == "Device Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type != "CCUSER") {
						array_push ( $query, $report );
					}
				} else {
					array_push ( $query, $report );
				}
			}
		} else if ($type == "Web Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type == "CCUSER") {
						array_push ( $query, $report );
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name );
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name );
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name );
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name );
		}
		
		$dist_list = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			//$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			
			if (isset ( $request ) && ! empty ( $request ) && (count ( $request ) > 0)) {
				$district = $request['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District']['field_ref'];
				if (isset ( $dist_list [$district] )) {
					$dist_list [$district] ++;
				} else {
					$dist_list [$district] = 1;
				}
			}
		}
		
		$final_values = [ ];
		foreach ( $dist_list as $dicsts => $count ) {
			$result ['label'] = $dicsts;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}


	public function get_drilling_request_schools($data, $date = false, $request_duration = "Daily", $dt_name = "All", $school_name = "All",$request_pie_status = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		
		$obj_data = json_decode ( $data, true );
		
		$type = $obj_data [0];
		$dist = strtolower ( $obj_data [1] );
		
		$query_temp = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'],false,$request_pie_status );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query_temp as $doc ) {
					/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query_temp = $doc_query;
			} else {
			}
		} else {
			foreach ( $query_temp as $doc ) {
				
				
				/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
				
				if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query_temp = $doc_query;
		}
		
		if ($type == "Device Initiated") {
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				
					if ($status == "Initiated") {
						
						if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						} else {
							array_push ( $query, $report );
						}
					} else {
						array_push ( $query, $report );
					}	
				} 
			}
		
		} else if ($type == "Screening Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Screening", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {				
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
			
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						}else if(($user_type == "PADMIN")){
							array_push ( $query, $report );
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
				
			}
		} else if ($type == "Web Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							array_push ( $query, $report );							
						}else if(($user_type == "PADMIN")){
							//$screening_initiated ++;
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Normal") {
					array_push ( $query, $report );	
				}
			}	
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Emergency") {
					array_push ( $query, $report );	
				}
			}
			
			
			
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Chronic") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Prescribed") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Prescribed") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Under Medication") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Under Medication") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Follow-up") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Follow-up") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Cured") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Cured") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Hospitalized") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Hospitalized") {
					array_push ( $query, $report );	
				}
			}
			
			
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name,$request_pie_status );
		}
		
		$school_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$district = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'];
				if (strtolower ( $district ) == $dist) {
					array_push ( $matching_docs, $doc [0] );
				}
			}
		}
		
		foreach ( $matching_docs as $docs ) {
			$school_name = $docs ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
			if (isset ( $school_list [$school_name] )) {
				$school_list [$school_name] ++;
			} else {
				$school_list [$school_name] = 1;
			}
		}
		
		$final_values = [ ];
		foreach ( $school_list as $school => $count ) {
			$result ['label'] = $school;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn 666666666666666666666666666666666666666");
		return $final_values;
	}
public function get_drilling_request_schools_old_dash($data, $date = false, $request_duration = "Yearly", $dt_name = "All", $school_name = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$dates ['today_date'] = "2018-11-01";
		$dates ['end_date'] = "2016-01-01";

		$obj_data = json_decode ( $data, true );
		
		$type = $obj_data [0];
		$dist = strtolower ( $obj_data [1] );
		
		if ($type == "Device Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type != "CCUSER") {
						array_push ( $query, $report );
					}
				} else {
					array_push ( $query, $report );
				}
			}
		} else if ($type == "Web Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type == "CCUSER") {
						array_push ( $query, $report );
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name );
			
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name );
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name );
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name );
		}
		
		// ini_set('memory_limit', '512M');
		// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
		
		$school_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			//$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $request ) && ! empty ( $request ) && (count ( $request ) > 0)) {
				$district = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District']['field_ref'];
				if (strtolower ( $district ) == $dist) {
					array_push ( $matching_docs, $request );
				}
			}
		}
		
		foreach ( $matching_docs as $docs ) {
			
			$school_name = $docs ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name']['field_ref'];
			if (isset ( $school_list [$school_name] )) {
				$school_list [$school_name] ++;
			} else {
				$school_list [$school_name] = 1;
			}
		}
		
		$final_values = [ ];
		foreach ( $school_list as $school => $count ) {
			$result ['label'] = $school;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}

	public function get_drilling_request_students($data, $date = false, $request_duration = "Daily", $dt_name = "All", $school_name = "All", $request_pie_status = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		
		$obj_data = json_decode ( $data, true );
		log_message("error","ooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($dates,true));
		
		$type = $obj_data ['0'];
		$school_name = $obj_data ['1'];	
		
		$query_temp = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'],false,$request_pie_status );
		log_message("error","tttttttttttttttttttttttttttttttttttttttttttttt".print_r($query_temp,true));
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query_temp as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					/*$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
					/*$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data' 
					) )->where ( 'doc_data.widget_data.page1.Student Info.Unique ID', $unique_id )->get ( $this->request_app_col_static_html );*/
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query_temp = $doc_query;
			} else {
			}
		} else {
			foreach ( $query_temp as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				/*$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );*/
				/*$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data' 
					) )->where ( 'doc_data.widget_data.page1.Student Info.Unique ID', $unique_id )->get ( $this->request_app_col_static_html );*/
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query_temp = $doc_query;
		}
		
		if ($type == "Device Initiated") {
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				
					if ($status == "Initiated") {
						
						if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						} else {
							array_push ( $query, $report );
						}
					} else {
						array_push ( $query, $report );
					}	
				} 
			}
		
		} else if ($type == "Screening Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Screening", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {				
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
			
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							//$web_initiated ++;
						}else if(($user_type == "PADMIN")){
							array_push ( $query, $report );
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
				
			}
		} else if ($type == "Web Initiated") {
			//$query_temp = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Initiated") {
					if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
						$user_type = $report ['history'] [0] ['submitted_user_type'];
						if (($user_type == "CCUSER")) {
							array_push ( $query, $report );							
						}else if(($user_type == "PADMIN")){
							//$screening_initiated ++;
						} else {
							//$device_initiated ++;
						}
					} else {
						//$device_initiated ++;
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name,$request_pie_status );
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Normal") {
					array_push ( $query, $report );	
				}
			}	
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Emergency") {
					array_push ( $query, $report );	
				}
			}
			
			
			
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$request_type = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Request Type'];
				if ($request_type == "Chronic") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Prescribed") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Prescribed") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Under Medication") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Under Medication") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Follow-up") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Follow-up") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Cured") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Cured") {
					array_push ( $query, $report );	
				}
			}
			
			
		}else if ($type == "Hospitalized") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			//$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name,$request_pie_status );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				$status = $report ['doc_data'] ['widget_data'] ['page2'] ['Review Info'] ['Status'];
				if ($status == "Hospitalized") {
					array_push ( $query, $report );	
				}
			}
			
			
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name,$request_pie_status );
		}
		
		// ini_set('memory_limit', '512M');
		// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
		$student_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn 9999999999999999999999999999999999999");
			$retrieval_list = array ();
			//$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $request ) && ! empty ( $request ) && count ( $request ) > 0) {
				//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa");
				$school = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name']['field_ref'];
				if ($school == $school_name) {
					//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb");
					array_push ( $matching_docs, $request ['doc_data']['widget_data']['page1']['Student Info']['Unique ID'] );
				}
			}
		}
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn ccccccccccccccccccccccccccccccccccccccccccccccccccccccc");
		return $matching_docs;
	}

	public function get_drilling_request_students_old_dash($data, $date = false, $request_duration = "Monthly", $dt_name = "All", $school_name = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$dates ['today_date'] = "2018-11-01";
		$dates ['end_date'] = "2016-01-01";
		
		$obj_data = json_decode ( $data, true );
		// log_message("debug","ooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($obj_data,true));
		
		$type = $obj_data ['0'];
		$school_name = $obj_data ['1'];
		
		// log_message("debug","tttttttttttttttttttttttttttttttttttttttttttttt".print_r($type,true));
		
		if ($type == "Device Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type != "CCUSER") {
						array_push ( $query, $report );
					}
				} else {
					array_push ( $query, $report );
				}
			}
		} else if ($type == "Web Initiated") {
			$query_temp = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Initiated", $dt_name, $school_name );
			
			$query = [ ];
			foreach ( $query_temp as $report ) {
				
				if (isset ( $report ['history'] [0] ['submitted_user_type'] )) {
					$user_type = $report ['history'] [0] ['submitted_user_type'];
					if ($user_type == "CCUSER") {
						array_push ( $query, $report );
					}
				}
			}
		} else if ($type == "Normal Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Normal", $dt_name, $school_name );
		} else if ($type == "Emergency Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Emergency", $dt_name, $school_name );
		} else if ($type == "Chronic Req") {
			// $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], "Chronic", $dt_name, $school_name );
		} else {
			// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
			$query = $this->get_all_requests_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], $type, $dt_name, $school_name );
		}
		
		// ini_set('memory_limit', '512M');
		// $query = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Status',$type)->get($this->request_app_col);
		$student_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			//$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $request ) && ! empty ( $request ) && count ( $request ) > 0) {
				$school = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref'];
				if ($school == $school_name) {
					//array_push ( $matching_docs, $doc [0] ['_id']->{'$id'} );
					array_push ( $matching_docs, $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID']);
				}
			}
		}
		return $matching_docs;
	}
public function get_all_requests_docs_old_dash($start_date, $end_date, $type = false, $dt_name = "All", $school_name = "All") 
	{
		if ($type == "Initiated") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Status' => $type 
			) )->get ( $this->request_app_col );
		} else if ($type == "Normal") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Normal" 
			) )->get ( $this->request_app_col );
			
		} else if ($type == "Emergency") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Emergency" 
			) )->get ( $this->request_app_col );
		} else if ($type == "Chronic") {
			$query = $this->mongo_db->where ( array (
					'doc_data.widget_data.page2.Review Info.Request Type' => "Chronic" 
			) )->get ( $this->request_app_col );
		} else {
			$query = $this->mongo_db->whereLike ( 'doc_data.widget_data.page2.Review Info.Status', $type )->get ( $this->request_app_col );
		}

		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}*/					

					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
		
				/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
		
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name']) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}*/
			
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
			}
			$query = $doc_query;
		}
		
		$result = [ ];
		foreach ( $query as $doc ) {
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];

				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					break;
				}
			}
		}
		$query = $result;
		return $query;
	}

	public function get_drilling_request_students_docs($_id_array) {
		/*$docs = [ ];
		//log_message ( "debug", "dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd" . print_r ( $_id_array, true ) );
		foreach ( $_id_array as $_id ) {
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );
			array_push ( $docs, $query [0] );
		}*/

		$docs = [ ];
		//log_message ( "debug", "rrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr" . print_r ( $_id_array, true ) );
		if (isset ( $_id_array ) && ! empty ( $_id_array ) && count ( $_id_array ) > 0) {
		foreach ( $_id_array as $_id ) {
			/*$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );*/
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "doc_data.widget_data.page1.Student Info.Unique ID", $_id )->get ( $this->request_app_col_static_html );
			array_push ( $docs, $query [0] );
			}
		}
		//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn ffffffffffffffffffffffffffffffffffffffffffffffffffffffff");
		
		return $docs;
	}
	

	public function get_drilling_request_students_docs_old_dash($_id_array) {
		$docs = [ ];
		
		foreach ( $_id_array as $_id ) {

			/*$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );*/
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",  $_id)->get ( $this->screening_app_col );

			if(empty($query))
			{
				$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
				) )->where ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",  $_id)->get ( 'healthcare201671115519757_divided_passed_out' );
			}
			if(isset($query[0]) && !empty($query[0]))
			{
				array_push ( $docs, $query [0] );
			}
		}
		return $docs;
	}
	// ----------------------------------------------------------------------
	
	// ===================================id=======================+==========================
	public function drilldown_identifiers_docs($start_date, $end_date, $type) {
		ini_set ( 'memory_limit', '512M' );
		$query = $this->mongo_db->whereIn ( "doc_data.widget_data.page1.Problem Info.Identifier", array (
				$type 
		) )->get ( $this->request_app_col );
		
		$result = [ ];
		foreach ( $query as $doc ) {
			
			foreach ( $doc ['history'] as $date ) {
				$time = $date ['time'];
				
				if (($time <= $start_date) && ($time >= $end_date)) {
					array_push ( $result, $doc );
					break;
				}
			}
		}
		$query = $result;
		
		return $query;
	}
	public function drilldown_identifiers_to_districts($data, $date = false, $request_duration ="Daily", $dt_name = "All", $school_name = "All",$request_pie_status = "All") {
		ini_set ( 'max_execution_time', 0 );
		ini_set ( 'memory_limit', '10G' );
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'], $type ,$request_pie_status );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );*/
							if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} 
			else
			{
			foreach ( $query as $doc ) {
				
				/*$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );*/
									if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
															
																array_push ( $doc_query, $doc );
														}
													}
													//log_message ( 'debug', 'drilldown_identifiers_to_districts----doc_query-----' . print_r ( $doc_query, true ) );
													$query = $doc_query;
												}
											} else {
			foreach ( $query as $doc ) {
						
						if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name'] ['field_ref'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page1.Problem Info.Identifier", array($type))->get($this->request_app_col);
		$dist_list = [ ];
		
		foreach ( $query as $identifiers ) {
			
			$retrieval_list = array ();
			//$unique_id = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//log_message ( 'debug', 'unique_id----' . print_r ( $unique_id, true ) );
			//$doc = $this->mongo_db->where/*Like*/ ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
		    //log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd".print_r($doc,true));
			//log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd".print_r(count($doc),true));
			if (isset ( $identifiers ) && ! empty ( $identifiers ) && (count ( $identifiers ) > 0)) {
				$district = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'];
				if (isset ( $dist_list [$district] )) {
					$dist_list [$district] ++;
				} else {
					$dist_list [$district] = 1;
				}
			}
		}
		
		$final_values = [ ];
		foreach ( $dist_list as $dicsts => $count ) {
			$result ['label'] = $dicsts;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}
	public function drilldown_identifiers_to_districts_old_dash($data, $date = false, $request_duration = "Monthly", $dt_name = "All", $school_name = "All") {
		ini_set ( 'max_execution_time', 0 );
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$dates ['today_date'] = "2018-10-01";
		$dates ['end_date'] = "2016-01-01";
		//$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs_old_dash ( $dates ['today_date'], $dates ['end_date'], $type );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );doc_data.widget_data.page1.Student Info.District.
					if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District']['field_ref'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
		
				//$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				//$screening_doc = $this->mongo_db->select(array('doc_data.widget_data.page2'))->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
		
				if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['School Name']['field_ref']) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page1.Problem Info.Identifier", array($type))->get($this->request_app_col);
		$dist_list = [ ];
		
		foreach ( $query as $identifiers ) {
			
			$retrieval_list = array ();
			//$unique_id = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			// log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd".print_r($doc,true));
			if (isset ( $identifiers) && (!empty ( $identifiers)) && (count ( $identifiers > 0))) {
				$district = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['District'] ['field_ref'];
				if (isset ( $dist_list [$district] )) {
					$dist_list [$district] ++;
				} else {
					$dist_list [$district] = 1;
				}
			}
		}
		
		$final_values = [ ];
		foreach ( $dist_list as $dicsts => $count ) {
			$result ['label'] = $dicsts;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}

	public function get_drilling_identifiers_schools($data, $date = false, $request_duration = "Monthly", $dt_name = "All", $school_name = "All") {
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$obj_data = json_decode ( $data, true );
		
		$type = $obj_data [0];
		$dist = strtolower ( $obj_data [1] );
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'], $type );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		// ini_set('memory_limit', '512M');
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page1.Problem Info.Identifier", array($type))->get($this->request_app_col);
		
		$school_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$district = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'];
				if (strtolower ( $district ) == strtolower ( $dist )) {
					array_push ( $matching_docs, $doc [0] );
				}
			}
		}
		
		foreach ( $matching_docs as $docs ) {
			$school_name = $docs ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
			if (isset ( $school_list [$school_name] )) {
				$school_list [$school_name] ++;
			} else {
				$school_list [$school_name] = 1;
			}
		}
		
		$final_values = [ ];
		foreach ( $school_list as $school => $count ) {
			$result ['label'] = $school;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}
	public function get_drilling_identifiers_students($data, $date = false, $request_duration = "Monthly", $dt_name = "All", $school_name = "All") {
		$obj_data = json_decode ( $data, true );
		// log_message("debug","ooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($obj_data,true));
		
		$type = $obj_data ['0'];
		$school_name = $obj_data ['1'];
		
		// log_message("debug","tttttttttttttttttttttttttttttttttttttttttttttt".print_r($type,true));
		
		$query = [ ];
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $request_duration );
		$query = $this->get_all_symptoms_docs ( $dates ['today_date'], $dates ['end_date'], $type );
		
		$doc_query = array ();
		if ($school_name == "All") {
			if ($dt_name != "All") {
				foreach ( $query as $doc ) {
					$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
					$screening_doc = $this->mongo_db->select ( array (
							'doc_data.widget_data.page2' 
					) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
					if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
						if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $dt_name )) {
							array_push ( $doc_query, $doc );
						}
					}
				}
				$query = $doc_query;
			} else {
			}
		} else {
			foreach ( $query as $doc ) {
				
				$unique_id = $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
				$screening_doc = $this->mongo_db->select ( array (
						'doc_data.widget_data.page2' 
				) )->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
				
				if (isset ( $screening_doc ) && ! empty ( $screening_doc ) && (count ( $screening_doc ) > 0)) {
					if (strtolower ( $screening_doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == strtolower ( $school_name )) {
						array_push ( $doc_query, $doc );
					}
				}
			}
			$query = $doc_query;
		}
		
		// ini_set('memory_limit', '512M');
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page1.Problem Info.Identifier", array($type))->get($this->request_app_col);
		
		$student_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$school = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
				if ($school == $school_name) {
					array_push ( $matching_docs, $doc [0] ['_id']->{'$id'} );
				}
			}
		}
		
		return $matching_docs;
	}
	public function get_drilling_identifiers_students_docs($_id_array) {
		$docs = [ ];
		
		foreach ( $_id_array as $_id ) {
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );
			array_push ( $docs, $query [0] );
		}
		return $docs;
	}
	
	// ===================================id=================================================
	private function screening_pie_data_for_stage1($dates) {
		ini_set ( 'max_execution_time', 0 );
		// ============================================================stage 1 ==============================================
		
		$count = $this->mongo_db->count ( $this->screening_app_col );
		if ($count < 10000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 10000;
			$loop = $count / $per_page;
		}
		
		$requests = [ ];
		
		$request ['label'] = 'Physical Abnormalities';
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page5.Doctor Check Up.Deficencies", array("Over Weight", "Under Weight"))->count($this->screening_app_col);
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight",
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
			// log_message("debug","responseeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=====1665==".print_r($response,true));
		}
		
		$request ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request ['label'] = 'General Abnormalities';
		
		// $search = array("doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array("Over Weight", "Under Weight"));
		// $query = $this->mongo_db->where(array("doc_data.widget_data.page5.Doctor Check Up.N A D" => array("Yes")))->count($this->screening_app_col);
		
		$merged_array = array ();
		$nad_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.N A D" => array (
						'$nin' => array (
								"Yes" 
						) 
				) 
		);
		$nad_not_yes = array (
				"doc_data.widget_data.page5.Doctor Check Up.N A D" => array (
						'$exists' => true 
				) 
		);
		
		$abnormalities_not_string = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => " " 
				) 
		);
		$ortho_not_string = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => " " 
				) 
		);
		$postural_not_string = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => " " 
				) 
		);
		$description_not_string = array (
				"doc_data.widget_data.page4.Doctor Check Up.Description" => array (
						'$ne' => "" 
				) 
		);
		$advice_not_string = array (
				"doc_data.widget_data.page4.Doctor Check Up.Advice" => array (
						'$ne' => "" 
				) 
		);
		$defects_not_string = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => " " 
				) 
		);
		$deficencles_not_string = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencles" => array (
						'$ne' => " " 
				) 
		);
		$childhood_not_string = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => " " 
				) 
		);
		$nad_not_string = array (
				"doc_data.widget_data.page5.Doctor Check Up.N A D" => array (
						'$ne' => " " 
				) 
		);
		$deficencies_not_string = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => " " 
				) 
		);
		
		array_push ( $merged_array, $nad_exists );
		array_push ( $merged_array, $nad_not_yes );
		
		array_push ( $merged_array, $abnormalities_not_string );
		array_push ( $merged_array, $ortho_not_string );
		array_push ( $merged_array, $postural_not_string );
		array_push ( $merged_array, $description_not_string );
		array_push ( $merged_array, $advice_not_string );
		array_push ( $merged_array, $defects_not_string );
		array_push ( $merged_array, $deficencles_not_string );
		array_push ( $merged_array, $childhood_not_string );
		array_push ( $merged_array, $nad_not_string );
		array_push ( $merged_array, $deficencies_not_string );
		
		// //log_message("debug","response=====1665==".print_r($merged_array,true));
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request ['label'] = 'Eye Abnormalities';
		// $search = array("doc_data.widget_data.page6.Without Glasses.Right" => "6/6", "doc_data.widget_data.page6.Without Glasses.Left" => "6/6", "doc_data.widget_data.page6.With Glasses.Right" => "", "doc_data.widget_data.page6.With Glasses.Left" => "", "doc_data.widget_data.page6.With Glasses.Right" => "6/6", "doc_data.widget_data.page6.With Glasses.Left" => "6/6", "doc_data.widget_data.page7.Colour Blindness.Right" => "No", "doc_data.widget_data.page7.Colour Blindness.Left" => "No", "doc_data.widget_data.page6" => array(),"doc_data.widget_data.page7" => array());
		// $query = $this->mongo_db->whereNe($search)->count($this->screening_app_col);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		
		array_push ( $and_merged_array, $page6_exists );
		array_push ( $and_merged_array, $page7_exists );
		
		// //log_message("debug","response=====1665==".print_r($merged_array,true));
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		// //log_message("debug","response=====1748==".print_r($response,true));
		// //log_message("debug","response=====1749==".print_r(count($response['result']),true));
		
		$request ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request ['label'] = 'Auditory Abnormalities';
		// $search = array("doc_data.widget_data.page8. Auditory Screening.Right" => "Pass", "doc_data.widget_data.page8. Auditory Screening.Left" => "Pass", "doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array('Normal'), "doc_data.widget_data.page8" => array());
		// $query = $this->mongo_db->whereNe($search)->count($this->screening_app_col);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		array_push ( $or_merged_array, $audi_left );
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request ['label'] = 'Dental Abnormalities';
		// $search = array("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => "Good", "doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => "No", "doc_data.widget_data.page9.Dental Check-up.Flourosis" => "No","doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => "No","doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => "No", "doc_data.widget_data.page9" => array());
		// $query = $this->mongo_db->whereNe($search)->count($this->screening_app_col);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"",
								" " 
						) 
				) 
		);
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $or_merged_array, $flourosis );
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $or_merged_array, $indication );
		
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			// log_message("debug","deeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee===".print_r($response,true));
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		// log_message("debug","pppppppppppppppppppppppppppppppp123=====".print_r($requests,true));
		
		return $requests;
		
		// ============================================================end of stage 1 =======================================
	}
	private function screening_pie_data_for_stage2($dates) {
		ini_set ( 'max_execution_time', 0 );
		ini_set ( 'memory_limit', '1G' );
		$count = $this->mongo_db->count ( $this->screening_app_col );
		if ($count < 10000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 10000;
			$loop = $count / $per_page;
		}
		// ======================================================stage 2 =================================================
		
		// $query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Name' => 1))->select(array("doc_data.widget_data"))->limit($per_page)->offset($page-1)->get($this->screening_app_col);
		
		$requests = [ ];
		
		$request = [ ];
		$request ['Physical Abnormalities'] ['label'] = 'Over Weight';
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page5.Doctor Check Up.Deficencies", array("Over Weight"))->count($this->screening_app_col);
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ['Physical Abnormalities'] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ['Physical Abnormalities'] ['label'] = 'Under Weight';
		// $query = $this->mongo_db->whereIn("doc_data.widget_data.page5.Doctor Check Up.Deficencies", array("Under Weight"))->count($this->screening_app_col);
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ['Physical Abnormalities'] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'General';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4" => array(), "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array()))->count($this->screening_app_col);
		
		$and_merged_array = array ();
		
		$general_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => '' 
				) 
		);
		$general_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => ' ' 
				) 
		);
		$general_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => [ ] 
				) 
		);
		
		$not_skin = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$nin' => array (
								"Skin" 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $general_str_empty );
		array_push ( $and_merged_array, $general_str_space );
		array_push ( $and_merged_array, $general_arr );
		array_push ( $and_merged_array, $not_skin );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Skin';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4" => array(), "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array()))->count($this->screening_app_col);
		
		$and_merged_array = array ();
		
		$merged_array = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$in' => array (
								"Skin" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Ortho';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4" => array(), "doc_data.widget_data.page4.Doctor Check Up.Ortho" => array()))->count($this->screening_app_col);
		// $request['value'] = $query;
		
		$and_merged_array = array ();
		$ortho = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$ortho_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => '' 
				) 
		);
		$ortho_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => ' ' 
				) 
		);
		$ortho_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $ortho );
		array_push ( $and_merged_array, $ortho_str_empty );
		array_push ( $and_merged_array, $ortho_str_space );
		array_push ( $and_merged_array, $ortho_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Postural';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4.Doctor Check Up.Postural" => array(), "doc_data.widget_data.page4" => array()))->count($this->screening_app_col);
		
		$and_merged_array = array ();
		
		$postural = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$postural_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => '' 
				) 
		);
		$postural_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => ' ' 
				) 
		);
		$postural_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $postural );
		array_push ( $and_merged_array, $postural_str_empty );
		array_push ( $and_merged_array, $postural_str_space );
		array_push ( $and_merged_array, $postural_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Defects at Birth';
		
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array(), "doc_data.widget_data.page5" => array()))->count($this->screening_app_col);
		
		$and_merged_array = array ();
		
		$birth_defect = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$exists' => true 
				) 
		);
		
		$birth_defect_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => '' 
				) 
		);
		$birth_defect_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => ' ' 
				) 
		);
		$birth_defect_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $birth_defect_str_empty );
		array_push ( $and_merged_array, $birth_defect_str_space );
		array_push ( $and_merged_array, $birth_defect_arr );
		
		array_push ( $and_merged_array, $birth_defect );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Deficencies';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array(), "doc_data.widget_data.page5" => array()))->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		$and_merged_array = array ();
		
		$deficencies = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$exists' => true 
				) 
		);
		
		$deficencies_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => '' 
				) 
		);
		$deficencies_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => ' ' 
				) 
		);
		$deficencies_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $deficencies_str_empty );
		array_push ( $and_merged_array, $deficencies_str_space );
		array_push ( $and_merged_array, $deficencies_arr );
		
		array_push ( $and_merged_array, $deficencies );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["General Abnormalities"] ['label'] = 'Childhood Diseases';
		// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array(), "doc_data.widget_data.page5" => array()))->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		
		$childhood_diseases = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$exists' => true 
				) 
		);
		
		$childhood_diseases_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => '' 
				) 
		);
		$childhood_diseases_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => ' ' 
				) 
		);
		$childhood_diseases_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $childhood_diseases_str_empty );
		array_push ( $and_merged_array, $childhood_diseases_str_space );
		array_push ( $and_merged_array, $childhood_diseases_arr );
		
		array_push ( $and_merged_array, $childhood_diseases );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Eye Abnormalities"] ['label'] = 'Without Glasses';
		// $search = array("doc_data.widget_data.page6.Without Glasses.Right" => "", "doc_data.widget_data.page6.Without Glasses.Left" => "", "doc_data.widget_data.page6.Without Glasses.Right" => "6/6", "doc_data.widget_data.page6.Without Glasses.Left" => "6/6", "doc_data.widget_data.page6" => array());
		// $query = $this->mongo_db->orWhere($search)->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.Without Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Eye Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Eye Abnormalities"] ['label'] = 'With Glasses';
		// $search = array("doc_data.widget_data.page6.With Glasses.Right" => "", "doc_data.widget_data.page6.With Glasses.Left" => "", "doc_data.widget_data.page6.With Glasses.Right" => "6/6", "doc_data.widget_data.page6.With Glasses.Left" => "6/6", "doc_data.widget_data.page6" => array());
		// $query = $this->mongo_db->orWhere($search)->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Eye Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Eye Abnormalities"] ['label'] = 'Colour Blindness';
		// $search = array("doc_data.widget_data.page7.Colour Blindness.Right" => array("Yes"), "doc_data.widget_data.page7.Colour Blindness.Left" => array("Yes"));
		// $query = $this->mongo_db->orWhere($search)->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Eye Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Auditory Abnormalities"] ['label'] = 'Right Ear';
		// $search = array("doc_data.widget_data.page8. Auditory Screening.Right" => "Fail", "doc_data.widget_data.page8" => array());
		// $query = $this->mongo_db->orWhere($search)->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Auditory Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Auditory Abnormalities"] ['label'] = 'Left Ear';
		// $search = array("doc_data.widget_data.page8. Auditory Screening.Left" => "Fail", "doc_data.widget_data.page8" => array());
		// $query = $this->mongo_db->orWhere($search)->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_left );
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Auditory Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Auditory Abnormalities"] ['label'] = 'Speech Screening';
		// $query = $this->mongo_db->whereInAll("doc_data.widget_data.page8. Auditory Screening.Speech Screening", array('Delay',"Misarticulation","Fluency","Voice"))->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Auditory Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Oral Hygiene - Fair';
		// $query = $this->mongo_db->whereNe("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene","Good")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Poor",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Oral Hygiene - Poor';
		// $query = $this->mongo_db->whereNe("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene","Good")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Fair",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Carious Teeth';
		// $query = $this->mongo_db->where("doc_data.widget_data.page9.Dental Check-up.Carious Teeth", "Yes")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Flourosis';
		// $query = $this->mongo_db->where("doc_data.widget_data.page9.Dental Check-up.Flourosis","Yes")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $flourosis );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Orthodontic Treatment';
		// $query = $this->mongo_db->where("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment","Yes")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		$request = [ ];
		$request ["Dental Abnormalities"] ['label'] = 'Indication for extraction';
		// $query = $this->mongo_db->where("doc_data.widget_data.page9.Dental Check-up.Indication for extraction", "Yes")->count($this->screening_app_col);
		// $request['value'] = $query;
		// array_push($requests,$request);
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Dental Abnormalities"] ['value'] = count ( $result );
		array_push ( $requests, $request );
		
		return $requests;
		
		// ======================================================end of stage 2===========================================
	}
	private function screening_pie_data_for_stage3($dates) {
		ini_set ( 'max_execution_time', 0 );
		
		$count = $this->mongo_db->count ( $this->screening_app_col );
		if ($count < 10000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 10000;
			$loop = $count / $per_page;
		}
		// ======================================================stage 3 =================================================
		
		$requests = [ ];
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Over Weight"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==========================================================================================
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		$request ["Under Weight"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ========================================================================================
		
		$and_merged_array = array ();
		
		$general_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => '' 
				) 
		);
		$general_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => ' ' 
				) 
		);
		$general_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => [ ] 
				) 
		);
		
		$not_skin = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$nin' => array (
								"Skin" 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $general_str_empty );
		array_push ( $and_merged_array, $general_str_space );
		array_push ( $and_merged_array, $general_arr );
		array_push ( $and_merged_array, $not_skin );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["General"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		$and_merged_array = array ();
		
		$merged_array = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$in' => array (
								"Skin" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Skin"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		array_push ( $requests, $request );
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$ortho = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		$ortho_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => '' 
				) 
		);
		$ortho_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => ' ' 
				) 
		);
		$ortho_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $ortho );
		array_push ( $and_merged_array, $ortho_str_empty );
		array_push ( $and_merged_array, $ortho_str_space );
		array_push ( $and_merged_array, $ortho_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Ortho"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===========================================================================
		
		$and_merged_array = array ();
		
		$postural = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$postural_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => '' 
				) 
		);
		$postural_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => ' ' 
				) 
		);
		$postural_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $postural );
		array_push ( $and_merged_array, $postural_str_empty );
		array_push ( $and_merged_array, $postural_str_space );
		array_push ( $and_merged_array, $postural_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Postural"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ========================================================================
		
		$and_merged_array = array ();
		
		$birth_defect = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$exists' => true 
				) 
		);
		
		$birth_defect_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => '' 
				) 
		);
		$birth_defect_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => ' ' 
				) 
		);
		$birth_defect_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $birth_defect_str_empty );
		array_push ( $and_merged_array, $birth_defect_str_space );
		array_push ( $and_merged_array, $birth_defect_arr );
		array_push ( $and_merged_array, $birth_defect );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Defects at Birth'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==============================================================================
		
		$and_merged_array = array ();
		
		$deficencies = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$exists' => true 
				) 
		);
		
		$deficencies_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => '' 
				) 
		);
		$deficencies_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => ' ' 
				) 
		);
		$deficencies_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $deficencies_str_empty );
		array_push ( $and_merged_array, $deficencies_str_space );
		array_push ( $and_merged_array, $deficencies_arr );
		
		array_push ( $and_merged_array, $deficencies );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Deficencies'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		
		$childhood_diseases = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$exists' => true 
				) 
		);
		
		$childhood_diseases_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => '' 
				) 
		);
		$childhood_diseases_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => ' ' 
				) 
		);
		$childhood_diseases_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $childhood_diseases_str_empty );
		array_push ( $and_merged_array, $childhood_diseases_str_space );
		array_push ( $and_merged_array, $childhood_diseases_arr );
		array_push ( $and_merged_array, $childhood_diseases );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Childhood Diseases'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.Without Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Without Glasses'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// =============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['With Glasses'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Colour Blindness'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===========================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Right Ear'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_left );
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Left Ear'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ====================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		$request ['Speech Screening'] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// =============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Poor",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Oral Hygiene - Fair"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Fair",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Oral Hygiene - Poor"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Carious Teeth"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $flourosis );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Flourosis"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Orthodontic Treatment"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		$request ["Indication for extraction"] = $this->get_drilling_screenings_districts_prepare_pie_array ( $result );
		
		// ======================================================end of stage 3 ===========================================
		return $request;
	}
	private function screening_pie_data_for_stage4($dates) {
		ini_set ( 'max_execution_time', 0 );
		
		$dist_list = $this->get_all_district ();
		
		$count = $this->mongo_db->count ( $this->screening_app_col );
		if ($count < 10000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 10000;
			$loop = $count / $per_page;
		}
		// ======================================================stage 3 =================================================
		
		$requests = [ ];
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		// log_message('debug','dddddddddddddddddddddddddddddddddddddddddddddddddddddddlist--------'.print_r($dist_list,true));
		foreach ( $dist_list as $dist ) {
			// log_message('debug','ddddddddddddddddddddddddddddddddddddddd--------------'.print_r(strtolower($dist["dt_name"]),true));
			$request ["Over Weight"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==========================================================================================
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) ); 
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ["Under Weight"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ========================================================================================
		
		$and_merged_array = array ();
		
		$general_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => '' 
				) 
		);
		$general_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => ' ' 
				) 
		);
		$general_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => [ ] 
				) 
		);
		
		$not_skin = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$nin' => array (
								"Skin" 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $general_str_empty );
		array_push ( $and_merged_array, $general_str_space );
		array_push ( $and_merged_array, $general_arr );
		array_push ( $and_merged_array, $not_skin );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ["General"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		$and_merged_array = array ();
		
		$merged_array = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$in' => array (
								"Skin" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ["Skin"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$ortho = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$ortho_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => '' 
				) 
		);
		$ortho_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => ' ' 
				) 
		);
		$ortho_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $ortho );
		array_push ( $and_merged_array, $ortho_str_empty );
		array_push ( $and_merged_array, $ortho_str_space );
		array_push ( $and_merged_array, $ortho_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ["Ortho"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===========================================================================
		
		$and_merged_array = array ();
		
		$postural = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$postural_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => '' 
				) 
		);
		$postural_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => ' ' 
				) 
		);
		$postural_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $postural );
		array_push ( $and_merged_array, $postural_str_empty );
		array_push ( $and_merged_array, $postural_str_space );
		array_push ( $and_merged_array, $postural_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ["Postural"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ========================================================================
		
		$and_merged_array = array ();
		
		$birth_defect = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$exists' => true 
				) 
		);
		
		$birth_defect_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => '' 
				) 
		);
		$birth_defect_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => ' ' 
				) 
		);
		$birth_defect_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $birth_defect_str_empty );
		array_push ( $and_merged_array, $birth_defect_str_space );
		array_push ( $and_merged_array, $birth_defect_arr );
		
		array_push ( $and_merged_array, $birth_defect );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ['Defects at Birth'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		
		$deficencies = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$exists' => true 
				) 
		);
		
		$deficencies_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => '' 
				) 
		);
		$deficencies_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => ' ' 
				) 
		);
		$deficencies_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $deficencies_str_empty );
		array_push ( $and_merged_array, $deficencies_str_space );
		array_push ( $and_merged_array, $deficencies_arr );
		
		array_push ( $and_merged_array, $deficencies );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $dist_list as $dist ) {
			$request ['Deficencies'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		
		$childhood_diseases = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$exists' => true 
				) 
		);
		
		$childhood_diseases_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => '' 
				) 
		);
		$childhood_diseases_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => ' ' 
				) 
		);
		$childhood_diseases_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $childhood_diseases_str_empty );
		array_push ( $and_merged_array, $childhood_diseases_str_space );
		array_push ( $and_merged_array, $childhood_diseases_arr );
		
		array_push ( $and_merged_array, $childhood_diseases );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Childhood Diseases'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"" 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.Without Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Without Glasses'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// =============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['With Glasses'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Colour Blindness'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===========================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Right Ear'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								" ",
								"" 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_left );
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Left Ear'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ====================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ['Speech Screening'] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// =============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Poor",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Oral Hygiene - Fair"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Fair",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Oral Hygiene - Poor"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								" ",
								"" 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Carious Teeth"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $flourosis );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Flourosis"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Orthodontic Treatment"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $dist_list as $dist ) {
			$request ["Indication for extraction"] [strtolower ( $dist ["dt_name"] )] = $this->get_drilling_screenings_schools_prepare_pie_array ( $result, strtolower ( $dist ["dt_name"] ) );
		}
		
		// ======================================================end of stage 3 ===========================================
		return $request;
	}
	
	
		private function screening_pie_data_for_stage5($dates) {
		ini_set ( 'max_execution_time', 0 );
		ini_set('memory_limit','10G');
		
		$school_list = $this->get_all_schools ();
		// log_message('debug','schhhhhhhhhhhhhhhhhhhhhhhhhhoooooooooooooooooooooooooooooolllllllll'.print_r($school_list,true));
		$count = $this->mongo_db->count ( $this->screening_app_col );
		$add_count = $count+100;
		if ($count < $add_count) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 5000;
			$loop = $count / $per_page;
		}
		// ======================================================stage 3 =================================================
		
		$requests = [ ];
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			// log_message('debug','schhhhhhhhhhhhhhhhhhhhhhhhhhoooooooooooooooooooooooooooooolllllllll'.print_r($school_name,true));
			$request ["Over Weight"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==========================================================================================
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Under Weight"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ========================================================================================
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Obese" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Obese"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//===========================================================
		$and_merged_array = array ();
		
		$general_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => '' 
				) 
		);
		$general_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => ' ' 
				) 
		);
		$general_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => [ ] 
				) 
		);
		
		$not_skin = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$nin' => array (
								"Skin" 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $general_str_empty );
		array_push ( $and_merged_array, $general_str_space );
		array_push ( $and_merged_array, $general_arr );
		array_push ( $and_merged_array, $not_skin );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["General"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$and_merged_array = array ();
		
		$merged_array = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$in' => array (
								"Skin" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["Skin"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		//===============================================================================
		
				//==============================================================================
		$and_merged_array = array ();
		
		$description_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Description" => array (
						'$ne' => ''
				)
		);
		$description_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Description" => array (
						'$ne' => ' '
				)
		);
		
		$advice_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Advice" => array (
						'$ne' => ''
				)
		);
		$advice_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Advice" => array (
						'$ne' => ' '
				)
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true
				)
		);
		
		array_push ( $and_merged_array, $description_str_empty );
		array_push ( $and_merged_array, $description_str_space );
		array_push ( $and_merged_array, $advice_str_empty );
		array_push ( $and_merged_array, $advice_str_space );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [
			array (
					'$match' => array (
							'$and' => $and_merged_array
					)
			),
			array (
					'$project' => array (
							"doc_data.widget_data" => true,
							"history" => true
					)
			),
			array (
					'$limit' => $offset
			),
			array (
					'$skip' => $offset - $per_page
			)
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
		
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
						
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
				
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["Others(Description/Advice)"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$ortho = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$ortho_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => '' 
				) 
		);
		$ortho_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => ' ' 
				) 
		);
		$ortho_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $ortho );
		array_push ( $and_merged_array, $ortho_str_empty );
		array_push ( $and_merged_array, $ortho_str_space );
		array_push ( $and_merged_array, $ortho_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Ortho"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===========================================================================
		
		$and_merged_array = array ();
		
		$postural = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$postural_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => '' 
				) 
		);
		$postural_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => ' ' 
				) 
		);
		$postural_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $postural );
		array_push ( $and_merged_array, $postural_str_empty );
		array_push ( $and_merged_array, $postural_str_space );
		array_push ( $and_merged_array, $postural_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Postural"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ========================================================================
		
		$and_merged_array = array ();
		
		$birth_defect = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$exists' => true 
				) 
		);
		
		$birth_defect_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => '' 
				) 
		);
		$birth_defect_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => ' ' 
				) 
		);
		$birth_defect_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $birth_defect_str_empty );
		array_push ( $and_merged_array, $birth_defect_str_space );
		array_push ( $and_merged_array, $birth_defect_arr );
		
		array_push ( $and_merged_array, $birth_defect );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Defects at Birth'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		// $and_merged_array = array ();
		
		// $deficencies = array (
				// "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						// '$not' => array (
								// '$size' => 0 
						// ) 
				// ) 
		// );
		// $page5_exists = array (
				// "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						// '$exists' => true 
				// ) 
		// );
		
		// $deficencies_str_empty = array (
				// "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						// '$ne' => '' 
				// ) 
		// );
		// $deficencies_str_space = array (
				// "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						// '$ne' => ' ' 
				// ) 
		// );
		// $deficencies_arr = array (
				// "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						// '$ne' => [ ] 
				// ) 
		// );
		
		// array_push ( $and_merged_array, $deficencies_str_empty );
		// array_push ( $and_merged_array, $deficencies_str_space );
		// array_push ( $and_merged_array, $deficencies_arr );
		
		// array_push ( $and_merged_array, $deficencies );
		// array_push ( $and_merged_array, $page5_exists );
		
		// $result = [ ];
		// for($page = 1; $page < $loop; $page ++) {
			// $offset = $per_page * ($page);
			// $pipeline = [ 
					// array (
							// '$match' => array (
									// '$and' => $and_merged_array 
							// ) 
					// ),
					// array (
							// '$project' => array (
									// "doc_data.widget_data" => true,
									// "history" => true 
							// ) 
					// ),
					// array (
							// '$limit' => $offset 
					// ),
					// array (
							// '$skip' => $offset - $per_page 
					// ) 
			// ];
			// $response = $this->mongo_db->command ( array (
					// 'aggregate' => $this->screening_app_col,
					// 'pipeline' => $pipeline 
			// ) );
			
			// $temp_result = [ ];
			// foreach ( $response ['result'] as $doc ) {
				// foreach ( $doc ['history'] as $date ) {
					// $time = $date ['time'];
					// if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						// array_push ( $temp_result, $doc );
						// break;
					// }
				// }
			// }
			// $result = array_merge ( $result, $temp_result );
		// }
		
		// foreach ( $school_list as $school_name ) {
			// $request ['Deficencies'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		// }
		
		//======================Deficencies divided into further parts=================================
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Anaemia" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Anaemia"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin Deficiency - Bcomplex" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin Deficiency - Bcomplex"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin A Deficiency" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin A Deficiency"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
				$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin Deficiency - Bcomplex" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin Deficiency - Bcomplex"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin D Deficiency" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin D Deficiency"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		
				$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin Deficiency - Bcomplex" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin Deficiency - Bcomplex"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"SAM/stunting" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["SAM/stunting"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
				$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Vitamin Deficiency - Bcomplex" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Vitamin Deficiency - Bcomplex"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$merged_array = array (
			"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
					'$in' => array (
							"Goiter" 
					) 
			) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Goiter"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		//======================Deficencies divided into further parts=================================
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		
		$childhood_diseases = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$exists' => true 
				) 
		);
		
		$childhood_diseases_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => '' 
				) 
		);
		$childhood_diseases_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => ' ' 
				) 
		);
		$childhood_diseases_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $childhood_diseases_str_empty );
		array_push ( $and_merged_array, $childhood_diseases_str_space );
		array_push ( $and_merged_array, $childhood_diseases_arr );
		
		array_push ( $and_merged_array, $childhood_diseases );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Childhood Diseases'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.Without Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Without Glasses'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// =============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['With Glasses'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Colour Blindness'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ===========================================================================
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$eye_lids = array (
				"doc_data.widget_data.page7.Colour Blindness.Eye Lids" => array (
						'$nin' => array (
								"Normal",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		
		array_push ( $or_merged_array, $eye_lids );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}

		foreach ( $school_list as $school_name ) {
			$request ['Eye Lids'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//============================================
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$conjunctiva = array (
				"doc_data.widget_data.page7.Colour Blindness.Conjunctiva" => array (
						'$nin' => array (
								"Normal",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);

		array_push ( $or_merged_array, $conjunctiva );
		array_push ( $and_merged_array, $page7_exists );
		
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Conjunctiva'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$cornea = array (
				"doc_data.widget_data.page7.Colour Blindness.Cornea" => array (
						'$nin' => array (
								"Normal",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		
		array_push ( $or_merged_array, $cornea );
		array_push ( $and_merged_array, $page7_exists );
	
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Cornea'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
	
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$pupil = array (
				"doc_data.widget_data.page7.Colour Blindness.Pupil" => array (
						'$nin' => array (
								"Normal",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		
		array_push ( $or_merged_array, $pupil );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Pupil'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
	
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$wearing_spectacles = array (
				"doc_data.widget_data.page7.Colour Blindness.Wearing Spectacles" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		
		array_push ( $or_merged_array, $wearing_spectacles );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Wearing Spectacles'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$subjective_refraction = array (
				"doc_data.widget_data.page7.Colour Blindness.Subjective Refraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);		
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		
		
		array_push ( $or_merged_array, $subjective_refraction );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Subjective Refraction'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//==========================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Right Ear'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_left );
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Left Ear'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ====================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Speech Screening'] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// =============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Poor",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Oral Hygiene - Fair"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Fair",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Oral Hygiene - Poor"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Carious Teeth"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $flourosis );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Flourosis"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Orthodontic Treatment"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Indication for extraction"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//====================================================================
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Root Canal Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up.Root Canal Treatment" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Root Canal Treatment"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
//===============================================================
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.CROWNS" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up.CROWNS" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["CROWNS"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//===========================================================
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Fixed Partial Denture" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up.Fixed Partial Denture" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Fixed Partial Denture"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		//=======================================================
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Curettage" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up.Curettage" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			if($response['ok'])
			{	
				foreach ( $response ['result'] as $doc ) {
					
					foreach ( $doc ['history'] as $date ) {
						$time = $date ['time'];
						
						if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
							array_push ( $temp_result, $doc );
							break;
						}
					}
				}
				
				$result = array_merge ( $result, $temp_result );
			}
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Curettage"] [base64_encode( strtolower ( $school_name ['school_name']) )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ======================================================end of stage 3 ===========================================
		return $request;
	}
	
	
	private function screening_pie_data_for_stage5_tt($dates) {
		ini_set ( 'max_execution_time', 0 );
		ini_set('memory_limit','10G');
		
		$school_list = $this->get_all_schools ();
		// log_message('debug','schhhhhhhhhhhhhhhhhhhhhhhhhhoooooooooooooooooooooooooooooolllllllll'.print_r($school_list,true));
		$count = $this->mongo_db->count ( $this->screening_app_col );
		if ($count < 5000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 5000;
			$loop = $count / $per_page;
		}
		// ======================================================stage 3 =================================================
		
		$requests = [ ];
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Over Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			// log_message('debug','schhhhhhhhhhhhhhhhhhhhhhhhhhoooooooooooooooooooooooooooooolllllllll'.print_r($school_name,true));
			$request ["Over Weight"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==========================================================================================
		
		$merged_array = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$in' => array (
								"Under Weight" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Under Weight"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ========================================================================================
		
		$and_merged_array = array ();
		
		$general_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => '' 
				) 
		);
		$general_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => ' ' 
				) 
		);
		$general_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$ne' => [ ] 
				) 
		);
		
		$not_skin = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$nin' => array (
								"Skin" 
						) 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $general_str_empty );
		array_push ( $and_merged_array, $general_str_space );
		array_push ( $and_merged_array, $general_arr );
		array_push ( $and_merged_array, $not_skin );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["General"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$and_merged_array = array ();
		
		$merged_array = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$in' => array (
								"Skin" 
						) 
				) 
		);
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => $merged_array 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["Skin"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		//===============================================================================
		
				//==============================================================================
		$and_merged_array = array ();
		
		$description_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Description" => array (
						'$ne' => ''
				)
		);
		$description_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Description" => array (
						'$ne' => ' '
				)
		);
		
		$advice_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Advice" => array (
						'$ne' => ''
				)
		);
		$advice_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Advice" => array (
						'$ne' => ' '
				)
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
						'$exists' => true
				)
		);
		
		array_push ( $and_merged_array, $description_str_empty );
		array_push ( $and_merged_array, $description_str_space );
		array_push ( $and_merged_array, $advice_str_empty );
		array_push ( $and_merged_array, $advice_str_space );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [
			array (
					'$match' => array (
							'$and' => $and_merged_array
					)
			),
			array (
					'$project' => array (
							"doc_data.widget_data" => true,
							"history" => true
					)
			),
			array (
					'$limit' => $offset
			),
			array (
					'$skip' => $offset - $per_page
			)
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
		
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
						
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
				
			$result = array_merge ( $result, $temp_result );
		}
		foreach ( $school_list as $school_name ) {
			$request ["Others(Description/Advice)"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$ortho = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		
		$ortho_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => '' 
				) 
		);
		$ortho_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => ' ' 
				) 
		);
		$ortho_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $ortho );
		array_push ( $and_merged_array, $ortho_str_empty );
		array_push ( $and_merged_array, $ortho_str_space );
		array_push ( $and_merged_array, $ortho_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Ortho"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===========================================================================
		
		$and_merged_array = array ();
		
		$postural = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$postural_str_empty = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => '' 
				) 
		);
		$postural_str_space = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => ' ' 
				) 
		);
		$postural_arr = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$ne' => [ ] 
				) 
		);
		
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $postural );
		array_push ( $and_merged_array, $postural_str_empty );
		array_push ( $and_merged_array, $postural_str_space );
		array_push ( $and_merged_array, $postural_arr );
		array_push ( $and_merged_array, $page4_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Postural"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ========================================================================
		
		$and_merged_array = array ();
		
		$birth_defect = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$exists' => true 
				) 
		);
		
		$birth_defect_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => '' 
				) 
		);
		$birth_defect_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => ' ' 
				) 
		);
		$birth_defect_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $birth_defect_str_empty );
		array_push ( $and_merged_array, $birth_defect_str_space );
		array_push ( $and_merged_array, $birth_defect_arr );
		
		array_push ( $and_merged_array, $birth_defect );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Defects at Birth'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		
		$deficencies = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$exists' => true 
				) 
		);
		
		$deficencies_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => '' 
				) 
		);
		$deficencies_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => ' ' 
				) 
		);
		$deficencies_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $deficencies_str_empty );
		array_push ( $and_merged_array, $deficencies_str_space );
		array_push ( $and_merged_array, $deficencies_arr );
		
		array_push ( $and_merged_array, $deficencies );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Deficencies'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		
		$childhood_diseases = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$not' => array (
								'$size' => 0 
						) 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$exists' => true 
				) 
		);
		
		$childhood_diseases_str_empty = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => '' 
				) 
		);
		$childhood_diseases_str_space = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => ' ' 
				) 
		);
		$childhood_diseases_arr = array (
				"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (
						'$ne' => [ ] 
				) 
		);
		
		array_push ( $and_merged_array, $childhood_diseases_str_empty );
		array_push ( $and_merged_array, $childhood_diseases_str_space );
		array_push ( $and_merged_array, $childhood_diseases_arr );
		
		array_push ( $and_merged_array, $childhood_diseases );
		array_push ( $and_merged_array, $page5_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Childhood Diseases'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$without_glass_left = array (
				"doc_data.widget_data.page6.Without Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$without_glass_right = array (
				"doc_data.widget_data.page6.Without Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.Without Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $without_glass_left );
		array_push ( $or_merged_array, $without_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Without Glasses'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// =============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$with_glass_left = array (
				"doc_data.widget_data.page6.With Glasses.Left" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		$with_glass_right = array (
				"doc_data.widget_data.page6.With Glasses.Right" => array (
						'$nin' => array (
								"6/6",
								"",
								" " 
						) 
				) 
		);
		
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $with_glass_left );
		array_push ( $or_merged_array, $with_glass_right );
		array_push ( $and_merged_array, $page6_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['With Glasses'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$color_right = array (
				"doc_data.widget_data.page7.Colour Blindness.Right" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$color_left = array (
				"doc_data.widget_data.page7.Colour Blindness.Left" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $color_right );
		array_push ( $or_merged_array, $color_left );
		array_push ( $and_merged_array, $page7_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Colour Blindness'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ===========================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_right = array (
				"doc_data.widget_data.page8. Auditory Screening.Right" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_right );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Right Ear'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$audi_left = array (
				"doc_data.widget_data.page8. Auditory Screening.Left" => array (
						'$nin' => array (
								"Pass",
								"",
								" " 
						) 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $audi_left );
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Left Ear'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ====================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$speech = array (
				"doc_data.widget_data.page8. Auditory Screening.Speech Screening" => array (
						'$nin' => array (
								"Normal",
								"",
								" ",
								[ ] 
						) 
				) 
		);
		
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $speech );
		
		array_push ( $and_merged_array, $page8_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ['Speech Screening'] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// =============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Poor",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Oral Hygiene - Fair"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$oral_hygiene = array (
				"doc_data.widget_data.page9.Dental Check-up.Oral Hygiene" => array (
						'$nin' => array (
								"Good",
								"Fair",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $oral_hygiene );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Oral Hygiene - Poor"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$carious_teeth = array (
				"doc_data.widget_data.page9.Dental Check-up.Carious Teeth" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $carious_teeth );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Carious Teeth"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$flourosis = array (
				"doc_data.widget_data.page9.Dental Check-up.Flourosis" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $flourosis );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Flourosis"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ==============================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$orthodontic = array (
				"doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $orthodontic );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Orthodontic Treatment"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		
		// ===========================================================================================
		
		$and_merged_array = array ();
		$or_merged_array = array ();
		
		$indication = array (
				"doc_data.widget_data.page9.Dental Check-up.Indication for extraction" => array (
						'$nin' => array (
								"No",
								"",
								" " 
						) 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $or_merged_array, $indication );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
		for($page = 1; $page < $loop; $page ++) {
			$offset = $per_page * ($page);
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array,
									'$or' => $or_merged_array 
							) 
					),
					array (
							'$limit' => $offset 
					),
					array (
							'$skip' => $offset - $per_page 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			$temp_result = [ ];
			foreach ( $response ['result'] as $doc ) {
				
				foreach ( $doc ['history'] as $date ) {
					$time = $date ['time'];
					
					if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
						array_push ( $temp_result, $doc );
						break;
					}
				}
			}
			
			$result = array_merge ( $result, $temp_result );
		}
		
		foreach ( $school_list as $school_name ) {
			$request ["Indication for extraction"] [strtolower ( $school_name ['school_name'] )] = $this->get_drilling_screenings_students_prepare_pie_array ( $result, strtolower ( $school_name ['school_name'] ) );
		}
		// ======================================================end of stage 3 ===========================================
		return $request;
	}
	public function update_screening_collection($date, $screening_duration) {
		if ($date) {
			//$date = date('Y-m-d', $date);
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		//Creating analytics For Year wise
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration ); // "Daily" ); 
		
		////log_message ( "debug", "datesssssssssssssssssssssssssssssssss--------------------" . print_r ( $dates, true ) );
		// ===================================stage1================================================
		for($init_date = $dates ['today_date']; $init_date >= $dates ['end_date'];) {
			////log_message ( "debug", "iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii--------------------" . print_r ( $init_date, true ) );
			////log_message ( "debug", "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee--------------------" . print_r ( $dates ['end_date'], true ) );
			$query = $this->mongo_db->where ( array (
					'pie_data.date' => $init_date 
			) )->count ( "healthcare201671115519757_screening_final_".$year );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $init_date . "-1 day" ) );
			
			$temp_dates ['today_date'] = $init_date;
			$temp_dates ['end_date'] = $end_date;
			
			// $temp_dates = $this->get_start_end_date ( $init_date, "Daily" );
			
			if ($query == 0) {
				
				$pie_data = array (
						"pie_data" => array (
								'date' => $init_date 
						) 
				);
				
				$requests = $this->screening_pie_data_for_stage5 ( $temp_dates );
				$pie_data ['pie_data'] ['stage5_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage4_new ( $requests );
				$pie_data ['pie_data'] ['stage4_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage3_new ( $requests );
				$pie_data ['pie_data'] ['stage3_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage2_new ( $requests );
				$pie_data ['pie_data'] ['stage2_pie_vales'] = $requests;
				
				////log_message ( "debug", "before stagesssssssssssssssssssssssssss--------------------" );
				$requests = $this->screening_pie_data_for_stage1_new ( $requests );
				$pie_data ['pie_data'] ['stage1_pie_vales'] = $requests;
				
				$this->mongo_db->insert ( "healthcare201671115519757_screening_final_".$year, $pie_data );
				////log_message ( "debug", "tttttttttttttttttttttttttttttttttttttttttttttttttttttttt" . print_r ( $init_date, true ) );
			}
			$init_date = $end_date;
		}
		
		// ===================================stage1 end============================================
		
		// ============================================================stage 2===============================================
		
		// ============================================================end of stage 2 =======================================
		
		// ===================================================insert into db=================================================
	}
	public function update_screening_collection1($date, $screening_duration) {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration ); // "Daily" ); //
		//log_message ( "debug", "datesssssssssssssssssssssssssssssssss--------------------" . print_r ( $dates, true ) );
		// ===================================stage1================================================
		for($init_date = $dates ['today_date']; $init_date >= $dates ['end_date'];) {
			//log_message ( "debug", "iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii--------------------" . print_r ( $init_date, true ) );
			//log_message ( "debug", "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee--------------------" . print_r ( $dates ['end_date'], true ) );
			$query = $this->mongo_db->where ( array (
					'pie_data.date' => $init_date 
			) )->count ( $this->screening_app_col_screening );
			
			$end_date = date ( "Y-m-d H:i:s", strtotime ( $init_date . "-1 day" ) );
			
			$temp_dates ['today_date'] = $init_date;
			$temp_dates ['end_date'] = $end_date;
			
			// $temp_dates = $this->get_start_end_date ( $init_date, "Daily" );
			
			if ($query == 0) {
				
				$pie_data = array (
						"pie_data" => array (
								'date' => $init_date 
						) 
				);
				//log_message ( "debug", "before stagesssssssssssssssssssssssssss--------------------" );
				$requests = $this->screening_pie_data_for_stage1 ( $temp_dates );
				$pie_data ['pie_data'] ['stage1_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage2 ( $temp_dates );
				$pie_data ['pie_data'] ['stage2_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage3 ( $temp_dates );
				$pie_data ['pie_data'] ['stage3_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage4 ( $temp_dates );
				$pie_data ['pie_data'] ['stage4_pie_vales'] = $requests;
				
				$requests = $this->screening_pie_data_for_stage5 ( $temp_dates );
				$pie_data ['pie_data'] ['stage5_pie_vales'] = $requests;
				
				$this->mongo_db->insert ( $this->screening_app_col_screening, $pie_data );
				//log_message ( "debug", "tttttttttttttttttttttttttttttttttttttttttttttttttttttttt" . print_r ( $init_date, true ) );
			}
			$init_date = $end_date;
		}
		
		// ===================================stage1 end============================================
		
		// ============================================================stage 2===============================================
		
		// ============================================================end of stage 2 =======================================
		
		// ===================================================insert into db=================================================
	}
	public function get_last_screening_update() {
		$query = $this->mongo_db->limit ( 1 )->orderBy ( array (
				'pie_data.date' => - 1 
		) )->select ( 'pie_data.date' )->get ( $this->screening_app_col_screening );
		
		if (isset ( $query ) && ! empty ( $query ) && (count ( $query ) > 0)) {
			return "Last update on : " . substr ( $query [0] ['pie_data'] ['date'], 0, 10 );
		} else {
			return "No updates yet.";
		}
	}
	public function get_all_screenings($date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
		//	$today_date = "2018-01-01";
		} else {
			$today_date = $this->today_date;
			//$today_date = "2018-01-01";
		}		
		
		
		//ini_set ( 'memory_limit', '10G' );
				// $query = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name',"TSWREIS SANGAREDDY(G),MEDAK")->get($this->screening_app_col);
				// $array = [];
				// foreach ($query as $doc){
						// if((isset($doc['doc_data']['widget_data']['page5']['Doctor Check Up'])) && is_array($doc['doc_data']['widget_data']['page5']['Doctor Check Up'])){
							
							// array_push($array,$doc['history']['last_stage']['time']);			
				// }}
				// array_unique($array);
				// log_message('debug','dtaesssssssssssssssssssssssssssssssssssssssssssssssss======='.print_r($array,true));
		
		
				 /* ini_set ( 'memory_limit', '10G' );
				$query = $this->mongo_db->get($this->screening_app_col);
				foreach ($query as $doc){
				if(isset($doc['doc_data']['widget_data']['page3']['Physical Exam']['Height cms'])){
					if(isset($doc['doc_data']['widget_data']['page3']['Physical Exam']['Weight kgs'])){
						if(isset($doc['doc_data']['widget_data']['page5']['Doctor Check Up'])){
							if(($doc['doc_data']['widget_data']['page3']['Physical Exam']['Height cms'] > 0) && ($doc['doc_data']['widget_data']['page3']['Physical Exam']['Height cms'] != "") && ($doc['doc_data']['widget_data']['page3']['Physical Exam']['Weight kgs'] > 0) && ($doc['doc_data']['widget_data']['page3']['Physical Exam']['Weight kgs'] != "")){
							$height = ($doc['doc_data']['widget_data']['page3']['Physical Exam']['Height cms']/100);
							$weight = $doc['doc_data']['widget_data']['page3']['Physical Exam']['Weight kgs'];
							
							$bmi = ($weight / ($height * $height));
							$bmi    = round($bmi,1);
							$doc['doc_data']['widget_data']['page3']['Physical Exam']['BMI%'] = $bmi;
							
						 if ($bmi <= 18.5) 
						  {
							 if((isset($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'])) && is_array($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'])){
								 $search = array_search ( "Under Weight" , $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] );
								 if($search === false){
								 //}else{
									 array_push($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'], "Under Weight");
								 }
							 }else{
								 $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] = [];
								 array_push($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'], "Under Weight");
							 }
							 //==================================
							 $search = array_search ( "Over Weight" , $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] );
								 if($search === false){
								 }else{
									 unset($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'][$search]);
								 }
							 //==================================
						  } 
						  else if ($bmi >= 18.5 && $bmi <= 24.9) 
						  { 
							//$normal++;
						  }
						  else
						  {
							  if((isset($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'])) && is_array($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'])){
								 $search = array_search ( "Over Weight" , $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] );
								 if($search === false){
								 //}else{
									 array_push($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'], "Over Weight");
								 }
							 }else{
								 $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] = [];
								 array_push($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'], "Over Weight");
							 }
							 //==================================
							 $search = array_search ( "Under Weight" , $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] );
								 if($search === false){
								 }else{
									 unset($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'][$search]);
								 }
							 //==================================
							 //==================================
							 $search = array_search ( "Over weight" , $doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'] );
								 if($search === false){
								 }else{
									 unset($doc['doc_data']['widget_data']['page5']['Doctor Check Up']['Deficencies'][$search]);
								 }
							 //==================================
						  }
						  //log_message('debug','searchingdoccccccccccccccccccccccccccccccccc======='.print_r($doc['doc_data']['widget_data'],true));
				$query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				}}}}}   */
				
				
				// ini_set ( 'memory_limit', '10G' );
				// $query = $this->mongo_db->get($this->screening_app_col);
				// foreach ($query as $doc){
						// if((isset($doc['doc_data']['widget_data']['page5']['Doctor Check Up'])) && (isset($doc['doc_data']['widget_data']['page4']['Doctor Check Up'])) && (isset($doc['doc_data']['widget_data']['page6']['With Glasses'])) && (isset($doc['doc_data']['widget_data']['page6']['Without Glasses'])) && (isset($doc['doc_data']['widget_data']['page7']['Colour Blindness'])) && (isset($doc['doc_data']['widget_data']['page7'][' Auditory Screening'])) && (isset($doc['doc_data']['widget_data']['page8']['Dental Check-up']))){
							// $doc['doc_data']['widget_data']['page3'] = [];
						  
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				// }}
			//Creating analytics For Year wise
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		if($year == "2019")
		{
		   $dates['end_date'] = "2019-01-01";	
		}
		
		//log_message ("error", "SCREENING DEBUG: end_date".print_r($dates['end_date'], true) );
		//log_message ("error", "SCREENING DEBUG: today_date".print_r($dates['today_date'], true) );
		//log_message ("error", "SCREENING DEBUG: YEAR".print_r($year, true) );

		// ================================================== for generated analytics
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage1_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( "healthcare201671115519757_screening_final_".$year );
		
		$requests ['Physical Abnormalities'] = 0;
		$requests ['General Abnormalities'] = 0;
		$requests ['Eye Abnormalities'] = 0;
		$requests ['Auditory Abnormalities'] = 0;
		$requests ['Dental Abnormalities'] = 0;
		
		foreach ( $pie_data as $each_pie ) {
			
			$requests ['Physical Abnormalities'] = $requests ['Physical Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [0] ['value'];
			$requests ['General Abnormalities'] = $requests ['General Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [1] ['value'];
			$requests ['Eye Abnormalities'] = $requests ['Eye Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [2] ['value'];
			$requests ['Auditory Abnormalities'] = $requests ['Auditory Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [3] ['value'];
			$requests ['Dental Abnormalities'] = $requests ['Dental Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [4] ['value'];
		}
		
		$result = [ ];
		foreach ( $requests as $request => $req_value ) {
			$req ['label'] = $request;
			$req ['value'] = $req_value;
			array_push ( $result, $req );
		}
		return $result;
		
		// ===============================================
		// $pie_data = [];
		// for($init_date = $dates ['today_date']; $init_date >= $dates ['end_date'];) {
		
		// $end_date = date ( "Y-m-d H:i:s", strtotime ( $init_date . "-1 day" ) );
		
		// $temp_dates ['today_date'] = $init_date;
		// $temp_dates ['end_date'] = $end_date;
		
		// $requests = $this->screening_pie_data_for_stage1 ( $temp_dates );
		// $temp_pie['pie_data'] ['stage1_pie_vales'] = $requests;
		// array_push($pie_data,$temp_pie);
		
		// $init_date = $end_date;
		// }
		// log_message("debug","ppppppppppppppppppppppppppppppppscreenenenenene=====".print_r($pie_data,true));
		
		// $requests ['Physical Abnormalities'] = 0;
		// $requests ['General Abnormalities'] = 0;
		// $requests ['Eye Abnormalities'] = 0;
		// $requests ['Auditory Abnormalities'] = 0;
		// $requests ['Dental Abnormalities'] = 0;
		
		// foreach ( $pie_data as $each_pie ) {
		
		// $requests ['Physical Abnormalities'] = $requests ['Physical Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [0] ['value'];
		// $requests ['General Abnormalities'] = $requests ['General Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [1] ['value'];
		// $requests ['Eye Abnormalities'] = $requests ['Eye Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [2] ['value'];
		// $requests ['Auditory Abnormalities'] = $requests ['Auditory Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [3] ['value'];
		// $requests ['Dental Abnormalities'] = $requests ['Dental Abnormalities'] + $each_pie ['pie_data'] ['stage1_pie_vales'] [4] ['value'];
		// }
		
		// $result = [ ];
		// foreach ( $requests as $request => $req_value ) {
		// $req ['label'] = $request;
		// $req ['value'] = $req_value;
		// array_push ( $result, $req );
		// }
		// return $result;
	}
	
	public function get_drilling_screenings_abnormalities($data, $date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
			//$today_date = "2018-01-01";
		} else {
			$today_date = $this->today_date;
			//$today_date = "2018-01-01";
		}	
		
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		if($year == "2019")
		{
			$obj_data = json_decode ( $data, true );
			$type = $obj_data ['label'];
			
			$dates = $this->get_start_end_date ( $today_date, $screening_duration );
			ini_set ( 'memory_limit', '10G' );
			$pie_data = $this->mongo_db->select ( array (
					'pie_data.stage2_pie_vales' 
			) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( 'healthcare201671115519757_screening_final_'.$year );
			
			switch ($type) {
				case "Physical Abnormalities" :
					
					$requests = [ ];
					
					$request ['label'] = 'Over Weight';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [0] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					$request ['label'] = 'Under Weight';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [1] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					$request ['label'] = 'Obese';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [2] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "General Abnormalities" :
					
					$requests = [ ];
					
					$request ['label'] = 'General';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [3] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Skin';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [4] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Others(Description/Advice)';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [5] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Ortho';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [6] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Postural';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [7] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Defects at Birth';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [8] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					// $request ['label'] = 'Deficencies';
					// $request ['value'] = 0;
					
					// foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						// $request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [8] ['General Abnormalities'] ['value'];
					// }
					// array_push ( $requests, $request );
					
					//==========================================Deficencies divided
					
					$request ['label'] = 'Anaemia';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [9] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Vitamin Deficiency - Bcomplex';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [10] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Vitamin A Deficiency';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [11] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Vitamin D Deficiency';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [12] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'SAM/stunting';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [13] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Goiter';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [14] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					//==========================================Deficencies divided
					
					$request ['label'] = 'Childhood Diseases';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [15] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "Eye Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Without Glasses';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [16] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'With Glasses';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [17] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Colour Blindness';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [18] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Eye Lids';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [19] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Conjunctiva';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [20] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Cornea';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [21] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Pupil';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [22] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Wearing Spectacles';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [23] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Subjective Refraction';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [24] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					
					return $requests;
					break;
				
				case "Auditory Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Right Ear';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [25] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Left Ear';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [26] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Speech Screening';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [27] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "Dental Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Oral Hygiene - Fair';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [28] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Oral Hygiene - Poor';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [29] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Carious Teeth';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [30] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Flourosis';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [31] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Orthodontic Treatment';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [32] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Indication for extraction';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [33] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					$request ['label'] = 'Root Canal Treatment';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [34] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'CROWNS';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [35] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Fixed Partial Denture';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [36] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					$request ['label'] = 'Curettage';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// //log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [33] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				default :
					break;
			}
		}else
		{
			$obj_data = json_decode ( $data, true );
			$type = $obj_data ['label'];
			
			$dates = $this->get_start_end_date ( $today_date, $screening_duration );
			ini_set ( 'memory_limit', '10G' );
			$pie_data = $this->mongo_db->select ( array (
					'pie_data.stage2_pie_vales' 
			) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( 'healthcare201671115519757_screening_final_'.$year );
			
			switch ($type) {
				case "Physical Abnormalities" :
					
					$requests = [ ];
					
					$request ['label'] = 'Over Weight';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [0] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					$request ['label'] = 'Under Weight';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [1] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					$request ['label'] = 'Obese';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [2] ['Physical Abnormalities'] ['value'];
					}
					
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "General Abnormalities" :
					
					$requests = [ ];
					
					$request ['label'] = 'General';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [3] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Skin';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [4] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Others(Description/Advice)';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [5] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Ortho';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [6] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Postural';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [7] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Defects at Birth';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [8] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					// $request ['label'] = 'Deficencies';
					// $request ['value'] = 0;
					
					// foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						// $request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [8] ['General Abnormalities'] ['value'];
					// }
					// array_push ( $requests, $request );
					
					//==========================================Deficencies divided
					
					$request ['label'] = 'Anaemia';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [9] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Vitamin Deficiency - Bcomplex';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [10] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Vitamin A Deficiency';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [11] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Vitamin D Deficiency';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [12] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'SAM/stunting';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [13] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					
					$request ['label'] = 'Goiter';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [14] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					//==========================================Deficencies divided
					
					$request ['label'] = 'Childhood Diseases';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [15] ['General Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "Eye Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Without Glasses';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [16] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'With Glasses';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [17] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Colour Blindness';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [18] ['Eye Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "Auditory Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Right Ear';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [19] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Left Ear';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [20] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Speech Screening';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [21] ['Auditory Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					return $requests;
					break;
				
				case "Dental Abnormalities" :
					$requests = [ ];
					
					$request ['label'] = 'Oral Hygiene - Fair';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [22] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Oral Hygiene - Poor';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [23] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Carious Teeth';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [24] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Flourosis';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [25] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Orthodontic Treatment';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [26] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );
					
					$request ['label'] = 'Indication for extraction';
					$request ['value'] = 0;
					
					foreach ( $pie_data as $each_pie ) {
						// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
						$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [27] ['Dental Abnormalities'] ['value'];
					}
					array_push ( $requests, $request );

					
					return $requests;
					break;
				
				default :
					break;
			}
		}
		
		
	}
	
	public function get_drilling_screenings_abnormalities_tt($data, $date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage2_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( $this->screening_app_col_screening );
		
		switch ($type) {
			case "Physical Abnormalities" :
				
				$requests = [ ];
				
				$request ['label'] = 'Over Weight';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [0] ['Physical Abnormalities'] ['value'];
				}
				
				array_push ( $requests, $request );
				
				$request ['label'] = 'Under Weight';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [1] ['Physical Abnormalities'] ['value'];
				}
				
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			case "General Abnormalities" :
				
				$requests = [ ];
				
				$request ['label'] = 'General';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [2] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Skin';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [3] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Others(Description/Advice)';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [4] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Ortho';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [5] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Postural';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [6] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Defects at Birth';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [7] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Deficencies';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [8] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Childhood Diseases';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [9] ['General Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			case "Eye Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Without Glasses';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [10] ['Eye Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'With Glasses';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [11] ['Eye Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Colour Blindness';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [12] ['Eye Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			case "Auditory Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Right Ear';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [13] ['Auditory Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Left Ear';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [14] ['Auditory Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Speech Screening';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [15] ['Auditory Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			case "Dental Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Oral Hygiene - Fair';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [16] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Oral Hygiene - Poor';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [17] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Carious Teeth';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [18] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Flourosis';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [19] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Orthodontic Treatment';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [20] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				$request ['label'] = 'Indication for extraction';
				$request ['value'] = 0;
				
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pppppppppppppppppppppppppppppppp=====".print_r($each_pie,true));
					$request ['value'] = $request ['value'] + $each_pie ['pie_data'] ['stage2_pie_vales'] [21] ['Dental Abnormalities'] ['value'];
				}
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			default :
				break;
		}
	}
	public function get_drilling_screenings_abnormalities1($data, $date = false, $screening_duration = "Yearly") {
		// $query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Name' => 1))->select(array("doc_data.widget_data"))->limit($per_page)->offset($page-1)->get($this->screening_app_col);
		$obj_data = json_decode ( $data, true );
		
		$type = $obj_data ['label'];
		
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		ini_set ( 'memory_limit', '1G' );
		
		$count = $this->mongo_db->count ( $this->screening_app_col );
		// //log_message("debug","cccccccccccccccccccccccccccccccccccccccc".print_r($count,true));
		if ($count < 10000) {
			$per_page = $count;
			$loop = 2; // $count / $per_page;
		} else {
			$per_page = 10000;
			$loop = $count / $per_page;
		}
		
		switch ($type) {
			case "Physical Abnormalities" :
				$requests = [ ];
				$request ['label'] = 'Over Weight';
				// $query = $this->mongo_db->whereIn("doc_data.widget_data.page5.Doctor Check Up.Deficencies", array("Over Weight"))->count($this->screening_app_col);
				
				$merged_array = array (
						"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
								'$in' => array (
										"Over Weight" 
								) 
						) 
				);
				
				$result = [ ];
				for($page = 1; $page < $loop; $page ++) {
					$offset = $per_page * ($page);
					$pipeline = [ 
							array (
									'$project' => array (
											"doc_data.widget_data" => true,
											"history" => true 
									) 
							),
							array (
									'$match' => $merged_array 
							),
							array (
									'$limit' => $offset 
							),
							array (
									'$skip' => $offset - $per_page 
							) 
					];
					$response = $this->mongo_db->command ( array (
							'aggregate' => $this->screening_app_col,
							'pipeline' => $pipeline 
					) );
					$temp_result = [ ];
					foreach ( $response ['result'] as $doc ) {
						
						foreach ( $doc ['history'] as $date ) {
							$time = $date ['time'];
							
							if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
								array_push ( $temp_result, $doc );
								break;
							}
						}
					}
					
					$result = array_merge ( $result, $temp_result );
				}
				
				$request ['value'] = count ( $result );
				array_push ( $requests, $request );
				
				$request ['label'] = 'Under Weight';
				// $query = $this->mongo_db->whereIn("doc_data.widget_data.page5.Doctor Check Up.Deficencies", array("Under Weight"))->count($this->screening_app_col);
				
				$merged_array = array (
						"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (
								'$in' => array (
										"Under Weight" 
								) 
						) 
				);
				
				$result = [ ];
				for($page = 1; $page < $loop; $page ++) {
					$offset = $per_page * ($page);
					$pipeline = [ 
							array (
									'$project' => array (
											"doc_data.widget_data" => true,
											"history" => true 
									) 
							),
							array (
									'$match' => $merged_array 
							),
							array (
									'$limit' => $offset 
							),
							array (
									'$skip' => $offset - $per_page 
							) 
					];
					$response = $this->mongo_db->command ( array (
							'aggregate' => $this->screening_app_col,
							'pipeline' => $pipeline 
					) );
					$temp_result = [ ];
					foreach ( $response ['result'] as $doc ) {
						
						foreach ( $doc ['history'] as $date ) {
							$time = $date ['time'];
							
							if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
								array_push ( $temp_result, $doc );
								break;
							}
						}
					}
					
					$result = array_merge ( $result, $temp_result );
				}
				
				$request ['value'] = count ( $result );
				array_push ( $requests, $request );
				
				return $requests;
				break;
			case "General Abnormalities" :
				$requests = [ ];
				$request ['label'] = 'General';
				// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4" => array(), "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array()))->count($this->screening_app_col);
				
				$and_merged_array = array ();
				
				$general_str_empty = array (
						"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
								'$ne' => '' 
						) 
				);
				$general_str_space = array (
						"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
								'$ne' => ' ' 
						) 
				);
				$general_arr = array (
						"doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => array (
								'$ne' => array () 
						) 
				);
				
				$page4_exists = array (
						"doc_data.widget_data.page4.Doctor Check Up" => array (
								'$exists' => true 
						) 
				);
				
				array_push ( $and_merged_array, $general_str_empty );
				array_push ( $and_merged_array, $general_str_space );
				array_push ( $and_merged_array, $general_arr );
				array_push ( $and_merged_array, $page4_exists );
				
				$result = [ ];
				for($page = 1; $page < $loop; $page ++) {
					$offset = $per_page * ($page);
					$pipeline = [ 
							array (
									'$match' => array (
											'$and' => $and_merged_array 
									) 
							),
							array (
									'$project' => array (
											"doc_data.widget_data" => true,
											"history" => true 
									) 
							),
							array (
									'$limit' => $offset 
							),
							array (
									'$skip' => $offset - $per_page 
							) 
					];
					$response = $this->mongo_db->command ( array (
							'aggregate' => $this->screening_app_col,
							'pipeline' => $pipeline 
					) );
					$temp_result = [ ];
					foreach ( $response ['result'] as $doc ) {
						
						foreach ( $doc ['history'] as $date ) {
							$time = $date ['time'];
							
							if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
								array_push ( $temp_result, $doc );
								break;
							}
						}
					}
					
					$result = array_merge ( $result, $temp_result );
				}
				
				$request ['value'] = count ( $result );
				array_push ( $requests, $request );
				
				$request ['label'] = 'Ortho';
				// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4" => array(), "doc_data.widget_data.page4.Doctor Check Up.Ortho" => array()))->count($this->screening_app_col);
				// $request['value'] = $query;
				
				$and_merged_array = array ();
				
				$ortho = array (
						"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
								'$not' => array (
										'$size' => 0 
								) 
						) 
				);
				
				$page4_exists = array (
						"doc_data.widget_data.page4.Doctor Check Up.Ortho" => array (
								'$exists' => true 
						) 
				);
				
				array_push ( $and_merged_array, $ortho );
				array_push ( $and_merged_array, $page4_exists );
				
				$result = [ ];
				for($page = 1; $page < $loop; $page ++) {
					$offset = $per_page * ($page);
					$pipeline = [ 
							array (
									'$match' => array (
											'$and' => $and_merged_array 
									) 
							),
							array (
									'$project' => array (
											"doc_data.widget_data" => true,
											"history" => true 
									) 
							),
							array (
									'$limit' => $offset 
							),
							array (
									'$skip' => $offset - $per_page 
							) 
					];
					
					$response = $this->mongo_db->command ( array (
							'aggregate' => $this->screening_app_col,
							'pipeline' => $pipeline 
					) );
					$temp_result = [ ];
					foreach ( $response ['result'] as $doc ) {
						
						foreach ( $doc ['history'] as $date ) {
							$time = $date ['time'];
							
							if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
								array_push ( $temp_result, $doc );
								break;
							}
						}
					}
					
					$result = array_merge ( $result, $temp_result );
				}
				
				$request ['value'] = count ( $result );
				array_push ( $requests, $request );
				
				$request ['label'] = 'Postural';
				// $query = $this->mongo_db->whereNe(array("doc_data.widget_data.page4.Doctor Check Up.Postural" => array(), "doc_data.widget_data.page4" => array()))->count($this->screening_app_col);
				
				$and_merged_array = array ();
				
				$postural = array (
						"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
								'$not' => array (
										'$size' => 0 
								) 
						) 
				);
				
				$page4_exists = array (
						"doc_data.widget_data.page4.Doctor Check Up.Postural" => array (
								'$exists' => true 
						) 
				);
				
				array_push ( $and_merged_array, $postural );
				array_push ( $and_merged_array, $page4_exists );
				
				$result = [ ];
				for($page = 1; $page < $loop; $page ++) {
					$offset = $per_page * ($page);
					$pipeline = [ 
							array (
									'$match' => array (
											'$and' => $and_merged_array 
									) 
							),
							array (
									'$project' => array (
											"doc_data.widget_data" => true,
											"history" => true 
									) 
							),
							array (
									'$limit' => $offset 
							),
							array (
									'$skip' => $offset - $per_page 
							) 
					];
					
					$response = $this->mongo_db->command ( array (
							'aggregate' => $this->screening_app_col,
							'pipeline' => $pipeline 
					) );
					$temp_result = [ ];
					foreach ( $response ['result'] as $doc ) {
						
						foreach ( $doc ['history'] as $date ) {
							$time = $date ['time'];
							
							if (($time <= $dates ['today_date']) && ($time >= $dates ['end_date'])) {
								array_push ( $temp_result, $doc );
								break;
							}
						}
					}
					
					$result = array_merge ( $result, $temp_result );
				}
				
				$request ['value'] = count ( $result );
				array_push ( $requests, $request );
				
				$request ['label'] = 'Defects at Birth';
				$query = $this->mongo_db->whereNe ( array (
						"doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => array (),
						"doc_data.widget_data.page5" => array () 
				) )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Deficencies';
				$query = $this->mongo_db->whereNe ( array (
						"doc_data.widget_data.page5.Doctor Check Up.Deficencies" => array (),
						"doc_data.widget_data.page5" => array () 
				) )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Childhood Diseases';
				$query = $this->mongo_db->whereNe ( array (
						"doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => array (),
						"doc_data.widget_data.page5" => array () 
				) )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				return $requests;
				break;
			case "Eye Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Without Glasses';
				$search = array (
						"doc_data.widget_data.page6.Without Glasses.Right" => "",
						"doc_data.widget_data.page6.Without Glasses.Left" => "",
						"doc_data.widget_data.page6.Without Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.Without Glasses.Left" => "6/6",
						"doc_data.widget_data.page6" => array () 
				);
				$query = $this->mongo_db->orWhere ( $search )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'With Glasses';
				$search = array (
						"doc_data.widget_data.page6.With Glasses.Right" => "",
						"doc_data.widget_data.page6.With Glasses.Left" => "",
						"doc_data.widget_data.page6.With Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.With Glasses.Left" => "6/6",
						"doc_data.widget_data.page6" => array () 
				);
				$query = $this->mongo_db->orWhere ( $search )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Colour Blindness';
				$search = array (
						"doc_data.widget_data.page7.Colour Blindness.Right" => array (
								"Yes" 
						),
						"doc_data.widget_data.page7.Colour Blindness.Left" => array (
								"Yes" 
						) 
				);
				$query = $this->mongo_db->orWhere ( $search )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				return $requests;
				break;
			case "Auditory Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Right Ear';
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Right" => "Fail",
						"doc_data.widget_data.page8" => array () 
				);
				$query = $this->mongo_db->orWhere ( $search )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Left Ear';
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Left" => "Fail",
						"doc_data.widget_data.page8" => array () 
				);
				$query = $this->mongo_db->orWhere ( $search )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Speech Screening';
				
				$query = $this->mongo_db->whereInAll ( "doc_data.widget_data.page8. Auditory Screening.Speech Screening", array (
						'Delay',
						"Misarticulation",
						"Fluency",
						"Voice" 
				) )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				return $requests;
				break;
			case "Dental Abnormalities" :
				$requests = [ ];
				
				$request ['label'] = 'Oral Hygiene';
				$query = $this->mongo_db->whereNe ( "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene", "Good" )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Carious Teeth';
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Carious Teeth", "Yes" )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Flourosis';
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Flourosis", "Yes" )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Orthodontic Treatment';
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment", "Yes" )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				$request ['label'] = 'Indication for extraction';
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Indication for extraction", "Yes" )->count ( $this->screening_app_col );
				$request ['value'] = $query;
				array_push ( $requests, $request );
				
				return $requests;
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_districts($data, $date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
			//$today_date = "2018-01-01";
		} else {
			$today_date = $this->today_date;
			//$today_date = "2018-01-01";
		}	
		
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage3_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( 'healthcare201671115519757_screening_final_'.$year );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		switch ($type) {
			case "Over Weight" :
				
				// $query = $this->mongo_db->where("doc_data.widget_data.page2.Personal Information.District","Nalgonda")->get($this->screening_app_col);
				// foreach ($query as $doc){
				
				// $doc['doc_data']['widget_data']['page2']['Personal Information']['District'] = "Nalgonda";
				
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				//log_message ( "debug", "iiiiiiiiiiiiiinnnnnnnnnnncapssssssssssssssss========================" );
				
				// }
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Over Weight"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Under Weight"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Obese" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Obese"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["General"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Skin"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Others(Description/Advice)"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Ortho"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Postural"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Defects at Birth"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			// case "Deficencies" :
				
				// $requests = [ ];
				// foreach ( $pie_data as $each_pie ) {
					// $requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Deficencies"] );
				// }
				
				// $request = [ ];
				// foreach ( $requests as $doc ) {
					// if (isset ( $request [$doc ['label']] )) {
						// $request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					// } else {
						// $request [$doc ['label']] = $doc ['value'];
					// }
				// }
				
				// $final_values = [ ];
				// foreach ( $request as $dist => $count ) {
					// $result ['label'] = $dist;
					// $result ['value'] = $count;
					// array_push ( $final_values, $result );
				// }
				
				// return $final_values;
				// break;
				
				//========================================Deficencies divided
				
			case "Anaemia" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Anaemia"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Vitamin Deficiency - Bcomplex" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Vitamin Deficiency - Bcomplex"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
				
			case "Vitamin A Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Vitamin A Deficiency"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Vitamin D Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Vitamin D Deficiency"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "SAM/stunting" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["SAM/stunting"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Goiter" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Goiter"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
				//========================================Deficencies divided
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Childhood Diseases"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Without Glasses"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["With Glasses"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Colour Blindness"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Right Ear"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Left Ear"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Speech Screening"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Oral Hygiene - Fair"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Oral Hygiene - Poor"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Carious Teeth"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Flourosis"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Orthodontic Treatment"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Indication for extraction"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Root Canal Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Root Canal Treatment"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "CROWNS" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["CROWNS"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Fixed Partial Denture" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Fixed Partial Denture"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Curettage" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Curettage"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_districts_tt($data, $date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage3_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( $this->screening_app_col_screening );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		switch ($type) {
			case "Over Weight" :
				
				// $query = $this->mongo_db->where("doc_data.widget_data.page2.Personal Information.District","Nalgonda")->get($this->screening_app_col);
				// foreach ($query as $doc){
				
				// $doc['doc_data']['widget_data']['page2']['Personal Information']['District'] = "Nalgonda";
				
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				//log_message ( "debug", "iiiiiiiiiiiiiinnnnnnnnnnncapssssssssssssssss========================" );
				
				// }
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Over Weight"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Under Weight"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["General"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Skin"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Others(Description/Advice)"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Ortho"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Postural"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Defects at Birth"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Deficencies" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Deficencies"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Childhood Diseases"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Without Glasses"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["With Glasses"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Colour Blindness"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Right Ear"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Left Ear"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Speech Screening"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Oral Hygiene - Fair"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Oral Hygiene - Poor"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Carious Teeth"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Flourosis"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Orthodontic Treatment"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage3_pie_vales'] ["Indication for extraction"] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_screenings_districts1($data) {
		// $query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Name' => 1))->select(array("doc_data.widget_data"))->limit($per_page)->offset($page-1)->get($this->screening_app_col);
		$obj_data = json_decode ( $data, true );
		
		$type = $obj_data ['label'];
		switch ($type) {
			case "Over Weight" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Over Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				break;
			
			case "Under Weight" :
				
				ini_set ( 'memory_limit', '512M' );
				
				// $query = $this->mongo_db->get($this->screening_app_col);
				// $chk =0;
				// $id=1000;
				// foreach ($query as $doc){
				// if(isset($doc['doc_data']['widget_data']['page8'][' Auditory Screening']['D D and disablity'])){
				// $doc['doc_data']['widget_data']['page8'][' Auditory Screening']['D D and disability'] = $doc['doc_data']['widget_data']['page8'][' Auditory Screening']['D D and disablity'];
				// unset($doc['doc_data']['widget_data']['page8'][' Auditory Screening']['D D and disablity']);
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				// }
				
				// $doc['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'] = 'MBNR_1423101_'.$id;
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				// $chk++;
				// $id++;
				
				// }
				// //log_message("debug","chhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhkkkkkkkkkkkkkkkkkkkkkkkk".print_r($chk,true));
				
				// $query = $this->mongo_db->where("doc_data.widget_data.page2.Personal Information.School Name","TSWRS-CHITKUL,MEDAK")->get($this->screening_app_col);
				// foreach ($query as $doc){
				
				// $doc['doc_data']['widget_data']['page2']['Personal Information']['School Name'] = "TSWREIS CHITKUL(G),MEDAK";
				
				// $query = $this->mongo_db->where("_id", new MongoID($doc["_id"]))->set($doc)->update($this->screening_app_col);
				// //log_message("debug","iiiiiiiiiiiiiinnnnnnnnnnncapssssssssssssssss========================");
				
				// }
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Under Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "General" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities", array (
						"Neurologic",
						"H and N",
						"ENT",
						"Lymphatic",
						"Heart",
						"Lungs",
						"Genitalia",
						"Skin" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Ortho" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Ortho", array (
						"Neck",
						"Shoulders",
						"Arms/Hands",
						"Hips",
						"Knees",
						"Feet" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Postural" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Postural", array (
						"No spinal Abnormality",
						"Spinal Abnormality",
						"Mild",
						"Marked",
						"Moderate" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Defects at Birth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth", array (
						"Neural Tube Defect",
						"Down Syndrome",
						"Cleft Lip and Palate",
						"Talipes Club foot",
						"Developmental Dysplasia of Hip",
						"Congenital Cataract",
						"Congenital Deafness",
						"Congenital Heart Disease",
						"Retinopathy of Prematurity" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Deficencies" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Anaemia",
						"Vitamin Deficiency - Bcomplex",
						"Vitamin A Deficiency",
						"Vitamin D Deficiency",
						"SAM/stunting",
						"Goiter",
						"Under Weight",
						"Over Weight",
						"Obese" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Childhood Diseases" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases", array (
						"Skin Conditions",
						"Otitis Media",
						"Rheumatic Heart Disease",
						"Asthma",
						"Convulsive Disorders",
						"Hypothyroidism",
						"Diabetes",
						"Epilepsy" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Without Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.Without Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.Without Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "With Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.With Glasses.Right" => "",
						"doc_data.widget_data.page6.With Glasses.Left" => "",
						"doc_data.widget_data.page6.With Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.With Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Colour Blindness" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page7.Colour Blindness.Right" => "No",
						"doc_data.widget_data.page7.Colour Blindness.Left" => "No" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Right Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Right" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Left Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Left" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Speech Screening" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereInAll ( "doc_data.widget_data.page8. Auditory Screening.Speech Screening", array (
						'Delay',
						"Misarticulation",
						"Fluency",
						"Voice" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Oral Hygiene" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNe ( "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene", "Good" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Carious Teeth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Carious Teeth", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Flourosis" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Flourosis", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Orthodontic Treatment" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			case "Indication for extraction" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Indication for extraction", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_districts_prepare_pie_array ( $query );
				
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_schools($data, $date = false, $screening_duration = "Yearly")
	{
		if ($date) {
			$today_date = $date;
			//$today_date = "2018-01-01";
		} else {
			$today_date = $this->today_date;
			//$today_date = "2018-01-01";
		}	
		
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage4_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( 'healthcare201671115519757_screening_final_'.$year );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['0'];
		$dist = strtolower ( $obj_data ['1'] );
		switch ($type) {
			case "Over Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Over Weight"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Over Weight"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Under Weight"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Under Weight"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Obese" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Obese"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Obese"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["General"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["General"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Skin"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Skin"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Ortho"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Ortho"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Postural"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Postural"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Defects at Birth"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Defects at Birth"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			// case "Deficencies" :
				
				// $requests = [ ];
				// foreach ( $pie_data as $each_pie ) {
					// if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Deficencies"] [strtolower ( $dist )] != null)
						// $requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Deficencies"] [strtolower ( $dist )] );
				// }
				
				// $request = [ ];
				// foreach ( $requests as $doc ) {
					// if (isset ( $request [$doc ['label']] )) {
						// $request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					// } else {
						// $request [$doc ['label']] = $doc ['value'];
					// }
				// }
				
				// $final_values = [ ];
				// foreach ( $request as $dist => $count ) {
					// $result ['label'] = $dist;
					// $result ['value'] = $count;
					// array_push ( $final_values, $result );
				// }
				
				// return $final_values;
				// break;
				
			//=================================Deficencies divided====================
			
			case "Anaemia" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Anaemia"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Anaemia"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Vitamin Deficiency - Bcomplex" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin Deficiency - Bcomplex"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin Deficiency - Bcomplex"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Vitamin A Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin A Deficiency"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin A Deficiency"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Vitamin D Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin D Deficiency"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Vitamin D Deficiency"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "SAM/stunting" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["SAM/stunting"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["SAM/stunting"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Goiter" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Goiter"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Goiter"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			//=================================Deficencies divided====================
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Childhood Diseases"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Childhood Diseases"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Without Glasses"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Without Glasses"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["With Glasses"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["With Glasses"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Colour Blindness"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Colour Blindness"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Right Ear"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Right Ear"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Left Ear"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Left Ear"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Speech Screening"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Speech Screening"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Carious Teeth"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Carious Teeth"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Flourosis"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Flourosis"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Indication for extraction"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Indication for extraction"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Root Canal Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Root Canal Treatment"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Root Canal Treatment"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "CROWNS" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["CROWNS"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["CROWNS"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Fixed Partial Denture" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Fixed Partial Denture"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Fixed Partial Denture"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;

				case "Curettage" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Curettage"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Curettage"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_schools_tt($data, $date = false, $screening_duration = "Yearly") {
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage4_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( $this->screening_app_col_screening );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['0'];
		$dist = strtolower ( $obj_data ['1'] );
		switch ($type) {
			case "Over Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Over Weight"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Over Weight"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Under Weight"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Under Weight"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["General"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["General"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Skin"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Skin"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
				
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Ortho"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Ortho"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Postural"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Postural"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Defects at Birth"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Defects at Birth"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Deficencies" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Deficencies"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Deficencies"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Childhood Diseases"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Childhood Diseases"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Without Glasses"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Without Glasses"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["With Glasses"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["With Glasses"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Colour Blindness"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Colour Blindness"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Right Ear"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Right Ear"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Left Ear"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Left Ear"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Speech Screening"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Speech Screening"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Carious Teeth"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Carious Teeth"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Flourosis"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Flourosis"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage4_pie_vales'] ["Indication for extraction"] [strtolower ( $dist )] != null)
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage4_pie_vales'] ["Indication for extraction"] [strtolower ( $dist )] );
				}
				
				$request = [ ];
				foreach ( $requests as $doc ) {
					if (isset ( $request [$doc ['label']] )) {
						$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
					} else {
						$request [$doc ['label']] = $doc ['value'];
					}
				}
				
				$final_values = [ ];
				foreach ( $request as $dist => $count ) {
					$result ['label'] = $dist;
					$result ['value'] = $count;
					array_push ( $final_values, $result );
				}
				
				return $final_values;
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_screenings_schools1($data) {
		$obj_data = json_decode ( $data, true );
		// log_message("debug","ooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($obj_data,true));
		
		$type = $obj_data ['0'];
		$dist = strtolower ( $obj_data ['1'] );
		switch ($type) {
			case "Over Weight" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Over Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Under Weight" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Under Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "General" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities", array (
						"Neurologic",
						"H and N",
						"ENT",
						"Lymphatic",
						"Heart",
						"Lungs",
						"Genitalia",
						"Skin" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Ortho" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Ortho", array (
						"Neck",
						"Shoulders",
						"Arms/Hands",
						"Hips",
						"Knees",
						"Feet" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Postural" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Postural", array (
						"No spinal Abnormality",
						"Spinal Abnormality",
						"Mild",
						"Marked",
						"Moderate" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Defects at Birth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth", array (
						"Neural Tube Defect",
						"Down Syndrome",
						"Cleft Lip and Palate",
						"Talipes Club foot",
						"Developmental Dysplasia of Hip",
						"Congenital Cataract",
						"Congenital Deafness",
						"Congenital Heart Disease",
						"Retinopathy of Prematurity" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Deficencies" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Anaemia",
						"Vitamin Deficiency - Bcomplex",
						"Vitamin A Deficiency",
						"Vitamin D Deficiency",
						"SAM/stunting",
						"Goiter",
						"Under Weight",
						"Over Weight",
						"Obese" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Childhood Diseases" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases", array (
						"Skin Conditions",
						"Otitis Media",
						"Rheumatic Heart Disease",
						"Asthma",
						"Convulsive Disorders",
						"Hypothyroidism",
						"Diabetes",
						"Epilepsy" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Without Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.Without Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.Without Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "With Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.With Glasses.Right" => "",
						"doc_data.widget_data.page6.With Glasses.Left" => "",
						"doc_data.widget_data.page6.With Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.With Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Colour Blindness" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page7.Colour Blindness.Right" => "No",
						"doc_data.widget_data.page7.Colour Blindness.Left" => "No" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Right Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Right" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Left Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Left" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Speech Screening" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereInAll ( "doc_data.widget_data.page8. Auditory Screening.Speech Screening", array (
						'Delay',
						"Misarticulation",
						"Fluency",
						"Voice" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Oral Hygiene" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNe ( "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene", "Good" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Carious Teeth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Carious Teeth", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Flourosis" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Flourosis", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Orthodontic Treatment" :
				ini_set ( 'memory_limit', '512M' );
				// $search = array("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment" => "No");
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			case "Indication for extraction" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Indication for extraction", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_schools_prepare_pie_array ( $query, $dist );
				
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_students($data, $date = false, $screening_duration = "Yearly") {
		ini_set ( 'memory_limit', '1G' );
		if ($date) {
			$today_date = $date;
			//$today_date = "2018-01-01";
		} else {
			$today_date = $this->today_date;
			//$today_date = "2018-01-01";
		}	
		
		if ($screening_duration != "Yearly"){
			$get_year = explode(" ",$screening_duration);
			$year = $get_year[0];
		}
		else
		{
			$get_year = explode("-",$today_date);
			$year = $get_year[0];
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage5_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( 'healthcare201671115519757_screening_final_'.$year );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['0'];
		$school_name = strtolower ( $obj_data ['1'] );
		//log_message ( "debug", "obbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbjjjjjjjjjjjjj" . print_r ( $school_name, true ) );
		switch ($type) {
			case "Over Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [base64_encode($school_name) ] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [base64_encode($school_name)] )) {
						log_message("debug","pieeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee".print_r($each_pie,true));
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [base64_encode($school_name)] );
					}
				}
				
				return $requests;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				
			case "Obese" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Obese"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Obese"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Obese"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			// case "Deficencies" :
				
				// $requests = [ ];
				// foreach ( $pie_data as $each_pie ) {
					// if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [base64_encode($school_name)] ))
						// $requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [base64_encode($school_name)] );
				// }
				
				// return $requests;
				// break;
				
			//==========================================Deficencies divided================
			
			case "Anaemia" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Anaemia"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Anaemia"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Anaemia"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				
			case "Vitamin Deficiency - Bcomplex" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin Deficiency - Bcomplex"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin Deficiency - Bcomplex"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin Deficiency - Bcomplex"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				
			case "Vitamin A Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin A Deficiency"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin A Deficiency"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin A Deficiency"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				
			case "Vitamin D Deficiency" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin D Deficiency"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin D Deficiency"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Vitamin D Deficiency"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "SAM/stunting" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["SAM/stunting"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["SAM/stunting"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["SAM/stunting"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				
			case "Goiter" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Goiter"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Goiter"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Goiter"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			//==========================================Deficencies divided================
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
				case "Root Canal Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Root Canal Treatment"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Root Canal Treatment"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Root Canal Treatment"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;

				case "CROWNS" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["CROWNS"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["CROWNS"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["CROWNS"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;

				case "Fixed Partial Denture" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Fixed Partial Denture"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Fixed Partial Denture"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Fixed Partial Denture"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;

				case "Curettage" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Curettage"] [base64_encode($school_name)] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Curettage"] [base64_encode($school_name)] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Curettage"] [base64_encode($school_name)] );
				}
				
				return $requests;
				break;
			
			default :
				;
				break;
		}
	}
	
	public function get_drilling_screenings_students_tt($data, $date = false, $screening_duration = "Yearly") {
		ini_set ( 'memory_limit', '1G' );
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$dates = $this->get_start_end_date ( $today_date, $screening_duration );
		
		$pie_data = $this->mongo_db->select ( array (
				'pie_data.stage5_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get ( $this->screening_app_col_screening );
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['0'];
		$school_name = strtolower ( $obj_data ['1'] );
		//log_message ( "debug", "obbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbjjjjjjjjjjjjj" . print_r ( $obj_data, true ) );
		switch ($type) {
			case "Over Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					// log_message("debug","pieeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee".print_r($each_pie,true));
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [strtolower ( $school_name )] )) {
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Over Weight"] [strtolower ( $school_name )] );
					}
				}
				
				return $requests;
				break;
			
			case "Under Weight" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Under Weight"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "General" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["General"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Skin" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Skin"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Others(Description/Advice)" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Others(Description/Advice)"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Ortho" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Ortho"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Postural" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Postural"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Defects at Birth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Defects at Birth"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Deficencies" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Deficencies"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Childhood Diseases" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Childhood Diseases"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Without Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Without Glasses"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "With Glasses" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["With Glasses"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Colour Blindness" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Colour Blindness"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Right Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Right Ear"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Left Ear" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Left Ear"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Speech Screening" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Speech Screening"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Oral Hygiene - Fair" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Fair"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Oral Hygiene - Poor" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Oral Hygiene - Poor"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Carious Teeth" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Carious Teeth"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Flourosis" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Flourosis"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Orthodontic Treatment" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Orthodontic Treatment"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			case "Indication for extraction" :
				
				$requests = [ ];
				foreach ( $pie_data as $each_pie ) {
					if ($each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [strtolower ( $school_name )] != null && is_array ( $each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [strtolower ( $school_name )] ))
						$requests = array_merge_recursive ( $requests, $each_pie ['pie_data'] ['stage5_pie_vales'] ["Indication for extraction"] [strtolower ( $school_name )] );
				}
				
				return $requests;
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_screenings_students1($data) {
		$obj_data = json_decode ( $data, true );
		// log_message("debug","ooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($obj_data,true));
		
		$type = $obj_data ['0'];
		$school_name = strtolower ( $obj_data ['1'] );
		switch ($type) {
			case "Over Weight" :
				
				$query = $this->mongo_db->select ( array (
						"_id",
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Over Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Under Weight" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data.widget_data" 
				) )->whereIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Under Weight" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "General" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities", array (
						"Neurologic",
						"H and N",
						"ENT",
						"Lymphatic",
						"Heart",
						"Lungs",
						"Genitalia",
						"Skin" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Ortho" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Ortho", array (
						"Neck",
						"Shoulders",
						"Arms/Hands",
						"Hips",
						"Knees",
						"Feet" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Postural" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page4.Doctor Check Up.Postural", array (
						"No spinal Abnormality",
						"Spinal Abnormality",
						"Mild",
						"Marked",
						"Moderate" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Defects at Birth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth", array (
						"Neural Tube Defect",
						"Down Syndrome",
						"Cleft Lip and Palate",
						"Talipes Club foot",
						"Developmental Dysplasia of Hip",
						"Congenital Cataract",
						"Congenital Deafness",
						"Congenital Heart Disease",
						"Retinopathy of Prematurity" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Deficencies" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Deficencies", array (
						"Anaemia",
						"Vitamin Deficiency - Bcomplex",
						"Vitamin A Deficiency",
						"Vitamin D Deficiency",
						"SAM/stunting",
						"Goiter",
						"Under Weight",
						"Over Weight",
						"Obese" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Childhood Diseases" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNotIn ( "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases", array (
						"Skin Conditions",
						"Otitis Media",
						"Rheumatic Heart Disease",
						"Asthma",
						"Convulsive Disorders",
						"Hypothyroidism",
						"Diabetes",
						"Epilepsy" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Without Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.Without Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.Without Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "With Glasses" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page6.With Glasses.Right" => "",
						"doc_data.widget_data.page6.With Glasses.Left" => "",
						"doc_data.widget_data.page6.With Glasses.Right" => "6/6",
						"doc_data.widget_data.page6.With Glasses.Left" => "6/6" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Colour Blindness" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page7.Colour Blindness.Right" => "No",
						"doc_data.widget_data.page7.Colour Blindness.Left" => "No" 
				);
				$query = $this->mongo_db->whereNe ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Right Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Right" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Left Ear" :
				ini_set ( 'memory_limit', '512M' );
				$search = array (
						"doc_data.widget_data.page8. Auditory Screening.Left" => "Fail" 
				);
				$query = $this->mongo_db->where ( $search )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Speech Screening" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereInAll ( "doc_data.widget_data.page8. Auditory Screening.Speech Screening", array (
						'Delay',
						"Misarticulation",
						"Fluency",
						"Voice" 
				) )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Oral Hygiene" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->whereNe ( "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene", "Good" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Carious Teeth" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Carious Teeth", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Flourosis" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Flourosis", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Orthodontic Treatment" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			case "Indication for extraction" :
				ini_set ( 'memory_limit', '512M' );
				$query = $this->mongo_db->where ( "doc_data.widget_data.page9.Dental Check-up.Indication for extraction", "Yes" )->get ( $this->screening_app_col );
				
				return $this->get_drilling_screenings_students_prepare_pie_array ( $query, $school_name );
				
				break;
			
			default :
				;
				break;
		}
	}
	public function get_drilling_screenings_districts_prepare_pie_array($query) {
		$requests = [ ];
		
		$dist_list = $this->get_all_district ();
		
		$dist_arr = [ ];
		foreach ( $dist_list as $dist ) {
			array_push ( $dist_arr, $dist ['dt_name'] );
		}
		
		foreach ( $dist_arr as $districts ) {
			$request ['label'] = $districts;
			$count = 0;
			if ($query) {
				foreach ( $query as $dist ) {
					if (isset ( $dist ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] )) {
						if (strtolower ( $dist ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == strtolower ( $districts )) {
							$count ++;
						}
					}
				}
			}
			$request ['value'] = $count;
			array_push ( $requests, $request );
		}
		
		return $requests;
	}
	public function get_drilling_screenings_schools_prepare_pie_array($query, $dist) {
		$search_result = [ ];
		$count = 0;
		if ($query) {
			foreach ( $query as $doc ) {
				if (isset ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] )) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'] ) == $dist) {
						array_push ( $search_result, $doc );
					}
				}
			}
			$request = [ ];
			foreach ( $search_result as $doc ) {
				if (isset ( $request [$doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name']] )) {
					$request [$doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name']] ++;
				} else {
					$request [$doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name']] = 1;
				}
			}
			
			//log_message ( "debug", "schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo" . print_r ( $request, true ) );
			$final_values = [ ];
			foreach ( $request as $school => $count ) {
				//log_message ( "debug", "schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo" . print_r ( $school, true ) );
				//log_message ( "debug", "ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc" . print_r ( $count, true ) );
				$result ['label'] = $school;
				$result ['value'] = $count;
				array_push ( $final_values, $result );
			}
			
			//log_message ( "debug", "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff" . print_r ( $final_values, true ) );
			
			return $final_values;
		}
	}
	public function get_drilling_screenings_students_prepare_pie_array($query, $school_name) {
		$search_result = [ ];
		$count = 0;
		if ($query) {
			foreach ( $query as $doc ) {
				if (isset ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] )) {
					if (strtolower ( $doc ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'] ) == $school_name) {
						array_push ( $search_result, $doc ['_id']->{'$id'} );
					}
				}
			}
			
			return $search_result;
		}
	}
	public function get_drilling_screenings_students_docs($_id_array) {
		$docs = [ ];
		
		foreach ( $_id_array as $_id ) {
			$query = $this->mongo_db->select(array("doc_data.widget_data"))->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );
			
			if (isset ( $query [0] ))
				array_push ( $docs, $query [0] );
		}
		return $docs;
	}
	public function drill_down_screening_to_students_load_ehr_doc($_id) {
		if(!preg_match('/_/i', $_id))
		{
			$query = $this->mongo_db->select ( array ('doc_data','history') )->where ( "_id", new MongoID ( $_id ) )->get ("ttwreis_screening_report_col_2020-2021");
		}else
		{
			$query = $this->mongo_db->select(array('doc_data','history'))->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$_id)->get('ttwreis_other_classes_screening_data_2019-2020');
		}
		
		$unique_id = $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'];		
		
		//whereLike( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $_id )
		if ($query) {
			$query_request = $this->mongo_db->select(array("doc_data.widget_data","doc_data.notes_data","doc_data.external_attachments","doc_properties","history"))->orderBy(array("history.0.time"=> -1))->where( "doc_data.widget_data.page1.Student Info.Unique ID", $unique_id )->get ( $this->request_app_col_static_html );
			
			
			if(count($query_request) > 0){
				foreach($query_request as $req_ind => $req){
					unset($query_request[$req_ind]['doc_data']["notes_data"]);
					$notes_data = $this->mongo_db->whereLike ("req_doc_id", new MongoId($req['_id']))->get ( $this->collections['ttwreis_req_notes'] );
					
					
					if(count($notes_data) > 0){
						$query_request[$req_ind]['doc_data']['notes_data'] = $notes_data[0]['notes_data'];
					}
				}
				
			}
			
			$query_notes = $this->mongo_db->orderBy(array('datetime' => 1))->where ( "uid", $unique_id )->get ( $this->notes_col );
			//log_message("debug","EHR======notes".print_r($query_notes,true));
			$unique_id = explode("_", $unique_id);
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			//$school_details = $this->mongo_db->where ( "school_name", $query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'] )->get ( $this->collections ['ttwreis_schools'] );
			$query_hs = $this->mongo_db->where ( "school_code", intval($unique_id[1]) )->get ( $this->collections ['ttwreis_health_supervisors'] );
			$hs_details = "";
			if(!empty($query_hs) && isset($query_hs))
			{
				$hs_details = $query_hs[0];
			}else
			{
				$query_hs = $this->mongo_db->where ( "school_code", $unique_id[1] )->get ( $this->collections ['ttwreis_health_supervisors'] );
				$hs_details = $query_hs[0];
			}
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			
			$result ['screening'] = $query;
			$result ['request'] = $query_request;
			$result ['notes'] = $query_notes;
			$result ['hs'] = $hs_details;
			//log_message("debug","result ==========notes".print_r($result ['notes'],true));
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['request'] = false;
			$result ['notes'] = false;
			$result ['hs'] = false;
			return $result;
		}
	}
	public function drill_down_screening_to_students_doc($_id) {
		$query = $this->mongo_db->select ( array (
				'doc_data.widget_data',
				'doc_data.chart_data',
				'doc_data.external_attachments',
				'history' 
		) )->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );
		if ($query) {
			
			return $query;
		} else {
			
			return false;
		}
	}
	
	// *************************************************
	
	/**
	 * Helper: Prepares IP address string for database insertion.
	 *
	 * @return string
	 */
	protected function _prepare_ip($ip_address) {
		return $ip_address;
	}
	public function user_exists($email = FALSE) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( array (
				'email' => $email 
		) )->get ( $this->collections ['ttwreis_health_supervisors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		if ($query !== array ()) {
			return TRUE;
		} else {
			return FALSE;
		}
	}
	public function cc_user_exists($email = FALSE) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( array (
				'email' => $email 
		) )->get ( $this->collections ['ttwreis_cc'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		if ($query !== array ()) {
			return TRUE;
		} else {
			return FALSE;
		}
	}
	public function school_exists($email = FALSE) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( array (
				'email' => $email 
		) )->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		if ($query !== array ()) {
			return TRUE;
		} else {
			return FALSE;
		}
	}
	public function doctor_exists($email = FALSE) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( array (
				'email' => $email 
		) )->get ( $this->collections ['ttwreis_doctors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		if ($query !== array ()) {
			return TRUE;
		} else {
			return FALSE;
		}
	}
	
	/**
	 * Sets an error message
	 */
	public function set_error($error) {
		$this->errors [] = $error;
		return $error;
	}
	
	/**
	 * Applies delimiters and returns themed errors
	 */
	public function errors() {
		$_output = '';
		foreach ( $this->errors as $error ) {
			$error_lang = $this->lang->line ( $error ) ? $this->lang->line ( $error ) : '##' . $error . '##';
			$_output .= $this->error_start_delimiter . $error_lang . $this->error_end_delimiter;
		}
		
		return $_output;
	}
	
	// ------------------------------------------------------------------------
	
	/**
	 * Return errors as an array, langified or not
	 */
	public function errors_array($langify = TRUE) {
		if ($langify) {
			$_output = array ();
			foreach ( $this->errors as $error ) {
				$errorLang = $this->lang->line ( $error ) ? $this->lang->line ( $error ) : '##' . $error . '##';
				$_output [] = $this->error_start_delimiter . $errorLang . $this->error_end_delimiter;
			}
			return $_output;
		} else {
			return $this->errors;
		}
	}
	
	/**
	 * Generates a random salt value.
	 */
	public function salt() {
		return substr ( md5 ( uniqid ( rand (), true ) ), 0, $this->salt_length );
	}
	
	/**
	 * Hashes the password to be stored in the database.
	 */
	public function hash_password($password, $salt = FALSE, $use_sha1_override = FALSE) {
		if (empty ( $password )) {
			return FALSE;
		}
		
		// Bcrypt
		if ($use_sha1_override === FALSE && $this->hash_method == 'bcrypt') {
			return $this->bcrypt->hash ( $password );
		}
		
		if ($this->store_salt && $salt) {
			return sha1 ( $password . $salt );
		} else {
			$salt = $this->salt ();
			return $salt . substr ( sha1 ( $salt . $password ), 0, - $this->salt_length );
		}
	}
	public function get_schools_by_dist_id($dist_id) {
		if ($dist_id == "All") {
			// ini_set ( 'memory_limit', '1G' );
			// $query = $this->mongo_db->select ( array ( 'doc_data.widget_data.page1', 'doc_data.widget_data.page2' ) )->orderBy(array('Hospital Unique ID' => 1))->get ( $this->screening_app_col );
			
			ini_set ( 'memory_limit', '1G' );
			$count = $this->mongo_db->count ( $this->screening_app_col );
			if ($count < 10000) {
				$per_page = $count;
				$loop = 2; // $count / $per_page;
			} else {
				$per_page = 10000;
				$loop = $count / $per_page;
			}
			
			$result = [ ];
			for($page = 1; $page < $loop; $page ++) {
				$offset = $per_page * ($page);
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data.page1" => true,
										"doc_data.widget_data.page2" => true 
								) 
						),
						array (
								'$limit' => $offset 
						),
						array (
								'$skip' => $offset - $per_page 
						) 
				];
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->screening_app_col,
						'pipeline' => $pipeline 
				) );
				$result = array_merge ( $result, $response ['result'] );
			}
			return $result;
		} else {
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$query = $this->mongo_db->select ( array (
					'school_name',
					'school_code',
					'school_mob',
					'contact_person_name' 
			) )->orderBy ( array (
					'school_name' => 1 
			) )->where ( 'dt_name', $dist_id )->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			return $query;
		}
	}
	public function get_students_by_school_name($school_name, $dist_name ,$academic_year) {
		if ($school_name == "All") {
			// log_message("debug","111111111111111111111111111111111111111".print_r(strtoupper($dist_name),true));
			// ini_set ( 'memory_limit', '1G' );
			// $query = $this->mongo_db->select ( array ( 'doc_data.widget_data.page1', 'doc_data.widget_data.page2' ) )->orderBy(array('Hospital Unique ID' => 1))->where ( "doc_data.widget_data.page2.Personal Information.District", strtoupper($dist_name) )->get ( $this->screening_app_col );
			ini_set ( 'memory_limit', '1G' );
			$count = $this->mongo_db->count ( $academic_year );
			if ($count < 10000) {
				$per_page = $count;
				$loop = 2; // $count / $per_page;
			} else {
				$per_page = 10000;
				$loop = $count / $per_page;
			}
			
			$merged_array = array (
					"doc_data.widget_data.page2.Personal Information.District" => strtoupper ( $dist_name ) 
			);
			
			$result = [ ];
			for($page = 1; $page < $loop; $page ++) {
				$offset = $per_page * ($page);
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data.page1" => true,
										"doc_data.widget_data.page2" => true 
								) 
						),
						array (
								'$match' => $merged_array 
						),
						array (
								'$limit' => $offset 
						),
						array (
								'$skip' => $offset - $per_page 
						) 
				];
				$response = $this->mongo_db->command ( array (
						'aggregate' => $academic_year,
						'pipeline' => $pipeline 
				) );
				
				$result = array_merge ( $result, $response ['result'] );
			}
			
			return $result;
		} else {
			ini_set ( 'max_execution_time', 0 );
			//log_message ( "debug", "22222222222222222222222222222222222222" . print_r ( $school_name, true ) );
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data.page1',
					'doc_data.widget_data.page2' 
			) )->orderBy ( array (
					'Hospital Unique ID' => 1 
			) )->where ( 'doc_data.widget_data.page2.Personal Information.School Name', $school_name )->get ( $academic_year );
			return $query;
		}
	}

	public function get_students_by_school_name_cc_users($school_name, $dist_name) {
		if ($school_name == "All") {
			// //log_message("debug","111111111111111111111111111111111111111".print_r(strtoupper($dist_name),true));
			ini_set ( 'memory_limit', '10G' );
			
			$count = $this->mongo_db->count ( $this->screening_app_col_tt_2021_2022 );
			if ($count < 10000) {
				$per_page = $count;
				$loop = 2; // $count / $per_page;
			} else {
				$per_page = 10000;
				$loop = $count / $per_page;
			}
			
			$merged_array = array (	"doc_data.widget_data.page2.Personal Information.District" => strtoupper ( $dist_name ));
			
			$result = [ ];
			for($page = 1; $page < $loop; $page ++) {
				$offset = $per_page * ($page);
				$pipeline = [ 
						array (
								'$project' => array ("doc_data.widget_data.page1" => true,"doc_data.widget_data.page2" => true) ),
						array (
								'$match' => $merged_array 
						),
						array (
								'$limit' => $offset 
						),
						array (
								'$skip' => $offset - $per_page 
						) 
				];
				$response = $this->mongo_db->command ( array ('aggregate' => $this->screening_app_col_tt_2021_2022,'pipeline' => $pipeline) );
				
				$result = array_merge ( $result, $response ['result'] );
			}
			
			return $result;
		} else {
			ini_set ( 'max_execution_time', 0 );
			//log_message ( "debug", "22222222222222222222222222222222222222" . print_r ( $school_name, true ) );
	$query = $this->mongo_db->select ( array ('doc_data.widget_data.page1','doc_data.widget_data.page2') )->orderBy ( array ('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1 
			) )->where ( 'doc_data.widget_data.page2.Personal Information.School Name', $school_name )->get ( $this->screening_app_col_tt_2021_2022 );
			return $query;
		}
	}
	public function get_reported_schools_count_by_dist_name($dist_id, $date) {
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'history.last_stage.time', $date )->get ( $this->absent_app_col );
		
		$count = 0;
		$r2h = 0;
		$sick = 0;
		foreach ( $query as $report ) {
			if (strtolower ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['District'] ) == strtolower ( $dist_id )) {
				$count ++;
				$sick = $sick + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['Sick'] );
				$sick = $sick + intval ( $report ['doc_data'] ['widget_data'] ['page2'] ['Attendence Details'] ['RestRoom'] );
				
				$r2h = $r2h + intval ( $report ['doc_data'] ['widget_data'] ['page1'] ['Attendence Details'] ['R2H'] );
			}
		}
		$data ['count'] = $count;
		$data ['sick'] = $sick;
		$data ['r2h'] = $r2h;
		
		return $data;
	}
	
	/*
	/ Get bmi values based  on selected Month
	*/
	public function get_reported_schools_bmi_count_by_dist_name($date,$dt_name,$school_name){
		
		
		if($dt_name == "All" && $school_name == "All")
		{
			$query = $this->mongo_db->select ( array (
					"doc_data.widget_data","doc_data.school_details") )
					->whereLike("doc_data.widget_data.page1.Student Details.BMI_values.month" , $date)->get ( $this->bmi_app_col );
		
		}
		else
		{
			$query = $this->mongo_db->select ( array (
					"doc_data.widget_data","doc_data.school_details") )
					->whereLike("doc_data.widget_data.page1.Student Details.BMI_values.month" , $date)->where(array("doc_data.school_details.District" => strtoupper($dt_name), "doc_data.school_details.School Name" => $school_name))->get ( $this->bmi_app_col );
		
		}
		
		/* foreach($query as $doc_data)
		{
			$bmi_values = $doc_data['doc_data']['widget_data']['page1']['Student Details']['BMI_values'];
		$count_bmi = count($bmi_values);
		log_message("debug","count_bmiiiiii".print_r($count_bmi,true));
		//$i = 0;
		$month[] = $date;
		for($i = 0; $i <= $count_bmi;$i++)
		{
			if(in_array('doc_data.widget_data.page1.Student Details.BMI_values.month',$month))
			{
				log_message("debug","naresh=============15403===".print_r($naresh,true));
			}
			
		}
		}
		exit() */;
		//$test = ['doc_data']['widget_data']['']
			/* $month = array ('doc_data.widget_data.page1.Student Details.BMI_values.month == ' => array (
						'$eq' => $date 
				) );
			
			
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => $month
								
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->bmi_app_col,
						'pipeline' => $pipeline 
				) );
				log_message("debug","query_nareshhhhhhhhhhhhhhhhhhhhhhhhhhhh".print_r($response,true));
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query; */
		/* $school_name = array();
		foreach($query as $unique)
		{
			//$query_naresh = array();
			$query_naresh_push = array();
			$stu_unique = $unique['doc_data']['widget_data']['page1']['Student Details']['Hospital Unique ID'];
			
			$after_explode = explode("_",$stu_unique);
			$school_code = $after_explode[1];
			$school_code = intval($school_code);
			
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$school_details = $this->mongo_db->select ( array('school_name') )->where ( 'school_code', $school_code )->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			$school_name = $school_details[0]['school_name'];
			
			//$query_naresh = $school_name;
			array_push($query_naresh_push,$school_name);
			log_message("debug","queryyyyyyyyyyyyyyyyyyyyyyyy".print_r($query_naresh_push,true));
		}
		
		  array_merge_recursive($query,$query_naresh_push);
		log_message("debug","query_nareshhhhhhhhhhhhhhhhhhhhhhhhhhhh".print_r($query,true));
		
		exit(); */
		//echo print_r($query,true);
		//exit();
				
		return $query;
	}


	public function get_students_uid_for_print($uid) {

		$final_output = array();
		$doc = array();
		$doc_old = array();
		$screeningInfo = $this->mongo_db->where ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get ( $this->screening_app_col );
	
					foreach ( $screeningInfo as $screening )
					{

						$unique_id = $screening ['doc_data'] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'];

						$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Info.Unique ID', $unique_id )->get ( $this->request_app_col_static_html);
						if(empty($doc))
						{
							$doc_old = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Info.Unique ID', $unique_id )->get ( $this->request_app_col);
						}

							$info ['student_info'] = $screening;
							$info ['request_info'] = array_merge($doc, $doc_old);
							
						array_push ( $final_output, $info );
					}
		return $final_output;
	}
	
	
	public function get_health_supervisors_school_id($id) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->where ( 'school_code', $id )->select ( array (
				'hs_name',
				'hs_mob' 
		) )->get ( $this->collections ['ttwreis_health_supervisors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		if ($query) {
			return $query [0];
		} else {
			return false;
		}
	}
	public function get_absent_school_details($school) {
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( "doc_data.widget_data.page1.Attendence Details.Select School", $school )->get ( $this->absent_app_col );
		if ($query) {
			return $query [0];
		} else {
			return false;
		}
	}
	public function get_student_count_school_name($school) {
		$count = $this->mongo_db->where ( 'doc_data.widget_data.page2.Personal Information.School Name', $school )->count ( $this->screening_app_col );
		return $count;
	}
	public function get_request_by_school_name($school_name, $date) {
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'history.0.time', $date )->get ( $this->request_app_col );
		
		$request = array ();
		foreach ( $query as $identifiers ) {
			$unique_id = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$doc_school = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
				if (strtolower ( $doc_school ) == strtolower ( $school_name )) {
					$req ['request'] = $identifiers;
					$req ['stud_details'] ['name'] = $doc [0] ['doc_data'] ['widget_data'] ['page1'] ['Personal Information'] ['Name'];
					$req ['stud_details'] ['class'] = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['Class'];
					$req ['stud_details'] ['section'] = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['Section'];
					array_push ( $request, $req );
				}
			}
		}
		return $request;
	}
	public function get_reports_by_dist_name($dist_name) {
		$query = $this->mongo_db->select ( array (
				'school_name',
				'school_code',
				'school_mob',
				'contact_person_name' 
		) )->orderBy ( array (
				'school_name' => 1 
		) )->where ( 'dt_name', $dist_id )->get ( $this->request_app_col );
		return $query;
	}
	public function get_school_data_school_name($school_name) {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->select ( array (
				'school_name',
				'school_code',
				'school_mob',
				'contact_person_name' 
		) )->orderBy ( array (
				'school_name' => 1 
		) )->where ( 'school_name', $school_name )->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function get_screening_pie_stage5($dates) {
		ini_set ( 'memory_limit', '10G' );
		$pie_stage5 = $this->mongo_db->select ( array (
				'pie_data.stage5_pie_vales' 
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get("healthcare201671115519757_screening_final_2019");//$this->screening_app_col_screening );
		return $pie_stage5;
	}
	
	public function get_screening_pie_stage4($dates) {
		$pie_stage4 = $this->mongo_db->select ( array (
				'pie_data.stage4_pie_vales'
		) )->whereBetween ( 'pie_data.date', $dates ['end_date'], $dates ['today_date'] )->get("healthcare201671115519757_screening_final_2019");//$this->screening_app_col_screening );
		return $pie_stage4;
	}
	
	
		public function screening_pie_data_for_stage4_new($requests) {
		$school_list = $this->get_all_schools ();
		$school_in_dist = [ ];
		
		foreach ( $school_list as $school ) {
			$school_in_dist [base64_encode(strtolower ( $school ['school_name'] ))] = strtolower ( $school ['dt_name'] );
		}
		$request_stage4 = [ ];
		//log_message("debug","in 3333333333333333333333333333333333333333333333333=======".print_r($school_in_dist,true));
		foreach ( $requests as $screening_index => $screening_array ) {
			$request_stage4 [$screening_index] = [ ];
			//log_message("debug","in 11111111111111111111111111111111111111111111111111111111=======".print_r($request_stage4,true));
			foreach ( $screening_array as $school_name => $inner_data ) {
				//log_message("debug","in 222222222222222222222222222222222222222222222222222222=======".print_r($request_stage4,true));
				if (! isset ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]] )) {
					$request_stage4 [$screening_index] [$school_in_dist [$school_name]] = null;
				}
				
				$school_data = [ ];
				if (count ( $inner_data ) > 0) {
					if (! isset ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]] )) {
						$request_stage4 [$screening_index] [$school_in_dist [$school_name]] = [ ];
					}
					$school_data ['label'] = strtoupper ( base64_decode($school_name) );
					$school_data ['value'] = count ( $inner_data );
					array_push ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]], $school_data );
					// log_message("debug","in ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc=======".print_r($request_stage4,true));
				}
			}
		}
		return $request_stage4;
	}
	public function screening_pie_data_for_stage3_new($requests) {
		$request_stage3 = [ ];
		foreach ( $requests as $request => $request_data ) {
			$request_stage3 [$request] = [ ];
			foreach ( $request_data as $dist_name => $dist_array ) {
				$dist_data ['label'] = strtoupper ( $dist_name );
				if (is_array ( $dist_array )) {
					$value_count = 0;
					foreach ( $dist_array as $school_array ) {
						$value_count = $value_count + $school_array ['value'];
					}
					$dist_data ['value'] = $value_count;
				} else {
					$dist_data ['value'] = count ( $dist_array );
				}
				
				array_push ( $request_stage3 [$request], $dist_data );
			}
		}
		return $request_stage3;
	}
	public function screening_pie_data_for_stage2_new($requests) {
		$request_stage2 = [ ];
		
		$stage_array = [ ];
		$stage_array ["Physical Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Over Weight"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Physical Abnormalities"] ["label"] = "Over Weight";
		$stage_array ["Physical Abnormalities"] ['value'] = $total_count;
		
		array_push ( $request_stage2, $stage_array );
		
		// =====
		$stage_array = [ ];
		$stage_array ["Physical Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Under Weight"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Physical Abnormalities"] ["label"] = "Under Weight";
		$stage_array ["Physical Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		$request = [ ];
		foreach ( $requests ["Obese"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Physical Abnormalities"] ["label"] = "Obese";
		$stage_array ["Physical Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["General"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "General";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Skin"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Skin";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// ===
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Others(Description/Advice)"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Others(Description/Advice)";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// =====
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Ortho"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Ortho";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Postural"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Postural";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Defects at Birth"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Defects at Birth";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		// $stage_array = [ ];
		// $stage_array ["General Abnormalities"] = [ ];
		
		// $request = [ ];
		// foreach ( $requests ["Deficencies"] as $doc ) {
			// if (isset ( $request [$doc ['label']] )) {
				// $request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			// } else {
				// $request [$doc ['label']] = $doc ['value'];
			// }
		// }
		// $total_count = 0;
		// foreach ( $request as $dist => $count ) {
			// $total_count = $total_count + $count;
		// }
		// $stage_array ["General Abnormalities"] ["label"] = "Deficencies";
		// $stage_array ["General Abnormalities"] ['value'] = $total_count;
		// array_push ( $request_stage2, $stage_array );
		
		//===
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Anaemia"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Anaemia";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Vitamin Deficiency - Bcomplex"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Vitamin Deficiency - Bcomplex";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Vitamin A Deficiency"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Vitamin A Deficiency";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Vitamin D Deficiency"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Vitamin D Deficiency";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["SAM/stunting"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "SAM/stunting";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Goiter"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Goiter";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Childhood Diseases"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Childhood Diseases";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Without Glasses"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Without Glasses";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["With Glasses"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "With Glasses";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Colour Blindness"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Colour Blindness";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Eye Lids"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Eye Lids";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Conjunctiva"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Conjunctiva";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Cornea"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Cornea";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Pupil"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Pupil";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Wearing Spectacles"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Wearing Spectacles";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Subjective Refraction"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Subjective Refraction";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Right Ear"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Right Ear";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Left Ear"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Left Ear";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$stage2_data = [ ];
		$stage2_data ["label"] = "Speech Screening";
		
		$request = [ ];
		foreach ( $requests ["Speech Screening"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Speech Screening";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Oral Hygiene - Fair"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Oral Hygiene - Fair";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Oral Hygiene - Poor"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Oral Hygiene - Poor";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Carious Teeth"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Carious Teeth";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$stage2_data = [ ];
		$stage2_data ["label"] = "Flourosis";
		
		$request = [ ];
		foreach ( $requests ["Flourosis"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Flourosis";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Orthodontic Treatment"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Orthodontic Treatment";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Indication for extraction"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Indication for extraction";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Root Canal Treatment"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Root Canal Treatment";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["CROWNS"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "CROWNS";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Fixed Partial Denture"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Fixed Partial Denture";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Curettage"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Curettage";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		
		return $request_stage2;
	}
	public function screening_pie_data_for_stage1_new($requests) {
		$request_stage1 = [ ];
		
		$stage_data = [ ];
		$stage_data ['label'] = "Physical Abnormalities";
		$stage_data ['value'] = $requests [0] ["Physical Abnormalities"] ['value'] + $requests [1] ["Physical Abnormalities"] ['value'] + $requests [2] ["Physical Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "General Abnormalities";
		$stage_data ['value'] = $requests [3] ["General Abnormalities"] ['value'] + $requests [4] ["General Abnormalities"] ['value'] + $requests [5] ["General Abnormalities"] ['value'] + $requests [6] ["General Abnormalities"] ['value'] + $requests [7] ["General Abnormalities"] ['value'] + $requests [8] ["General Abnormalities"] ['value'] + $requests [9] ["General Abnormalities"] ['value'] + $requests [10] ["General Abnormalities"] ['value'] + $requests [11] ["General Abnormalities"] ['value'] + $requests [12] ["General Abnormalities"] ['value'] + $requests [13] ["General Abnormalities"] ['value'] + $requests [14] ["General Abnormalities"] ['value'] + $requests [15] ["General Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['value'] = $requests [16] ["Eye Abnormalities"] ['value'] + $requests [17] ["Eye Abnormalities"] ['value'] + $requests [18] ["Eye Abnormalities"] ['value'] + $requests [19] ["Eye Abnormalities"] ['value'] + $requests [20] ["Eye Abnormalities"] ['value'] + $requests [21] ["Eye Abnormalities"] ['value'] + $requests [22] ["Eye Abnormalities"] ['value'] + $requests [23] ["Eye Abnormalities"] ['value'] + $requests [24] ["Eye Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "Auditory Abnormalities";
		$stage_data ['value'] = $requests [25] ["Auditory Abnormalities"] ['value'] + $requests [26] ["Auditory Abnormalities"] ['value'] + $requests [27] ["Auditory Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "Dental Abnormalities";
		$stage_data ['value'] = $requests [28] ["Dental Abnormalities"] ['value'] + $requests [29] ["Dental Abnormalities"] ['value'] + $requests [30] ["Dental Abnormalities"] ['value'] + $requests [31] ["Dental Abnormalities"] ['value'] + $requests [32] ["Dental Abnormalities"] ['value'] + $requests [33] ["Dental Abnormalities"] ['value'] + $requests [34] ["Dental Abnormalities"] ['value'] + $requests [35] ["Dental Abnormalities"] ['value'] + $requests [36] ["Dental Abnormalities"] ['value'] + $requests [37] ["Dental Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		return $request_stage1;
	}
	
	public function screening_pie_data_for_stage4_new_tt($requests) {
		$school_list = $this->get_all_schools ();
		$school_in_dist = [ ];
		
		foreach ( $school_list as $school ) {
			$school_in_dist [strtolower ( $school ['school_name'] )] = strtolower ( $school ['dt_name'] );
		}
		$request_stage4 = [ ];
		
		foreach ( $requests as $screening_index => $screening_array ) {
			$request_stage4 [$screening_index] = [ ];
			// log_message("debug","in 11111111111111111111111111111111111111111111111111111111=======".print_r($request_stage4,true));
			foreach ( $screening_array as $school_name => $inner_data ) {
				// log_message("debug","in 222222222222222222222222222222222222222222222222222222=======".print_r($request_stage4,true));
				if (! isset ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]] )) {
					$request_stage4 [$screening_index] [$school_in_dist [$school_name]] = null;
				}
				
				$school_data = [ ];
				if (count ( $inner_data ) > 0) {
					if (! isset ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]] )) {
						$request_stage4 [$screening_index] [$school_in_dist [$school_name]] = [ ];
					}
					$school_data ['label'] = strtoupper ( $school_name );
					$school_data ['value'] = count ( $inner_data );
					array_push ( $request_stage4 [$screening_index] [$school_in_dist [$school_name]], $school_data );
					// log_message("debug","in ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc=======".print_r($request_stage4,true));
				}
			}
		}
		return $request_stage4;
	}
	public function screening_pie_data_for_stage3_new_tt($requests) {
		$request_stage3 = [ ];
		foreach ( $requests as $request => $request_data ) {
			$request_stage3 [$request] = [ ];
			foreach ( $request_data as $dist_name => $dist_array ) {
				$dist_data ['label'] = strtoupper ( $dist_name );
				if (is_array ( $dist_array )) {
					$value_count = 0;
					foreach ( $dist_array as $school_array ) {
						$value_count = $value_count + $school_array ['value'];
					}
					$dist_data ['value'] = $value_count;
				} else {
					$dist_data ['value'] = count ( $dist_array );
				}
				
				array_push ( $request_stage3 [$request], $dist_data );
			}
		}
		
		return $request_stage3;
	}
	public function screening_pie_data_for_stage2_new_tt($requests) {
		$request_stage2 = [ ];
		
		$stage_array = [ ];
		$stage_array ["Physical Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Over Weight"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Physical Abnormalities"] ["label"] = "Over Weight";
		$stage_array ["Physical Abnormalities"] ['value'] = $total_count;
		
		array_push ( $request_stage2, $stage_array );
		
		// =====
		$stage_array = [ ];
		$stage_array ["Physical Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Under Weight"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Physical Abnormalities"] ["label"] = "Under Weight";
		$stage_array ["Physical Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["General"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "General";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Skin"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Skin";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// ===
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Others(Description/Advice)"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Others(Description/Advice)";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// =====
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Ortho"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Ortho";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Postural"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Postural";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Defects at Birth"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Defects at Birth";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Deficencies"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Deficencies";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["General Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Childhood Diseases"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["General Abnormalities"] ["label"] = "Childhood Diseases";
		$stage_array ["General Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Without Glasses"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Without Glasses";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["With Glasses"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "With Glasses";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Eye Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Colour Blindness"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Eye Abnormalities"] ["label"] = "Colour Blindness";
		$stage_array ["Eye Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Right Ear"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Right Ear";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Left Ear"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Left Ear";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Auditory Abnormalities"] = [ ];
		
		$stage2_data = [ ];
		$stage2_data ["label"] = "Speech Screening";
		
		$request = [ ];
		foreach ( $requests ["Speech Screening"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Auditory Abnormalities"] ["label"] = "Speech Screening";
		$stage_array ["Auditory Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Oral Hygiene - Fair"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Oral Hygiene - Fair";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Oral Hygiene - Poor"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Oral Hygiene - Poor";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Carious Teeth"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Carious Teeth";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$stage2_data = [ ];
		$stage2_data ["label"] = "Flourosis";
		
		$request = [ ];
		foreach ( $requests ["Flourosis"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Flourosis";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Orthodontic Treatment"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Orthodontic Treatment";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		// =====
		$stage_array = [ ];
		$stage_array ["Dental Abnormalities"] = [ ];
		
		$request = [ ];
		foreach ( $requests ["Indication for extraction"] as $doc ) {
			if (isset ( $request [$doc ['label']] )) {
				$request [$doc ['label']] = $request [$doc ['label']] + $doc ['value'];
			} else {
				$request [$doc ['label']] = $doc ['value'];
			}
		}
		$total_count = 0;
		foreach ( $request as $dist => $count ) {
			$total_count = $total_count + $count;
		}
		$stage_array ["Dental Abnormalities"] ["label"] = "Indication for extraction";
		$stage_array ["Dental Abnormalities"] ['value'] = $total_count;
		array_push ( $request_stage2, $stage_array );
		// ===
		
		return $request_stage2;
	}
	public function screening_pie_data_for_stage1_new_tt($requests) {
		$request_stage1 = [ ];
		
		$stage_data = [ ];
		$stage_data ['label'] = "Physical Abnormalities";
		$stage_data ['value'] = $requests [0] ["Physical Abnormalities"] ['value'] + $requests [1] ["Physical Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "General Abnormalities";
		$stage_data ['value'] = $requests [2] ["General Abnormalities"] ['value'] + $requests [3] ["General Abnormalities"] ['value'] + $requests [4] ["General Abnormalities"] ['value'] + $requests [5] ["General Abnormalities"] ['value'] + $requests [6] ["General Abnormalities"] ['value'] + $requests [7] ["General Abnormalities"] ['value'] + $requests [8] ["General Abnormalities"] ['value'] + $requests [9] ["General Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "Eye Abnormalities";
		$stage_data ['value'] = $requests [10] ["Eye Abnormalities"] ['value'] + $requests [11] ["Eye Abnormalities"] ['value'] + $requests [12] ["Eye Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "Auditory Abnormalities";
		$stage_data ['value'] = $requests [13] ["Auditory Abnormalities"] ['value'] + $requests [14] ["Auditory Abnormalities"] ['value'] + $requests [15] ["Auditory Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		$stage_data = [ ];
		$stage_data ['label'] = "Dental Abnormalities";
		$stage_data ['value'] = $requests [16] ["Dental Abnormalities"] ['value'] + $requests [17] ["Dental Abnormalities"] ['value'] + $requests [18] ["Dental Abnormalities"] ['value'] + $requests [19] ["Dental Abnormalities"] ['value'] + $requests [20] ["Dental Abnormalities"] ['value'] + $requests [21] ["Dental Abnormalities"] ['value'];
		array_push ( $request_stage1, $stage_data );
		
		return $request_stage1;
	}
	
	public function initiate_request($doc_id, $user_coll_data, $app_coll_data) {
		$user_collection = $doc_id . "_docs";
		$this->mongo_db->insert ( $user_collection, $user_coll_data );
		$this->mongo_db->insert ( $this->request_app_col, $app_coll_data );
		$this->mongo_db->insert ( $this->request_app_col . "_shadow", $app_coll_data );
		$this->mongo_db->insertStut ( 'status', $this->request_app_col, $app_coll_data ["doc_properties"] ['doc_id'], $app_coll_data ["app_properties"] ['app_name'] );
	}
	
	public function messaging($message)
	{
		$data = $this->session->userdata("customer");
		
		$data = array(
			"message" => $message,
			"unique_id" => $uid,
		);
	
		$response = $this->data = $this->ttwreis_common_model->messaging($message);
		//$this->data = "";
	
		$this->output->set_output($response);
	}
	public function groupscount() {
		$count = $this->mongo_db->count ( 'ttwreis_chat_groups' );
		return $count;
	}
	public function get_groups($per_page, $page) {
		$offset = $per_page * ($page - 1);
		$query = $this->mongo_db->limit ( $per_page )->offset ( $offset )->get ( 'ttwreis_chat_groups' );
		return $query;
	}
	
	public function get_all_groups() {
		$query = $this->mongo_db->get ( 'ttwreis_chat_groups' );
		return $query;
	}
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: Get accessible chat rooms ( for the loggedin user )
	 * 
	 * @param  array  $user_email  Loggedin user email
	 *
	 * @return array
	 * 
	 * @author Selva 
	 */
	 
	public function get_accessible_groups($user_email) {
		$accessible_chat_rooms = array();
		$query = $this->mongo_db->get ( 'ttwreis_chat_groups' );
		log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13631====='.print_r($query,true));
		foreach($query as $data)
		{
			$group_name = $data['group_name'];
			log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13635====='.print_r($group_name,true));
			$where_array = array('group_name'=>$group_name,'list_of_users'=>array('$in'=>array($user_email)));
			log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13637====='.print_r($where_array,true));
			$grps = $this->mongo_db->where($where_array)->get ( 'ttwreis_chat_groups_users' );
			log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13639====='.print_r($grps,true));
			log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13640====='.print_r(count($grps),true));
			if(isset($grps) && !empty($grps))
			{
				array_push($accessible_chat_rooms,$query);
			}
			
		}
		log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$chat_rooms_result==13644====='.print_r($accessible_chat_rooms,true));
		return $accessible_chat_rooms;
	}
	
	public function get_all_admin_users() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_admins'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function get_all_health_supervisors() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_health_supervisors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function get_all_cc_users() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_cc'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}
	public function get_all_superiors() {
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->get ( $this->collections ['superiors'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		return $query;
	}

    // ------------------------------------------------------------------------

	/**
	 * Helper: Add message
	 * 
	 * @param  array  $post          $_POST data
	 * @param  array  $chat_room_id  chat Room ID
	 *
	 * @return array
	 * 
	 * @author Selva 
	 */
	 
	public function add_message($post,$chat_room_id)
	{
		$data = array(
				"message_id"   => get_unique_id(),
				"user_id"      => $post['user_id'],
				"user_name"    => $post['username'],
				"chat_room_id" => $chat_room_id,
				"message" 	   => $post['message'],
				"created_at"   => date("Y-m-d H:i:s")
		);
		$query = $this->mongo_db->insert($this->collections['ttwreis_messages'],$data);
		
		if($query){
			$response['error'] = false;			
			$response['message'] = $data;
		}else{
			$response['error'] = true;
			$response['message'] = 'Failed send message ' . $stmt->error;
		}
		
		log_message('debug','HEALTHCARE_APP=====CHAT_ROOMS=====$user_id==13660====='.print_r($response,true));
		return $response;
	}
	public function get_messages($msg_id)
	{
		$query = $this->mongo_db->where("chat_room_id",$msg_id)->get($this->collections['ttwreis_messages']);
		return $query;
	}
	
	public function get_user_by_email($name, $email){
				
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		log_message('debug','eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee=========.'.print_r($email,true));
		$user = $this->mongo_db->where("email",$email)->get($this->collections['ttwreis_admins']);
		log_message('debug','uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu=========.'.print_r($user,true));
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		if($user){
			$temp["user_id"] = $user[0]['email'];
			$temp["name"] = $user[0]['username'];
			$temp["email"] = $user[0]['email'];
			$temp["created_at"] = $user[0]['registered_on'];
			
			// User with same email already existed in the db
			$response["error"] = false;
			$response["user"] = $temp;			
		}else{
			// Failed to create user
			$response["error"] = true;
			$response["message"] = "User not found.";
		}
		return $response;		
	}
	
	public function updateGcmID($login, $gcm_registration_id){
		$id_exists = $this->mongo_db->where("user_id",$login)->get($this->collections['ttwreis_users_gcm']);
		$data = array(
			"user_id" => $login,
			"gcm_registration_id" => $gcm_registration_id
		);
		if($id_exists){
			$query = $this->mongo_db->where("user_id",$login)->set($data)->get($this->collections['ttwreis_users_gcm']);
		}else{
			$query = $this->mongo_db->insert($this->collections['ttwreis_users_gcm'],$data);
		}
		return $query;
	}
	
	public function get_sanitation_report_app()
	{
	  $query = $this->mongo_db->select(array('app_template'))->where('_id',$this->sanitation_app_col)->get($this->collections['records']);
	  return $query[0]['app_template'];
	
	}
	
	// ------------------------------------------------------------------------------------------------------------

	/**
	 * Helper: Get data to draw sanitation report pie based on the selected criteria ( Model )
	 *
	 * @param  string  $date              Selected date 
	 * @param  string  $search_criteria   Criteria question for sanitation report
	 * @param  string  $opt   			  Criteria option for sanitation report
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	public function get_sanitation_report_pie_data($date, $search_criteria, $opt) {
	
	 $output 			     = array();
	 $sanitation_report      = array();
	 $sanitation_report['district_list']   = array();
	 $sanitation_report['schools_list']    = array();
	 $sanitation_report['attachment_list'] = array();
	 
	 $query = $this->mongo_db->select(array('doc_data.widget_data','doc_data.external_attachments'),array())->where(array('doc_data.widget_data.page4.Declaration Information.Date:'=>$date,$search_criteria=>$opt))->get($this->sanitation_app_col);
	 
	 $dist_list = $this->get_all_district ();
		
	 $dist_arr = [ ];
	 foreach ( $dist_list as $dist ) {
		array_push ( $dist_arr, $dist ['dt_name'] );
	 }
	
	foreach ( $dist_arr as $district_name ) {
	    $schools = array();
		$sanitation_attachments = array();
	    $sanitation_report['schools_list'][$district_name]  = array();
		$sanitation_report['attachment_list'][$district_name]  = array();
		$request ['label'] = $district_name;
		$count = 0;
		if ($query) {
			foreach ( $query as $dist ) {
				if (isset ( $dist ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] )) {
					if (strtolower ( $dist ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] ) == strtolower ( $district_name )) {
					    if(!in_array($dist ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'],$schools))
						{
							$count ++;
							array_push($schools,$dist ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']);
							if(isset($dist ['doc_data']['external_attachments']) && !empty($dist ['doc_data']['external_attachments']))
							{
						       $path = array();
							   
						       foreach($dist ['doc_data']['external_attachments'] as $key=>$attachments)
							   {
							     array_push($path,$attachments['file_path']);
							   }
							   
							   $sanitation_attachments[$dist ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']] = $path;
							}
						}
					}
				}
			}
		}
		$request ['value'] = $count;
		array_push ( $output, $request );
		$sanitation_report['schools_list'][$district_name]    = $schools;
		$sanitation_report['attachment_list'][$district_name] = $sanitation_attachments;
	}
	
	$sanitation_report['district_list'] = $output;
		
	 if($sanitation_report)
	     return $sanitation_report;
	 else
		 return false;
		
	}
	
	/*public function get_sanitation_report_pie_schools_data($date = FALSE)
	{
		Variables
		$all_schools               = array();
		$all_schools_district      = array();
		$all_schools_name      	   = array();
		$submitted_schools 	       = array();
		$submitted_school_district = array();
		$submitted_school_name     = array();
		$not_submitted_schools	   = array();
		$schools_data              = array();
		$not_submitted_dist        = array();
		
		$schools_list = $this->get_all_schools();
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'doc_data.widget_data.page4.Declaration Information.Date:',$today_date )->get ( $this->sanitation_app_col );
		
		foreach ( $query as $doc ) {
			    if(!in_array($doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'],$submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] );
					array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'] );
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		   $dist_array    = explode(",",$school_name);
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		return $schools_data;

		$not_submitted_dist        = array();
		
		$all_schools_mobile        = array();
		$all_schools_cpn      	   = array();
		$submitted_school_mob 	   = array();
		$submitted_school_person   = array();
		$not_submitted_school_mob 	   = array();
		$not_submitted_school_person   = array();
		
		$schools_list = $this->get_all_schools();
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
			$all_schools_mobile[$school_data['school_name']] = $school_data['school_mob'];
			$all_schools_cpn[$school_data['school_name']] = $school_data['contact_person_name'];
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'doc_data.widget_data.page4.Declaration Information.Date:',$today_date )->get ( $this->sanitation_app_col_v2 );
		
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====716=='.print_r($query,true));
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====717=='.print_r($today_date,true));
		
		foreach ( $query as $doc ) {
			    if(!in_array($doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'],$submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] );
					array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'] );
					
					if(isset($all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']])){
						array_push ( $submitted_school_mob,$all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']] );
						array_push ( $submitted_school_person,$all_schools_cpn[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']] );
					}else{
						array_push ( $submitted_school_mob,"" );
						array_push ( $submitted_school_person,"" );
					}
					
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		$submitted_schools['mobile']       = $submitted_school_mob;
		$submitted_schools['person_name']  = $submitted_school_person;
		
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		   $dist_array    = explode(",",$school_name);
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		   
			if(isset($all_schools_mobile[$school_name])){
				array_push ( $not_submitted_school_mob,$all_schools_mobile[$school_name] );
				array_push ( $not_submitted_school_person,$all_schools_cpn[$school_name] );
			}else{
				array_push ( $not_submitted_school_mob,"" );
				array_push ( $not_submitted_school_person,"" );
			}
		   
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		$not_submitted_schools['mobile']       = $not_submitted_school_mob;
		$not_submitted_schools['person_name']  = $not_submitted_school_person;
		
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		//
		
		return $schools_data;
	}*/
	
	public function insert_ehr_note($post)
	{
		$token = $query = $this->mongo_db->insert($this->notes_col,$post);
	
		return $token;
	}
	
	public function delete_ehr_note($doc_id)
	{
		$query = $this->mongo_db->where ( array (
				"_id" => new MongoId ( $doc_id ) 
		) )->delete ( $this->notes_col );
	
		return $query;
	}
	
	public function ttwreis_chronic_cases_count()
    {
     $query = $this->mongo_db->get($this->collections['ttwreis_chronic_cases']);
	 return count($query);
    }
	
	function get_chronic_cases_model($limit, $page)
	{
	    $offset = $limit * ( $page - 1) ;
		
		$this->mongo_db->orderBy(array('_id' => 1));
		$this->mongo_db->limit($limit);
		$this->mongo_db->offset($offset);
		$query = $this->mongo_db->get($this->collections['ttwreis_chronic_cases']);
		if ($query)
		{
			return $query;
		}
		else
		{
			return FALSE;
		}
	}
	
	public function get_chronic_cases_model_for_data_table()
	{
	    $this->mongo_db->orderBy(array('created_time' => -1));
		$query = $this->mongo_db->get($this->collections['ttwreis_chronic_cases']);
		if ($query)
		{
			return $query;
		}
		else
		{
			return FALSE;
		}
	}
	
	function get_all_chronic_unique_ids_model()
	{
	    $this->mongo_db->orderBy(array('_id' => 1));
		$query = $this->mongo_db->select(array('student_unique_id','case_id','scheduled_months','school_name'),array())->getWhere($this->collections['ttwreis_chronic_cases'],array('followup_scheduled'=>'true'));
		if ($query)
		{
			return $query;
		}
		else
		{
			return FALSE;
		}
	}
	
	function create_schedule_followup_model($unique_id,$medication_schedule,$treatment_period,$start_date,$month_names,$case_id)
	{
	   $update_array = array(
	   'start_date'         => $start_date,
	   'medication_schedule'=> $medication_schedule,
	   'treatment_period'   => $treatment_period,
	   'scheduled_months'   => $month_names,
	   'followup_scheduled' => "true");
	   
	   $updated = $this->mongo_db->where(array('student_unique_id'=>$unique_id,'case_id'=>$case_id))->set($update_array)->update($this->collections['ttwreis_chronic_cases']);
	   
	   if($updated)
		   return TRUE;
	   else
		   return FALSE;
	}
	
	function calculate_chronic_graph_compliance_percentage($case_id,$unique_id,$medication_taken)
	{
	   $medication_schedule = array();
	   $query = $this->mongo_db->select(array(),array())->getWhere($this->collections['ttwreis_chronic_cases'],array('student_unique_id'=>$unique_id,'case_id'=>$case_id));  
	   
	   foreach($query as $value)
	   {
	     $medication_schedule = $value['medication_schedule'];
	   }
	   
	   $schedule_count = count($medication_schedule);
	   
	   if(isset($medication_taken) && !empty($medication_taken))
	   {
	     $taken_count = count($medication_taken);
	   }
	   else
	   {
         $taken_count = 0;
	   }
	   $compliance_percentage = ($taken_count/$schedule_count)*100;
	   return $compliance_percentage;
	}
	
	function update_schedule_followup_model($unique_id,$case_id,$compliance,$selected_date)
	{
		$check_query = array("student_unique_id"=>$unique_id,"case_id"=>$case_id,"medication_taken"=>array('$elemMatch'=>array("date"=>$selected_date)));
		 
		$is_already_updated = $this->mongo_db->where($check_query)->get($this->collections['ttwreis_chronic_cases']);
		
		if($is_already_updated)
		{
	       return "ALREADY_UPDATED";
		}
		else
		{
	       $datewise_update = array("date"=>$selected_date,"compliance"=>$compliance);
	  
		   $query = array("student_unique_id"=>$unique_id,"case_id"=>$case_id);
		
		   $update = array('$push'=>array("medication_taken"=>$datewise_update));
			 
		   $response = $this->mongo_db->command(array( 
			'findAndModify' => $this->collections['ttwreis_chronic_cases'],
			'query'         => $query,
			'update'        => $update,
			'upsert'        => true
			));
		
			if($response['ok'])
			{
			   return "UPDATE_SUCCESS";
			}
			else
			{
		       return "UPDATE_FAIL";
			}
		}
	}
	
	// ---------------------------------------------------------------------------------------
	
	/**
	 * Helper: Fetch Student's pill compliance data
	 *
	 * @param string $case_id 			 Case ID
	 * @param string $student_unique_id  Hospital Unique ID
	 *
	 * @return array
	 *
	 * @author Selva
	 */
	 
	public function fetch_student_pill_compliance_data($case_id,$student_unique_id)
	{
	    $where_clause = array(
		'case_id' => $case_id,
		'student_unique_id'=> $student_unique_id
		);
		
		$query = $this->mongo_db->where($where_clause)->get($this->collections['ttwreis_chronic_cases']);
        return $query;
	}
	
	function get_dup_docs($docs_arr){
		$doc_matchs = [];
		$matched_doc_ids = [];
		foreach($docs_arr as $id){
			$doc_sech = $this->mongo_db->select(array("_id",'doc_data'))->where("doc_data.widget_data.page1.Personal Information.Hospital Unique ID" , $id)->get($this->screening_app_col);
			$inner_doc_count = count($doc_sech);
			log_message('debug','111111111111111111111111111111111111'.print_r($inner_doc_count,true));
			if($inner_doc_count >1){
				log_message('debug','2222222222222222222222222222222222'.print_r($id,true));
				if (!in_array($id, $matched_doc_ids)) {
					log_message('debug','33333333333333333333333333333333333333333'.print_r($doc_matchs,true));
					for ($doc_pointer = 0 ; $doc_pointer < $inner_doc_count ; $doc_pointer++){
						$doc_pointer_id = (string)$doc_sech[$doc_pointer]['_id'];
						array_push($matched_doc_ids, $doc_pointer_id);
						//log_message('debug','44444444444444444444444444444444444444444444444'.print_r($matched_doc_ids,true));
					}
					
					$doc_record['doc_id'] = $doc_sech[0]['doc_data']['widget_data']['page1']['Personal Information']['Name'];
					$doc_record['matched_count'] = $inner_doc_count;
					$doc_record['document1'] = (string)$doc_sech[0]['_id'];
					$doc_record['document2'] = (string)$doc_sech[1]['_id'];
					$doc_record['uid'] = $id;
					array_push($doc_matchs, $doc_record);
					
				}
				
			}
		}
		return $doc_matchs;
		
	}
	
	function get_document($doc_id){
		$query = $this->mongo_db->where("_id", new MongoId($doc_id))->get($this->screening_app_col);
		
	
		if (isset($query[0])) {
			log_message('debug','fffffffffffffffffffffffffffffffffffffffffff');
			return json_decode(json_encode($query[0]),true);
		}else{
			return false;
		}
	
	}
	
	function get_all_docs_in_uid_no($uid_no){
		
		$query = $this->mongo_db->select(array("doc_data.widget_data"))->where("doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid_no)->get($this->screening_app_col);
	
		if (isset($query)) {
			log_message('debug','fffffffffffffffffffffffffffffffffffffffffff');
			return json_decode(json_encode($query),true);
		}else{
			return false;
		}
	
	}

	public function get_sanitation_report_data_with_date($date,$school_name)
	{
	    if ($date) {
			$selected_date = $date;
		} else {
			$selected_date = $this->today_date;
		}
		
		$this->mongo_db->limit(1)->where(array('doc_data.widget_data.page4.Declaration Information.Date:'=>$selected_date,'doc_data.widget_data.page4.School Information.School Name'=>$school_name));
		$query = $this->mongo_db->get($this->sanitation_app_col_v2);
		if($query)
			return $query;
		else
			return FALSE;
	}

	public function insert_request_note($post)
	{
		$query_request = $this->mongo_db->where ( "req_doc_id", $post ['doc_id'] )->get ( $this->collections['ttwreis_req_notes'] );
		
		//log_message('debug','notessssssssssssssssspost===query_request==========================='.print_r($query_request,true));
		
		$notes = array(
			'note_id' => get_unique_id(),
			'note'	  => $post['note'],
			'username'=> $post['username'],
			'datetime'=> $post['datetime']
		);
		
		if(isset($query_request[0]['notes_data'])){
			array_push($query_request[0]['notes_data'],$notes);
		}
		else{
			$query_request[0]['notes_data'] = [];
			array_push($query_request[0]['notes_data'],$notes);
			$query_request[0]["req_doc_id"] = $post ['doc_id'];
		}
		
		$is_notes = $this->mongo_db->where ( "req_doc_id", $post ['doc_id'] )->count( $this->collections ['ttwreis_req_notes'] );
		
		if($is_notes > 0){
			$token = $this->mongo_db->where ( "req_doc_id", $post ['doc_id'] )->set($query_request[0])->update( $this->collections ['ttwreis_req_notes'] );
		}else{
			$token = $this->mongo_db->insert( $this->collections ['ttwreis_req_notes'], $query_request[0]);
		}
	
	   // log_message('debug','notessssssssssssssssspost===token==========================='.print_r($token,true));

		return $token;
	}
	
		public function get_all_active_request(){
		$date = date('Y-m-d') . " 00:00:00";
		
		$dates = $this->get_start_end_date ( $date, "Daily" );
		
		
		$start_date = $dates ['today_date'];
		$end_date = $dates ['end_date'];
		
		$his_0_lte = array (
				"history.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_0_gte = array (
				"history.time" => array (
						'$gte' => $end_date 
				) 
		);
		/*$his_1_lte = array (
				"history.1.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_1_gte = array (
				"history.1.time" => array (
						'$gte' => $end_date 
				) 
		);
		$his_last_lte = array (
				"history.last_stage.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_last_gte = array (
				"history.last_stage.time" => array (
						'$gte' => $end_date 
				) 
		);*/
		
		//$and_merged_array_condition = array();
		$and_merged_array_0 = array();
		//$and_merged_array_1 = array();
		//$and_merged_array_last = array();
		
		array_push ( $and_merged_array_0, $his_0_lte );
		array_push ( $and_merged_array_0, $his_0_gte );
		
		
		//array_push ( $and_merged_array_1, $his_1_lte );
		//array_push ( $and_merged_array_1, $his_1_gte );

		//array_push ( $and_merged_array_last, $his_last_lte );
		//array_push ( $and_merged_array_last, $his_last_gte );
		
		
		// ////log_message("debug","response=====1665==".print_r($merged_array,true));
		$result = [ ];
			
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$or' => array (
										array('$and' => $and_merged_array_0)
										//array('$and' => $and_merged_array_1),
										//array('$and' => $and_merged_array_last),
								)									
							) 
					)
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline 
			) );
			
			//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn vvvvvvvvvvvvvvvvvvvvvvvvvvvv11111111111111111111111111111111111--".print_r($response,true));
			
			//=============================================vjhbdhdsuhyvsuyhvuyv
			$query = array();
			if($response['ok']){
				$query = $response["result"];
			}
			
			
		return count($query);
		
	}
	
	public function get_all_raised_request(){
		$date = date('Y-m-d') . " 00:00:00";
		$dates = $this->get_start_end_date ( $date, "Daily" );
		
		$date = date('Y-m-d') . " 00:00:00";
		
		$dates = $this->get_start_end_date ( $date, "Daily" );
		
		
		$start_date = $dates ['today_date'];
		$end_date = $dates ['end_date'];
		
		$his_0_lte = array (
				"history.0.time" => array (
						'$lte' => $start_date 
				) 
		);
		$his_0_gte = array (
				"history.0.time" => array (
						'$gte' => $end_date 
				) 
		);
		
		//$and_merged_array_condition = array();
		$and_merged_array_0 = array();
		
		array_push ( $and_merged_array_0, $his_0_lte );
		array_push ( $and_merged_array_0, $his_0_gte );
		
		
		// ////log_message("debug","response=====1665==".print_r($merged_array,true));
		$result = [ ];
			
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$or' => array (
										array('$and' => $and_merged_array_0)
								)									
							) 
					)
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline 
			) );
			
			//log_message("debug","innnnnnnnnnnnnnnnnnnnnn fn vvvvvvvvvvvvvvvvvvvvvvvvvvvv11111111111111111111111111111111111--".print_r($response,true));
			
			//=============================================vjhbdhdsuhyvsuyhvuyv
			$query = array();
			if($response['ok']){
				$query = $response["result"];
			}
			
			
		return count($query);
	}
	
	
	public function get_today_news_feeds($date){
		
		if(!$date){
			$date = date('Y-m-d');
		}
		
		$display_date = array (
				"display_date" => array (
						'$regex' => $date
				) 
		);
		$result = [ ];
			
			$pipeline = [ 
					
					array('$match' => $display_date)
					
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->collections ['ttwreis_news_feed'],
					'pipeline' => $pipeline 
			) );
			$query = array();
			if($response['ok']){
				$query = $response["result"];
			}
	
		return $query;
	
	}

	public function add_news_feed($news_data){
		
		$query = $this->mongo_db->insert ( $this->collections ['ttwreis_news_feed'], $news_data );
	
		return $query;
	
	}
	
	public function get_all_news_feeds(){
	
		$query = $this->mongo_db->get ( $this->collections ['ttwreis_news_feed'] );
	
		return $query;
	
	}
	
	public function delete_news_feed($nf_id)
	{
		$query = $this->mongo_db->where(array("_id"=>new MongoId($nf_id)))->delete($this->collections['ttwreis_news_feed']);
		return $query;
	}
	
	public function get_news_feed($nf_id)
	{
		$query = $this->mongo_db->where(array("_id"=>new MongoId($nf_id)))->get($this->collections['ttwreis_news_feed']);
		return $query[0];
	}
	
	public function update_news_feed($news_data,$news_id)
	{
		
		$query = $this->mongo_db->where(array("_id"=>new MongoId($news_id)))->set($news_data)->update($this->collections['ttwreis_news_feed']);
		return $query;
	}

	// ------------------------------------------------------------------------
	 
	/**
	* Helper : Update note content ( request notes )
	*
	* @param  string  $doc_id   Request document id
	* @param  string  $note_id  Note id
	* @param  string  $note     Note
	*
	* @return bool
	*
	* @author Selva
	*/

	public function update_request_note($doc_id,$note_id,$note)
	{
       $query = array('req_doc_id'=>$doc_id,'notes_data'=>array('$elemMatch'=>array('note_id'=>$note_id)));

       $update = array('$set'=>array('notes_data.$.note'=>$note));

       $response = $this->mongo_db->command(array( 
		'findAndModify' => 'ttwreis_req_notes',
		'query'         => $query,
		'update'        => $update
	    ));
		
		return $response['ok'];
	}
	
	public function get_all_rised_req()
	{
		$user_data = $this->session->userdata ( "customer" );
		
		$uniqueID = strtoupper(str_ireplace('.','_',substr($user_data['email'],0,strpos($user_data['email'],'@')-2)));
		
		//$query = $this->mongo_db->whereLike("doc_data.widget_data.page1.Student Info.Unique ID", $uniqueID)->select(array("doc_data.widget_data","history","doc_properties"))->get($this->request_app_col);
		
		$hs_mail = array (
				"doc_data.widget_data.page1.Student Info.Unique ID" => array (
						'$regex' => $uniqueID
				) 
		);
		$last_stage = array (
				"history.last_stage" => array (
						'$exists' => true
				) 
		);
		
		$and_merged_array = array();
		
		array_push ( $and_merged_array, $hs_mail );
		array_push ( $and_merged_array, $last_stage );
		
		$result = [ ];
			
			$pipeline = [

					array('$match' => array (
									'$and' => $and_merged_array 
							))	
			];
			
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col,
					'pipeline' => $pipeline 
			) );
			$query = array();
			if($response['ok']){
				$query = $response["result"];
			}
		
		return $query;
	}
	
	function update_doc_for_disapprove($doc){
		$query = $this->mongo_db->where('_id', new MongoId($doc['_id']))->set($doc)->update($this->request_app_col);
		unset($doc['_id']);
		$query = $this->mongo_db->insert($this->request_app_col.'_shadow',$doc);
		return $query;
	}
	
	function get_workflow_stage_details($app_id,$collection,$select){
		$query = $this->mongo_db->where('_id', $app_id)->select($select)->get($collection);
		return $query[0];
	}
	
	/*
	*Fetchinhg BMI value with Unique id
	*author Naresh
	*/ 
	
	public function get_student_bmi_values($unique_id)
	{
		$query = $this->mongo_db->select(array('doc_data.widget_data.page1.Student Details.BMI_values'))->where(array('doc_data.widget_data.page1.Student Details.Hospital Unique ID' => $unique_id))->get('healthcare2017619153715384');
		log_message("debug","query==========12576".print_r($query,true));
		
		if($query)
			return $query;
	    else
			return FALSE;
	}
	
	//update personal Information
   public function get_update_personal_ehr_uid($uid) {
		$query = $this->mongo_db->select ( array ('doc_data.widget_data','doc_data.chart_data','doc_data.external_attachments','history'))->whereLike ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get ( $this->screening_app_col_tt_2021_2022 );
		log_message("debug","update personal Info for modelllllll114816".print_r($query,true));
		 if ($query) {
			$query_request = $this->mongo_db->where ( "doc_data.widget_data.page1.Student Info.Unique ID", $uid )->get ( $this->request_app_col );
			log_message("debug"," query_request update personal Info for modelllllll114816".print_r($query_request,true));
			$result ['screening'] = $query;
			///$result ['request'] = $query_request;
			return $result;
		} else {
			$result ['screening'] = false;
			//$result ['request'] = false;
			return $result;
		} 
	}
	
	public function update_student_ehr_model($unique_id,$doc_data)
	{
	  //$doc_data = array("doc_data"=>array("widget_data"=>$doc_data),"history"=>$history);
	  $query = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$unique_id)->set($doc_data)->update($this->screening_app_col_tt_2021_2022);
	  log_message('debug',"updateeeeeeeeeeeee".print_r($query,true));
	  if($query)
		  return TRUE;
	  else
		  return FALSE;
	}
	
	function delete_doc_from_user_col($doc_id,$hs_user_col){
		$this->mongo_db->where(array('app_id' => $this->request_app_col, 'doc_id' => $doc_id))->delete($hs_user_col.'_web_docs');
		$this->mongo_db->where(array('app_id' => $this->request_app_col, 'doc_id' => $doc_id))->delete($hs_user_col.'_docs');
		$cc_users = $this->get_all_cc_users();
		foreach($cc_users as $cc_user){
			$email = str_replace("@","#",$cc_user['email']);
			$this->mongo_db->where(array('app_id' => $this->request_app_col, 'doc_id' => $doc_id))->delete($email.'_web_docs');
			$this->mongo_db->where(array('app_id' => $this->request_app_col, 'doc_id' => $doc_id))->delete($email.'_docs');
		}
	}
	
	
	function unique_id_check($unique_id_check_zipfile){
		
		$and_merged_array = array ();
		
		$unique_id = array (
				"doc_data.widget_data.page1.Personal Information.Hospital Unique ID" => $unique_id_check_zipfile
				);
				
		$page3_exists = array (
				"doc_data.widget_data.page3.Physical Exam" => array (
						'$exists' => true 
				) 
		);
		$page4_exists = array (
				"doc_data.widget_data.page4.Doctor Check Up" => array (
						'$exists' => true 
				) 
		);
		$page5_exists = array (
				"doc_data.widget_data.page5.Doctor Check Up" => array (
						'$exists' => true 
				) 
		);
		$page6_exists = array (
				"doc_data.widget_data.page6.With Glasses" => array (
						'$exists' => true 
				) 
		);
		$page7_exists = array (
				"doc_data.widget_data.page7.Colour Blindness" => array (
						'$exists' => true 
				) 
		);
		$page8_exists = array (
				"doc_data.widget_data.page8. Auditory Screening" => array (
						'$exists' => true 
				) 
		);
		$page9_exists = array (
				"doc_data.widget_data.page9.Dental Check-up" => array (
						'$exists' => true 
				) 
		);
		
		array_push ( $and_merged_array, $unique_id );
		array_push ( $and_merged_array, $page3_exists );
		array_push ( $and_merged_array, $page4_exists );
		array_push ( $and_merged_array, $page5_exists );
		array_push ( $and_merged_array, $page6_exists );
		array_push ( $and_merged_array, $page7_exists );
		array_push ( $and_merged_array, $page8_exists );
		array_push ( $and_merged_array, $page9_exists );
		
		$result = [ ];
			$pipeline = [ 
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true 
							) 
					),
					array (
							'$match' => array (
									'$and' => $and_merged_array
							) 
					) 
			];
			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->screening_app_col,
					'pipeline' => $pipeline 
			) );
			//echo print_r($response,true);
			//exit();
			
			$query = 0;
			if($response['ok']){
				//$query = count($response["result"]);
				if(count($response["result"]) == 0 ){
					
					$and_merged_array = array ();
					
					$page1_exists = array (
							"doc_data.widget_data.page1.Personal Information" => array (
									'$exists' => true 
							) 
					);
					$page2_exists = array (
							"doc_data.widget_data.page2.Personal Information" => array (
									'$exists' => true 
							) 
					);
					
					array_push ( $and_merged_array, $unique_id );
					array_push ( $and_merged_array, $page1_exists );
					array_push ( $and_merged_array, $page2_exists );
					
					$result = [ ];
						$pipeline = [ 
								array (
										'$project' => array (
												"doc_data.widget_data" => true,
												"history" => true 
										) 
								),
								array (
										'$match' => array (
												'$and' => $and_merged_array
										) 
								) 
						];
						$response = $this->mongo_db->command ( array (
								'aggregate' => $this->screening_app_col,
								'pipeline' => $pipeline 
						) );
						
						$query = 0;
						if($response['ok']){
							//$query = count($response["result"]);
							if(count($response["result"]) == 0 ){
								$and_merged_array = array ();
								
								array_push ( $and_merged_array, $unique_id );
								
								$result = [ ];
									$pipeline = [ 
											array (
													'$project' => array (
															"doc_data.widget_data" => true,
															"history" => true 
													) 
											),
											array (
													'$match' => array (
															'$and' => $and_merged_array
													) 
											) 
									];
									$response = $this->mongo_db->command ( array (
											'aggregate' => $this->screening_app_col,
											'pipeline' => $pipeline 
									) );
									
									$query = 0;
									if($response['ok']){
										//$query = count($response["result"]);
										if(count($response["result"]) == 0 ){
											return "No document found";
											//exit();
										}else{
											return "Only unique id document";
											
										}
									}
							}
							else
							{
								return "Only personal info document";
								
							}
						}
				}else{
					return "Full document";
					
				}
			}
		
	}

	public function get_screening_reports_ehr_uid($uid) 
	{
			$query = $this->mongo_db->select ( array (
					'doc_data.widget_data',
					'doc_data.chart_data',
					'doc_data.external_attachments',
					'history' 
			) )->whereLike( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get ( $this->screening_app_col );
			$result ['screening'] = $query;
			//$result ['request']   = false;
			return $result;
			
	}

	public function update_screening_details($_id,$data_user)
	{
		//echo $_id;
		//exit();
		
		$this->mongo_db->where(array('_id' => new MongoID($_id)))->set($data_user)->update( $this->screening_app_col );
		
	   /* //$this->mongo_db->switchDatabase($this->common_db['common_db']);
	   $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => $data_user['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID']))->set($data_user)->update($this->collections['healthcare20161014212024617']);
	   //$this->mongo_db->switchDatabase($this->common_db['dsn']); */
		 
		
	}

	//Uploading zipfiles
	//author Naresh
	public function insert_screening_details($data_user){
		
		//$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		
		$query = $this->mongo_db->insert($this->screening_app_col,$data_user);
		
		//$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		log_message('debug','insert_screening_details'.print_r($query,TRUE));
		
		//return $query;
		
	 log_message('debug',"data_history======".print_r($query,true));
		if($query)
		{
			return TRUE;
		}
		else
		{
			return FALSE;
		}
   }
   
   public function get_initaite_requests_count($today_date)
	{
		$document = $this->mongo_db->select(array('history'))->whereLike("history.0.time" , $today_date)->get($this->request_app_col);
		
		//if(count($document)>0){
			
			return $document;
		//}
		
		
	}
	
	public function get_doctors_response_count($today_date)
	{
		$document = $this->mongo_db->select(array('history'))->whereLike("history.1.time" , $today_date)->get($this->request_app_col);
		
		return $document;
	}


// BMI PIE REPORT
	/*public function get_bmi_report_model($current_month,$district_name, $school_name, $student_type,$student_age) 
	{
		
		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
		
		$requests = [ ];
		
		$district_name = strtoupper($district_name);
		
		if ( $school_name != "All" && $district_name!= "select") {
			echo print_r($school_name, true);
			echo print_r($district_name, true);
			exit();
				
				$under_weight = $this->mongo_db->where('doc_data.school_details.School Name',$school_name)->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'UNDER WEIGHT';
				$request ['value'] = count($under_weight);
				array_push ( $requests, $request );
				
				$normal_weight = $this->mongo_db->where('doc_data.school_details.School Name',$school_name)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"24.99")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'NORMAL WEIGHT';
				$request ['value'] = count($normal_weight);
				array_push ( $requests, $request );
				
				$over_weight = $this->mongo_db->where('doc_data.school_details.School Name',$school_name)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"25.00",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"29.99")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'OVER WEIGHT';
				$request ['value'] = count($over_weight);
				array_push ( $requests, $request );
				
				$obese = $this->mongo_db->where('doc_data.school_details.School Name',$school_name)->wheregte('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"30.0")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'OBESE';
				$request ['value'] = count($obese);
				array_push ( $requests, $request );
				
		}else {
			}
		
		if ($school_name == "All") {
			if ($district_name != "select") {
				
				$under_weight = $this->mongo_db->where('doc_data.school_details.District',$district_name)->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'UNDER WEIGHT';
				$request ['value'] = count($under_weight);
				array_push ( $requests, $request );
				
				$normal_weight = $this->mongo_db->where('doc_data.school_details.District',$district_name)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"24.99")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'NORMAL WEIGHT';
				$request ['value'] = count($normal_weight);
				array_push ( $requests, $request );
				
				$over_weight = $this->mongo_db->where('doc_data.school_details.District',$district_name)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"25.00",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"29.99")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'OVER WEIGHT';
				$request ['value'] = count($over_weight);
				array_push ( $requests, $request );
				
				$obese = $this->mongo_db->where('doc_data.school_details.District',$district_name)->wheregte('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"30.0")->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get('healthcare2017619153715384');
				$request ['label'] = 'OBESE';
				$request ['value'] = count($obese);
				array_push ( $requests, $request );
				
			} else {
			}
		} 
		return $requests;
		
	}*/
	public function get_bmi_report_model($current_month,$district_name, $school_name,$student_type = false,$student_age = false) {
		
		if ($current_month) {
			//$selected_month = "2018-10";
			$selected_month = $current_month;
		} else {
			//$selected_month = "2018-10";
			$selected_month = $this->selected_month;
		}
		
		$requests = [ ];
		$request_under_weight = array();
		$request_normal_weight = array();
		$request_over_weight = array();
		$request_obese= array();
		
		if($school_name == "select" && $district_name == "select")
		{
			$query = array('doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month.'-*'),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
			$documents = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($query)->get('healthcare2017619153715384');
			foreach ($documents as  $value) 
			{
				$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
				if($end_array['bmi'] < 18.50)
				{
					array_push($request_under_weight, $value);
				}else if($end_array['bmi'] >= 18.50 && $end_array['bmi'] <= 24.99 )
				{
					array_push($request_normal_weight, $value);
				}else if($end_array['bmi'] >= 25.00 && $end_array['bmi'] <= 29.99 )
				{
					array_push($request_over_weight, $value);
				}else if($end_array['bmi'] >= 30 )
				{
					array_push($request_obese, $value);
				}
			}
				$request ['label'] = 'UNDER WEIGHT';
				$request ['value'] = count($request_under_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'NORMAL WEIGHT';
				$request ['value'] = count($request_normal_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'OVER WEIGHT';
				$request ['value'] = count($request_over_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'OBESE';
				$request ['value'] = count($request_obese);
				array_push ( $requests, $request );

				return $requests;
				
		}else if ( $school_name != "All" && $district_name != "select") 
		{
			$query = array('doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month.'-*'),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.school_details.School Name' => $school_name,'doc_data.widget_data.school_details.District' => $district_name,
		'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
			$documents = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($query)->get('healthcare2017619153715384');
			foreach ($documents as  $value) 
			{
				$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
				if($end_array['bmi'] < 18.50)
				{
					array_push($request_under_weight, $value);
				}else if($end_array['bmi'] >= 18.50 && $end_array['bmi'] <= 24.99 )
				{
					array_push($request_normal_weight, $value);
				}else if($end_array['bmi'] >= 25.00 && $end_array['bmi'] <= 29.99 )
				{
					array_push($request_over_weight, $value);
				}else if($end_array['bmi'] >= 30 )
				{
					array_push($request_obese, $value);
				}
			}
				$request ['label'] = 'UNDER WEIGHT';
				$request ['value'] = count($request_under_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'NORMAL WEIGHT';
				$request ['value'] = count($request_normal_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'OVER WEIGHT';
				$request ['value'] = count($request_over_weight);
				array_push ( $requests, $request );
				$request ['label'] = 'OBESE';
				$request ['value'] = count($request_obese);
				array_push ( $requests, $request );

				return $requests;
		}else if ($school_name == "All") {
			if ($district_name != "select")
			 {
				$query = array('doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => (!empty($student_type) && isset($student_type)) ? $student_type : array('$exists' => true),'doc_data.widget_data.school_details.District' => $district_name,
			'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
				//echo print_r($query,true);echo print_r($student_age,true);exit();
				$documents = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($query)->get('healthcare2017619153715384');
				foreach ($documents as  $value) 
				{
					$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
					if($end_array['bmi'] < 18.50)
					{
						array_push($request_under_weight, $value);
					}else if($end_array['bmi'] >= 18.50 && $end_array['bmi'] <= 24.99 )
					{
						array_push($request_normal_weight, $value);
					}else if($end_array['bmi'] >= 25.00 && $end_array['bmi'] <= 29.99 )
					{
						array_push($request_over_weight, $value);
					}else if($end_array['bmi'] >= 30 )
					{
						array_push($request_obese, $value);
					}
				}
					$request ['label'] = 'UNDER WEIGHT';
					$request ['value'] = count($request_under_weight);
					array_push ( $requests, $request );
					$request ['label'] = 'NORMAL WEIGHT';
					$request ['value'] = count($request_normal_weight);
					array_push ( $requests, $request );
					$request ['label'] = 'OVER WEIGHT';
					$request ['value'] = count($request_over_weight);
					array_push ( $requests, $request );
					$request ['label'] = 'OBESE';
					$request ['value'] = count($request_obese);
					array_push ( $requests, $request );

					return $requests;
				
			} else {
			}
		} 
		return $requests;
		
	}
	
public function get_drilling_bmi_students_prepare_pie_array($query, $school_name, $type)
	{
		$search_result = [ ];
		$count = 0;
		
		 if ($query) {
			
			$request = [ ];
			$UI_arr = [ ];
			foreach ( $query as $doc ) {
				
				
				switch ($type) {
					case "UNDER WEIGHT" :
					
						$bmi_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						$UI_arr = array_merge ( $UI_arr, $bmi_ids_arr );
						
						break;
					case "NORMAL WEIGHT" :
						
						$bmi_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
					
						$UI_arr = array_merge ( $UI_arr, $bmi_ids_arr );
						
						break;
					
					case "OVER WEIGHT" :
						
						$bmi_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						
						$UI_arr = array_merge ( $UI_arr, $bmi_ids_arr );
						
						break;
						
					case "OBESE" :
						
						$bmi_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						
						$UI_arr = array_merge ( $UI_arr, $bmi_ids_arr );
						
						break;
						
					default :
					break;
				}
		 }
		
			return $UI_arr;
		}
	}

	/*public function get_drill_down_to_bmi_report($type, $current_month, $district_name, $school_name = "All") 
	{
		$current_month = substr($current_month,0,-3);

		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
		ini_set ( 'memory_limit', '10G' );
		$district_name = strtoupper($district_name);
		switch ($type) {
			case "UNDER WEIGHT" :
				
				$query = $this->mongo_db->select ( array (
						"doc_data" 
				) )->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50")->whereLike ( 'doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get ( $this->bmi_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
					
				}
				
				return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
				break;
				
			case "NORMAL WEIGHT" :
			ini_set ( 'memory_limit', '10G' );
				$query = $this->mongo_db->select ( array (
						"doc_data" 
				) )->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.50",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"24.99")->whereLike ( 'doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get ( $this->bmi_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
						
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				
				return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
				break;
			
			case "OVER WEIGHT" :
			ini_set ( 'memory_limit', '10G' );
			
				$query = $this->mongo_db->select ( array (
						"doc_data" 
				) )->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"25.00",'doc_data.widget_data.page1.Student Details.BMI_values.bmi',"29.99")->whereLike ( 'doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get ( $this->bmi_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
				break;
				
			case "OBESE" :
			ini_set ( 'memory_limit', '10G' );
			
				$query = $this->mongo_db->select ( array (
						"doc_data" 
				) )->wheregte('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"30.0")->whereLike ( 'doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->get ( $this->bmi_app_col );
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
				break;
			
			default :
				;
				break;
		}
	}*/

	public function get_drill_down_to_bmi_report($type, $current_month, $district_name, $school_name = "All",$student_type = false,$student_age = false) 
	{
		$current_month = substr($current_month,0,-3);

		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
		ini_set ( 'memory_limit', '10G' );
		$query = array();
		
		if($district_name == "select" && $school_name == "select")
		{
			
			switch ($type) 
			{
				case "UNDER WEIGHT" :
					$under_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$lt' => 18.50),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));

					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($under_weight)->get ( $this->bmi_app_col );		

					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] < 18.50)
						{
							array_push($query, $value);
						}
					}								
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
					
				case "NORMAL WEIGHT" :
				ini_set ( 'memory_limit', '10G' );
				$normal_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 18.50,'$lte' => 24.99),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($normal_weight)->get ( $this->bmi_app_col );	

					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 18.50 && $end_array['bmi'] <= 24.99)
						{
							array_push($query, $value);
						}
					}					
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
				
				case "OVER WEIGHT" :
				ini_set ( 'memory_limit', '10G' );
				
					$over_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 25.00,'$lte' => 29.99),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($over_weight)->get ( $this->bmi_app_col );
					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 25.00 && $end_array['bmi'] <= 29.99)
						{
							array_push($query, $value);
						}
					}	
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
					
				case "OBESE" :
				ini_set ( 'memory_limit', '10G' );
				
				$obese_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 30.00),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));

					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($obese_weight)->get ( $this->bmi_app_col );

					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 30)
						{
							array_push($query, $value);
						}
					}	
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
				
				default :
					;
					break;
			}
		}else
		{
			switch ($type) 
			{
				case "UNDER WEIGHT" :
					$under_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$lt' => 18.50),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),
					'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));

					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($under_weight)->get ( $this->bmi_app_col );

					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] < 18.50)
						{
							array_push($query, $value);
						}
					}	
					
					$doc_query = array ();
					if ($school_name == "All") {
						if ($district_name != "select") {
							foreach ( $query as $doc ) {
								if (strtolower ( $doc ['doc_data']['widget_data']['school_details'] ['District'] ) == strtolower ( $district_name )) {
									array_push ( $doc_query, $doc );
								}
							}
							$query = $doc_query;
						} else {
						}
					} else {
						foreach ( $query as $doc ) {
							
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
						
					}
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
					
				case "NORMAL WEIGHT" :
				ini_set ( 'memory_limit', '10G' );
				$normal_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 18.50,'$lte' => 24.99),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' =>$selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($normal_weight)->get ( $this->bmi_app_col );

					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 18.50 && $end_array['bmi'] <= 24.99)
						{
							array_push($query, $value);
						}
					}						
					
					$doc_query = array ();
					if ($school_name == "All") {
						if ($district_name != "select") {
							foreach ( $query as $doc ) {
								if (strtolower ( $doc ['doc_data'] ['widget_data']['school_details'] ['District'] ) == strtolower ( $district_name )) {
									array_push ( $doc_query, $doc );
								}
							}
							$query = $doc_query;
							
						} else {
							
						}
					} else {
						foreach ( $query as $doc ) {
							
							if (strtolower ( $doc ['doc_data'] ['widget_data']['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						
						$query = $doc_query;
					}
					
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
				
				case "OVER WEIGHT" :
				ini_set ( 'memory_limit', '10G' );
				
					$over_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 25.00,'$lte' => 29.99),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),
					'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($over_weight)->get ( $this->bmi_app_col );
					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 25.00 && $end_array['bmi'] <= 29.99)
						{
							array_push($query, $value);
						}
					}	
					$doc_query = array ();
					if ($school_name == "All") {
						if ($district_name != "select") {
							foreach ( $query as $doc ) {
								if (strtolower ( $doc ['doc_data']['widget_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
									array_push ( $doc_query, $doc );
								}
							}
							$query = $doc_query;
						} else {
						}
					} else {
						foreach ( $query as $doc ) {
							
							if (strtolower ( $doc ['doc_data'] ['widget_data']['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					}
					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
					
				case "OBESE" :
				ini_set ( 'memory_limit', '10G' );
				
				$obese_weight = array('doc_data.widget_data.page1.Student Details.BMI_values.bmi'=>array('$gte' => 30.00),
						'doc_data.widget_data.page1.Student Details.BMI_values.month' => array('$regex' => $selected_month),'doc_data.widget_data.page1.Student Details.Gender' => ($student_type)?$student_type:array('$exists' => true),'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));

					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($obese_weight)->get ( $this->bmi_app_col );
					foreach ($docs as $value) 
					{
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['BMI_values']);
						if($end_array['bmi'] >= 30)
						{
							array_push($query, $value);
						}
					}
					$doc_query = array ();
					if ($school_name == "All") {
						if ($district_name != "select") {
							foreach ( $query as $doc ) {
								
								if (strtolower ( $doc ['doc_data']['widget_data']['school_details'] ['District'] ) == strtolower ( $district_name )) {
									array_push ( $doc_query, $doc );
								}
							}
							$query = $doc_query;

						} else {
						}
					} else {
						foreach ( $query as $doc ) {
							
							if (strtolower ( $doc ['doc_data'] ['widget_data']['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
						
					}

					return $this->get_drilling_bmi_students_prepare_pie_array ( $query, $school_name, $type );
					break;
				
				default :
					;
					break;
			}
		}
		
	}
	 

	 
	 public function get_drilling_bmi_students_docs($_id_array) 
	 {
		
		/*$bmi_request = array ();
		//set_time_limit(0);
		ini_set ( 'memory_limit', '10G' );
		
		if(isset($_id_array) && !empty($_id_array))
		{
			foreach ( $_id_array as $_id ) 
			{
				$query = $this->mongo_db->select ( array (
						'doc_data.widget_data.page1',
						'doc_data.widget_data.page2' 
				) )->where( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $_id )->get ( $this->screening_app_col );
				
				foreach ( $query as $bmi_docs )
					{
						$unique_id = $bmi_docs ['doc_data'] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'];
						$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Details.Hospital Unique ID', $unique_id )->get ( $this->bmi_app_col);
						
						if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
								$bmi ['student_info'] = $bmi_docs;
								$bmi ['BMI_values'] = $doc [0] ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['BMI_values'];
								//$bmi['bmi_id'] = $doc[0]['_id'];
								
								array_push ( $bmi_request, $bmi );
						}
					}
		}
	
		return $bmi_request;
	}*/

		$bmi_request = array ();
		//set_time_limit(0);
		ini_set ( 'memory_limit', '10G' );
		
		if(isset($_id_array) && !empty($_id_array))
		{
			foreach ( $_id_array as $_id ) 
			{
				/*$query = $this->mongo_db->select ( array (
						'doc_data.widget_data.page1',
						'doc_data.widget_data.page2' 
				) )->where( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $_id )->get ( $this->screening_app_col );
				
				foreach ( $query as $bmi_docs )
					{
						$unique_id = $bmi_docs ['doc_data'] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'];
						$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Details.Hospital Unique ID', $unique_id )->get ( $this->bmi_app_col);
						
						if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
								$bmi ['student_info'] = $bmi_docs;
								$bmi ['BMI_values'] = $doc [0] ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['BMI_values'];
								//$bmi['bmi_id'] = $doc[0]['_id'];
								
								array_push ( $bmi_request, $bmi );
						}
					}*/

					$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Details.Hospital Unique ID', $_id )->get ( $this->bmi_app_col);
						
						if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
								/*$bmi ['student_info'] = $bmi_docs;
								$bmi ['BMI_values'] = $doc [0] ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['BMI_values'];*/
								//$bmi['bmi_id'] = $doc[0]['_id'];
								
								array_push ( $bmi_request, $doc );
						}
		}
	
		return $bmi_request;
	}
	}
	

	public function get_student_bmi_graph_values($hospital_unique_id)
	{
		$query = $this->mongo_db->select(array('doc_data.widget_data.page1.Student Details.BMI_values'))->where( array('doc_data.widget_data.page1.Student Details.Hospital Unique ID' => $hospital_unique_id))->get($this->bmi_app_col);
		
		
		if($query)
			return $query;
	    else
			return FALSE;
	}
	
	
	public function export_bmi_reports_monthly_to_excel($date, $district_name="select", $school_name="All"){
		
		$bmi_reports = [ ];
		
		if ( $school_name != "All") {
			
				
				$query = $this->mongo_db->where('doc_data.school_details.School Name',$school_name)->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$date)->orderBy ( array (
					'doc_data.school_details.District' => 1 
			) )->get ( $this->bmi_app_col );
				
				array_push ( $bmi_reports, $query );
		}
		if ($school_name == "All") {
			if ($district_name != "select") {
				$district_name = strtoupper($district_name);
				$query = $this->mongo_db->where('doc_data.school_details.District',$district_name)->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$date)->orderBy ( array (
					'doc_data.school_details.District' => 1 
			) )->get ( $this->bmi_app_col );
				
				array_push ( $bmi_reports, $query );
			}
		}
		
		return $bmi_reports[0];
	}
	
	public function get_bmi_submitted_schools_list($current_month,$district_name,$dist_id)
	{
		$district_name = strtoupper($district_name);
		// Variables
		$all_schools               = array();
		$all_schools_district      = array();
		$all_schools_name      	   = array();
		
		$submitted_schools 	       = array();
		$submitted_school_district = array();
		$submitted_school_name     = array();
		$not_submitted_schools	   = array();
		$schools_data              = array();
		$not_submitted_dist        = array();
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$schools_list = $this->mongo_db->whereLike('dt_name',$dist_id)->get ( $this->collections ['ttwreis_schools'] );
		
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
	
		$query = $this->mongo_db->select(array('doc_data.school_details'))->whereLike('doc_data.widget_data.page1.Student Details.BMI_values.month',$selected_month)->where(array('doc_data.school_details.District' => $district_name))->get($this->bmi_app_col);
		
		
		foreach ( $query as $doc ) {
			
			    if(!in_array($doc ['doc_data'] ['school_details'] ['School Name'], $submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['school_details'] ['District']);
					array_push ( $submitted_school_name,$doc ['doc_data'] ['school_details'] ['School Name'] );
					
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		   $dist_array    = explode(",",$school_name);
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		   
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		
		
		
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		return $schools_data;
		
	}


	
   
   public function get_chronic_request() {
		
		$requests = [ ];
		
		$query = $this->get_request_docs('Chronic',"Not Cured");
		$request ['label'] = 'Chronic';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		$query = $this->get_request_docs('Deficiency',"Not Cured");
		$request ['label'] = 'Deficiency';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		$query = $this->get_request_docs('Defects',"Not Cured");
		$request ['label'] = 'Defects';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		return $requests;
		
	}
	
	public function update_chronic_request_pie($status_type) {
		
		$requests = [ ];
		
		$query = $this->get_request_docs('Chronic',$status_type);
		$request ['label'] = 'Chronic';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		$query = $this->get_request_docs('Deficiency',$status_type);
		$request ['label'] = 'Deficiency';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		$query = $this->get_request_docs('Defects',$status_type);
		$request ['label'] = 'Defects';
		$request ['value'] = count($query);
		array_push ( $requests, $request );
		
		return $requests;
		
	}
	
	public function drill_down_request_to_symptoms($data,$status_type){
		
		$obj_data = json_decode ( $data, true );
		$type = $obj_data ['label'];
		
		$query = $this->get_request_docs($type,$status_type);
		
		$prob_arr = [ ];
		foreach ( $query as $doc ) {
			if (isset ( $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'] )) {
				$problems = $doc ['doc_data'] ['widget_data'] ['page1'] ['Problem Info'] ['Identifier'];
				foreach ( $problems as $problem ) {
					if (isset ( $prob_arr [$problem] )) {
						$prob_arr [$problem] ++;
					} else {
						$prob_arr [$problem] = 1;
					}
				}
			}
		}
		
		// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob_arr,true));
		$final_values = [ ];
		foreach ( $prob_arr as $prob => $count ) {
			// //log_message("debug","schooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo".print_r($prob,true));
			// //log_message("debug","ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc".print_r($count,true));
			$result ['label'] = $prob;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		// //log_message("debug","fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff".print_r($final_values,true));
		
		return $final_values;
	}
	
	public function drilldown_chronic_request_to_districts($data, $status_type) {
		
		ini_set ( 'max_execution_time', 0 );
		ini_set ( 'memory_limit', '5G' );
		$query = [ ];
		
		$obj_data = json_decode ( $data, true );
		$search_param_1 = $obj_data[0];
		$search_param_2 = $obj_data[1];
		$params = explode(" / ", $search_param_1);
		$search_param_1 = $params[1];
		
		//$query = $this->get_request_docs_params($search_param_1,$search_param_2,$status_type);
		
		$dist_list = [ ];
		
		/*foreach ( $query as $identifiers ) {
			
			$retrieval_list = array ();
			$unique_id = $identifiers ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			//log_message ( 'debug', 'unique_id----' . print_r ( $unique_id, true ) );
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
		    log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd".print_r($doc,true));
			log_message("debug","dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd".print_r(count($doc),true));
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$district = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'];
				if (isset ( $dist_list [$district] )) {
					$dist_list [$district] ++;
				} else {
					$dist_list [$district] = 1;
				}
			}
		}*/

		$date = "2018-07-02";
		$dist_list = $this->mongo_db->select(array('pie_data.Chronic'),array('_id'))->whereLike('pie_data.date',$date)->get('ttwreis_district_wise_healthrequest_counts');
		
		$dist_list = $dist_list[0]['pie_data']['Chronic'][$search_param_2];
		
		$final_values = [ ];
		foreach ( $dist_list as $dicsts => $count ) {
			$result ['label'] = $dicsts;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}
	
	public function drilldown_chronic_request_to_schools($data, $status_type) {
		
		ini_set ( 'max_execution_time', 0 );
		ini_set ( 'memory_limit', '5G' );
		$query = [ ];
		
		$obj_data = json_decode ( $data, true );
		$search_param_1 = $obj_data[0];
		$params = explode(" / ", $search_param_1);
		$search_param_1 = $params[1];
		$search_param_2 = $params[2];
		
		//$query = $this->get_request_docs_params($search_param_1,$search_param_2,$status_type);
		//$dist = strtolower ( $obj_data [1] );
		
		$school_list = [ ];
		$matching_docs = [ ];
		
		/*foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$district = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['District'];
				if (strtolower ( $district ) == $dist) {
					array_push ( $matching_docs, $doc [0] );
				}
			}
		}
		
		foreach ( $matching_docs as $docs ) {
			$school_name = $docs ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
			if (isset ( $school_list [$school_name] )) {
				$school_list [$school_name] ++;
			} else {
				$school_list [$school_name] = 1;
			}
		}
		*/
		$date = "2018-07-02";
		$dist = strtoupper( $obj_data [1] );
		$dist_list = $this->mongo_db->select(array('pie_data.Chronic'),array('_id'))->whereLike('pie_data.date',$date)->get('ttwreis_school_wise_healthrequest_counts');
		log_message('error',"dist_list===========21494".print_r($dist_list,true));
		$school_list = $dist_list[0]['pie_data']['Chronic'][$search_param_2][$dist];

		$final_values = [ ];
		foreach ( $school_list as $school => $count ) {
			$result ['label'] = $school;
			$result ['value'] = $count;
			array_push ( $final_values, $result );
		}
		
		return $final_values;
	}
	
	public function drilldown_chronic_request_to_students($data,$status_type) {
		
		
		$query = [ ];
		
		$obj_data = json_decode ( $data, true );
		$search_param_1 = $obj_data[0];
		$params = explode(" / ", $search_param_1);
		$search_param_1 = $params[1];
		$search_param_2 = $params[2];
		
		$school_name = $obj_data ['1'];
		$school_name = strtoupper($school_name);
			//log_message("error","school_name====17428".print_r($school_name,true));
		if(isset($school_name))
		{
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$schools_list = $this->mongo_db->select(array('school_code'),array('_id'))->where('school_name',$school_name)->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

			$school_code = $schools_list[0]['school_code'];

			if(isset($school_code) && ! empty($school_code))
			{
				$this->mongo_db->switchDatabase($this->common_db ['common_db']);
				$get_hs_email = $this->mongo_db->select(array('email'))->where('school_code',$school_code)->get($this->collections ['ttwreis_health_supervisors']);
				$this->mongo_db->switchDatabase($this->common_db ['dsn']);
				$email = $get_hs_email[0]['email'];
				$dist_code = strtoupper(str_ireplace(".", "_",substr($email,0,strpos($email,"@")-2)));
			}
			else{
				$dist_code = "";
			}

		}
		
		if(isset($dist_code) && !empty($dist_code))
		{
			$query = $this->get_request_docs_params_with_school($search_param_1,$search_param_2,$status_type,$dist_code);
		}
		else
		{
			$query = $this->get_request_docs_params($search_param_1,$search_param_2,$status_type);
		}
		
		
		$student_list = [ ];
		$matching_docs = [ ];
		
		foreach ( $query as $request ) {
			
			$retrieval_list = array ();
			$unique_id = $request ['doc_data'] ['widget_data'] ['page1'] ['Student Info'] ['Unique ID'];
			$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $unique_id )->get ( $this->screening_app_col );
			if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
				$school = $doc [0] ['doc_data'] ['widget_data'] ['page2'] ['Personal Information'] ['School Name'];
				if ($school == $school_name) {
					array_push ( $matching_docs, $doc [0] ['_id']->{'$id'} );
				}
			}
		}
		
		return $matching_docs;
	}

	private function get_request_docs($request_type,$status_type){
		
		if($status_type == "Cured"){
			
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $request_type);
			$cured = array ("doc_data.widget_data.page2.Review Info.Status" => "Cured");

			$and_merged_array = array();
			
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $cured );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query;
				
		}else{
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $request_type);
			$not_cured = array ("doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured"));
			$date = array('history.0.time' => array('$gte' => "2018-05-01"));
			$and_merged_array = array();
			
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $date );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query;
		}
		
		
		
	}
	
	private function get_request_docs_params($search_param_1, $search_param_2, $status_type){
		
		if($status_type == "Cured"){
			
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $search_param_1);
			$symptoms = array ('doc_data.widget_data.page1.Problem Info.Identifier' => $search_param_2);
			$cured = array ("doc_data.widget_data.page2.Review Info.Status" => "Cured");

			$and_merged_array = array();
			
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $symptoms );
			array_push ( $and_merged_array, $cured );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query;
				
		}else{
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $search_param_1);
			$symptoms = array ('doc_data.widget_data.page1.Problem Info.Identifier' => $search_param_2);
			$not_cured = array ("doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured"));
			$date = array('history.0.time' => array('$regex' => "2018-05-*"));
			$and_merged_array = array();
			
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $symptoms );
			array_push ( $and_merged_array, $not_cured );
			array_push ( $and_merged_array, $date );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query;
		}
	}


	private function get_request_docs_params_with_school($search_param_1, $search_param_2, $status_type,$dist_code){

		$start_date = date("Y-m-d H:i:s");
		log_message('error',"start_datestart_date============17561".print_r($start_date,true));
		//$school_code = "HYD_".$school_code."_*";
		if($status_type == "Cured"){
			$unique_id = array('doc_data.widget_data.page1.Student Info.Unique ID' => array('$regex' => $dist_code));
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $search_param_1);
			$symptoms = array ('doc_data.widget_data.page1.Problem Info.Identifier' => $search_param_2);
			$cured = array ("doc_data.widget_data.page2.Review Info.Status" => "Cured");
	
			$and_merged_array = array();
			
			array_push ( $and_merged_array, $unique_id );
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $symptoms );
			array_push ( $and_merged_array, $cured );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}
				
				return $query;
				
		}else{
			$unique_id = array('doc_data.widget_data.page1.Student Info.Unique ID' => array('$regex' => $dist_code));
			$init_request = array ('doc_data.widget_data.page2.Review Info.Request Type' => $search_param_1);
			$symptoms = array ('doc_data.widget_data.page1.Problem Info.Identifier' => $search_param_2);
			$not_cured = array ("doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured"));
			$date = array('history.time' => array('$gte' => "2018-05-01"));
			$and_merged_array = array();
			
			array_push ( $and_merged_array, $unique_id );
			array_push ( $and_merged_array, $init_request );
			array_push ( $and_merged_array, $symptoms );
			array_push ( $and_merged_array, $not_cured );
			array_push ( $and_merged_array, $date );
			$result = [ ];
				
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data" => true,
										"history" => true 
								) 
						),
						array (
								'$match' => array (
										'$and' => $and_merged_array					
								) 
						)
				];
				
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->request_app_col,
						'pipeline' => $pipeline 
				) );
				$query = array();
				if($response['ok']){
					$query = $response["result"];
				}

				return $query;
		}
	}
	//fetch request form ehr
	public function get_reports_ehr_uid_new_html_static_hs($uid) {
		
		$query = $this->mongo_db->select ( array (
				'doc_data.widget_data',
				'doc_data.chart_data',
				'doc_data.external_attachments',
				'history' 
		) )->whereLike ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->limit(700)->get ( $this->screening_app_col );
		if ($query) {
			$query_request = $this->mongo_db->orderBy(array("history.0.time"=>-1))->where ( "doc_data.widget_data.page1.Student Info.Unique ID", strtoupper($uid) )->get ('healthcare2016108181933756_static_html');
			
			if(count($query_request) > 0){
				foreach($query_request as $req_ind => $req){
					unset($query_request[$req_ind]['doc_data']["notes_data"]);
					$notes_data = $this->mongo_db->where ("req_doc_id", $req['doc_properties']['doc_id'])->get ( $this->collections['ttwreis_req_notes'] );
										
					if(count($notes_data) > 0){
						$query_request[$req_ind]['doc_data']['notes_data'] = $notes_data[0]['notes_data'];
					}
				}
				
			}
			
			$query_notes = $this->mongo_db->where ( "uid", strtoupper($uid) )->get ( $this->notes_col );
			
			
			
			if(isset($query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'])){
				$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
				$school_details = $this->mongo_db->where ( "school_name", $query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'] )->get ( $this->collections ['ttwreis_schools'] );
				
				if(count($school_details) > 0){
					$query_hs = $this->mongo_db->where ( "school_code", $school_details[0]['school_code'] )->get ( $this->collections ['ttwreis_health_supervisors'] );
				}else{
					$query_hs[0] = false;
				}
				$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			}else{
				$query_hs[0] = false;
			}
			
			
			$result ['screening'] = $query;
			$result ['request'] = $query_request;
			$result ['notes'] = $query_notes;
			$result ['hs'] = $query_hs[0];
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['request'] = false;
			$result ['notes'] = false;
			$result ['hs'] = false;
			return $result;
		}
	}
	/**
	 * Helper: get approval history from document collection
	 *
	 * @return array
	 *  
	 * @author Naresh 
	 */

    function get_approval_history($doc_id)
    {
    	$query = $this->mongo_db->select(array('history'))->where(array('doc_properties.doc_id'=> $doc_id))->get($this->request_app_col_static_html);
    	return $query[0]['history'];
    }
	function get_sanitation_report_fields_count($district_name,$school_name)
	{
		
		if($district_name == 'All' && $school_name == 'All')
		{
			$today_date = date("Y-m-d");
			$campusOnce = $this->mongo_db->
								where(array(
										
										'doc_properties.status' => 2,
									    "doc_data.widget_data.page4.Declaration Information.Date:" => $today_date
									))->get("healthcare20171211809800_version_2");
			
			return $campusOnce;
		}
		elseif($school_name == 'All')
		{
			$today_date = date("Y-m-d");
			$campusOnceCount = $this->mongo_db->
								where(array(
										'doc_data.widget_data.page4.School Information.District' => strtoupper($district_name),
										'doc_properties.status' => 2, 
										"doc_data.widget_data.page4.Declaration Information.Date:" => $today_date 					    
									))->get("healthcare20171211809800_version_2");
								
			return $campusOnceCount;
			
		}
	}
	public function get_initaite_requests_count_today_date($today_date)
	{
		$exists_history = array('history.0.time' => array('$regex' => $today_date ));
		
		$document = $this->mongo_db->select(array('history'))->where($exists_history)->count($this->request_app_col_static_html);
		//log_message('error','document--------------------19480'.print_r($document,true));
		if(count($document)>0){
			return $document;
		}
	}

	public function get_requests_count_today_date($today_date)
	{
		$exists_history = array('history.0.time' => array('$regex' => $today_date ));
		
		$document['normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->where($exists_history)->count($this->request_app_col_static_html);

		$document['defects'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Defects"))->where($exists_history)->count($this->request_app_col_static_html);

		$document['deficiency'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Deficiency"))->where($exists_history)->count($this->request_app_col_static_html);

		$document['emergency_count'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->where($exists_history)->count($this->request_app_col_static_html);

		$document['chronic_count'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->where($exists_history)->count($this->request_app_col_static_html);

		$document['normal_count'] = $document['normal'] + $document['defects'] + $document['deficiency'];

		if(count($document)>0){
			return $document;
		} 
	}
	
	public function get_doctors_response_count_today_date($today_date)
	{
		$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'));
		$document = $this->mongo_db->select(array('history'))->where($exists_doctor)->whereLike("history.time" , $today_date)->get($this->request_app_col_static_html);
		
		return $document;
	}
	public function get_show_ehr_details($request_type,$date,$school_name)
	{
		
		$data['all_request'] = $this->mongo_db->whereLike('history.0.time',$date)->get('healthcare2016108181933756_static_html');
		if($school_name== "All")
		{
			if($request_type == "Normal" )
			{
			$normal_request_all = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type))->get('healthcare2016108181933756_static_html');
				return $normal_request_all;
			
			}
			else if($request_type == "Emergency")
			{ 
			$emergency_request_all = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type))->get('healthcare2016108181933756_static_html');

			return $emergency_request_all;
				
			}
			else if($request_type == "Chronic")
			{
				$chronic_request_all = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type))->get('healthcare2016108181933756_static_html');
				return $chronic_request_all;
				
			}
		}else{
			
			if($request_type == "Normal")
			{
			$normal_request = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->get('healthcare2016108181933756_static_html');
				return $normal_request;
			
			}
			
			else if($request_type == "Emergency")
			{ 
			$emergency_request = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->get('healthcare2016108181933756_static_html');

			return $emergency_request;
				
			}
			else if($request_type == "Chronic")
			{
				$chronic_request = $this->mongo_db->select(array(),array('_id'))->whereLike('history.0.time',$date)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => $request_type, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->get('healthcare2016108181933756_static_html');
				return $chronic_request;
				
			}
		}
		
		
	}
	public function drill_down_screening_to_students_load_ehr_new_dashboard($_id) {
		
		$query = $this->mongo_db->select ( array (
				'doc_data.widget_data',
				'doc_data.chart_data',
				'doc_data.external_attachments',
				'history' 
		) )->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID',$_id)->
		get ( $this->screening_app_col );
		//->where ( "_id", new MongoID ( $_id ) )
		
		if ($query) {
			$query_request = $this->mongo_db->select(array("doc_data.widget_data","doc_data.notes_data","doc_data.external_attachments","doc_properties","history"))->orderBy(array("history.0.time"=> -1))->where( "doc_data.widget_data.page1.Student Info.Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ('healthcare2016108181933756_static_html');
			
			
			
			if(count($query_request) > 0){
				foreach($query_request as $req_ind => $req){
					unset($query_request[$req_ind]['doc_data']["notes_data"]);
					$notes_data = $this->mongo_db->whereLike ("req_doc_id", new MongoId($req['_id']))->get ( $this->collections['ttwreis_req_notes'] );
					
					
					if(count($notes_data) > 0){
						$query_request[$req_ind]['doc_data']['notes_data'] = $notes_data[0]['notes_data'];
					}
				}
				
			}
			
			$query_notes = $this->mongo_db->orderBy(array('datetime' => 1))->where ( "uid", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'] )->get ( $this->notes_col );

			//log_message("debug","EHR======notes".print_r($query_notes,true));
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$school_details = $this->mongo_db->where ( "school_name", $query[0]['doc_data']['widget_data']['page2']['Personal Information']['School Name'] )->get ( $this->collections ['ttwreis_schools'] );

			$query_hs = $this->mongo_db->where ( "school_code", $school_details[0]['school_code'] )->get ( $this->collections ['ttwreis_health_supervisors'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

			$bmi_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->bmi_app_col);
			
			
			$hb_value_table_addto_ehr = $this->mongo_db->where("doc_data.widget_data.page1.Student Details.Hospital Unique ID", $query [0] ["doc_data"] ['widget_data'] ['page1'] ['Personal Information'] ['Hospital Unique ID'])->get($this->hb_app_col);
			
			$result ['screening'] = $query;
			$result ['request'] = $query_request;
			$result ['notes'] = $query_notes;
			$result ['hs'] = $query_hs[0];
			$result ['BMI_report'] = $bmi_value_table_addto_ehr;
			$result ['hb_report'] = $hb_value_table_addto_ehr;
			//log_message("debug","result ==========notes".print_r($result ['notes'],true));
			return $result;
		} else {
			$result ['screening'] = false;
			$result ['request'] = false;
			$result ['notes'] = false;
			$result ['hs'] = false;
			$result ['BMI_report'] = false;
			$result ['hb_report'] = false;
			return $result;
		}
	}
	public function get_drilling_screenings_students_docs_count($_id_array) {
		$docs = [ ];
		ini_set ( 'memory_limit', '10G' );
		foreach ( $_id_array as $_id ) {
			$query = $this->mongo_db->select(array("doc_data.widget_data"))->where ( "_id", new MongoID ( $_id ) )->get ( $this->screening_app_col );
			
			if (isset ( $query [0] ))
				array_push ( $docs, $query [0] );
		}
		return $docs;
	}
	// hb PIE REPORT
	public function get_hb_report_model($current_month, $district_name, $school_name,$student_type = false,$student_age = false)
	{
		if ($current_month){
			$selected_month = $current_month;
			//$selected_month = "2018-10";
		}else {
			$selected_month = $this->selected_month;
			//$selected_month = "2018-10";
		}

		$requests = [ ];
		$requests_array = [ ];
		$requests_array_normal = [ ];
		$requests_array_moderate = [ ];
		$requests_array_mild = [ ];
		
		if($school_name == "select" && $district_name == "select")
		{
			$query = array('doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
		//`	$documents = $this->mongo_db->select(array('doc_data.widget_data'))->where($query)->get($this->hb_app_col);
			$documents = $this->mongo_db->select(array('doc_data.widget_data'))->where($query)->get($this->hb_app_col);
			
			foreach ($documents as $value) 
			{
				$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);				
				
				if($end_array['hb'] <= 8.0)
				{
					array_push($requests_array, $value);
				}else if($end_array['hb'] >= 12.0 && $end_array['hb'] <= 18.0)
				{
					array_push($requests_array_normal, $value);			
				}else if($end_array['hb'] >= 8.1 && $end_array['hb'] <= 10.0)
				{
					array_push($requests_array_moderate, $value);
				}else if($end_array['hb'] >= 10.1 && $end_array['hb'] < 12.0)
				{
					array_push($requests_array_mild, $value);
				}

			}
			
			$request ['label'] = 'SEVERE';
			$request ['value'] = count($requests_array);
			array_push ( $requests, $request );
			$request ['label'] = 'NORMAL';
			$request ['value'] = count($requests_array_normal);
			array_push ( $requests, $request );
			$request ['label'] = 'MODERATE';
			$request ['value'] = count($requests_array_moderate);
			array_push ( $requests, $request );
			$request ['label'] = 'MILD';
			$request ['value'] = count($requests_array_mild);
			array_push ( $requests, $request );

			return $requests;
		}else if ( $school_name != "All" && $district_name != "select") 
		{
			
			
			$query = array('doc_data.widget_data.school_details.School Name' => $school_name,
				'doc_data.widget_data.school_details.District' => $district_name,
				'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month."-_*"),
				'doc_data.widget_data.page1.Student Details.Gender' => (!empty($student_type) && isset($student_type)) ? $student_type : array('$exists' => true),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));

			$documents = $this->mongo_db->select(array('doc_data.widget_data'))->where($query)->get($this->hb_app_col);

			
						
			foreach ($documents as $value) 
			{
				$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);				
				
				if($end_array['hb'] <= 8.0)
				{
					array_push($requests_array, $value);
				}else if($end_array['hb'] >= 12.0 && $end_array['hb'] <= 18.0)
				{
					array_push($requests_array_normal, $value);			
				}else if($end_array['hb'] >= 8.1 && $end_array['hb'] <= 10.0)
				{
					array_push($requests_array_moderate, $value);
				}else if($end_array['hb'] >= 10.1 && $end_array['hb'] < 12.0)
				{
					array_push($requests_array_mild, $value);
				}

			}
			$request ['label'] = 'SEVERE';
			$request ['value'] = count($requests_array);
			array_push ( $requests, $request );
			$request ['label'] = 'NORMAL';
			$request ['value'] = count($requests_array_normal);
			array_push ( $requests, $request );
			$request ['label'] = 'MODERATE';
			$request ['value'] = count($requests_array_moderate);
			array_push ( $requests, $request );
			$request ['label'] = 'MILD';
			$request ['value'] = count($requests_array_mild);
			array_push ( $requests, $request );
						
			return $requests;

		}else if ($school_name == "All") {
			if ($district_name != "select") {	

				$query = array('doc_data.widget_data.school_details.District' => $district_name,
				'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Gender' => (!empty($student_type) && isset($student_type)) ? $student_type : array('$exists' => true),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
			$documents = $this->mongo_db->select(array('doc_data.widget_data'))->where($query)->get($this->hb_app_col);
			
			foreach ($documents as $value) 
			{
				$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);				
				
				if($end_array['hb'] <= 8.0)
				{
					array_push($requests_array, $value);
				}else if($end_array['hb'] >= 12.0 && $end_array['hb'] <= 18.0)
				{
					array_push($requests_array_normal, $value);			
				}else if($end_array['hb'] >= 8.1 && $end_array['hb'] <= 10.0)
				{
					array_push($requests_array_moderate, $value);
				}else if($end_array['hb'] >= 10.1 && $end_array['hb'] < 12.0)
				{
					array_push($requests_array_mild, $value);
				}

			}
			$request ['label'] = 'SEVERE';
			$request ['value'] = count($requests_array);
			array_push ( $requests, $request );
			$request ['label'] = 'NORMAL';
			$request ['value'] = count($requests_array_normal);
			array_push ( $requests, $request );
			$request ['label'] = 'MODERATE';
			$request ['value'] = count($requests_array_moderate);
			array_push ( $requests, $request );
			$request ['label'] = 'MILD';
			$request ['value'] = count($requests_array_mild);
			array_push ( $requests, $request );
						
			return $requests;
			} 
		} 		
		return $requests;
	}
	public function get_hb_submitted_schools_list($current_month,$district_name,$dist_id)
	{
		
		// Variables
		$all_schools               = array();
		$all_schools_district      = array();
		$all_schools_name      	   = array();
		
		$submitted_schools 	       = array();
		$submitted_school_district = array();
		$submitted_school_name     = array();
		$not_submitted_schools	   = array();
		$schools_data              = array();
		$not_submitted_dist        = array();
		
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$schools_list = $this->mongo_db->whereLike('dt_name',$dist_id)->get ( $this->collections ['ttwreis_schools'] );
		
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
	
		$query = $this->mongo_db->select(array('doc_data.widget_data.school_details'))->whereLike('doc_data.widget_data.page1.Student Details.HB_values.month',$selected_month)->where(array('doc_data.widget_data.school_details.District' => $district_name))->get($this->hb_app_col);
		
		
		foreach ( $query as $doc ) {
			
			    if(!in_array($doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'], $submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['school_details'] ['District']);
					array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] );
					
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		   $dist_array    = explode(",",$school_name);
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		   
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		
		
		
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		return $schools_data;
		
	}
	public function get_drill_down_to_hb_report($type, $current_month, $district_name, $school_name = "All", $student_type =false, $student_age = false) 
	{
		$current_month = substr($current_month,0,-3);

		if ($current_month) {
			$selected_month = $current_month;
		} else {
			$selected_month = $this->selected_month;
		}
		ini_set ( 'memory_limit', '10G' );
		if($district_name == "select" && $school_name == "select")
		{		$query = array();
				switch ($type) {
				case "SEVERE" :
					$query_severe = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$lte' => 8.0),
						'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
						'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($query_severe)->get ( $this->hb_app_col );						
					
					foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] <= 8.0)
						{
							array_push($query, $value);
						}
					}
					//log_message('error', 'queryqueryqueryqueryquery========================'.print_r($query, true));
					return $this->get_drilling_hb_students_prepare_pie_array ( $query,$school_name, $type );
					break;
					
				case "NORMAL" :
				ini_set ( 'memory_limit', '10G' );
				$query_normal = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 12.0,'$lte' => 18.0),
						'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
					'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($query_normal)->get ( $this->hb_app_col );		

					foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 12.0 && $end_array['hb'] <= 18.0)
						{
							array_push($query, $value);
						}
					}			
										
					return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
					break;
				
				case "MODERATE" :
				ini_set ( 'memory_limit', '10G' );
				$query_moderate = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 8.1,'$lte' => 10.0),
						'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
					'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
				
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($query_moderate)->get ( $this->hb_app_col );	

					foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 8.1 && $end_array['hb'] <= 10.0)
						{
							array_push($query, $value);
						}
					}				
					
					return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
					break;
					
				case "MILD" :
				ini_set ( 'memory_limit', '10G' );
				$query_mild = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 10.1,'$lt' => 12.0),
						'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
					'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
				
					$docs = $this->mongo_db->select ( array (
							"doc_data" 
					) )->where($query_mild)->get ( $this->hb_app_col );	

					foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 10.1 && $end_array['hb'] < 12.0)
						{
							array_push($query, $value);
						}
					}				
					
					return $this->get_drilling_hb_students_prepare_pie_array ( $query,$school_name,  $type );
					break;
				
				default :
					;
					break;
		}
		}else{
			$query = array();
			switch ($type) {

			case "SEVERE" :
				$query_severe = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$lte' => 8.0),
					'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
				$docs = $this->mongo_db->select ( array (
						"doc_data" 
				) )->where($query_severe)->get ( $this->hb_app_col );	
				foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] <= 8.0)
						{
							array_push($query, $value);
						}
					}
									
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if(isset($doc ['doc_data'] ['widget_data']['school_details']))
							{
								if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
								}
							}else{
								if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
								}
							}	
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}							
					}
					$query = $doc_query;
					
				}
				return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
				break;
				
			case "NORMAL" :
			ini_set ( 'memory_limit', '10G' );
			$query_normal = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 12.0,'$lte' => 18.0),
					'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
				$docs = $this->mongo_db->select ( array (
						"doc_data" 
				) )->where($query_normal)->get ( $this->hb_app_col );

				foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 12.0 && $end_array['hb'] <= 18.0)
						{
							array_push($query, $value);
						}
					}
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {

						if(isset($doc ['doc_data'] ['widget_data']['school_details']))
							{
								if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
								}
							}else{
								if (strtolower ( $doc ['doc_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
								}
							}							
							
						}
						$query = $doc_query;
						
					} else {
						
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					
					$query = $doc_query;
				}
				
				return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
				break;
			
			case "MODERATE" :
			ini_set ( 'memory_limit', '10G' );
			$query_moderate = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 8.1,'$lte' => 10.0),
					'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
			
				$docs = $this->mongo_db->select ( array (
						"doc_data" 
				) )->where($query_moderate)->get ( $this->hb_app_col );

				foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 8.1 && $end_array['hb'] <= 10.0)
						{
							array_push($query, $value);
						}
					}
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
				break;
				
			case "MILD" :
			ini_set ( 'memory_limit', '10G' );
			$query_mild = array('doc_data.widget_data.page1.Student Details.Gender' => ($student_type) ? $student_type : array('$exists' => true),'doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$gte' => 10.1,'$lte' => 12.0),
					'doc_data.widget_data.page1.Student Details.HB_values.month' => array('$regex' => $selected_month),
				'doc_data.widget_data.page1.Student Details.Age' => (!empty($student_age) && $student_age != "select" && intval($student_age) != 0 ) ? intval($student_age) : array('$exists' => true));
			
				$docs = $this->mongo_db->select ( array (
						"doc_data" 
				) )->where($query_mild)->get ( $this->hb_app_col );

				foreach ($docs as $value) {
						$end_array = end($value['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
						if($end_array['hb'] >= 10.1 && $end_array['hb'] < 12.0)
						{
							array_push($query, $value);
						}
					}
				
				$doc_query = array ();
				if ($school_name == "All") {
					if ($district_name != "select") {
						foreach ( $query as $doc ) {
							if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['District'] ) == strtolower ( $district_name )) {
								array_push ( $doc_query, $doc );
							}
						}
						$query = $doc_query;
					} else {
					}
				} else {
					foreach ( $query as $doc ) {
						
						if (strtolower ( $doc ['doc_data'] ['widget_data'] ['school_details'] ['School Name'] ) == strtolower ( $school_name )) {
							array_push ( $doc_query, $doc );
						}
					}
					$query = $doc_query;
				}
				return $this->get_drilling_hb_students_prepare_pie_array ( $query, $school_name, $type );
				break;
			
			default :
				;
				break;
		}
		}
	}
	public function get_drilling_hb_students_prepare_pie_array($query, $school_name, $type)
	{
		$search_result = [ ];
		$count = 0;
		
		 if ($query) {
			
			$request = [ ];
			$UI_arr = [ ];
			foreach ( $query as $doc ) {
				
				
				switch ($type) {
					case "SEVERE" :
					
						$hb_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						$UI_arr = array_merge ( $UI_arr, $hb_ids_arr );
						
						break;
					case "NORMAL" :
						
						$hb_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
					
						$UI_arr = array_merge ( $UI_arr, $hb_ids_arr );
						
						break;
					
					case "MODERATE" :
						
						$hb_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						
						$UI_arr = array_merge ( $UI_arr, $hb_ids_arr );
						
						break;
						
					case "MILD" :
						
						$hb_ids_arr = explode ( " ", $doc ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'] );
						
						$UI_arr = array_merge ( $UI_arr, $hb_ids_arr );
						
						break;
						
					default :
					break;
				}
		 }
		
			return $UI_arr;
		}
	}
	public function get_drilling_hb_students_docs($_id_array) 
	 {
		$hb_request = array ();
		//set_time_limit(0);
		ini_set ( 'memory_limit', '10G' );
		
		if(isset($_id_array) && !empty($_id_array))
		{
			foreach ( $_id_array as $_id ) 
			{
				$query = $this->mongo_db->select ( array (
						'doc_data.widget_data.page1.Student Details','doc_data.widget_data.school_details'
				) )->where( "doc_data.widget_data.page1.Student Details.Hospital Unique ID", $_id )->get ( $this->hb_app_col );
				
				foreach ( $query as $hb_docs )
					{
						$unique_id = $hb_docs ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['Hospital Unique ID'];
						$doc = $this->mongo_db->where ( 'doc_data.widget_data.page1.Student Details.Hospital Unique ID', $unique_id )->get ( $this->hb_app_col);
						
						if (isset ( $doc ) && ! empty ( $doc ) && (count ( $doc ) > 0)) {
								$hb ['student_info'] = $hb_docs;
								$hb ['HB_latest'] = $doc [0] ['doc_data'] ['widget_data'] ['page1'] ['Student Details'] ['HB_latest'];
								//$hb['hb_id'] = $doc[0]['_id'];
								
								array_push ( $hb_request, $hb );
						}
					}
		}
	
		return $hb_request;
	}
	}
	public function get_student_hb_graph_values($hospital_unique_id)
	{
		$query = $this->mongo_db->select(array('doc_data.widget_data'))->where( array('doc_data.widget_data.page1.Student Details.Hospital Unique ID' => $hospital_unique_id))->get($this->hb_app_col);
		
		
		if($query)
			return $query;
	    else
			return FALSE;
	}

	public function get_sevier_count($type)
	{
		$final_values_6 = array();
		$final_values_8 = array();
		$final_values_10_12 = array();
		$final_values_8_10 = array();
		$query = $this->mongo_db->select(array('doc_data.widget_data.page1.Student Details.HB_values'))->where(array('doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$exists' => true),'doc_data.widget_data.page1.Student Details.Gender' => ($type != "All") ? $type : array('$exists' => true)))->get($this->hb_app_col);
		
		foreach ($query as $hb_values)
		{
			$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
			if($end_hb['hb'] <= 6 )
			{
				array_push($final_values_6, $hb_values);
			}else if ($end_hb['hb'] > 6 && $end_hb['hb'] <= 8)
			{
				array_push($final_values_8, $hb_values);
			}else if($end_hb['hb'] > 10 && $end_hb['hb'] <= 12)
			{
				array_push($final_values_10_12, $hb_values);				
			}else if($end_hb['hb'] > 8 && $end_hb['hb'] <= 10) 
			{
				array_push($final_values_8_10, $hb_values);
			}
					
		}

			$final_data['below_6_hb_values'] = count($final_values_6);
			$final_data['sevier'] = count($final_values_8);
			$final_data['mild'] = count($final_values_10_12);
			$final_data['moderate'] = count($final_values_8_10);
		/*$final_data['below_6_hb_values'] = count($final_values);

		$query = $this->mongo_db->whereLt('doc_data.widget_data.page1.Student Details.HB_values.hb',8)->get($this->hb_app_col);
		foreach ($query as $hb_values)
		{
			$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
			if($end_hb['hb'] <= 8 )
			{
				array_push($final_values, $hb_values);
			}
					
		}
		$final_data['sevier'] = count($final_values);

		$query = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_values.hb',10.1,12.0)->get($this->hb_app_col);

		foreach ($query as $hb_values)
		{
			$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
			if($end_hb['hb'] >= 10 || $end_hb['hb'] <= 12 )
			{
				array_push($final_values, $hb_values);
			}
					
		}
		$final_data['mild'] = count($final_values);

		$query = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_values.hb',8.1,10)->get($this->hb_app_col);
		foreach ($query as $hb_values)
		{
			$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
			if($end_hb['hb'] >= 8 || $end_hb['hb'] <= 10 )
			{
				array_push($final_values, $hb_values);
			}
					
		}
		$final_data['moderate'] = count($final_values);*/

		if(!empty($final_data))
		{
			return $final_data;
		}else{
			return FALSE;
		}
	}

	public function get_bmi_count()
	{
		$query['below_14_bmi_values'] = $this->mongo_db->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"14")->count($this->bmi_app_col);

		$query['under_weight'] = $this->mongo_db->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"18.5")->count($this->bmi_app_col);

		$query['over_weight'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"25.00","29.99")->count($this->bmi_app_col);

		$query['obese'] = $this->mongo_db->wheregte('doc_data.widget_data.page1.Student Details.BMI_values.bmi',"30")->count($this->bmi_app_col);


		if(!empty($query))
		{
			return $query;
		}else{
			return FALSE;
		}
	}

	public function get_screened_count()
	{
		
		$Page3Exists = array (
						"doc_data.widget_data.page3.Physical Exam" => array (
								'$exists' => true
						)
		);
		$Page4Exists = array (
						"doc_data.widget_data.page4.Doctor Check Up" => array (
								'$exists' => true
						)
		);
		$qry = $this->mongo_db->where($Page4Exists,$Page3Exists)->count($this->screening_app_col);

		if($qry){
			return $qry;
		}else{
			return FALSE;
		}

			
	}

	public function get_attendance_count()
	{
		$date = $this->today_date;

		$query = $this->mongo_db->whereLike('history.last_stage.time',$date)->count($this->absent_app_col);

		if($query){
			return $query;
		}else{
			return FALSE;
		}
	}
	public function get_sanitation_count()
	{
		$date = $this->today_date;

		$query = $this->mongo_db->whereLike('history.last_stage.time',$date)->count($this->sanitation_app_col_v2);

		if($query){
			return $query;
		}else{
			return FALSE;
		}
	}
	public function get_chronic_asthma_count()
	{
		$date = $this->today_date;

		$query['chronic'] = $this->mongo_db->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['anemia'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Blood' => "Anaemia"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['tb'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Others' => "TB"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['asthma'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Respiratory_system' => "Asthma"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['scabies'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Skin' => "Scabies"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['epilepsy'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Central_nervous_system' => "Epilepy"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['hypothyroidism'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Endo' => "Hypothyroidism"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['hiv'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Others' => "HIV"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');

		$query['diabetese'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Endo' => "Diabetes Milletus Type 1"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->count('healthcare2016108181933756_static_html');
		//echo print_r($query,TRUE);exit();
		if($query){
			return $query;
		}else{
			return FALSE;
		}
	}
	public function get_total_emergency_req_count()
	{
		$query['total_emergency_req_count'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->count("healthcare2016108181933756_static_html");

		$query['out_patient_total_count'] = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Out Patients"))->count("ttwreis_field_officer_report");

		$query['admitted_total_count'] = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Emergency or Admitted"))->count("ttwreis_field_officer_report");

		$query['review_cases_total_count'] = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Review Cases"))->count("ttwreis_field_officer_report");

		$query['doctor_visits_total_count'] = $this->mongo_db->count("ttwreis_doctor_visiting_reports");

		if($query){
			return $query;
		}else{
			return FALSE;
		}
	}

	public function get_bmi_students_docs($bmi_type)
	{
		switch ($bmi_type) {
			case 'Below 14 BMI Count ':
		
				$query = $this->mongo_db->limit(100)->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',14)->get($this->bmi_app_col);

				return $query;
				break;

				case 'Under Weight Count ':
				$query = $this->mongo_db->limit(100)->whereLt('doc_data.widget_data.page1.Student Details.BMI_values.bmi',18.5)->get($this->bmi_app_col);
				return $query;
				break;

				case 'Over Weight Count ':
				$query = $this->mongo_db->limit(100)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_values.bmi',25.00,29.99)->get($this->bmi_app_col);
				return $query;
				break;

				case 'Obese Count ':
				$query = $this->mongo_db->limit(100)->wheregte('doc_data.widget_data.page1.Student Details.BMI_values.bmi',30)->get($this->bmi_app_col);
				return $query;
				break;
			
			default:
				# code...
				break;
		}
	}
	public function get_hb_students_docs($hb_type)
	{
		//echo print_r($_POST, true); exit();
		$final_values = array();
		switch ($hb_type) {
			case 'Critical Anemia Cases Count ':
				$query = $this->mongo_db->select(array('doc_data.widget_data'))->where(array('doc_data.widget_data.page1.Student Details.HB_values.hb' => array('$lte' => 6)))->get($this->hb_app_col);
				
				foreach ($query as $hb_values) {
					$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
					if($end_hb['hb'] <= 6 )
					{
						array_push($final_values, $hb_values);
					}
					
				}
				return $final_values;
				break;

			case 'Severe Anemia Cases Count ':
				$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_values.hb',6,8)->get($this->hb_app_col);
				foreach ($query as $hb_values) 
				{
					$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
					if($end_hb['hb'] > 6 && $end_hb['hb'] <= 8 )
					{
						array_push($final_values, $hb_values);
					}

				}
				
				//echo print_r($final_values, true);
				
				return $final_values;
				break;

			case 'Mild Anemia Cases Count ':
				$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_values.hb',10.1,12.0)->get($this->hb_app_col);
				foreach ($query as $hb_values) {
					$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);

					if($end_hb['hb'] > 10 &&  $end_hb['hb'] <= 12.0)
					{
						array_push($final_values, $hb_values);
					}
					
				}
				
				return $final_values;
				break;

			case 'Moderate Anemia Cases Count ':
				$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_values.hb',8.1,10)->get($this->hb_app_col);
				foreach ($query as $hb_values) {
					$end_hb = end($hb_values['doc_data']['widget_data']['page1']['Student Details']['HB_values']);
					if($end_hb['hb'] > 8 && $end_hb['hb'] <= 10)
					{
						array_push($final_values, $hb_values);
					}
					
				}
				return $final_values;
				break;
			
			default:
				# code...
				break;
		}
	}

	public function get_study_circle_data_model($uid) {

		
		$query = $this->mongo_db->limit(1)->select ( array (
				'doc_data.widget_data',
				'doc_data.chart_data',
				'doc_data.external_attachments',
				'history' 
		) )->whereLike ( "doc_data.widget_data.page1.Personal Information.Hospital Unique ID", $uid )->get ( $this->screening_app_col_tt_2021_2022 );
		//log_message("debug","update personal Info for modelllllll114816".print_r($query,true));
		 if ($query) {
			
			$result ['screening'] = $query;
			///$result ['request'] = $query_request;
			return $result;
		} else {
			$result ['screening'] = false;
			//$result ['request'] = false;
			return $result;
		} 
	}

	public function get_chronic_students_docs($chronic_type)
	{
		/*var_dump($chronic_type);
		exit;*/
		switch ($chronic_type) {
			case 'Anemia':
		
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Blood' => "Anaemia"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'TB':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Others' => "TB"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'Asthma':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Respiratory_system' => "Asthma"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'Scabies':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Skin' => "Scabies"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'Epilepsy':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Central_nervous_system' => "Epilepy"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;
				
				case 'Hypothyroidism':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Endo' => "Hypothyroidism"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'HIV':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Others' => "HIV"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

				case 'Diabetes':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Endo' => "Diabetes Milletus Type 1"))->whereLike('doc_data.widget_data.page2.Review Info.Request Type',"Chronic")->get('healthcare2016108181933756_static_html');
				return $query;
				break;

			default:
				# code...
				break;
		}
	}
	public function get_field_officer_req_students_docs($fieldOfficerReq)
	{

		switch ($fieldOfficerReq) {
				case 'Out Patient':
				$query = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Out Patients"))->get("ttwreis_field_officer_report");
				return $query;
				break;

				case 'Admitted Cases':
				$query = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Emergency or Admitted"))->get("ttwreis_field_officer_report");
				return $query;
				break;

				case 'Review Cases':
				$query = $this->mongo_db->where(array('doc_data.widget_data.type_of_request' => "Review Cases"))->get("ttwreis_field_officer_report");
				return $query;
				break;

				case 'Doctor Visits':
				$query = $this->mongo_db->get("ttwreis_doctor_visiting_reports");
				return $query;
				break;

			default:
				break;
		}
	}

	public function get_emergency_req_students_docs($emergencyReq)
	{
		$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get('healthcare2016108181933756_static_html');
		return $query;
	}
	/************************** request pie chart ##author Suman reddy start**********************************/
	public function get_schools_by_dist($dist_id) {

		if ($dist_id == "All") {
			ini_set ( 'memory_limit', '10G' );
			
			$count = $this->mongo_db->count ( $this->screening_app_col );
			if ($count < 10000) {
				$per_page = $count;
				$loop = 2; // $count / $per_page;
			} else {
				$per_page = 10000;
				$loop = $count / $per_page;
			}
			
			$result = [ ];
			for($page = 1; $page < $loop; $page ++) {
				$offset = $per_page * ($page);
				$pipeline = [ 
						array (
								'$project' => array (
										"doc_data.widget_data.page1" => true,
										"doc_data.widget_data.page2" => true 
								) 
						),
						array (
								'$limit' => $offset 
						),
						array (
								'$skip' => $offset - $per_page 
						) 
				];
				$response = $this->mongo_db->command ( array (
						'aggregate' => $this->screening_app_col,
						'pipeline' => $pipeline 
				) );
				$result = array_merge ( $result, $response ['result'] );
			}
			return $result;
		} else {
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$query = $this->mongo_db->select ( array (
					'school_name',
					'school_code',
					'school_mob',
					'contact_person_name' 
			) )->orderBy ( array (
					'school_name' => 1 
			) )->where (array('school_name' => array('$regex' => $dist_id )))->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			return $query;
		}
	}
	public function get_monthly_request_by_month($date_month,$school_name,$dt_name)
	{
		$date_month = substr($date_month,0,-3);
		
		$normal_request_counts = array();
		$normal_diease = array();
		$emergency_diease = array();
		$chronic_diease = array();
		
		$emergency_request_counts = array();
		$chronic_request_counts = array();
		
		if($school_name == "All" && $dt_name == "All")
		{
			$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereLike("history.0.time" , $date_month)->get('healthcare2016108181933756_static_html');			

			foreach ($query as $request_type)
			{
				$type = $request_type['doc_data']['widget_data']['page2']['Review Info']['Request Type'];
				
						
				switch ($type) {
					case 'Normal':					
						array_push($normal_request_counts, $type);
						$types['normal'] = count($normal_request_counts);
						$normal = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Normal'];
						array_push($normal_diease, $normal);
						$types['disease_normal'] = $normal_diease;
						break;
					case 'Emergency':					
						array_push($emergency_request_counts, $type);
						$types['emergency'] = count($emergency_request_counts);
						$emergency = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Emergency'];
						array_push($emergency_diease, $emergency);
						$types['disease_emergency'] = $emergency_diease;

						break;	
					case 'Chronic':					
						array_push($chronic_request_counts, $type);
						$types['chronic'] = count($chronic_request_counts);
						$chronic = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Chronic'];
						array_push($chronic_diease, $chronic);
						$types['disease_chronic'] = $chronic_diease;
						break;
					
					default:
						;
						break;
				}
				
			}
			if($types)
			{
				return $types;
			}else{
				return FALSE;
			}	
		}

		if($dt_name != "All" && $school_name == "All")
		{
			$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereLike("history.0.time" , $date_month)->where(array('doc_data.widget_data.page1.Student Info.District.field_ref' => $dt_name))->get('healthcare2016108181933756_static_html');			
			if(!empty($query) && isset($query))
			{
				foreach ($query as $request_type)
				{
					$type = $request_type['doc_data']['widget_data']['page2']['Review Info']['Request Type'];
					
							
					switch ($type) {
						case 'Normal':					
							array_push($normal_request_counts, $type);
							$types['normal'] = count($normal_request_counts);
							$normal = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Normal'];
							array_push($normal_diease, $normal);
							$types['disease_normal'] = $normal_diease;
							

							break;
						case 'Emergency':					
							array_push($emergency_request_counts, $type);
							$types['emergency'] = count($emergency_request_counts);
							$emergency = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Emergency'];
							array_push($emergency_diease, $emergency);
							$types['disease_emergency'] = $emergency_diease;

							break;	
						case 'Chronic':					
							array_push($chronic_request_counts, $type);
							$types['chronic'] = count($chronic_request_counts);
							$chronic = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Chronic'];
							array_push($chronic_diease, $chronic);
							$types['disease_chronic'] = $chronic_diease;
							break;
						
						default:
							;
							break;
					}
					
				}
			}else
			{
				$types['no_data'] = "No Data is Availability";
			}
			if($types)
			{
				return $types;
			}else{
				return FALSE;
			}
		}
		if($dt_name != "All" && $school_name != "All")
		{
			$query = $this->mongo_db->select(array('doc_data.widget_data'))->whereLike("history.0.time" , $date_month)->where(array('doc_data.widget_data.page1.Student Info.District.field_ref' => $dt_name,'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->get('healthcare2016108181933756_static_html');	
			
		  if(!empty($query) && isset($query))
		   {
			foreach ($query as $request_type)
			{
				$type = $request_type['doc_data']['widget_data']['page2']['Review Info']['Request Type'];
				
						
				switch ($type) {
					case 'Normal':					
						array_push($normal_request_counts, $type);
						$types['normal'] = count($normal_request_counts);
						$normal = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Normal'];
						array_push($normal_diease, $normal);
						$types['disease_normal'] = $normal_diease;
						break;
					case 'Emergency':					
						array_push($emergency_request_counts, $type);
						$types['emergency'] = count($emergency_request_counts);
						$emergency = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Emergency'];
						array_push($emergency_diease, $emergency);
						$types['disease_emergency'] = $emergency_diease;

						break;	
					case 'Chronic':					
						array_push($chronic_request_counts, $type);
						$types['chronic'] = count($chronic_request_counts);
						$chronic = $request_type['doc_data']['widget_data']['page1']['Problem Info']['Chronic'];
						array_push($chronic_diease, $chronic);
						$types['disease_chronic'] = $chronic_diease;
						break;
					
					default:
						;
						break;
				}
				
			}
		  }else
			{
				$types['no_data'] = "No Data is Availability";
			}
			if($types)
			{
				return $types;
			}else{
				return FALSE;
			}
		}

		
		
		
	}
	public function drill_down_chronic_student_list($chronic_symtom)
	{
		$chronic_sym = explode(".", $chronic_symtom);
		$month = substr($chronic_sym[2], 0,-3);
		
		
		if($chronic_sym[3] == "All" && $chronic_sym[4] == "All")
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Chronic.".$chronic_sym[0] => $chronic_sym[1],'history.0.time' => array('$regex' => $month));			
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($chronic_sym[3] != "All" && $chronic_sym[4] == "All") 
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Chronic.".$chronic_sym[0] => $chronic_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $chronic_sym[3]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($chronic_sym[3] != "All" && $chronic_sym[4] != "All")
		{
			
			$serch = array("doc_data.widget_data.page1.Problem Info.Chronic.".$chronic_sym[0] => $chronic_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $chronic_sym[3],'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $chronic_sym[4]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}
		
		return $query;			
	}
	public function drill_down_emergency_student_list($emergency_symtom)
	{	
		
		$emergency_sym = explode(".", $emergency_symtom);
		$month = substr($emergency_sym[2], 0,-3);
		if($emergency_sym[3] == "All" && $emergency_sym[4] == "All")
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Emergency.".$emergency_sym[0] => $emergency_sym[1],'history.0.time' => array('$regex' => $month));			
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($emergency_sym[3] != "All" && $emergency_sym[4] == "All") 
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Emergency.".$emergency_sym[0] => $emergency_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $emergency_sym[3]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($emergency_sym[3] != "All" && $emergency_sym[4] != "All")
		{
			
			$serch = array("doc_data.widget_data.page1.Problem Info.Emergency.".$emergency_sym[0] => $emergency_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $emergency_sym[3],'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $emergency_sym[4]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}
		
		
		return $query;			
	}
	public function drill_down_normal_student_list($normal_symtom)
	{

		$normal_sym = explode(".", $normal_symtom);
		$month = substr($normal_sym[2], 0,-3);
		if($normal_sym[3] == "All" && $normal_sym[4] == "All")
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Normal.".$normal_sym[0] => $normal_sym[1],'history.0.time' => array('$regex' => $month));			
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($normal_sym[3] != "All" && $normal_sym[4] == "All") 
		{			
			$serch = array("doc_data.widget_data.page1.Problem Info.Normal.".$normal_sym[0] => $normal_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $normal_sym[3]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}else if($normal_sym[3] != "All" && $normal_sym[4] != "All")
		{
			
			$serch = array("doc_data.widget_data.page1.Problem Info.Normal.".$normal_sym[0] => $normal_sym[1],'history.0.time' => array('$regex' => $month),'doc_data.widget_data.page1.Student Info.District.field_ref' => $normal_sym[3],'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $normal_sym[4]);		
			$query = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where($serch)->get('healthcare2016108181933756_static_html');
		}
		
		return $query;			
	}

	public function get_all_students_count()
	{
		$females_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(G).,', '$options' => 'i'))));
    	$males_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(B).,', '$options' => 'i'))));
    	$gender['female'] = count($females_count['values']);
    	$gender['male'] = count($males_count['values']);
    	$gender['total_students'] = count($males_count['values']) + count($females_count['values']);
    	
		//$query = $this->mongo_db->count('healthcare2016226112942701');

		return $gender;
	}

	public function get_total_requests()
	{
		$data['total_req_count'] = $this->mongo_db->select(array())->whereNe(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Defects','doc_data.widget_data.page2.Review Info.Request Type' => 'Deficiency','doc_data.widget_data.page2.Review Info.Request Type' => "",'doc_data.widget_data.page2.Review Info.Request Type' => false))->count($this->request_app_col_static_html);
		
		$data['normal_req_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->count($this->request_app_col_static_html);

		$data['normal_req_count_not_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal'))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count($this->request_app_col_static_html);

		$data['normal_req_count_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal'))->where(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count($this->request_app_col_static_html);

		$data['emergency_req_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency'))->count($this->request_app_col_static_html);

		$data['emergency_req_count_not_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency'))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->count($this->request_app_col_static_html);

		$data['emergency_req_count_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency'))->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->count($this->request_app_col_static_html);

		$data['chronic_req_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->count($this->request_app_col_static_html);

		$data['chronic_req_count_not_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic'))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->count($this->request_app_col_static_html);

		$data['chronic_req_count_cured'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic'))->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->count($this->request_app_col_static_html);
		return $data;
	}
	 

	  public function check_unique_id_is_exists($school_name)
	{
		$greater_unique_id = [];
		$number_passed_out_unique = 0;
		//$unique_id_for_latest_col = $this->mongo_db->command(array('distinct' => $this->screening_app_col ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=> array('doc_data.widget_data.page2.Personal Information.School Name' => $school_name )));
		$unique_id_for_latest_col = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name))->select(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID'),array())->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->get($this->screening_app_col);
		
		foreach ($unique_id_for_latest_col as $unique_ids)
		{
			$unique_ids = $unique_ids['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'];
			if(preg_match('/STAFF/i', $unique_ids) || preg_match('/Staff/i', $unique_ids))
			{

			}else
			{
				$unique_id = explode("_", $unique_ids);
				$num_length = strlen((string)$unique_id[2]);
				if($num_length >= 4)
				{
					$last_id = $unique_id[2];
				}
				
			}
		}
		$latest_id = intval($last_id);
		$last_unique_id = $unique_id[0]."_".$unique_id[1]."_".$latest_id;
		//$number_latest_unique = max($unique_id_for_latest_col['values']);


		//$unique_id_for_passed_out_col = $this->mongo_db->command(array('distinct' => "healthcare2016226112942701_divided_passed_out" ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=> array('doc_data.widget_data.page2.Personal Information.School Name' => $school_name )));
		$unique_id_for_passed_out_col = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name))->select(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID'),array())->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->get('healthcare201671115519757_divided_passed_out');
		
		if(isset($unique_id_for_passed_out_col) && !empty($unique_id_for_passed_out_col))
		{
			foreach ($unique_id_for_passed_out_col as $unique_ids_out) 
			{
				$unique_ids_out = $unique_ids_out['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'];
				if(preg_match('/STAFF/i', $unique_ids_out) || preg_match('/Staff/i', $unique_ids_out))
				{

				}else
				{
					$unique_id_out = explode("_", $unique_ids_out);
					$num_length_out = strlen((string)$unique_id_out[2]);
					if($num_length_out >= 4)
					{
						$last_id_out = $unique_id_out[2];
					}
					
				}
			}
			//$number_passed_out_unique = max($unique_id_for_passed_out_col['values']);	
			$latest_id_out = intval($last_id_out);
			$last_id_out = $unique_id_out[0]."_".$unique_id_out[1]."_".$latest_id_out;
			if($last_unique_id > $last_id_out)
			{
				return $last_unique_id;
			}else
			{
				return $last_id_out;
			}
		}
		return $last_unique_id;
				
	}


	/* For new students bulk import getting last unique id new pattern */
	
		public function check_last_unique_id_exists_in_school($school_name)
	{
		$all_list = array();

		$all_uniqueID = $this->mongo_db->select(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID'),array())->whereLike('doc_data.widget_data.page2.Personal Information.School Name' , $school_name)->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->get('ttwreis_screening_report_col_2021-2022');
		if(!empty($all_uniqueID)){
			foreach ($all_uniqueID as $data1) {
				$uniques1 = $data1['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'];
				array_push($all_list, $uniques1);
			}
		}

		$all_uniqueID_frm_pasout = $this->mongo_db->select(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID'),array())->whereLike('doc_data.widget_data.page2.Personal Information.School Name' , $school_name)->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->get('ttwreis_screening_report_col_2021-2022_passed_out');
		if(!empty($all_uniqueID_frm_pasout)){
			foreach ($all_uniqueID_frm_pasout as $data2) {
				$uniques2 = $data2['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'];
				if(!in_array($uniques2, $all_list)){
					array_push($all_list, $uniques2);
				}
			}
		}

		$all_uniqueID_frm_otherscls = $this->mongo_db->select(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID'),array())->whereLike('doc_data.widget_data.page2.Personal Information.School Name' , $school_name)->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->get('ttwreis_other_classes_screening_data_2020-2021');
		if(!empty($all_uniqueID_frm_otherscls)){
			foreach ($all_uniqueID_frm_otherscls as $data3) {
				$uniques3 = $data3['doc_data']['widget_data']['page1']['Personal Information']['Hospital Unique ID'];
				if(!in_array($uniques3, $all_list)){
					array_push($all_list, $uniques3);
				}
			}
		}

		sort($all_list);
		$value = end($all_list);
	
		return $value;
	}


	public function show_field_officer_submit_student($doc_id)
    {
            $getSubmittedDocs = $this->mongo_db->where(array('doc_properties.doc_id'=>$doc_id))->get('ttwreis_field_officer_report');
            return $getSubmittedDocs;
    } 
	 public function show_doctor_visiting_reports($doc_id)
    {
            $getSubmittedDocs = $this->mongo_db->where(array('doc_properties.doc_id'=>$doc_id))->get('ttwreis_doctor_visiting_reports');
            return $getSubmittedDocs;
    }

    public function get_hb_submitted_schools_data_with_symptom($symptom_type, $gender_type)
	{
		$filtered_school_names = [];
		$hb_final = [];
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$all_schools = $this->mongo_db->select(array('school_name'))->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

		if($gender_type == 'Male'){
			foreach($all_schools as $school){
				
				if(preg_match('/(B)/', $school['school_name'])){
					array_push($filtered_school_names, $school);
				}
			
			}
		}else{
			foreach($all_schools as $schools){
				
				if(preg_match('/(G)/', $schools['school_name'])){
					array_push($filtered_school_names, $schools);
				}
			
			}
		}
		
		switch ($symptom_type) {
			case 'Severe':
			foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$severe = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->count('ttwreis_himglobin_report_col');

				if($severe != 0){
				$severe_cases['label'] = $scls_name;
				$severe_cases['value'] = intval($severe);
				$severe_cases['symptom'] = $symptom_type;
				$severe_cases['gender'] = $gender_type;
				array_push($hb_final, $severe_cases);
				}

			}
			return $hb_final;
			break;
			case 'Moderate' :
			foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$moderate = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->count('ttwreis_himglobin_report_col');

				if($moderate != 0){
				$moderate_cases['label'] = $scls_name;
				$moderate_cases['value'] = intval($moderate);
				$moderate_cases['symptom'] = $symptom_type;
				$moderate_cases['gender'] = $gender_type;
				array_push($hb_final, $moderate_cases);
				}

			}
			return $hb_final;
			break;

			case 'Mild':
				foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$mild = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->count('ttwreis_himglobin_report_col');

				if($mild != 0){
				$mild_cases['label'] = $scls_name;
				$mild_cases['value'] = intval($mild);
				$mild_cases['symptom'] = $symptom_type;
				$mild_cases['gender'] = $gender_type;
				array_push($hb_final, $mild_cases);
				}

			}
			return $hb_final;
			break;
			
			default:
				;
				break;
		}

	}


public function get_screening_hb_data_for_boys(){

		$hb_final = array();

		$severe = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Male')->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->count('ttwreis_himglobin_report_col');
		$severe_cases['label'] = "Severe";
		$severe_cases['value'] = intval($severe);
		array_push($hb_final, $severe_cases);

		$moderate = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Male')->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->count('ttwreis_himglobin_report_col');
		$moderate_cases['label'] = "Moderate";
		$moderate_cases['value'] = intval($moderate);
		array_push($hb_final, $moderate_cases);

		$mild = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Male')->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->count('ttwreis_himglobin_report_col');
		$mild_cases['label'] = "Mild";
		$mild_cases['value'] = intval($mild);
		array_push($hb_final, $mild_cases);

		//echo print_r($hb_final, true); exit();
		return $hb_final;
	}

	public function get_screening_hb_data_for_girls(){

		$hb_final = array();

		$severe = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->count('ttwreis_himglobin_report_col');
		$severe_cases['label'] = "Severe";
		$severe_cases['value'] = intval($severe);
		array_push($hb_final, $severe_cases);

		$moderate = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->count('ttwreis_himglobin_report_col');
		$moderate_cases['label'] = "Moderate";
		$moderate_cases['value'] = intval($moderate);
		array_push($hb_final, $moderate_cases);

		$mild = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->count('ttwreis_himglobin_report_col');
		$mild_cases['label'] = "Mild";
		$mild_cases['value'] = intval($mild);
		array_push($hb_final, $mild_cases);

		//echo print_r($hb_final, true); exit();
		return $hb_final;
	}

public function get_students_hb_list_scl_wise($school_name, $symptom_type, $gender_type)
	{

		switch ($symptom_type)
		{
			case 'Severe':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->get('ttwreis_himglobin_report_col');
				
				return $query;
				break;
			case 'Moderate':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->get('ttwreis_himglobin_report_col');
				return $query;
				break;

			case 'Mild':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->get('ttwreis_himglobin_report_col');
				return $query;
				break;
			default:
				;
				break;
		}

	}

	public function get_bmi_submitted_schools_data_with_symptom($symptom_type, $gender_type)
	{
		$filtered_school_names = [];
		$bmi_final = [];
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$all_schools = $this->mongo_db->select(array('school_name'))->get ( $this->collections ['ttwreis_schools'] );
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

		if($gender_type == 'Male'){
			foreach($all_schools as $school){
				
				if(preg_match('/(B)/', $school['school_name'])){
					array_push($filtered_school_names, $school);
				}
			
			}
		}else{
			foreach($all_schools as $schools){
				
				if(preg_match('/(G)/', $schools['school_name'])){
					array_push($filtered_school_names, $schools);
				}
			
			}
		}
		
		switch ($symptom_type) {
			case 'UNDER WEIGHT':
			foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$under_weight = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50)->count('healthcare2017619153715384');

				if($under_weight != 0){
				$under_weight_cases['label'] = $scls_name;
				$under_weight_cases['value'] = intval($under_weight);
				$under_weight_cases['symptom'] = $symptom_type;
				$under_weight_cases['gender'] = $gender_type;
				array_push($bmi_final, $under_weight_cases);
				}

			}
			return $bmi_final;
			break;
			case 'OVER WEIGHT' :
			foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$over_weight = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25.00,29.99)->count('healthcare2017619153715384');

				if($over_weight != 0){
				$over_weight_cases['label'] = $scls_name;
				$over_weight_cases['value'] = intval($over_weight);
				$over_weight_cases['symptom'] = $symptom_type;
				$over_weight_cases['gender'] = $gender_type;
				array_push($bmi_final, $over_weight_cases);
				}

			}
			return $bmi_final;
			break;

			case 'OBESE WEIGHT':
				foreach ($filtered_school_names as $scl) {
				$scls_name = $scl['school_name'];
				
				$obese_weight = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $scls_name ))->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->count('healthcare2017619153715384');

				if($obese_weight != 0){
				$obese_weight_cases['label'] = $scls_name;
				$obese_weight_cases['value'] = intval($obese_weight);
				$obese_weight_cases['symptom'] = $symptom_type;
				$obese_weight_cases['gender'] = $gender_type;
				array_push($bmi_final, $obese_weight_cases);
				}

			}
			return $bmi_final;
			break;
			
			default:
				;
				break;
		}

	}


	public function get_screening_bmi_data_for_boys(){

		$bmi_final = array();

		$under_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender','Male')->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50)->count('healthcare2017619153715384');
		$under_weight_cases['label'] = "UNDER WEIGHT";
		$under_weight_cases['value'] = intval($under_weight);
		array_push($bmi_final, $under_weight_cases);

		$over_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Male')->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25.00,29.99)->count('healthcare2017619153715384');
		$over_weight_cases['label'] = "OVER WEIGHT";
		$over_weight_cases['value'] = intval($over_weight);
		array_push($bmi_final, $over_weight_cases);

		$obese_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Male')->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->count('healthcare2017619153715384');
		$obese_weight_cases['label'] = "OBESE WEIGHT";
		$obese_weight_cases['value'] = intval($obese_weight);
		array_push($bmi_final, $obese_weight_cases);

		//echo print_r($hb_final, true); exit();
		return $bmi_final;
	}

	public function get_screening_bmi_data_for_girls(){

		$bmi_final = array();

		$under_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50)->count('healthcare2017619153715384');
		$under_weight_cases['label'] = "UNDER WEIGHT";
		$under_weight_cases['value'] = intval($under_weight);
		array_push($bmi_final, $under_weight_cases);

		$over_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25.00,29.99)->count('healthcare2017619153715384');
		$over_weight_cases['label'] = "OVER WEIGHT";
		$over_weight_cases['value'] = intval($over_weight);
		array_push($bmi_final, $over_weight_cases);

		$obese_weight = $this->mongo_db->where('doc_data.widget_data.page1.Student Details.Gender', 'Female')->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->count('healthcare2017619153715384');
		$obese_weight_cases['label'] = "OBESE WEIGHT";
		$obese_weight_cases['value'] = intval($obese_weight);
		array_push($bmi_final, $obese_weight_cases);

		//echo print_r($bmi_final, true); exit();
		return $bmi_final;
	}


public function get_students_bmi_list_scl_wise($school_name, $symptom_type, $gender_type)
	{

		switch ($symptom_type)
		{
			case 'UNDER WEIGHT':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50)->get('healthcare2017619153715384');
				
				return $query;
				break;
			case 'OVER WEIGHT':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25.00,29.99)->get('healthcare2017619153715384');
				return $query;
				break;

			case 'OBESE WEIGHT':
				$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender'=> $gender_type, 'doc_data.widget_data.school_details.School Name' => $school_name ))->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->get('healthcare2017619153715384');
				return $query;
				break;
			default:
				;
				break;
		}

	}


   public function ttwreis_covid_cases_model($passing_date)
    {

    	$get_details = $this->mongo_db->select('doc_data.widget_data')->whereLike('history.time', $passing_date)->where('doc_data.widget_data.page1.Problem Info.Emergency.Disease', 'Covid-19')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->get('healthcare2016108181933756_static_html');

        return $get_details;
    }

     public function ttwreis_covid_cured_cases_model($passing_date)
    {
    	$get_details = $this->mongo_db->select('doc_data.widget_data')->whereLike('history.time', $passing_date)->where(array('doc_data.widget_data.page1.Problem Info.Emergency.Disease' => 'Covid-19','doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->get('healthcare2016108181933756_static_html');

        return $get_details;
    }

    public function get_covid_cases_reports_span_model($start, $end)
    {
  
     $get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->where('doc_data.widget_data.page1.Problem Info.Emergency.Disease', 'Covid-19')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->get('healthcare2016108181933756_static_html');
     
     return $get_details;

    }

    public function get_covid_cured_cases_reports_span_model($start, $end)
    {
  
  $get_details = $this->mongo_db->select('doc_data.widget_data')->whereLike('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->where(array('doc_data.widget_data.page1.Problem Info.Emergency.Disease' => 'Covid-19' , 'doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->get('healthcare2016108181933756_static_html');
     
     return $get_details;

    }

    public function ttwreis_dr_not_responded_model($today_date)
   {	
   	
   	  $date = substr($today_date,0,-3);
   		
      $get_details = $this->mongo_db->where(array('history.time' => array('$regex' => $date)))->whereNe('history.current_stage','Doctor')->get('healthcare2016108181933756_static_html');
     
      return $get_details;
   }


   public function get_dr_not_responded_span_model($start, $end)
    {  
    	
    	$query = $this->mongo_db->whereBetween('history.time' , $start,$end)->whereNe('history.current_stage','Doctor')->get('healthcare2016108181933756_static_html');

    	//echo print_r($query, true); exit;
    	return $query;
    }

    public function get_excel_dr_not_responded_reports_model($start_date, $end_date)
	{
	
	$get_details = $this->mongo_db->whereBetween('history.time' , $start_date,$end_date)->whereNe('history.current_stage','Doctor')->get('healthcare2016108181933756_static_html');


 	return $get_details;
	}

	public function ttwreis_get_excel_covidcases_model($start_date, $end_date)
    {
    	$get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page1.Problem Info.Emergency.Disease', 'Covid-19')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->get('healthcare2016108181933756_static_html');
     
     return $get_details;
    }

	/******************end*********************************************************/

/************************ NEW Interface for admin DashBoard **********************************/

	public function get_doctor_names()
	{
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->select(array('username', 'email'))->where(array('email' => array('$regex' => "ttwreis.dr")))->get('ttwreis_doctors');
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		return $query;
	}

/*Request Info*/

	public function get_daily_request_for_bar($start_date, $end_date, $district_name, $school_name)
	{
		
		if($district_name == 'All' && $school_name == 'All'){

			
			if($start_date != $end_date)
			{
				$query['normal'] = $this->mongo_db->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->count('healthcare2016108181933756_static_html');

				$query['emergency'] = $this->mongo_db->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Emergency')->count('healthcare2016108181933756_static_html');

				$query['chronic'] = $this->mongo_db->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Chronic')->count('healthcare2016108181933756_static_html');

				$query['cured'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

				$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor');

				$docs = $this->mongo_db->select(array('history'))->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where($exists_doctor)->get($this->request_app_col_static_html);

				$doc_names= [];
				foreach ($docs as $data) {
					$his = end($data['history']);

					if($his['current_stage'] == "Doctor"){
						$docs = $his['submitted_by_name'];
						array_push($doc_names, $docs);
					}
					
				}

				$query['doc_response'] = count($doc_names);
			}else{
				$query['normal'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->whereLike('history.0.time', $start_date)->count('healthcare2016108181933756_static_html');
				$query['emergency'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Emergency')->whereLike('history.0.time', $start_date)->count('healthcare2016108181933756_static_html');
				$query['chronic'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Chronic')->whereLike('history.0.time', $start_date)->count('healthcare2016108181933756_static_html');

				$query['cured'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');
				
				$exists_doctor = array('history.time'=>array('$regex' => $start_date), 'history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor');

				$docs = $this->mongo_db->select(array('history'))->where($exists_doctor)->get($this->request_app_col_static_html);

				$doc_names= [];
				foreach ($docs as $data) {
					$his = end($data['history']);

					if($his['current_stage'] == "Doctor"){
						$docs = $his['submitted_by_name'];
						array_push($doc_names, $docs);
					}
					
				}

				$query['doc_response'] = count($doc_names);
			}
			
			//echo print_r($query['normal'], true); exit();

		}elseif ($district_name != 'All' && $school_name == 'All') {
			$query['normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$query['emergency'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$query['chronic'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor','history.time'=>array('$regex' => $today_date), 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name);
			$query['doc_response'] = $this->mongo_db->select(array('history'))->where($exists_doctor)->count($this->request_app_col_static_html);
		}elseif ($district_name != 'All' && $school_name != 'All') {
			$query['normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$query['emergency'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$query['chronic'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereLike('history.0.time', $today_date)->count('healthcare2016108181933756_static_html');

			$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor','history.time'=>array('$regex' => $today_date), 'doc_data.widget_data.page1.Student Info.School Name.field_ref' =>$school_name);
			$query['doc_response'] = $this->mongo_db->select(array('history'))->where($exists_doctor)->count($this->request_app_col_static_html);
		}
		
		
		return $query;
	}

	public function to_daily_health_request($start_date,$end_date, $request_type,$school_name,$district) 

	{	

		if($district == 'All' && $school_name == 'All')
		{
			switch ($request_type) {
				case 'Normal':						
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');

					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;

				case 'Cured':

				$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
				return $query;
				break;
				
				default:
					# code...
					break;
			}

		}elseif ($district != 'All' && $school_name == 'All') {
			switch ($request_type) {
				case 'Normal':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Cured':

				$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
				return $query;
				break;
				
				default:
					# code...
					break;
			}
		}elseif ($district != 'All' && $school_name != 'All') {
			switch ($request_type) {
				case 'Normal':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->where('history.0.time', array('$gte'=>$start_date), 'history.0.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				
				default:
					# code...
					break;
			}
		}

	}

/*Doctors Response Info*/	

	public function get_daily_doc_response_with_name($start_date,$end_date, $request_type,  $school_name, $district)
	{

		$doc_names = [];
		if($district == 'All' && $school_name == 'All'){

			$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor');
			$docs = $this->mongo_db->select(array('history'))->where($exists_doctor)->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get($this->request_app_col_static_html);

			foreach ($docs as $data) {
				$his = end($data['history']);

				if($his['current_stage'] == "Doctor"){
					$docs = $his['submitted_by_name'];
					array_push($doc_names, $docs);
				}
				
			}


			$final = array_count_values($doc_names);

		
			return $final;


		}elseif ($district != 'All' && $school_name == 'All') {

			$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name);
			$docs = $this->mongo_db->select(array('history'))->where($exists_doctor)->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count($this->request_app_col_static_html);
			
			foreach ($docs as $data) {
				$his = end($data['history']);
				if($his['current_stage'] == "Doctor"){
					$docs = $his['submitted_by_name'];
					array_push($doc_names, $docs);
				}
			}


			$final = array_count_values($doc_names);

			
			return $final;
		}elseif ($district != 'All' && $school_name != 'All') {
			$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' =>$school_name);
			$docs = $this->mongo_db->select(array('history'))->where($exists_doctor)->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count($this->request_app_col_static_html);

			foreach ($docs as $data) {
				$his = end($data['history']);
				if($his['current_stage'] == "Doctor"){
					$docs = $his['submitted_by_name'];
					array_push($doc_names, $docs);
				}
			}


			$final = array_count_values($doc_names);

			
			return $final;
		}
    }

    public function get_doc_res_students_daily_req($start_date,$end_date, $doc_name)
	{
		$doc_res = [];
		$exists_doctor = array('history.submitted_by' => array('$regex' => 'ttwreis.dr'),'history.current_stage' => 'Doctor');
		$docs = $this->mongo_db->select(array('history', 'doc_data.widget_data'))->where($exists_doctor)->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get($this->request_app_col_static_html);

		foreach ($docs as $data) {
			$his = end($data['history']);

			if($his['current_stage'] == "Doctor"){
				if($his['submitted_by_name']== $doc_name){
					array_push($doc_res, $data);
				}
			}
			
		}
		return $doc_res;

	}


	/* Cards Data fetching For new dashboard*/

	public function get_data_for_cards_with_filters($academic_year, $district_name, $school_name, $gender_type)
	{
		if($academic_year == '2015-2016'){
			$span = 'healthcare2016226112942701_screening_final_2015-16';
		}elseif($academic_year == '2016-2017'){
			$span = 'healthcare2016226112942701_screening_final_2016-17';
		}elseif ($academic_year == '2017-2018') {
			$span = 'healthcare2016226112942701_screening_final_2017-18';
		}elseif ($academic_year == '2018-2019') {
			$span = 'healthcare2016226112942701_screening_final_2019';
		}elseif ($academic_year == '2019-2020') {
			$span = 'healthcare201671115519757';
		}elseif ($academic_year == '2020-2021') {
			$span = 'ttwreis_screening_report_col_2020-2021';
		}

		if($district_name == 'All' && $school_name =='All')
		{

			if($gender_type == 'All'){
				// For the Total Students
					$data['total_students'] = $this->mongo_db->count($span);

				// For the Total schools
					$this->mongo_db->switchDatabase($this->common_db['common_db']);
					$data['total_schools'] = $this->mongo_db->count('ttwreis_schools');
					$this->mongo_db->switchDatabase($this->common_db['dsn']);
				// screened Students:
					$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
						     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

					$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->count($span);

					$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];

				// Screened Schools

					$schools = $this->mongo_db->where($page3andpage9exists)->command(array('distinct' => 'ttwreis_screening_report_col_2020-2021', 'key' =>'doc_data.widget_data.page2.Personal Information.School Name'));
				
					$data['screened_schools'] =count($schools['values']);

				//Not Screened Schools
				$data['not_screened_schools'] = $data['total_schools'] - $data['screened_schools'];


			}else{
				// For the Total Students
				$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Gender', $gender_type)->count($span);

			// For the Total schools
				$this->mongo_db->switchDatabase($this->common_db['common_db']);
				$data['total_schools'] = $this->mongo_db->count('ttwreis_schools');
				$this->mongo_db->switchDatabase($this->common_db['dsn']);
			// screened Students:
				$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
					     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

				$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page1.Personal Information.Gender', $gender_type)->count($span);

				$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];

			// Screened Schools

				$schools = $this->mongo_db->where($page3andpage9exists)->command(array('distinct' => 'ttwreis_screening_report_col_2020-2021', 'key' =>'doc_data.widget_data.page2.Personal Information.School Name'));
			
				$data['screened_schools'] =count($schools['values']);

				$data['not_screened_schools'] = $data['total_schools'] - $data['screened_schools'];
			}
			
		return $data;

		}elseif ($district_name != 'All' && $school_name =='All') {

			if ($gender_type == 'All') {
				
			// For the Total Students
			$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->count($span);

			// For the Total schools
				$school_count = [];
				$this->mongo_db->switchDatabase($this->common_db['common_db']);
				$school = $this->mongo_db->get('ttwreis_schools');
				$this->mongo_db->switchDatabase($this->common_db['dsn']);
				
				foreach ($school as $scl) {
					
					$seperating_dist_name = explode(',', $scl['school_name']);
					
					if($seperating_dist_name[1] == $district_name){
						array_push($school_count, $scl['school_name']);

					}

				}

				$data['total_schools'] = count($school_count);

			// screened Students:
				$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
					     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

				$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->count($span);

				$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];

			// Screened Schools

				$schools = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->command(array('distinct' => 'ttwreis_screening_report_col_2020-2021', 'key' =>'doc_data.widget_data.page2.Personal Information.School Name'));
			
				$data['screened_schools'] =count($schools['values']);

				$data['not_screened_schools'] = $data['total_schools'] - $data['screened_schools'];

			}else {

			/*// For the Total Students
				$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->count($span);*/

				// For the Total Students
				$data['total_students'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Personal Information.Gender'=> $gender_type, 'doc_data.widget_data.page2.Personal Information.District', $district_name ))->count($span);

				

			// For the Total schools
				$school_count = [];
				$this->mongo_db->switchDatabase($this->common_db['common_db']);
				$school = $this->mongo_db->get('ttwreis_schools');
				$this->mongo_db->switchDatabase($this->common_db['dsn']);
				
				foreach ($school as $scl) {
					
					$seperating_dist_name = explode(',', $scl['school_name']);
					
					if($seperating_dist_name[1] == $district_name){
						array_push($school_count, $scl['school_name']);

					}

				}

				$data['total_schools'] = count($school_count);

			// screened Students:
				$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
					     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

				$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->count($span);

				$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];

			// Screened Schools

				$schools = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->command(array('distinct' => 'ttwreis_screening_report_col_2020-2021', 'key' =>'doc_data.widget_data.page2.Personal Information.School Name'));
			
				$data['screened_schools'] =count($schools['values']);

				$data['not_screened_schools'] = $data['total_schools'] - $data['screened_schools'];
				}
			
		
			return $data;


		}elseif ($district_name != 'All' && $school_name !='All' && $gender_type == 'All') {

			

			//For Total schools in districts wise
			$school_count = [];
			$this->mongo_db->switchDatabase($this->common_db['common_db']);
			$school = $this->mongo_db->get('ttwreis_schools');
			$this->mongo_db->switchDatabase($this->common_db['dsn']);
			
			foreach ($school as $scl) {
				
				$seperating_dist_name = explode(',', $scl['school_name']);
				
				if($seperating_dist_name[1] == $district_name){
					array_push($school_count, $scl['school_name']);

				}

			}

			$data['total_schools'] = count($school_count);

			// For the Total Students
			$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name',$school_name)->count('ttwreis_screening_report_col_2020-2021');

			// screened Students:
			$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
				     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

			$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.School Name', $school_name)->count($span);
			
			//Not screened students
			$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];

			// Screened Schools

			$schools = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.District', $district_name)->command(array('distinct' => 'ttwreis_screening_report_col_2020-2021', 'key' =>'doc_data.widget_data.page2.Personal Information.School Name'));
		
			$data['screened_schools'] =count($schools['values']);

			//Not Screened Schools
			$data['not_screened_schools'] = $data['total_schools'] - $data['screened_schools'];
		
			return $data;
				
			}elseif ($district_name != 'All' && $school_name !='All' && $gender_type != 'All') {

			// For the Total Students

			//$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Gender',$gender_type)->count('healthcare201671115519757');

			$school_count = [];
			$this->mongo_db->switchDatabase($this->common_db['common_db']);
			$school = $this->mongo_db->get('ttwreis_schools');
			$this->mongo_db->switchDatabase($this->common_db['dsn']);
			
			foreach ($school as $scl) {
				
				$seperating_dist_name = explode(',', $scl['school_name']);
				
				if($seperating_dist_name[1] == $district_name){
					array_push($school_count, $scl['school_name']);

				}

			}

			$data['total_schools'] = count($school_count);
			$data['total_students'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Personal Information.Gender'=> $gender_type, 'doc_data.widget_data.page2.Personal Information.School Name' => $school_name ))->count('ttwreis_screening_report_col_2020-2021');

			//echo print_r($data['total_students'],true); exit();

			// screened Students:
			$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
				     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

			$data['screened_students'] = $this->mongo_db->where($page3andpage9exists)->where('doc_data.widget_data.page2.Personal Information.School Name', $school_name)->count($span);
			
			//Not screened students
			$data['not_screened_students'] = $data['total_students'] - $data['screened_students'];
	        
	        return $data;

		}
	    

	}

/// First Stage analytics Generation author ===== Harish

public function do_stage1_refresh($academic_year)
	{

		if($academic_year == "2017-2018"){
			$screening_duration = 'healthcare201671115519757_screening_final';
		}elseif($academic_year == "2015-2016" || $academic_year == "2019-2020"){
			$screening_duration = 'healthcare201671115519757_screening_final';
		}else {
			$screening_duration = 'ttwreis_screening_report_col_'.$academic_year;
		}

		$abnormality_counts = [];

		$studentPhotoandpage3Exists = array (
			"doc_data.widget_data.page9.Dental Check-up" => array (
					'$exists' => true),
			"doc_data.widget_data.page3.Physical Exam" => array (
					'$exists' => true
			)
		);

		$ortho_array = [];
		$ortho = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page4.Doctor Check Up.Ortho"));


		foreach ($ortho['values'] as $index => $value) {
			if($value != " " || $value != "" || $value != false){
			$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page4.Doctor Check Up.Ortho'=> $value))->count($screening_duration);
          		array_push($ortho_array, $qry);
				}
          	}
			$ortho_val = array_sum($ortho_array);
          	$ortho['label'] = 'Ortho Abnormalities';
          	$ortho['value'] = $ortho_val;
          	array_push($abnormality_counts, $ortho);
/*
		$skin_array = [];
		$skin = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page4.Doctor Check Up.Skin conditions"));

		foreach ($skin['values'] as $index => $value) {

			$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page4.Doctor Check Up.Skin conditions'=> $value))->count($screening_duration);
          		array_push($skin_array, $qry);
          	}
			$skin_val = array_sum($skin_array);
          	$skin['label'] = 'Skin Abnormalities';
          	$skin['value'] = $skin_val;
          	array_push($abnormality_counts, $skin);*/

        $postural_array = [];
		$postural = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page4.Doctor Check Up.Postural"));

		foreach ($postural['values'] as $index => $value) {

			if($value != " " || $value != "" || $value != false){

			$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page4.Doctor Check Up.Postural'=> $value))->count($screening_duration);
          		array_push($postural_array, $qry);
			}

          	}
			$postural_val = array_sum($postural_array);
          	$postural['label'] = 'Postural Abnormalities';
          	$postural['value'] = $postural_val;
          	array_push($abnormality_counts, $postural);

	        /*$common_diesease_array = [];
			$Common_Diseases = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page4.Doctor Check Up.Common Diseases"));
			foreach ($Common_Diseases['values'] as $index => $value) {

				$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page4.Doctor Check Up.Common Diseases'=> $value))->count($screening_duration);
	          		array_push($common_diesease_array, $qry);
	          	}
				$common_diesease_val = array_sum($common_diesease_array);
	          	$common_diesease['label'] = 'Common Disease Abnormalities';
	          	$common_diesease['value'] = $common_diesease_val;
	          	array_push($abnormality_counts, $common_diesease);*/
	
		$dab_array = [];
		$dab = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth"));

		foreach ($dab['values'] as $index => $value) {

			if($value != " " || $value != "" || $value != false){
				$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page5.Doctor Check Up.Defects at Birth'=> $value))->count($screening_duration);
				}

          		array_push($dab_array, $qry);
          	}
			$dab_val = array_sum($dab_array);
          	$dab['label'] = 'Defects At Birth';
          	$dab['value'] = $dab_val;
          	array_push($abnormality_counts, $dab);

		
      	$deficencies_array = [];
		//$Deficencies = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page5.Doctor Check Up.Deficencies"));
		$Deficencies = [
			"Under Weight",
			"Anaemia",
			"Vitamin Deficiency - Bcomplex",
			"Over Weight",
			"Anemic",
			"Vitamin deficiency",
			"Goiter",
			"Vitamin A Deficiency",
			"Vitamin D Deficiency",
			"Normal Weight",
			"SAM/stunting",
			"Obese",
			"Anemia-Mild",
			"Anemia-Moderate"
			];
		foreach ($Deficencies as $index => $value) {
			
			$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page5.Doctor Check Up.Deficencies'=> $value))->count($screening_duration);
          		array_push($deficencies_array, $qry);
          	}
			$deficencies_val = array_sum($deficencies_array);

          	$deficencies['label'] = 'Deficiencies';
          	$deficencies['value'] = $deficencies_val;

          	array_push($abnormality_counts, $deficencies);

        $childhood = [];
		$Childhood_Diseases = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases"));
		
		foreach ($Childhood_Diseases['values'] as $index => $value) {

			if($value != " " || $value != "" || $value != false){

				$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases'=> $value))->count($screening_duration);
			}
          		array_push($childhood, $qry);
          	}
			$childhood_val = array_sum($childhood);
          	$childhood['label'] = 'Childhood Diseases';
          	$childhood['value'] = $childhood_val;
          	array_push($abnormality_counts, $childhood);

        $check_if_array = [];
		$check_if = $this->mongo_db->command(array('distinct' => $screening_duration,'key' => "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities"));
		foreach ($check_if['values'] as $index => $value) {
			if($value != " " || $value != "" || $value != false){

			$qry = $this->mongo_db->where($studentPhotoandpage3Exists)->where(array('doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities'=> $value))->count($screening_duration);
				}
          		array_push($check_if_array, $qry);
          	}
			$check_if_val = array_sum($check_if_array);
          	$check_if['label'] = 'General Abnormalities';
          	$check_if['value'] = $check_if_val;
          	array_push($abnormality_counts, $check_if);

		//Dental Problems
		$dental_count = [];
  		$qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Oral Hygiene";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);

	    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Carious Teeth";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);

	    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Flourosis";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);

	    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Orthodontic Treatment";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);

	     $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Indication for extraction";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);

	    /* $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Halitosis";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);*/

	   /*  $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Flat patches";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);*/

	   /*  $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->count($screening_duration);
      		//$carious_teeth['values'] = "Ulcer";
      		//$carious_teeth['count'] = $qry;
	          
	        array_push($dental_count, $qry);*/

	       $dent_val = array_sum($dental_count);

	       $Dental['label'] = 'Dental Abnormalities';
		   $Dental['value'] = $dent_val;

		array_push($abnormality_counts, $Dental);

		//Eye Abnormalities

		$eye_count = [];

				$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Right"=>array('$in'=> array("6/36", "6/24", "6/60", "6/18"))))->count($screening_duration);

				array_push($eye_count, $qry);

	          	$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Left"=>array('$in'=> array("6/36", "6/24", "6/60", "6/18"))))->count($screening_duration);
	          	
			        array_push($eye_count, $qry);

			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Right"=>array('$in'=> array("6/36", "6/24", "6/60", "6/18"))))->count($screening_duration);
	          		
			          
			        array_push($eye_count, $qry);

			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Left"=>array('$in'=> array("6/36", "6/24", "6/60", "6/18"))))->count($screening_duration);
	          		
			          
			        array_push($eye_count, $qry);

			    $vision_screen = $this->mongo_db->command(array('distinct' => $screening_duration ,'key' => "doc_data.widget_data.page6.Screenings"));


          		foreach ($vision_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page6.Screenings'=>$value))->count($screening_duration);
	          		if($qry != 0){

	          		array_push($eye_count, $qry);
	          		}
	          	}

	          	$qry = $this->mongo_db->where(array("doc_data.widget_data.page7.Colour Blindness.Right"=>"Yes"))->count($screening_duration);

  	    		
  	    		array_push($eye_count, $qry);

  	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page7.Colour Blindness.Left"=>"Yes"))->count($screening_duration);
  	    		
  	    		array_push($eye_count, $qry);

	          	/*$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->count($screening_duration);
	          	array_push($eye_count, $qry);*/

		       $eye_val = array_sum($eye_count);

		       $eye['label'] = 'Eye Abnormalities';
			   $eye['value'] = $eye_val;

			  array_push($abnormality_counts, $eye);
		// Audio And Speech Abnormalities

			$audio_speech_count = [];
  	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->count($screening_duration);
  	    		
  	    		array_push($audio_speech_count, $qry);

  	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->count($screening_duration);
  	    		
  	    		array_push($audio_speech_count, $qry);

  	    		$speech_screen = $this->mongo_db->command(array('distinct' => $screening_duration ,'key' => "doc_data.widget_data.page8. Auditory Screening.Speech Screening"));

  	    		
            		foreach ($speech_screen['values'] as $index => $value) {
            			if($value != 'Normal' && $value != " " && $value != "" && $value != false)
            			{
  	          				$qry = $this->mongo_db->where(array('doc_data.widget_data.page8. Auditory Screening.Speech Screening'=>$value))->count($screening_duration);

            			}

            			
  	          			array_push($audio_speech_count, $qry);
  	          		
  	          	}

  	          	
  	          	$dd_disability = $this->mongo_db->command(array('distinct' => $screening_duration ,'key' => "doc_data.widget_data.page8. Auditory Screening.D D and disability"));
            		foreach ($dd_disability['values'] as $index => $value) {
            			if($value != " " && $value != "" && $value != false){

  	          			$qry = $this->mongo_db->where(array('doc_data.widget_data.page8. Auditory Screening.D D and disability'=>$value))->count($screening_duration);
  	          				array_push($audio_speech_count, $qry);
            			}
  	          		
  	          	}

  	         

  	         $audio_val = array_sum($audio_speech_count);


		       $audio['label'] = 'Auditory And Speech Abnormalities';
			   $audio['value'] = $audio_val;

			   array_push($abnormality_counts, $audio);

		$result = [];
		foreach($abnormality_counts as $request){
			$req['label'] = $request['label'];
			$req['value'] = $request['value'];

			array_push($result, $req);
		}

		
		$pie_data['academic_year']    = $academic_year;
		$pie_data['stage1_info'] = $result;

		//$insert = $this->mongo_db->insert('panacea_screening_stage1_analytics_new', array('doc_data' => $pie_data));
		$exists = $this->mongo_db->where('doc_data.academic_year', $pie_data['academic_year'])->get('ttwreis_screening_stage1_analytics_new');

		if(isset($exists) && !empty($exists))
		{
			$insert = $this->mongo_db->where(array('doc_data.academic_year' => $pie_data['academic_year']))->set(array('doc_data.stage1_info' =>$result))->update('ttwreis_screening_stage1_analytics_new');
		}else{
			$insert = $this->mongo_db->insert('ttwreis_screening_stage1_analytics_new', array('doc_data' => $pie_data));
		}
		
		return $insert;
	}

	public function get_screening_pie_values($span)
	{

		//$refresh = $this->get_all_screeningssss();
		//$span = '2019-2020';
		$qry = $this->mongo_db->select(array('doc_data.stage1_info'))->where('doc_data.academic_year', $span)->get('ttwreis_screening_stage1_analytics_new');

		$result = [ ];

		foreach($qry as $data){

			$ortho ['label'] = $data ['doc_data'] ['stage1_info'] [0] ['label'];
			$ortho ['value'] = $data ['doc_data'] ['stage1_info'] [0] ['value'];

			if($ortho ['value'] != 0)
			{

			array_push($result, $ortho);
			}

			
			
			$postural ['label'] = $data ['doc_data'] ['stage1_info'] [1] ['label'];
			$postural ['value'] = $data ['doc_data'] ['stage1_info'] [1] ['value'];
			if($postural ['value'] != 0)
			{
				
			array_push($result, $postural);
			}

			$defect_at ['label'] = $data ['doc_data'] ['stage1_info'] [2] ['label'];
			$defect_at ['value'] = $data ['doc_data'] ['stage1_info'] [2] ['value'];
			if($defect_at ['value'] != 0)
			{
				
			array_push($result, $defect_at);
			}

			$dificiences ['label'] = $data ['doc_data'] ['stage1_info'] [3] ['label'];
			$dificiences ['value'] = $data ['doc_data'] ['stage1_info'] [3] ['value'];
			if($dificiences ['value'] != 0)
			{
				
			array_push($result, $dificiences);
			}

			$Childhood ['label'] = $data ['doc_data'] ['stage1_info'] [4] ['label'];
			$Childhood ['value'] = $data ['doc_data'] ['stage1_info'] [4] ['value'];
			if($Childhood ['value'] != 0)
			{
				
			array_push($result, $Childhood);
			}

			$general ['label'] = $data ['doc_data'] ['stage1_info'] [5] ['label'];
			$general ['value'] = $data ['doc_data'] ['stage1_info'] [5] ['value'];
			if($general ['value'] != 0){
				
			array_push($result, $general);
			}
			$dental ['label'] = $data ['doc_data'] ['stage1_info'] [6] ['label'];
			$dental ['value'] = $data ['doc_data'] ['stage1_info'] [6] ['value'];
			if($dental ['value'] != 0){
				
			array_push($result, $dental);
			}

			$eye ['label'] = $data ['doc_data'] ['stage1_info'] [7] ['label'];
			$eye ['value'] = $data ['doc_data'] ['stage1_info'] [7] ['value'];

			if($eye ['value'] != 0){
				
			array_push($result, $eye);
			}


			$auditory ['label'] = $data ['doc_data'] ['stage1_info'] [8] ['label'];
			$auditory ['value'] = $data ['doc_data'] ['stage1_info'] [8] ['value'];

			if($auditory ['value'] != 0){
				
			array_push($result, $auditory);
			}



		}

		$resultsss = [ ];
		foreach ( $result as $data ) {

			$req ['label'] = $data['label'];
			$req ['value'] = $data['value'];
			if($req ['value'] != 0){
				
			array_push($result, $req);
			}
			array_push ( $resultsss, $req );
		}

		return $resultsss;


	}

	public function get_dt_name_based_on_id($dt_name){
		//$query = $this->mongo_db->where('st_name', "$dt_name")->get('panacea_district');
		$query = $this->mongo_db->select('dt_name')->where ( '_id', new MongoId ( "$dt_name" ) )->get ( 'ttwreis_district' );
		 
		return $query;
	}

// Get SChools by symptom

	public function get_schools_by_symptom($symptom, $academic_years_data, $po_name, $school_name)
	{

		if($academic_years_data == "2017-2018"){
			$academic_year = 'healthcare201671115519757';
		}elseif($academic_years_data == "2015-2016" || $academic_years_data == "2019-2020"){
			$academic_year = 'healthcare201671115519757';
		}else {
			$academic_year = 'ttwreis_screening_report_col_'.$academic_years_data;
		}

		if(($school_name == false) || ($school_name == 'All_po'))
		{
			$school_name = 'All';
		}

		$empty = [];

		if(($po_name == 'All') && ($school_name == 'All')){

			switch ($symptom) {

			// General Symptoms
			case "ENT": case "Neurologic": case "Heart": case "Skin": case "Abdomen": case "Lungs": case "H and N": case "Genetalia": case "Lymphatic": case "Lyphamatic": case "Genitalia":
				$general_symptoms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => $symptom ))->get($academic_year);

					foreach($general_symptoms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}


					$schools_with_count = array_count_values($empty);
					
				return $schools_with_count;
				break;
			// Ortho problems
			case "Neck": case "Shoulders": case "Arms/Hands": case "Knees": case "Feet": case "Hips": case "Arms":
				$ortho_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page4.Doctor Check Up.Ortho" => $symptom))->get($academic_year);

					foreach($ortho_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Postural problems
			case "No spinal Abnormality": case "Spinal Abnormality": case "Moderate": case "Mild": case "Marked": case 'Spinal Abnomality':

				$postural_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page4.Doctor Check Up.Postural" => $symptom))->get($academic_year);
				foreach($postural_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Common problems
			case "Myalgia": case "Tonsillitis": case "tonsillitis": case "Cold": case "cold": case "Cervical Lymph Adenitis": case "ASOM": case "Acute Br.Asthama": case "Icterus": case "Pyrexia": case "URTI": case "Injuries": case "UTI": case "Angular Stomatities": case "Angular Stomatitis": case "Aphthous Ulcers": case "Glossities": case "Pharyngitis": case "Headache": case "Stomachache": case "Diarrhea": case "Behaviour Disorder":
				$common_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page4.Doctor Check Up.Common Diseases" => $symptom))->get($academic_year);
				foreach($common_problems as $symptom)
					{

					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Defects at Birth problems
			case "Neural Tube Defect": case "Down Syndrome": case "Cleft Lip and Palate": case "Talipes Club foot": case "Developmental Dyslpasia of Hip": case "Congenital Heart Disease": case "Congenital Cataract": case "Congenital Deafness": case "Congential Heart Disease": case "Retinopathy of Prematurity": case "Retinopathy of Prematurity(only at DH)": case "Sickle Cell Anaemia": case "Down Syndome": case "Congential Cataract": case "Congential Deafness":

				$defects_at_birth_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => $symptom ))->get($academic_year);
				foreach($defects_at_birth_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Deficencies problems
			case "Anemia-Mild": case "Anemia-Moderate": case "Anemia-Severe": case "Vitamin Deficiency - BComplex": case "Vitamin A Deficiency": case "Vitamin C Deficiency": case "Vitamin D Deficiency": case "SAM/Stunting": case "Goiter": case "Under Weight": case "Over Weight":case "Obese": case "Anaemia": case "Vitamin Deficiency - Bcomplex": case "Normal Weight":
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page5.Doctor Check Up.Deficencies" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Childhood Disease problems
			case "CSOM": case "Rheumatic Heart Disease": case "Chronic Br.Asthma": case "Hyperthyroidism": case "Hypothyrodism": case "Hypothyroidism": case "Type-I Diabeties": case "Type-II Diabeties": case "Epilepsy": case "PCOD": case 'Type-I Diabetes': case 'Type-II Diabetes': case 'Skin Conditions': case 'Asthma': case 'Skin conditions': case 'Hypothyrodism': case 'Otitis Media': case 'Convulsive Disorders': case 'Diabetes':
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
				// Skin problems
				case "Scabies": case "Taenia Corporis": case "Taenia Facialis": case "Taenia Cruris": case "ECCEMA": case "Psoriasis": case "Allergic Rash": case "White Patches on Face": case "Acne on Face": case "Hyper Pigmentation": case "Hypo Pigmentation": case "Hansens Disease": case "Molluscum": case "Nail Bed Disease": case "Greying of Hair": case "Danddruff": case "Cracked Feet": case "Hyperhidrosis": case "ECZEMA": case "Greying Hair":
				$skin_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page4.Doctor Check Up.Skin conditions" => $symptom))->get($academic_year);
				foreach($skin_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;

						//Vision Abnormalities
						case "Without Glasses Right":

							$without_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Without Glasses Left":
						$without_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Right":

							$with_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Left":
						$with_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Left Squnit": case "Redness of Eye Left": case "Redness of Eye Right": case "Redness of Eye": case "Stye": case "Trauma": case "Blepharitis": case "Right Squnit": case "Myopia": case "Forign Boady": case "Hyperopia": case "Pterizium": case "Chalazion": case "Pterygium": case "Forign Body":
						$vision_problem = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.Vision Screening" => $symptom))->get($academic_year);
						foreach($vision_problem as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Bitot Night Blindness":
							
						$bitot = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->get($academic_year);

						foreach($bitot as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Auditory Screening Right": case 'Auditory Screening Right':
						$auditory_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->get($academic_year);
						foreach($auditory_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break; 

						case "Auditory Screening Left": case 'Auditory Screening Left':	
						$auditory_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->get($academic_year);
						foreach($auditory_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Normal": case "Fluency": case "Normal": case "Delay": case "Fluency": case "Misarticulation": case "Tongue Tie": case "Stammering": case "Voice": case "Behaviour Disorder": case "Language Delay": case "Misarticulaion": case "Pyrexia": case "Injuries": case "Myalgia": case "Pharyngitis": case "Stomachache": case "Headache": case "Cold": case "UTI": case "Behaviour Disorder":
						$speech_screen = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page8. Auditory Screening.Speech Screening" => $symptom))->get($academic_year);
						foreach($speech_screen as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Oral Hygiene -Poor":
						$oral_poor = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->get($academic_year);
						foreach($oral_poor as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Carious Teeth":
						$carious_teeth = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->get($academic_year);
						foreach($carious_teeth as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Flourosis":
						$flourosis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->get($academic_year);
						foreach($flourosis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				   		case "Orthodontic Treatment":
				    	$orho_treatment = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->get($academic_year);
				    	foreach($orho_treatment as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				    	case "Indication for extraction":
				    	$ife = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->get($academic_year);
				    	foreach($ife as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				     	case "Halitosis":
				      	$halitotis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->get($academic_year);
				      	foreach($halitotis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				      case "Flat patches Red":
				       $fpr = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->get($academic_year);
				       foreach($fpr as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				       case "Flat patches White":
				       $fpw = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->get($academic_year);
				       foreach($fpw as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				        case "Ulcer":
				        $ulcer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->get($academic_year);
				        foreach($ulcer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Doctor Referral Made":
						$doctor_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->get($academic_year);
						foreach($doctor_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						 case "Vision Referral Made":
						 $vision_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($vision_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;

						 case "Auditory Referral Made":
						 $auditory_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($auditory_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
						 case "Dental Check-up Referral Made":
						 $dental_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array("doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($dental_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
			default:
				break;
		}

		}elseif (($po_name != 'All') && ($school_name == 'All')) {
			switch ($symptom) {

			// General Symptoms
			case "ENT": case "Neurologic": case "Heart": case "Skin": case "Abdomen": case "Lungs": case "H and N": case "Genetalia": case "Lymphatic": case "Lyphamatic":
				$general_symptoms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => $symptom ))->get($academic_year);

					foreach($general_symptoms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}


					$schools_with_count = array_count_values($empty);
					
				return $schools_with_count;
				break;
			// Ortho problems
			case "Neck": case "Shoulders": case "Arms/Hands": case "Knees": case "Feet": case "Hips": case "Arms":
				$ortho_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page4.Doctor Check Up.Ortho" => $symptom))->get($academic_year);

					foreach($ortho_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Postural problems
			case "No spinal Abnormality": case "Spinal Abnormality": case "Moderate": case "Mild": case "Marked": case 'Spinal Abnomality':

				$postural_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page4.Doctor Check Up.Postural" => $symptom))->get($academic_year);
				foreach($postural_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Common problems
			case "Myalgia": case "Tonsillitis": case "tonsillitis": case "Cold": case "cold": case "Cervical Lymph Adenitis": case "ASOM": case "Acute Br.Asthama": case "Icterus": case "Pyrexia": case "URTI": case "Injuries": case "UTI": case "Angular Stomatities": case "Angular Stomatitis": case "Aphthous Ulcers": case "Glossities": case "Pharyngitis": case "Headache": case "Stomachache": case "Diarrhea": case "Behaviour Disorder":
				$common_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page4.Doctor Check Up.Common Diseases" => $symptom))->get($academic_year);
				foreach($common_problems as $symptom)
					{

					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Defects at Birth problems
			case "Neural Tube Defect": case "Down Syndrome": case "Cleft Lip and Palate": case "Talipes Club foot": case "Developmental Dyslpasia of Hip": case "Congenital Heart Disease": case "Congenital Cataract": case "Congenital Deafness": case "Congential Heart Disease": case "Retinopathy of Prematurity": case "Retinopathy of Prematurity(only at DH)": case "Sickle Cell Anaemia": case "Down Syndome": case "Congential Cataract": case "Congential Deafness":

				$defects_at_birth_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => $symptom ))->get($academic_year);
				foreach($defects_at_birth_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Deficencies problems
			case "Anemia-Mild": case "Anemia-Moderate": case "Anemia-Severe": case "Vitamin Deficiency - BComplex": case "Vitamin A Deficiency": case "Vitamin C Deficiency": case "Vitamin D Deficiency": case "SAM/Stunting": case "Goiter":case "Under Weight": case "Over Weight":case "Obese":
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Childhood Disease problems
			case "CSOM": case "Rheumatic Heart Disease": case "Chronic Br.Asthma": case "Hyperthyroidism": case "Hypothyrodism": case "Hypothyroidism": case "Type-I Diabeties": case "Type-II Diabeties": case "Epilepsy": case "PCOD": case 'Type-I Diabetes': case 'Type-II Diabetes':
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
				// Skin problems
				case "Scabies": case "Taenia Corporis": case "Taenia Facialis": case "Taenia Cruris": case "ECCEMA": case "Psoriasis": case "Allergic Rash": case "White Patches on Face": case "Acne on Face": case "Hyper Pigmentation": case "Hypo Pigmentation": case "Hansens Disease": case "Molluscum": case "Nail Bed Disease": case "Greying of Hair": case "Danddruff": case "Cracked Feet": case "Hyperhidrosis": case "ECZEMA": case "Greying Hair":
				$skin_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page4.Doctor Check Up.Skin conditions" => $symptom))->get($academic_year);
				foreach($skin_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;

						//Vision Abnormalities
						case "Without Glasses Right":

							$without_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Without Glasses Left":
						$without_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Right":

							$with_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Left":
						$with_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Left Squnit": case "Redness of Eye Left": case "Redness of Eye Right": case "Redness of Eye": case "Stye": case "Trauma": case "Blepharitis": case "Right Squnit": case "Myopia": case "Forign Boady": case "Hyperopia": case "Pterizium": case "Chalazion": case "Pterygium": case "Forign Body":
						$vision_problem = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Vision Screening" => $symptom))->get($academic_year);
						foreach($vision_problem as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Bitot Night Blindness":
							
						$bitot = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->get($academic_year);

						foreach($bitot as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Auditory Screening Right": case 'Auditory Screening Right':
						$auditory_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->get($academic_year);
						foreach($auditory_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break; 

						case "Auditory Screening Left": case 'Auditory Screening Left':	
						$auditory_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->get($academic_year);
						foreach($auditory_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Normal": case "Fluency": case "Normal": case "Delay": case "Fluency": case "Misarticulation": case "Tongue Tie": case "Stammering": case "Voice": case "Behaviour Disorder": case "Language Delay": case "Misarticulaion": case "Pyrexia": case "Injuries": case "Myalgia": case "Pharyngitis": case "Stomachache": case "Headache": case "Cold": case "UTI":
						$speech_screen = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8. Auditory Screening.Speech Screening" => $symptom))->get($academic_year);
						foreach($speech_screen as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Oral Hygiene -Poor":
						$oral_poor = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->get($academic_year);
						foreach($oral_poor as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Carious Teeth":
						$carious_teeth = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->get($academic_year);
						foreach($carious_teeth as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Flourosis":
						$flourosis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->get($academic_year);
						foreach($flourosis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				   		case "Orthodontic Treatment":
				    	$orho_treatment = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->get($academic_year);
				    	foreach($orho_treatment as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				    	case "Indication for extraction":
				    	$ife = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->get($academic_year);
				    	foreach($ife as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				     	case "Halitosis":
				      	$halitotis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->get($academic_year);
				      	foreach($halitotis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				      case "Flat patches Red":
				       $fpr = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->get($academic_year);
				       foreach($fpr as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				       case "Flat patches White":
				       $fpw = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->get($academic_year);
				       foreach($fpw as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				        case "Ulcer":
				        $ulcer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->get($academic_year);
				        foreach($ulcer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Doctor Referral Made":
						$doctor_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->get($academic_year);
						foreach($doctor_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						 case "Vision Referral Made":
						 $vision_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($vision_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;

						 case "Auditory Referral Made":
						 $auditory_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($auditory_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
						 case "Dental Check-up Referral Made":
						 $dental_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($dental_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
			default:
				break;
		}
		}elseif (($po_name != 'All') && ($school_name != 'All')) {
			switch ($symptom) {

			// General Symptoms
			case "ENT": case "Neurologic": case "Heart": case "Skin": case "Abdomen": case "Lungs": case "H and N": case "Genetalia": case "Lymphatic": case "Lyphamatic":
				$general_symptoms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => $symptom ))->get($academic_year);

					foreach($general_symptoms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}


					$schools_with_count = array_count_values($empty);
					
				return $schools_with_count;
				break;
			// Ortho problems
			case "Neck": case "Shoulders": case "Arms/Hands": case "Knees": case "Feet": case "Hips": case "Arms":
				$ortho_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page4.Doctor Check Up.Ortho" => $symptom))->get($academic_year);

					foreach($ortho_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Postural problems
			case "No spinal Abnormality": case "Spinal Abnormality": case "Moderate": case "Mild": case "Marked": case 'Spinal Abnomality':

				$postural_problms = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page4.Doctor Check Up.Postural" => $symptom))->get($academic_year);
				foreach($postural_problms as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Common problems
			case "Myalgia": case "Tonsillitis": case "tonsillitis": case "Cold": case "cold": case "Cervical Lymph Adenitis": case "ASOM": case "Acute Br.Asthama": case "Icterus": case "Pyrexia": case "URTI": case "Injuries": case "UTI": case "Angular Stomatities": case "Angular Stomatitis": case "Aphthous Ulcers": case "Glossities": case "Pharyngitis": case "Headache": case "Stomachache": case "Diarrhea": case "Behaviour Disorder":
				$common_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page4.Doctor Check Up.Common Diseases" => $symptom))->get($academic_year);
				foreach($common_problems as $symptom)
					{

					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Defects at Birth problems
			case "Neural Tube Defect": case "Down Syndrome": case "Cleft Lip and Palate": case "Talipes Club foot": case "Developmental Dyslpasia of Hip": case "Congenital Heart Disease": case "Congenital Cataract": case "Congenital Deafness": case "Congential Heart Disease": case "Retinopathy of Prematurity": case "Retinopathy of Prematurity(only at DH)": case "Sickle Cell Anaemia": case "Down Syndome": case "Congential Cataract": case "Congential Deafness":

				$defects_at_birth_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => $symptom ))->get($academic_year);
				foreach($defects_at_birth_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
			// Deficencies problems
			case "Anemia-Mild": case "Anemia-Moderate": case "Anemia-Severe": case "Vitamin Deficiency - BComplex": case "Vitamin A Deficiency": case "Vitamin C Deficiency": case "Vitamin D Deficiency": case "SAM/Stunting": case "Goiter":case "Under Weight": case "Over Weight":case "Obese":
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page5.Doctor Check Up.Deficencies" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
    		// Childhood Disease problems
			case "CSOM": case "Rheumatic Heart Disease": case "Chronic Br.Asthma": case "Hyperthyroidism": case "Hypothyrodism": case "Hypothyroidism": case "Type-I Diabeties": case "Type-II Diabeties": case "Epilepsy": case "PCOD": case 'Type-I Diabetes': case 'Type-II Diabetes':
				$deficencies_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => $symptom))->get($academic_year);
				foreach($deficencies_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;
				// Skin problems
				case "Scabies": case "Taenia Corporis": case "Taenia Facialis": case "Taenia Cruris": case "ECCEMA": case "Psoriasis": case "Allergic Rash": case "White Patches on Face": case "Acne on Face": case "Hyper Pigmentation": case "Hypo Pigmentation": case "Hansens Disease": case "Molluscum": case "Nail Bed Disease": case "Greying of Hair": case "Danddruff": case "Cracked Feet": case "Hyperhidrosis": case "ECZEMA": case "Greying Hair":
				$skin_problems = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page4.Doctor Check Up.Skin conditions" => $symptom))->get($academic_year);
				foreach($skin_problems as $symptom)
					{
					$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

					array_push($empty, $school);

					}

					$schools_with_count = array_count_values($empty);
				return $schools_with_count;
				break;

						//Vision Abnormalities
						case "Without Glasses Right":

							$without_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Without Glasses Left":
						$without_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($without_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Right":

							$with_glass_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "With Glasses Left":
						$with_glass_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->get($academic_year);
						foreach($with_glass_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Left Squnit": case "Redness of Eye Left": case "Redness of Eye Right": case "Redness of Eye": case "Stye": case "Trauma": case "Blepharitis": case "Right Squnit": case "Myopia": case "Forign Boady": case "Hyperopia": case "Pterizium": case "Chalazion": case "Pterygium": case "Forign Body":
						$vision_problem = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Vision Screening" => $symptom))->get($academic_year);
						foreach($vision_problem as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Bitot Night Blindness":
							
						$bitot = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->get($academic_year);

						foreach($bitot as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Auditory Screening Right": case 'Auditory Screening Right':
						$auditory_right = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->get($academic_year);
						foreach($auditory_right as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break; 

						case "Auditory Screening Left": case 'Auditory Screening Left':	
						$auditory_left = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->get($academic_year);
						foreach($auditory_left as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Normal": case "Fluency": case "Normal": case "Delay": case "Fluency": case "Misarticulation": case "Tongue Tie": case "Stammering": case "Voice": case "Behaviour Disorder": case "Language Delay": case "Misarticulaion": case "Pyrexia": case "Injuries": case "Myalgia": case "Pharyngitis": case "Stomachache": case "Headache": case "Cold": case "UTI":
						$speech_screen = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8. Auditory Screening.Speech Screening" => $symptom))->get($academic_year);
						foreach($speech_screen as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Oral Hygiene -Poor":
						$oral_poor = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->get($academic_year);
						foreach($oral_poor as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Carious Teeth":
						$carious_teeth = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->get($academic_year);
						foreach($carious_teeth as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Flourosis":
						$flourosis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->get($academic_year);
						foreach($flourosis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				   		case "Orthodontic Treatment":
				    	$orho_treatment = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->get($academic_year);
				    	foreach($orho_treatment as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				    	case "Indication for extraction":
				    	$ife = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->get($academic_year);
				    	foreach($ife as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				     	case "Halitosis":
				      	$halitotis = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->get($academic_year);
				      	foreach($halitotis as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				      case "Flat patches Red":
				       $fpr = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->get($academic_year);
				       foreach($fpr as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				       case "Flat patches White":
				       $fpw = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->get($academic_year);
				       foreach($fpw as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

				        case "Ulcer":
				        $ulcer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->get($academic_year);
				        foreach($ulcer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						case "Doctor Referral Made":
						$doctor_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->get($academic_year);
						foreach($doctor_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
						break;

						 case "Vision Referral Made":
						 $vision_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($vision_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;

						 case "Auditory Referral Made":
						 $auditory_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($auditory_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
						 case "Dental Check-up Referral Made":
						 $dental_refer = $this->mongo_db->select(array('doc_data.widget_data.page2.Personal Information.School Name'))->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->get($academic_year);
						 foreach($dental_refer as $symptom)
							{
							$school = $symptom['doc_data']['widget_data']['page2']['Personal Information']['School Name'];

							array_push($empty, $school);

							}

							$schools_with_count = array_count_values($empty);
						return $schools_with_count;
							break;
			default:
				break;
		}
		}
			
	}

	public function get_students_by_symptom($symptom, $school, $academic_years_data)
	{
		
		if($academic_years_data == "2017-2018"){
			$academic_year = 'healthcare201671115519757';
		}elseif($academic_years_data == "2015-2016" || $academic_years_data == "2019-2020"){
			$academic_year = 'healthcare201671115519757';
		}else {
			$academic_year = 'ttwreis_screening_report_col_'.$academic_years_data;
		}

		switch ($symptom) {

			// General Symptoms
			case "ENT": case "Neurologic": case "Heart": case "Skin": case "Abdomen": case "Lungs": case "H and N": case "Genetalia": case "Lymphatic": case "Lyphamatic": case "Genitalia":
				$general_symptoms = $this->mongo_db->where(array("doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $general_symptoms;
				break;
			// Ortho problems
			case "Neck": case "Shoulders": case "Arms/Hands": case "Knees": case "Feet": case "Hips": case "Arms":
				$ortho_problms = $this->mongo_db->where(array("doc_data.widget_data.page4.Doctor Check Up.Ortho" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $ortho_problms;
				break;
			// Postural problems
			case "No spinal Abnormality": case "Spinal Abnormality": case "Moderate": case "Mild": case "Marked": case 'Spinal Abnomality': case "Referral Made": case "Referal Made":

				$postural_problms = $this->mongo_db->where(array("doc_data.widget_data.page4.Doctor Check Up.Postural" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $postural_problms;
				break;
			// Common problems
			case "Myalgia": case "Tonsillitis": case "tonsillitis": case "Cold": case "cold": case "Cervical Lymph Adenitis": case "ASOM": case "Acute Br.Asthama": case "Icterus": case "Pyrexia": case "URTI": case "Injuries": case "UTI": case "Angular Stomatities": case "Angular Stomatitis": case "Aphthous Ulcers": case "Glossities": case "Pharyngitis": case "Headache": case "Stomachache": case "Diarrhea": case "Behaviour Disorder":
				$common_problems = $this->mongo_db->where(array("doc_data.widget_data.page4.Doctor Check Up.Common Diseases" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $common_problems;
				break;
    		// Defects at Birth problems
			case "Neural Tube Defect": case "Down Syndrome": case "Cleft Lip and Palate": case "Talipes Club foot": case "Developmental Dyslpasia of Hip": case "Congenital Heart Disease": case "Congenital Cataract": case "Congenital Deafness": case "Congential Heart Disease": case "Retinopathy of Prematurity": case "Retinopathy of Prematurity(only at DH)": case "Sickle Cell Anaemia": case "Down Syndome": case "Congential Cataract": case "Congential Deafness":

				$defects_at_birth_problems = $this->mongo_db->where(array("doc_data.widget_data.page5.Doctor Check Up.Defects at Birth" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $defects_at_birth_problems;
				break;
			// Deficencies problems
			case "Anemia-Mild": case "Anemia-Moderate": case "Anemia-Severe": case "Vitamin Deficiency - BComplex": case "Vitamin A Deficiency": case "Vitamin C Deficiency": case "Vitamin D Deficiency": case "SAM/Stunting": case "Goiter":case "Under Weight": case "Over Weight":case "Obese": case "Anaemia": case "Anemic": case "Vitamin Deficiency - Bcomplex": case "Normal Weight":
				$deficencies_problems = $this->mongo_db->where(array("doc_data.widget_data.page5.Doctor Check Up.Deficencies" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $deficencies_problems;
				break;
    		// Childhood Disease problems
			case "CSOM": case "Rheumatic Heart Disease": case "Chronic Br.Asthma": case "Hyperthyroidism": case "Hypothyrodism": case "Hypothyroidism": case "Type-I Diabeties": case "Type-II Diabeties": case "Epilepsy": case "PCOD": case 'Type-I Diabetes': case 'Type-II Diabetes': case 'Skin Conditions': case 'Asthma': case 'Skin conditions': case 'Hypothyrodism': case 'Otitis Media': case 'Convulsive Disorders': case 'Diabetes':
			
				$deficencies_problems = $this->mongo_db->where(array("doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
				return $deficencies_problems;
				break;
			// Skin problems
			case "Scabies": case "Taenia Corporis": case "Taenia Facialis": case "Taenia Cruris": case "ECCEMA": case "Psoriasis": case "Allergic Rash": case "White Patches on Face": case "Acne on Face": case "Hyper Pigmentation": case "Hypo Pigmentation": case "Hansens Disease": case "Molluscum": case "Nail Bed Disease": case "Greying of Hair": case "Danddruff": case "Cracked Feet": case "Hyperhidrosis": case "ECZEMA": case "Greying Hair":
			$skin_problems = $this->mongo_db->where(array("doc_data.widget_data.page4.Doctor Check Up.Skin conditions" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
			return $skin_problems;
			break;

					//Vision Abnormalities
					case "Without Glasses Right":

						$without_glass_right = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", "")), 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
					return $without_glass_right;
					break;

					case "Without Glasses Left":
					$without_glass_left = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true), "doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", "")), 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
					return $without_glass_left;
					break;

					case "With Glasses Right":

						$with_glass_right = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", "")), 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
					return $with_glass_right;
					break;

					case "With Glasses Left":
					$with_glass_left = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true), "doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", "")), 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
					return $with_glass_left;
					break;

					case "Left Squnit": case "Redness of Eye Left": case "Redness of Eye Right": case "Redness of Eye": case "Stye": case "Trauma": case "Blepharitis": case "Right Squnit": case "Myopia": case "Forign Boady": case "Hyperopia": case "Pterizium": case "Chalazion": case "Pterygium": case "Forign Body":
					$vision_problem = $this->mongo_db->where(array("doc_data.widget_data.page6.Vision Screening" => $symptom, 'doc_data.widget_data.page2.Personal Information.School Name' => $school ))->get($academic_year);
					return $vision_problem;
					break;

					case "Bitot Night Blindness":
						
					$bitot = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->get($academic_year);

					return $bitot;
					break;

				//Auditory 

					case "Auditory Screening Right":

					$auditory_right = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->get($academic_year);
					return $auditory_right;
					break; 

					case "Auditory Screening Left":
					$auditory_left = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->get($academic_year);
					return $auditory_left;
					break;

					case "Normal": case "Fluency": case "Normal": case "Delay": case "Fluency": case "Misarticulation": case "Tongue Tie": case "Stammering": case "Voice": case "Behaviour Disorder": case "Language Delay": case "Misarticulaion": case "Pyrexia": case "Injuries": case "Myalgia": case "Pharyngitis": case "Stomachache": case "Headache": case "Cold": case "UTI": case "Behaviour Disorder ": case "Behaviour Disorder":
					$speech_screen = $this->mongo_db->where(array("doc_data.widget_data.page8. Auditory Screening.Speech Screening" => $symptom, "doc_data.widget_data.page2.Personal Information.School Name" => $school ))->get($academic_year);
					return $speech_screen;
					break;

					//Dental Problems

					case "Oral Hygiene -Poor":
					$oral_poor = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->get($academic_year);
					return $oral_poor;
					break;

					case "Carious Teeth":
					$carious_teeth = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->get($academic_year);
					return $carious_teeth;
					break;

					case "Flourosis":
					$flourosis = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->get($academic_year);
					return $flourosis;
					break;

			   		case "Orthodontic Treatment":
			    	$orho_treatment = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->get($academic_year);
			    	return $orho_treatment;
					break;

			    	case "Indication for extraction":
			    	$ife = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->get($academic_year);
			    	return $ife;
					break;

			     	case "Halitosis":
			      	$halitotis = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->get($academic_year);
			      	return $halitotis;
					break;

			      case "Flat patches Red":
			       $fpr = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->get($academic_year);
			       return $fpr;
					break;

			       case "Flat patches White":
			       $fpw = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->get($academic_year);
			       return $fpw;
					break;

			        case "Ulcer":
			        $ulcer = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->get($academic_year);
			        return $ulcer;
					break;

					//Refferal Made
					case "Doctor Referral Made":
					$doctor_refer = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->get($academic_year);
					return $doctor_refer;
					break;

					case "Vision Referral Made":
					 $vision_refer = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->get($academic_year);
					 return $vision_refer;
						break;

				 case "Auditory Referral Made":
				 $auditory_refer = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->get($academic_year);
				 return $auditory_refer;
					break;
				 case "Dental Check-up Referral Made":
				 $dental_refer = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school)->where(array("doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->get($academic_year);
				 return $dental_refer;
					break;
			default:
				break;
		}
	}

	// Code for Table View

	public function get_all_screening_diseases_counts($academic_years_data, $abnormalities, $po_name, $school_name = false)
	{

		if($academic_years_data == "2017-2018"){
			$academic_year = 'healthcare201671115519757';
		}elseif($academic_years_data == "2015-2016" || $academic_years_data == "2019-2020"){
			$academic_year = 'healthcare201671115519757';
		}else {
			$academic_year = 'ttwreis_screening_report_col_'.$academic_years_data;
		}

	    
		if(($school_name == false) || ($school_name == 'All_po'))
		{
			$school_name = 'All';
		}

	    $abnormalities_array = array();

	    if(($po_name == 'All') && ($school_name == 'All')){

	    	switch ($abnormalities) {

	    	case 'General_Abnormalities': case 'General Abnormalities':
	    		$check = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities"));
	          		foreach ($check['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities'=>$value))->count($academic_year);

		          		$check['values'] = $value;
		          		$check['count'] = $qry;
			          	if($check['count'] != 0 && $check['values'] != " " && $check['values'] != ""){
			          		array_push($abnormalities_array, $check);
		          		}
		          		
		        }
	    	break;

	    	case 'postural': case 'Postural Abnormalities':
	    		    	
	          	$postural = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Postural"));
		          	foreach ($postural['values'] as $index => $value) {
		          		
			          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Postural'=>$value))->count($academic_year);
		          		
			          		$postural['values'] = $value;
			          		$postural['count'] = $qry;

			          		if($postural['count'] != 0 && $postural['values'] != " " && $postural['values'] != ""){
			          		array_push($abnormalities_array, $postural);
		          			}
			          		
			        	}
			break;

			case 'ortho': case 'Ortho Abnormalities':
				$ortho = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Ortho"));
	          		foreach ($ortho['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Ortho'=>$value))->count($academic_year);
		          		$ortho['values'] = $value;
		          		$ortho['count'] = $qry;

		          		if($ortho['count'] != 0 && $ortho['values'] != " " && $ortho['values'] != ""){
			          		array_push($abnormalities_array, $ortho);
		          			}
		          		
		        }

			break;

			case 'skin': case 'Skin Abnormalities':
				$skin = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Skin conditions"));
		        foreach ($skin['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Skin conditions'=>$value))->count($academic_year);
		          	//log_message('error','checkingskinconditionsscabies==='.print_r($qry,true));
		          		$skin['values'] = $value;
		          		$skin['count'] = $qry;

		          		if($skin['count'] != 0){
			          		array_push($abnormalities_array, $skin);
		          			}
		          }

			break;

			case 'common_dieseases': case 'Common Disease Abnormalities':
				$common_dieseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Common Diseases"));
	          foreach ($common_dieseases['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Common Diseases'=>$value))->count($academic_year);
		          		$common_dieseases['values'] = $value;
		          		$common_dieseases['count'] = $qry;
		          		if($common_dieseases['count'] != 0){
			          		array_push($abnormalities_array, $common_dieseases);
		          			}
		          }

			break;

			case 'defects_at_birth': case 'Defects At Birth':
				$defects_at_birth = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth"));
           		foreach ($defects_at_birth['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page5.Doctor Check Up.Defects at Birth'=>$value))->count($academic_year);
	          		$defects_at_birth['values'] = $value;
	          		$defects_at_birth['count'] = $qry;
	          		if($defects_at_birth['count'] != 0 && $defects_at_birth['values'] != " " && $defects_at_birth['values'] != ""){
			          		array_push($abnormalities_array, $defects_at_birth);
		          			}
	          	}

			break;	

			case 'deficencies': case 'Deficiencies':

				//$deficencies = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Deficencies"));
				$deficencies = [
					   
					"Under Weight",
					"Anaemia",
					"Vitamin Deficiency - Bcomplex",
					"Over Weight",
					"Anemic",
					"Vitamin deficiency",
					"Goiter",
					"Vitamin A Deficiency",
					"Vitamin D Deficiency",
					"Normal Weight",
					"SAM/stunting",
					"Obese",
					"Anemia-Mild",
					"Anemia-Moderate"
					];
          		foreach ($deficencies as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page5.Doctor Check Up.Deficencies'=>$value))->count($academic_year);
	          		$deficencies['values'] = $value;
	          		$deficencies['count'] = $qry;
	          		if($deficencies['count'] != 0 && $deficencies['values'] != " " && $deficencies['values'] != ""){
	          		array_push($abnormalities_array, $deficencies);
          			}
	          	}
			break;

			case 'childhood_diseases': case 'Childhood Diseases':
				 $childhood_diseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases"));
          		foreach ($childhood_diseases['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases'=>$value))->count($academic_year);
	          		$childhood_diseases['values'] = $value;
	          		$childhood_diseases['count'] = $qry;
	          		if($childhood_diseases['count'] != 0 && $childhood_diseases['values'] != " " && $childhood_diseases['values'] != ""){
			          		array_push($abnormalities_array, $childhood_diseases);
		          			}
	          }

			break;	  
	    		        
	    	case 'Eye_Abnormalities': case 'Eye Abnormalities':

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Right";
	          		$vision_screening['count'] = $qry;
	          		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}

	          	$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Left";
	          		$vision_screening['count'] = $qry;
			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}

			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Right";
	          		$vision_screening['count'] = $qry;
			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}

			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Left";
	          		$vision_screening['count'] = $qry;

			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}

			    $vision_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page6.Vision Screening"));
          		foreach ($vision_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page6.Vision Screening'=>$value))->count($academic_year);
	          		$vision_screening['values'] = $value;
	          		$vision_screening['count'] = $qry;
	          		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}
	          	}

	          	$qry = $this->mongo_db->where(array("doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->count($academic_year);
	    		$vision_screening['values'] = "Bitot Night Blindness";
	    		$vision_screening['count'] = $qry;

	    		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
          			}

	    		
	    	break;

	    	case 'Auditory_Abnormalities' : case 'Auditory And Speech Abnormalities':

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Right";
	    		$auditory_screening['count'] = $qry;

	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Left";
	    		$auditory_screening['count'] = $qry;
	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$speech_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.Speech Screening"));
          		foreach ($speech_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page8. Auditory Screening.Speech Screening'=>$value))->count($academic_year);
	          		$speech_screening['values'] = $value;
	          		$speech_screening['count'] = $qry;
	          		if($speech_screening['count'] != 0 && $speech_screening['values'] != 'Normal' && $speech_screening['values'] != " " && $speech_screening['values'] != ""){
	          		array_push($abnormalities_array, $speech_screening);
	      			}
	          	}

	          	$dd_disability = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.D D and disability"));
          		foreach ($dd_disability['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page8. Auditory Screening.D D and disability'=>$value))->count($academic_year);
	          		$dd_screening['values'] = $value;
	          		$dd_screening['count'] = $qry;
	          		if(!empty($dd_screening['values']) && $dd_screening['count'] != 0){
	          		array_push($abnormalities_array, $dd_screening);
	      			}
	          	}


	    	break;

	    	case 'Dental_Checkup': case 'Dental Abnormalities':

          		$qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->count($academic_year);
	          		$carious_teeth['values'] = "Oral Hygiene -Poor";
	          		$carious_teeth['count'] = $qry;
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Carious Teeth";
	          		$carious_teeth['count'] = $qry;
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Flourosis";
	          		$carious_teeth['count'] = $qry;
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Orthodontic Treatment";
	          		$carious_teeth['count'] = $qry;
			        
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Indication for extraction";
	          		$carious_teeth['count'] = $qry;
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Halitosis";
	          		$carious_teeth['count'] = $qry;
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->count($academic_year);
	          		$carious_teeth['values'] = "Flat patches Red";
	          		$carious_teeth['count'] = $qry;
			        
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
			    $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->count($academic_year);
	          		$carious_teeth['values'] = "Flat patches White";
	          		$carious_teeth['count'] = $qry;
			       
			       if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Ulcer";
	          		$carious_teeth['count'] = $qry;
			       if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
		          		
	    		break;

	    	case 'Refferal_Made':


	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Doctor Referral Made";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Vision Referral Made";
	    		$carious_teeth['count'] = $qry;
	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Auditory Referral Made";
	    		$carious_teeth['count'] = $qry;
	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Dental Check-up Referral Made";
	    		$carious_teeth['count'] = $qry;
	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
	    		
	    		break;
	    	case 'Command_centre':

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page10.Command Center Followup"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Command Center Followup";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page10.Post Operative Cases"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Post Operative Cases";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array("doc_data.widget_data.page10.Surgery Cases"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Surgery Cases";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
	    		
	    		break;
	    	
	    	default:
	    		# code...
	    		break;
	    }

	    }elseif (($po_name != 'All') && ($school_name == 'All')) {
	    	 switch ($abnormalities) {

	    	case 'General_Abnormalities': case 'General Abnormalities':
	    		$check = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities"));
	          		foreach ($check['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities'=>$value))->count($academic_year);
		          		$check['values'] = $value;
		          		$check['count'] = $qry;

		          	if($check['count'] != 0 && $check['values'] != " " && $check['values'] != ""){
	          		array_push($abnormalities_array, $check);
	      			}
		        }
	    	break;

	    	case 'postural': case 'Postural Abnormalities':
	    		    	
	          	$postural = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Postural"));
		          	foreach ($postural['values'] as $index => $value) {
			          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page4.Doctor Check Up.Postural'=>$value))->count($academic_year);
			          		$postural['values'] = $value;
			          		$postural['count'] = $qry;
			          		if($postural['count'] != 0 && $postural['values'] != " " && $postural['values'] != ""){
			          		array_push($abnormalities_array, $postural);
			      			}
			        	}
			break;

			case 'ortho': case 'Ortho Abnormalities':
				$ortho = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Ortho"));
	          		foreach ($ortho['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page4.Doctor Check Up.Ortho'=>$value))->count($academic_year);
		          		$ortho['values'] = $value;
		          		$ortho['count'] = $qry;
		          		if($ortho['count'] != 0 && $ortho['values']!= " " && $ortho['values'] != ""){
		          		array_push($abnormalities_array, $ortho);
		      			}

		        }

			break;
/*
			case 'skin': case 'Skin Abnormalities':
				$skin = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Skin conditions"));
		        foreach ($skin['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page4.Doctor Check Up.Skin conditions'=>$value))->count($academic_year);
		          	//log_message('error','checkingskinconditionsscabies==='.print_r($qry,true));
		          		$skin['values'] = $value;
		          		$skin['count'] = $qry;
		          		if($skin['count'] != 0){
		          		array_push($abnormalities_array, $skin);
		      			}
		          }

			break;*/

		/*	case 'common_dieseases': case 'Common Disease Abnormalities':
				$common_dieseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Common Diseases"));
	          foreach ($common_dieseases['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page4.Doctor Check Up.Common Diseases'=>$value))->count($academic_year);
		          		$common_dieseases['values'] = $value;
		          		$common_dieseases['count'] = $qry;
		          		if($common_dieseases['count'] != 0){
		          		array_push($abnormalities_array, $common_dieseases);
		      			}
		          }

			break;*/

			case 'defects_at_birth': case 'Defects At Birth':
				$defects_at_birth = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth"));
           		foreach ($defects_at_birth['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page5.Doctor Check Up.Defects at Birth'=>$value))->count($academic_year);
	          		$defects_at_birth['values'] = $value;
	          		$defects_at_birth['count'] = $qry;
	          		if($defects_at_birth['count'] != 0 && $defects_at_birth['values'] != " " && $defects_at_birth['values'] != ""){
	          		array_push($abnormalities_array, $defects_at_birth);
	      			}
	          	}

			break;	

			case 'deficencies': case 'Deficiencies':

				//$deficencies = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Deficencies"));
				$deficencies = [
					   "Under Weight",
					"Anaemia",
					"Vitamin Deficiency - Bcomplex",
					"Over Weight",
					"Anemic",
					"Vitamin deficiency",
					"Goiter",
					"Vitamin A Deficiency",
					"Vitamin D Deficiency",
					"Normal Weight",
					"SAM/stunting",
					"Obese",
					"Anemia-Mild",
					"Anemia-Moderate"
					];
          		foreach ($deficencies as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page5.Doctor Check Up.Deficencies'=>$value))->count($academic_year);
	          		$deficencies['values'] = $value;
	          		$deficencies['count'] = $qry;
	          		if($deficencies['count'] != 0 && $deficencies['values']!= " " && $deficencies['values'] != ""){
	          		array_push($abnormalities_array, $deficencies);
	      			}
	          	}
			break;

			case 'childhood_diseases': case 'Childhood Diseases':
				 $childhood_diseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases"));
          		foreach ($childhood_diseases['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases'=>$value))->count($academic_year);
	          		$childhood_diseases['values'] = $value;
	          		$childhood_diseases['count'] = $qry;
	          		if($childhood_diseases['count'] != 0 && $childhood_diseases['values']!= " " && $childhood_diseases['values'] != ""){
	          		array_push($abnormalities_array, $childhood_diseases);
	      			}
	          }

			break;	  
	    		        
	    	case 'Eye_Abnormalities': case 'Eye Abnormalities':

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Right";
	          		$vision_screening['count'] = $qry;

	          		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

	          	$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Left";
	          		$vision_screening['count'] = $qry;
			          
			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Right";
	          		$vision_screening['count'] = $qry;
			          
			       if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			     $qry = $this->mongo_db->where(array("doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Left";
	          		$vision_screening['count'] = $qry;
			          
			       if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			    $vision_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page6.Vision Screening"));
          		foreach ($vision_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page6.Vision Screening'=>$value))->count($academic_year);
	          		$vision_screening['values'] = $value;
	          		$vision_screening['count'] = $qry;
	          		if($vision_screening['count'] != 0 && $vision_screening['values']!=" " && $vision_screening['values']!= ""){
	          		array_push($abnormalities_array, $vision_screening);
	      			}
	          	}

	          	$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->count($academic_year);
	    		$vision_screening['values'] = "Bitot Night Blindness";
	    		$vision_screening['count'] = $qry;

	    		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

	    		
	    	break;

	    	case 'Auditory_Abnormalities' : case 'Auditory And Speech Abnormalities':

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Right";
	    		$auditory_screening['count'] = $qry;

	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Left";
	    		$auditory_screening['count'] = $qry;

	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$speech_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.Speech Screening"));
          		foreach ($speech_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page8. Auditory Screening.Speech Screening'=>$value))->count($academic_year);
	          		$speech_screening['values'] = $value;
	          		$speech_screening['count'] = $qry;
	          		if($speech_screening['count'] != 0 && $speech_screening['values']!=" " && $speech_screening['values'] != "" ){
	          		array_push($abnormalities_array, $speech_screening);
	      			}
	          	}

	          	$dd_disability = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.D D and disability"));
          		foreach ($dd_disability['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, 'doc_data.widget_data.page8. Auditory Screening.D D and disability'=>$value))->count($academic_year);
	          		$dd_screening['values'] = $value;
	          		$dd_screening['count'] = $qry;
	          		if($dd_screening['count'] != 0){
	          		array_push($abnormalities_array, $dd_screening);
	      			}
	          	}


	    	break;

	    	case 'Dental_Checkup': case 'Dental Abnormalities':

          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->count($academic_year);
	          		$carious_teeth['values'] = "Oral Hygiene -Poor";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Carious Teeth";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Flourosis";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Orthodontic Treatment";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Indication for extraction";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Halitosis"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Halitosis";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"Red"))->count($academic_year);
	          		$carious_teeth['values'] = "Flat patches Red";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Flat patches"=>"White"))->count($academic_year);
	          		$carious_teeth['values'] = "Flat patches White";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Ulcer"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Ulcer";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
		          		
	    		break;

	    	case 'Refferal_Made':


	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page5.Doctor Check Up.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Doctor Referral Made";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page7.Colour Blindness.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Vision Referral Made";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page8.Auditory Screening.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Auditory Referral Made";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page9.Dental Check-up.Referral Made"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Dental Check-up Referral Made";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
	    		
	    		break;
	    	case 'Command_centre':

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page10.Command Center Followup"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Command Center Followup";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page10.Post Operative Cases"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Post Operative Cases";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$po_name, "doc_data.widget_data.page10.Surgery Cases"=>"Yes"))->count($academic_year);
	    		$carious_teeth['values'] = "Surgery Cases";
	    		$carious_teeth['count'] = $qry;

	    		if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}
	    		
	    		break;
	    	
	    	default:
	    		# code...
	    		break;
	    }
	    }elseif (($po_name != 'All') && ($school_name != 'All')) {
	    	 switch ($abnormalities) {

	    	case 'General_Abnormalities': case 'General Abnormalities':
	    		$check = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities"));
	          		foreach ($check['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page4.Doctor Check Up.Check the box if normal else describe abnormalities'=>$value))->count($academic_year);
		          		$check['values'] = $value;
		          		$check['count'] = $qry;

		          		if($check['count'] != 0 && $check['values']!=" " && $check['values']!=""){
		          		array_push($abnormalities_array, $check);
		      			}
		        }
	    	break;

	    	case 'postural': case 'Postural Abnormalities':
	    		    	
	          	$postural = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Postural"));
		          	foreach ($postural['values'] as $index => $value) {
			          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page4.Doctor Check Up.Postural'=>$value))->count($academic_year);
			          		$postural['values'] = $value;
			          		$postural['count'] = $qry;
			          		if($postural['count'] != 0 && $postural['values'] != " " && $postural['values'] != ""){
			          		array_push($abnormalities_array, $postural);
			      			}
			        	}
			break;

			case 'ortho': case 'Ortho Abnormalities':
				$ortho = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Ortho"));
	          		foreach ($ortho['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page4.Doctor Check Up.Ortho'=>$value))->count($academic_year);
		          		$ortho['values'] = $value;
		          		$ortho['count'] = $qry;
		          		if($ortho['count'] != 0 && $ortho['values']!=" " && $ortho['values'] != ""){
		          		array_push($abnormalities_array, $ortho);
		      			}
		        }

			break;

			/*case 'skin': case 'Skin Abnormalities':
				$skin = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Skin conditions"));
		        foreach ($skin['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page4.Doctor Check Up.Skin conditions'=>$value))->count($academic_year);
		          	//log_message('error','checkingskinconditionsscabies==='.print_r($qry,true));
		          		$skin['values'] = $value;
		          		$skin['count'] = $qry;
		          		if($skin['count'] != 0){
		          		array_push($abnormalities_array, $skin);
		      			}
		          }

			break;

			case 'common_dieseases': case 'Common Disease Abnormalities':
				$common_dieseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page4.Doctor Check Up.Common Diseases"));
	          foreach ($common_dieseases['values'] as $index => $value) {
		          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page4.Doctor Check Up.Common Diseases'=>$value))->count($academic_year);
		          		$common_dieseases['values'] = $value;
		          		$common_dieseases['count'] = $qry;
		          		if($common_dieseases['count'] != 0){
		          		array_push($abnormalities_array, $common_dieseases);
		      			}
		          }

			break;*/

			case 'defects_at_birth': case 'Defects At Birth':
				$defects_at_birth = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Defects at Birth"));
           		foreach ($defects_at_birth['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page5.Doctor Check Up.Defects at Birth'=>$value))->count($academic_year);
	          		$defects_at_birth['values'] = $value;
	          		$defects_at_birth['count'] = $qry;
	          		if($defects_at_birth['count'] != 0 && $defects_at_birth['values']!=" " && $defects_at_birth['values']!=""){
	          		array_push($abnormalities_array, $defects_at_birth);
	      			}
	          	}

			break;	

			case 'deficencies': case 'Deficiencies':

				//$deficencies = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Deficencies"));
				$deficencies = [
					   "Under Weight",
					"Anaemia",
					"Vitamin Deficiency - Bcomplex",
					"Over Weight",
					"Anemic",
					"Vitamin deficiency",
					"Goiter",
					"Vitamin A Deficiency",
					"Vitamin D Deficiency",
					"Normal Weight",
					"SAM/stunting",
					"Obese",
					"Anemia-Mild",
					"Anemia-Moderate"
					];
          		foreach ($deficencies as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page5.Doctor Check Up.Deficencies'=>$value))->count($academic_year);
	          		$deficencies['values'] = $value;
	          		$deficencies['count'] = $qry;
	          		if($deficencies['count'] != 0 && $deficencies['values']!=" " && $deficencies['values']!=""){
	          		array_push($abnormalities_array, $deficencies);
	      			}
	          	}
			break;

			case 'childhood_diseases': case 'Childhood Diseases':
				 $childhood_diseases = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases"));
          		foreach ($childhood_diseases['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page5.Doctor Check Up.Childhood Diseases'=>$value))->count($academic_year);
	          		$childhood_diseases['values'] = $value;
	          		$childhood_diseases['count'] = $qry;
	          		if($childhood_diseases['count'] != 0 && $childhood_diseases['values'] !=" " && $childhood_diseases['values'] != ""){
	          		array_push($abnormalities_array, $childhood_diseases);
	      			}
	          }

			break;	  
	    		        
	    	case 'Eye_Abnormalities': case 'Eye Abnormalities':

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Right";
	          		$vision_screening['count'] = $qry;
	          		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

	          	$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Without Glasses" => array('$exists' => true),"doc_data.widget_data.page6.Without Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "Without Glasses Left";
	          		$vision_screening['count'] = $qry;
			          
			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Right"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Right";
	          		$vision_screening['count'] = $qry;
			          
			        if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.With Glasses" => array('$exists' => true),"doc_data.widget_data.page6.With Glasses.Left"=>array('$nin'=> array("6/12", "6/6", "6/9", ""))))->count($academic_year);
	          		$vision_screening['values'] = "With Glasses Left";
	          		$vision_screening['count'] = $qry;
			          
			       if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

			    $vision_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page6.Vision Screening"));
          		foreach ($vision_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page6.Vision Screening'=>$value))->count($academic_year);
	          		$vision_screening['values'] = $value;
	          		$vision_screening['count'] = $qry;
	          		if($vision_screening['count'] != 0 && $vision_screening['values'] != " " && $vision_screening['values']!= "" && $vision_screening['values'] != "Normal"){
	          		array_push($abnormalities_array, $vision_screening);
	      			}
	          	}

	          	$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page6.Bitot Night Blindness"=>"Yes"))->count($academic_year);
	    		$vision_screening['values'] = "Bitot Night Blindness";
	    		$vision_screening['count'] = $qry;

	    		if($vision_screening['count'] != 0){
	          		array_push($abnormalities_array, $vision_screening);
	      			}

	    		
	    	break;

	    	case 'Auditory_Abnormalities' : case 'Auditory And Speech Abnormalities':

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8. Auditory Screening.Right"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Right";
	    		$auditory_screening['count'] = $qry;

	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page8. Auditory Screening.Left"=>"Fail"))->count($academic_year);
	    		$auditory_screening['values'] = "Auditory Screening Left";
	    		$auditory_screening['count'] = $qry;

	    		if($auditory_screening['count'] != 0){
          		array_push($abnormalities_array, $auditory_screening);
      			}

	    		$speech_screen = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.Speech Screening"));
          		foreach ($speech_screen['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page8. Auditory Screening.Speech Screening'=>$value))->count($academic_year);
	          		$speech_screening['values'] = $value;
	          		$speech_screening['count'] = $qry;
	          		if($speech_screening['count'] != 0 && $speech_screening['values']!=" " && $speech_screening['values']!= "" && $speech_screening['values']!= false && $speech_screening['values'] != 'Normal'){
	          		array_push($abnormalities_array, $speech_screening);
	      			}
	          	}

	          	$dd_disability = $this->mongo_db->command(array('distinct' => $academic_year ,'key' => "doc_data.widget_data.page8. Auditory Screening.D D and disability"));
          		foreach ($dd_disability['values'] as $index => $value) {
	          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, 'doc_data.widget_data.page8. Auditory Screening.D D and disability'=>$value))->count($academic_year);
	          		$dd_screening['values'] = $value;
	          		$dd_screening['count'] = $qry;
	          		if($dd_screening['count'] != 0){
	          		array_push($abnormalities_array, $dd_screening);
	      			}
	          	}


	    	break;

	    	case 'Dental_Checkup': case 'Dental Abnormalities':

          		$qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Oral Hygiene"=>"Poor"))->count($academic_year);
	          		$carious_teeth['values'] = "Oral Hygiene -Poor";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Carious Teeth"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Carious Teeth";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Flourosis"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Flourosis";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Orthodontic Treatment"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Orthodontic Treatment";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			     $qry = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=>$school_name, "doc_data.widget_data.page9.Dental Check-up.Indication for extraction"=>"Yes"))->count($academic_year);
	          		$carious_teeth['values'] = "Indication for extraction";
	          		$carious_teeth['count'] = $qry;
			          
			        if($carious_teeth['count'] != 0){
	          		array_push($abnormalities_array, $carious_teeth);
	      			}

			    
			   
		          		
	    		
	    		break;
	    	
	    	default:
	    		# code...
	    		break;
	    }
	    }

	    $abnormal_original = [];

	    foreach ($abnormalities_array as $abno) {
	    	 
	    	$data['label'] = $abno['values'];
	    	
	    	$data['value'] = $abno['count'];
	    	if($data['value'] != 0){

	    	array_push($abnormal_original, $data);
	    	}

	    }

	    return $abnormal_original;
	   
	}

	/*Db Creation*/

	public function refresh_for_create_db_school_zone_status($selected_opt, $district, $scl_zone, $type)
	{
		if($selected_opt == 'Scabies'){
			$data = $this->get_school_status_based_on_scabies($district, $type, $scl_zone);


			$doc_data['widget_data']['academic year'] = '2019-2020';
			$doc_data['widget_data']['problem'] = $selected_opt;
			$doc_data['widget_data']['date'] = date('Y-m-d');
			$doc_data['widget_data']['counts'] = $data;
			
			$pass = array('doc_data'=>$doc_data);

			$insert = $this->mongo_db->insert('tribal_school_health_status_counts', $pass);

		}else if($selected_opt == 'Abnormalities'){
			$data = $this->get_school_status_based_on_abnormal($district, $type, $scl_zone);


			$doc_data['widget_data']['academic year'] = '2019-2020';
			$doc_data['widget_data']['problem'] = $selected_opt;
			$doc_data['widget_data']['date'] = date('Y-m-d');
			$doc_data['widget_data']['counts'] = $data;
			
			$pass = array('doc_data'=>$doc_data);

			$insert = $this->mongo_db->insert('tribal_school_health_status_counts', $pass);


		}else if($selected_opt == 'Bites'){
			$data = $this->get_school_status_based_on_bites($district, $type, $scl_zone);

			$doc_data['widget_data']['academic year'] = '2019-2020';
			$doc_data['widget_data']['problem'] = $selected_opt;
			$doc_data['widget_data']['date'] = date('Y-m-d');
			$doc_data['widget_data']['counts'] = $data;
			$pass = array('doc_data'=>$doc_data);

			$insert = $this->mongo_db->insert('tribal_school_health_status_counts', $pass);

		}else if($selected_opt == 'HB'){
			$data = $this->get_school_status_based_on_hb($district, $type, $scl_zone);

			$doc_data['widget_data']['academic year'] = '2019-2020';
			$doc_data['widget_data']['problem'] = $selected_opt;
			$doc_data['widget_data']['date'] = date('Y-m-d');
			$doc_data['widget_data']['counts'] = $data;
			
			$pass = array('doc_data'=>$doc_data);

			$insert = $this->mongo_db->insert('tribal_school_health_status_counts', $pass);

		} elseif($selected_opt == 'BMI'){
			$data = $this->get_school_status_based_on_bmi($district, $type, $scl_zone);


			$doc_data['widget_data']['academic year'] = '2019-2020';
			$doc_data['widget_data']['problem'] = $selected_opt;
			$doc_data['widget_data']['date'] = date('Y-m-d');
			$doc_data['widget_data']['counts'] = $data;

			$pass = array('doc_data'=>$doc_data);

			$insert = $this->mongo_db->insert('tribal_school_health_status_counts', $pass);

		}


		return $insert;
	}

	public function get_schools_satus_for_dashboard_for_all($selected_opt)
	{
	$query = $this->mongo_db->limit(1)->select(array('doc_data.widget_data.counts'))->where('doc_data.widget_data.problem', $selected_opt)->orderBy(array('doc_data.widget_data.date'=> -1))->get('tribal_school_health_status_counts');

	return $query;
	}

/*School health status based on Problems*/
	public function get_schools_satus_for_dashboard($selected_opt, $district, $scl_zone, $type)
	{
		if($selected_opt == 'Scabies'){
			$data = $this->get_school_status_based_on_scabies($district, $type, $scl_zone);
		}else if($selected_opt == 'Abnormalities'){
			$data = $this->get_school_status_based_on_abnormal($district, $type, $scl_zone);
		}else if($selected_opt == 'Bites'){
			$data = $this->get_school_status_based_on_bites($district, $type, $scl_zone);
		}else if($selected_opt == 'HB'){
			$data = $this->get_school_status_based_on_hb($district, $type, $scl_zone);
		} elseif($selected_opt == 'BMI'){
			$data = $this->get_school_status_based_on_bmi($district, $type, $scl_zone);
		}
		return $data;
	}

/*Get school Names Based on Filters*/
public function get_all_schools_student_type_with_district($district_name) 
{

	if($district_name == 'All'){
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$query = $this->mongo_db->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		}else{
			$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$query = $this->mongo_db->where(array('school_name' => array('$regex' => $district_name)))->get ( $this->collections ['ttwreis_schools'] );
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		}
		
		foreach ( $query as $schools => $school ) {
			$dt_name = $this->mongo_db->where ( '_id', new MongoId ( $school ['dt_name'] ) )->get ( 'ttwreis_district' );
			if (isset ( $school ['dt_name'] )) {
				$query [$schools] ['dt_name'] = $dt_name [0] ['dt_name'];
			} else {
				$query [$schools] ['dt_name'] = "No state selected";
			}
		}
		return $query;

}



	public function get_school_status_based_on_scabies($district, $type, $scl_zone= FALSE)
	{
		//$total_count = [];
		$red = [];
		$orange = [];
		$green = [];

		$all_schools_name = array();
		$schools_list = $this->get_all_schools_student_type_with_district($district);
		foreach ($schools_list as $school_data) {
			array_push($all_schools_name, $school_data['school_name']);
		}

		
		foreach ($all_schools_name as $school) {
			$scabies_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Skin' => 'Scabies','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');


			if($type == 'for_count'){
				if($scabies_count_doc > 5){
					$zone = $school;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif (($scabies_count_doc >2) && ($scabies_count_doc <5)) {
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}else{

				if($scabies_count_doc > 5){
					$zone['scl'] = $school;
					$zone['count'] = $scabies_count_doc;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif (($scabies_count_doc >2) && ($scabies_count_doc <5)) {
					$zone['scl'] = $school;
					$zone['count'] = $scabies_count_doc;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone['scl'] = $school;
					$zone['count'] = $scabies_count_doc;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}
			
		}

		if($type == 'for_count'){
			$final['red'] = sizeof($red);
			$final['orange'] = sizeof($orange);
			$final['green'] = sizeof($green);

			/*$scab_all['red'] = sizeof($red);
			$scab_all['orange'] = sizeof($orange);
			$scab_all['green'] = sizeof($green);

			save_for_school_counts_db($scab_all);*/
		}else{
			if($scl_zone == 'Red Zone'){
				$final = $red;
			}elseif ($scl_zone == 'Orange Zone') {
				$final = $orange;
			}elseif ($scl_zone == 'Green Zone') {
				$final = $green;
			}
			
			
		}
		

		//array_push($total_count, $final);

		return $final;
	}

	public function get_school_status_based_on_abnormal($district, $type, $scl_zone= FALSE)
	{
		$red = [];
		$orange = [];
		$green = [];

		$all_schools_name = array();
		$schools_list = $this->get_all_schools_student_type_with_district($district);
		foreach ($schools_list as $school_data) {
			array_push($all_schools_name, $school_data['school_name']);
		}

		foreach ($all_schools_name as $school) {
			
			$abdominal_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Normal.Gastro_intestinal' =>'Abdominal Pain','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');

			$vomitings_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Normal.Gastro_intestinal' => 'Vomitings','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');
			
			$diarrhoea_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Normal.Gastro_intestinal' => 'Diarrhoea','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');
			
			$total = $abdominal_count_doc+$vomitings_count_doc+$diarrhoea_count_doc;

			
			if($type == 'for_count'){

				if($total > 6){
					$zone = $school;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif (($total >2) && ($total <5)) {
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}else{

				if($total > 6){
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif (($total >2) && ($total <5)) {
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}

			
		}

		if($type == 'for_count'){
			$final['red'] = sizeof($red);
			$final['orange'] = sizeof($orange);
			$final['green'] = sizeof($green);

		}else{
			if($scl_zone == 'Red Zone'){
				$final = $red;
			}elseif ($scl_zone == 'Orange Zone') {
				$final = $orange;
			}elseif ($scl_zone == 'Green Zone') {
				$final = $green;
			}
			
			
		}
		
		return $final;

	}

	public function get_school_status_based_on_bites($district, $type, $scl_zone= FALSE)
	{
		$red = [];
		$orange = [];
		$green = [];

		$all_schools_name = array();
		$schools_list = $this->get_all_schools_student_type_with_district($district);
		foreach ($schools_list as $school_data) {
			array_push($all_schools_name, $school_data['school_name']);
		}
		foreach ($all_schools_name as $school) {
			$scorpion_bite_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Emergency.Bites' =>'Scorpion','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');

			$snake_bite_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Emergency.Bites' => 'Snake','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');

			$honeybee_bite_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Emergency.Bites' => 'Honey Bee','doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school))->whereNe(array('doc_data.widget_data.page2.Review Info.Status' => "Cured"))->count('healthcare2016108181933756_static_html');

			$total = $scorpion_bite_count_doc+$snake_bite_count_doc+$honeybee_bite_count_doc;

			

			if($type == 'for_count'){

				if($total > 6){
							$zone = $school;
							//$zon['count'] = $scabies_count_doc;
							array_push($red, $zone);
						}elseif (($total >2) && ($total <6)) {
							$zone = $school;
							//$zone['count'] = $scabies_count_doc;
							array_push($orange, $zone);
						}else{
							$zone = $school;
							//$zone['count'] = $scabies_count_doc;
							array_push($green, $zone);
						}

			}else{

				if($total > 6){
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif (($total >2) && ($total <6)) {
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}


			}


		}

		if($type == 'for_count'){
			$final['red'] = sizeof($red);
			$final['orange'] = sizeof($orange);
			$final['green'] = sizeof($green);

		}else{
			if($scl_zone == 'Red Zone'){
				$final = $red;
			}elseif ($scl_zone == 'Orange Zone') {
				$final = $orange;
			}elseif ($scl_zone == 'Green Zone') {
				$final = $green;
			}
			
			
		}

		return $final;

	}

	public function get_school_status_based_on_hb($district, $type, $scl_zone= FALSE)
	{
		$red = [];
		$orange = [];
		$green = [];

		$all_schools_name = array();
		$schools_list = $this->get_all_schools_student_type_with_district($district);
		foreach ($schools_list as $school_data) {
			array_push($all_schools_name, $school_data['school_name']);
		}
		foreach ($all_schools_name as $school) {

			$severe_hb_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.HB_latest.hb' => array('$lte' => 8.0),'doc_data.widget_data.school_details.School Name' => $school))->count($this->hb_app_col);
			
			$moderate_hb_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.HB_latest.hb' => array('$gte' => 8.1, '$lte' => 10.0),'doc_data.widget_data.school_details.School Name' => $school))->count($this->hb_app_col);


			$mild_hb_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.HB_latest.hb' => array('$gte' => 10.1, '$lte' => 12.0),'doc_data.widget_data.school_details.School Name' => $school))->count($this->hb_app_col);


			$total = $severe_hb_count_doc+$moderate_hb_count_doc+$mild_hb_count_doc;

			$anemics = $severe_hb_count_doc+$moderate_hb_count_doc;


			if($type == 'for_count'){

				if($severe_hb_count_doc > 6 || $anemics > 10){
					$zone = $school;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif ($total >25) {
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}else{

				if($severe_hb_count_doc > 6 || $anemics > 10){
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif ($total >25) {
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}

		}

		if($type == 'for_count'){
			$final['red'] = sizeof($red);
			$final['orange'] = sizeof($orange);
			$final['green'] = sizeof($green);

		}else{
			if($scl_zone == 'Red Zone'){
				$final = $red;
			}elseif ($scl_zone == 'Orange Zone') {
				$final = $orange;
			}elseif ($scl_zone == 'Green Zone') {
				$final = $green;
			}
			
			
		}

		return $final;

	}

	public function get_school_status_based_on_bmi($district, $type, $scl_zone= FALSE)
	{
		$red = [];
		$orange = [];
		$green = [];

		$all_schools_name = array();
		$schools_list = $this->get_all_schools_student_type_with_district($district);
		foreach ($schools_list as $school_data) {
			array_push($all_schools_name, $school_data['school_name']);
		}
		foreach ($all_schools_name as $school) {

			$under_weight_bmi_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.BMI_latest.bmi' => array('$lte' => 18.50),'doc_data.widget_data.school_details.School Name' => $school))->count($this->bmi_app_col);

			$over_weight_bmi_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.BMI_latest.bmi' => array('$gte' => 25.00, '$lte' => 29.99),'doc_data.widget_data.school_details.School Name' => $school))->count($this->bmi_app_col);

			$obese_weight_bmi_count_doc = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.BMI_latest.bmi' => array('$gte' => 30.00),'doc_data.widget_data.school_details.School Name' => $school))->count($this->bmi_app_col);

			$total = $under_weight_bmi_count_doc+$over_weight_bmi_count_doc+$obese_weight_bmi_count_doc;

			$sever = $under_weight_bmi_count_doc+$obese_weight_bmi_count_doc;

			
			if($type == 'for_count'){

				if($under_weight_bmi_count_doc > 6 || $sever > 17){
					$zone = $school;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif ($total >25) {
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone = $school;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}else{

				if($under_weight_bmi_count_doc > 6 || $sever > 17){
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zon['count'] = $scabies_count_doc;
					array_push($red, $zone);
				}elseif ($total >25) {
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($orange, $zone);
				}else{
					$zone['scl'] = $school;
					$zone['count'] = $total;
					//$zone['count'] = $scabies_count_doc;
					array_push($green, $zone);
				}

			}
		}

		if($type == 'for_count'){
			$final['red'] = sizeof($red);
			$final['orange'] = sizeof($orange);
			$final['green'] = sizeof($green);

		}else{
			if($scl_zone == 'Red Zone'){
				$final = $red;
			}elseif ($scl_zone == 'Orange Zone') {
				$final = $orange;
			}elseif ($scl_zone == 'Green Zone') {
				$final = $green;
			}
			
			
		}

		return $final;

	}
/*End school health status */

/*Today glance for new dashboard*/
	public function get_quick_glance_label_counts_model($today_date)
	{
		 
		$data['fo_out_patient_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.Out Patient.hospialt_name' => array('$ne' => ''),'history.last_stage.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->count('ttwreis_field_officer_report');	 

		$data['fo_emergency_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.Emergency or Admitted.hospialt_name' => array('$ne' => ''),'history.last_stage.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->count('ttwreis_field_officer_report');

		$data['fo_review_cases_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.Review Cases.hospialt_name' => array('$ne' => ''),'history.last_stage.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->count('ttwreis_field_officer_report');

		$data['aneamia_cases_count'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Blood' =>  'Anemia','history.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->count('healthcare2016108181933756_static_html');

		$data['doctor_visiting_count']   = $this->mongo_db->select(array("doc_data.widget_data.school_details.School Name"))->where(array('history.last_stage.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->get('ttwreis_doctor_visiting_reports');

		$all_schools = [];

		foreach ($data['doctor_visiting_count'] as $school) {
				
					$school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];

					//echo print_r($school_name, true); exit();
					
					if(in_array($school_name, $all_schools)){

					}else{

						array_push($all_schools, $school_name);
					}
			}
			
			$data['count'] = count($all_schools);

		$data['surgery_needed_counts'] = $this->mongo_db->select(array())->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Surgery-Needed','history.time' => ($today_date) ? array('$regex' => $today_date) : array('$exists' => TRUE)))->count('healthcare2016108181933756_static_html');
		//echo print_r($data['surgery_needed_counts'], true); exit;

		return $data;	

	}


	public function get_anemia_records_based_on_span_model($start, $end)
   	{    

  	$query = $this->mongo_db->select(array('doc_data.widget_data', 'history'))->whereBetween('history.time', $start, $end)->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Blood' => 'Anemia'))->get('healthcare2016108181933756_static_html');

    return $query;

    }

/*Fetching Field officer Names*/

	public function get_field_officer_name()
	{
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
		$query = $this->mongo_db->select(array('username', 'email'))->where(array('email' => array('$regex' => "ttwreis.cc")))->get('ttwreis_cc');
		$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
		
		return $query;
	}

	public function get_fo_records_based_on_span_model($start, $end, $fo_mail)
{
	$email = str_replace('@', '#', $fo_mail);
	$query = $this->mongo_db->select(array('doc_data.widget_data', 'history'))->whereBetween('history.last_stage.time', $start, $end)->where('history.last_stage.submitted_by', $email)->get('ttwreis_field_officer_report');

	return $query;

}

	public function get_dr_submitted_records_based_on_span_model($start, $end, $dr_mail)		
	{			 
		$query = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('history.current_stage' => "Doctor", 'history.submitted_by'=>$dr_mail))->get("healthcare2016108181933756_static_html");
	   
	    return $query;

	}

	public function get_hs_anemia_submitted_docs_students_model($date)
	{

	$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Chronic.Blood' => 'Anemia'))->whereLike('history.time', $date)->get('healthcare2016108181933756_static_html');
	return $query;

	}

	public function get_hs_surgery_submitted_docs_students_model($date,$status)
	{

	$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status', $status)->whereLike('history.time', $date)->get('healthcare2016108181933756_static_html');
	return $query;

	}

	public function get_daily_doctor_visit_schools_list_model($date)
	{

	$query = $this->mongo_db->select(array("doc_data.widget_data.school_details.School Name"))->where(array('history.last_stage.time' => ($date) ? array('$regex' => $date) : array('$exists' => TRUE)))->get('ttwreis_doctor_visiting_reports');
	$all_schools = [];
	foreach ($query as $school) {

	$school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
	array_push($all_schools, $school_name);

	}

	$data = array_count_values($all_schools);

	return $data;

	}

	public function get_daily_doctor_visit_student_list_model($date, $status, $school_name)
	{

    $query = $this->mongo_db->where(array("doc_data.widget_data.school_details.School Name" => $school_name))->where(array('history.last_stage.time' => ($date) ? array('$regex' => $date) : array('$exists' => TRUE)))->get('ttwreis_doctor_visiting_reports');  

    return $query;

   }

	 public function get_time_span_visiting_student_list_model($school_name,$start_date,$end_date)
	 {
	 	$query = $this->mongo_db->where(array("doc_data.widget_data.school_details.School Name" => $school_name))->whereBetween('history.last_stage.time' , $start_date,$end_date)->get('ttwreis_doctor_visiting_reports');  

	 	return $query;
	 }

	 public function get_dr_visit_schools_based_on_span_model($start, $end)
     {						
     	
     $query = $this->mongo_db->select(array("doc_data.widget_data.school_details.School Name"))->whereBetween('history.last_stage.time' , $start, $end)->get('ttwreis_doctor_visiting_reports');    

     				$all_schools = [];
     				foreach ($query as $school) {
     						
     				$school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
     				array_push($all_schools, $school_name);     							
     					}  
     					$data = array_count_values(array_filter($all_schools));  
     				    					
    				return $data;

     }

	/* Emergency STudents carousal for new dashboard*/
	public function get_data_for_emergency_carousel($date)
	{
		$students = [];
		
		$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->whereLike('history.0.time',$date )->get('healthcare2016108181933756_static_html');

		foreach ($query as $p_data) {
			$ss = $p_data['doc_data']['widget_data']['page1']['Student Info']['Unique ID'];
			$data['uniqid'] = $ss;
			$data['name'] = $p_data['doc_data']['widget_data']['page1']['Student Info']['Name']['field_ref'];
			
			$data['discription'] = $p_data['doc_data']['widget_data']['page2']['Problem Info']['Description'];
			
			$get_pic = $this->mongo_db->select(array('doc_data.widget_data.page1.Personal Information.Photo'))->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $ss)->get('healthcare201671115519757');
			foreach ($get_pic as $pic) {
				$pic_check = $pic['doc_data']['widget_data']['page1']['Personal Information']['Photo'];
				if(isset($pic_check['file_path']) && !empty($pic_check['file_path'])){
					$data['pics'] = $pic_check['file_path'];
					array_push($students, $data);
				}else{
					array_push($students, $data);
				}
			}
		}
			
		return $students;
	}

	/*Chronic Pie Start*/
		/*Author === "Yoga narasimha"*/
public function get_chronic_counts_requests_pie_model()
    {        

        $requests_chronic_cases = [];

    //$req_cases = ["Epilepsy", "Asthma", "TB", "CHD", "Nephritic syndrome", "HIV", "Sickle Cell Anaemia","Anemia","Cancers","Renal Stones","Covid-19","Hypothyroidism","Scabies","Leprosy","Diabetes Milletus Type 1","Dental Caries"];
            

            $not_equal_to = array ("doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured"));

            $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Central_nervous_system', array("Epilepsy"))->count('healthcare2016108181933756_static_html');
            if($nor != 0)
            {
                $req['label'] = "Epilepsy";
                $req['value'] = $nor;
                array_push($requests_chronic_cases, $req);
            }

             $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Respiratory_system', array("Asthma"))->count('healthcare2016108181933756_static_html');
            if($nor != 0)
            {
                $req['label'] = "Asthma";
                $req['value'] = $nor;
                array_push($requests_chronic_cases, $req);
            }

            $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Emergency.Disease', array("Covid-19"))->count('healthcare2016108181933756_static_html');
            if($nor != 0)
            {
                $req['label'] = "Covid-19";
                $req['value'] = $nor;
                array_push($requests_chronic_cases, $req);
            }


            $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Others', array("TB"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "TB";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }


     $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Cardio_vascular_system', array("CHD"))->count('healthcare2016108181933756_static_html');
     
      if($nor != 0)
        {
            $req['label'] = "CHD";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

       $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Kidney', array("Nephritic syndrome"))->count('healthcare2016108181933756_static_html');
     
      if($nor != 0)
        {
            $req['label'] = "Nephritic syndrome";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

         $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Others', array("HIV"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "HIV";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }


     $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Blood', array("Sickle Cell Anemia"))->count('healthcare2016108181933756_static_html');
     
      if($nor != 0)
        {
            $req['label'] = "Sickle Cell Anemia";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

       $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Blood', array("Anemia"))->count('healthcare2016108181933756_static_html');
     
      if($nor != 0)
        {
            $req['label'] = "Anemia";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

     $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Skin', array("Cancers"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Cancers";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

        $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Endo', array("Hypothyroidism"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Hypothyroidism";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }

        $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Skin', array("Scabies"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Scabies";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }	

         $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Others', array("Leprosy"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Leprosy";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }	
    
     $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Endo', array("Diabetes Milletus Type 1"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Diabetes Milletus Type 1";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }		

         $nor = $this->mongo_db->where($not_equal_to)->whereIn('doc_data.widget_data.page1.Problem Info.Chronic.Ent', array("Dental Caries"))->count('healthcare2016108181933756_static_html');

      if($nor != 0)
        {
            $req['label'] = "Dental Caries";
            $req['value'] = $nor;
            array_push($requests_chronic_cases, $req);
        }


        return $requests_chronic_cases;
    }

   /*Chronic Pie End*/

    /*Chronic Students List Start*/
public function get_chronic_students_from_pie_model($symptom)
{			

		$not_equal_to = array ("doc_data.widget_data.page2.Review Info.Status" => array ('$ne' => "Cured"));

	switch ($symptom) {

 		case 'Epilepsy':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Central_nervous_system" , $symptom)->get("healthcare2016108181933756_static_html");

  		return $chronic_query;
         break;

		case 'Asthma':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Respiratory_system" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;
		         
		case 'HIV':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Others" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'TB':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Others" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Anemia':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Blood" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Sickle Cell Anemia':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Blood" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Cancers':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Skin" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'CHD':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Cardio_vascular_system" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Nephrotic Syndrome':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Kidney" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Hypothyroidism':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Endo" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;
		         break;

		case 'Covid-19':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Emergency.Disease" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;

		  case 'Scabies':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Skin" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;


		  case 'Leprosy':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Others" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;



		  case 'Diabetes Milletus Type 1':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Endo" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;



		  case 'Dental Caries':

		$chronic_query = $this->mongo_db->where($not_equal_to)->where("doc_data.widget_data.page1.Problem Info.Chronic.Ent" , $symptom)->get("healthcare2016108181933756_static_html");

		  return $chronic_query;


		         break;


		}
	
}


    /*Chronic Students List End*/

/*Total COunts Requests Pie*/
	public function get_total_counts_requests_pie($academic_year, $district_name, $school_name, $gender_type)
	{

		if($academic_year == '2015-2016'){
			$start_date = '2015-05-20';
			$end_date = '2016-05-20';
		}elseif($academic_year == '2016-2017'){
			$start_date = '2016-05-21';
			$end_date = '2017-05-20';
		}elseif ($academic_year == '2017-2018') {
			$start_date = '2017-05-21';
			$end_date = '2018-05-20';
		}elseif ($academic_year == '2018-2019') {
			$start_date = '2018-05-21';
			$end_date = '2019-05-20';
		}elseif ($academic_year == '2019-2020') {
			$start_date = '2019-05-21';
			$end_date = '2020-05-20';
		}elseif ($academic_year == '2020-2021') {
			$start_date = '2020-05-21';
			$end_date = '2021-05-20';
		}elseif ($academic_year == '2021-2022') {
			$start_date = '2021-05-21';
			$end_date = '2022-05-20';
		}

		if($district_name == 'All' && $school_name == 'All'){
			$query['normal'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['emergency'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['chronic'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
			$query['cured'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

		}else if ($district_name !== 'All' && $school_name == 'All'){
			$query['normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal' , 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['emergency'] =  $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency' , 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['chronic'] =  $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic' , 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['cured'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured' , 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');


		}else if($district_name != 'All' && $school_name != 'All'){
			$query['normal'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->where('doc_data.widget_data.page1.Student Info.School Name.field_ref' ,$school_name)->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['emergency'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->where('doc_data.widget_data.page1.Student Info.School Name.field_ref' ,$school_name)->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['chronic'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->where('doc_data.widget_data.page1.Student Info.School Name.field_ref' ,$school_name)->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

			$query['cured'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Status' => 'Cured' , 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');

		}

	 
	  return $query;

	}

	/*Update Request Info*/

	public function get_daily_updated_request_for_bar($start_date, $end_date, $district_name, $school_name)
	{
		
		if($district_name == 'All' && $school_name == 'All'){
			
			if($start_date != $end_date)
			{
				$query['updated_normal'] = $this->mongo_db->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->count('healthcare2016108181933756_static_html');

				$query['updated_emergency'] = $this->mongo_db->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Emergency')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->count('healthcare2016108181933756_static_html');

				$query['updated_chronic'] = $this->mongo_db->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where('doc_data.widget_data.page2.Review Info.Request Type', 'Chronic')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->count('healthcare2016108181933756_static_html');

								
			}else{
				$query['updated_normal'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->whereLike('history.time', $start_date)->count('healthcare2016108181933756_static_html');
				$query['updated_emergency'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Emergency')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->whereLike('history.time', $start_date)->count('healthcare2016108181933756_static_html');
				$query['updated_chronic'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Chronic')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->whereLike('history.time', $start_date)->count('healthcare2016108181933756_static_html');				

			}
			
		}elseif ($district_name != 'All' && $school_name == 'All') {
			$query['updated_normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			$query['updated_emergency'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			$query['updated_chronic'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			
		}elseif ($district_name != 'All' && $school_name != 'All') {
			$query['updated_normal'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			$query['updated_emergency'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			$query['updated_chronic'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->count('healthcare2016108181933756_static_html');

			
		}
		
		
		return $query;
	}

	public function get_daily_updated_health_request($start_date,$end_date, $request_type,$school_name,$district) 
	{
		
		if($district == 'All' && $school_name == 'All')
		{
			switch ($request_type) {
				case 'Normal':
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type', 'Normal')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				
				default:
					# code...
					break;
			}

		}elseif ($district != 'All' && $school_name == 'All') {
			switch ($request_type) {
				case 'Normal':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref' => $district))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				
				default:
					# code...
					break;
			}
		}elseif ($district != 'All' && $school_name != 'All') {
			switch ($request_type) {
				case 'Normal':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Emergency':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				case 'Chronic':
					$query = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $school_name))->whereNe("doc_data.widget_data.page2.Review Info.Status" , "Cured")->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->get('healthcare2016108181933756_static_html');
					return $query;
					break;
				
				default:
					# code...
					break;
			}
		}

	}

/*Hospitalized bar*/


	public function get_hospitalized_data_count_model($start,$end)
	{  

		$query['normal_hyderabad'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal' , 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

			$query['emergency_hyderabad'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

	   		$query['chronic_hyderabad'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic' , 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

			$query['normal_other_districts'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

			$query['emergency_other_districts'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency' ,'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

			$query['chronic_other_districts'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic' ,'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

		return $query;
	}

/*District wise hospitalised stundents*/

	public function get_hospitalized_data_table_model($start,$end, $hospital_district, $request_type) {

	if($request_type == 'Normal'){

        	 if($hospital_district == 'HYDERABAD'){

        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal' , 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
        	 }
        	else{
        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Normal', 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
                }

        }elseif ($request_type == 'Emergency') {
 			
            if($hospital_district == 'HYDERABAD'){

        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency' , 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
        	 }       	        	

        	else{
        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Emergency', 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
                }

        }elseif ($request_type == 'Chronic'){        

          if($hospital_district == 'HYDERABAD'){

        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic' , 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' , 'doc_data.widget_data.page2.Hospital Info.District Name' => 'HYDERABAD'))->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
        	 }
        	else{
        $query = $this->mongo_db->select(array('doc_data.widget_data', 'history.time'))->where(array('doc_data.widget_data.page2.Review Info.Request Type' => 'Chronic', 'doc_data.widget_data.page2.Review Info.Status' => 'Hospitalized' ))->whereNe('doc_data.widget_data.page2.Hospital Info.District Name' , 'HYDERABAD')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
                }
        }
       
        return $query;

    }

    /*Hospital type data*/
	public function get_hospital_type_of_bar_count_model($start,$end)
	{
	    $query['government'] = $this->mongo_db->where('doc_data.widget_data.page2.Hospital Info.Hospital Type', 'Government')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

	    $query['private'] = $this->mongo_db->where('doc_data.widget_data.page2.Hospital Info.Hospital Type','Private')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

	    $query['discharge'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Discharged')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');

	    $query['cured'] = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->count('healthcare2016108181933756_static_html');
	     
	    
	    return $query;
	}

/*Hospital type students data*/
	public function get_hospital_type_data_table_model($start,$end, $hospital_type)
	{

	    if($hospital_type == 'Government') {

	      $query = $this->mongo_db->where('doc_data.widget_data.page2.Hospital Info.Hospital Type', 'Government')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');

	    }elseif ($hospital_type == 'Private') {

	        $query = $this->mongo_db->where('doc_data.widget_data.page2.Hospital Info.Hospital Type','Private')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');

	    }elseif ($hospital_type == 'Discharged') {

	        $query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Discharged')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
	      
	    }elseif ($hospital_type == 'Cured') {

	        $query = $this->mongo_db->where('doc_data.widget_data.page2.Review Info.Status','Cured')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->get('healthcare2016108181933756_static_html');
	    }

	      return $query;
	}

/*Admitted cases*/

    function last_three_months_req_monitoring($start_date, $end_date) 
	{
	    $start = strval($start_date);
	    $end = strval($end_date);
	       
		 $request['hospitalised'] = $this->mongo_db->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Hospitalized"))->count($this->request_app_col_static_html);
		 
		$request['reiew'] = $this->mongo_db->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Review"))->count($this->request_app_col_static_html);

		$request['out'] = $this->mongo_db->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Out-Patient"))->count($this->request_app_col_static_html);
	       
	    return $request;

	}

	public function get_admitted_cases_schools_list($start_date, $end_date, $request_type)
	{
		$start = strval($start_date);
	    $end = strval($end_date);
	    $schools = [];
	    switch ($request_type) {
	    	case 'Admitted':
	    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Hospitalized"))->get($this->request_app_col_static_html);

	    		//echo print_r($requests, true); exit();
	    		foreach ($requests as $scl) {

	    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
	    			
	    			array_push($schools, $scl_name);
	    		}

	    		$final = array_count_values($schools);

	    		return $final;
	    		break;
	    	case 'Review':
	    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Review"))->get($this->request_app_col_static_html);

	    		//echo print_r($requests, true); exit();
	    		foreach ($requests as $scl) {

	    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
	    			
	    			array_push($schools, $scl_name);
	    		}

	    		$final = array_count_values($schools);

	    		return $final;
	    		break;
	    	case 'Out-Patient':
	    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Out-Patient"))->get($this->request_app_col_static_html);

	    		//echo print_r($requests, true); exit();
	    		foreach ($requests as $scl) {

	    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
	    			
	    			array_push($schools, $scl_name);
	    		}

	    		$final = array_count_values($schools);

	    		return $final;
	    		break;
	    	
	    	default:
	    		# code...
	    		break;
	    }
	}

	/*HB overall bar for new dashboard*/
public function get_hb_overall_data_count_model($start,$end)
{  

	//$today_date = substr($today_date,0,-3);
			
	$query['very_severe'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',6)->count('ttwreis_himglobin_report_col');

	$query['severe'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 6.1,8)->count('ttwreis_himglobin_report_col');

   	$query['moderate'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',8.1,10)->count('ttwreis_himglobin_report_col');

   	$query['mild'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,11.9)->count('ttwreis_himglobin_report_col');

   	$query['normal'] = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->count('ttwreis_himglobin_report_col');   	

			

		return $query;

	}

	/*HB Overall student data*/
public function get_hb_overall_data_table_model($start,$end, $hb_type)
	{  
		$all_schools = [];
		$school_name = [];
       
			
	if($hb_type == 'VERY SEVERE') {
		

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',6)->get('ttwreis_himglobin_report_col');
       		

        foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        }

        $data = array_count_values($all_schools);
        

	}elseif ($hb_type == 'SEVERE') {

			
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 6.1,8)->get('ttwreis_himglobin_report_col');        			

            foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        		}

        $data = array_count_values($all_schools);

	}elseif ($hb_type == 'MODERATE') {
			

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',8.1,10)->get('ttwreis_himglobin_report_col');
        		
               foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        }

        $data = array_count_values($all_schools);

			}elseif ($hb_type == 'MILD') {
				
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,11.9)->get('ttwreis_himglobin_report_col');        			

                foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        		}

        $data = array_count_values($all_schools);

			}elseif ($hb_type == 'NORMAL') {
				
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');        			

                foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        		}

        $data = array_count_values($all_schools);

			}

		return $data;

	}

	public function get_hb_overall_students_data_table_model($start_hb,$end_hb, $hb_type, $school_name)
	    {  			            
	            
	     if($hb_type == 'VERY SEVERE') {       

        $query = $this->mongo_db->where(array('doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',6)->get('ttwreis_himglobin_report_col');                      

    }elseif ($hb_type == 'SEVERE') {           

        $query = $this->mongo_db->where(array('doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',  6.1,8)->get('ttwreis_himglobin_report_col');                   

    }elseif ($hb_type == 'MODERATE') {           

        $query = $this->mongo_db->where(array('doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8.1,10)->get('ttwreis_himglobin_report_col');                   

    }elseif ($hb_type == 'MILD') {              

        $query = $this->mongo_db->where(array('doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,11.9)->get('ttwreis_himglobin_report_col');                  

            }elseif ($hb_type == 'NORMAL') {               

        $query = $this->mongo_db->where(array('doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');                    

            }

        return $query;

    }

/*HB bar for new dashboard gender wise*/
	public function get_hb_gender_wise_data_count_model($start,$end)
  	{  

	//$today_date = substr($today_date,0,-3);
			
	$query['severe_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->count('ttwreis_himglobin_report_col');

	$query['moderate_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->count('ttwreis_himglobin_report_col');

   	$query['mild_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->count('ttwreis_himglobin_report_col');

   	$query['normal_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->count('ttwreis_himglobin_report_col');

	$query['severe_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->count('ttwreis_himglobin_report_col');

	$query['moderate_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->count('ttwreis_himglobin_report_col');

	$query['mild_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->count('ttwreis_himglobin_report_col');

	$query['normal_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->count('ttwreis_himglobin_report_col');		

		return $query;

	}

/*HB Gender wise student data*/
	public function get_hb_gender_wise_data_table_model($start,$end, $hb_type, $hb_gender)
	{  
		$all_schools = [];
		$school_name = [];
       
	//$date = substr($date,0,-3);
			
	if($hb_type == 'SEVERE') {

		if($hb_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->get('ttwreis_himglobin_report_col');

        			}else{

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->get('ttwreis_himglobin_report_col');
                }		

        foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        }

        $data = array_count_values($all_schools);
        

	}elseif ($hb_type == 'MODERATE') {

			if($hb_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->get('ttwreis_himglobin_report_col');

        			}else{
        	
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->get('ttwreis_himglobin_report_col');
                }

            foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        		}

        $data = array_count_values($all_schools);

	}elseif ($hb_type == 'MILD') {

				if($hb_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->get('ttwreis_himglobin_report_col');

        			}else{
        	
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->get('ttwreis_himglobin_report_col');
              }
               foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        }

        $data = array_count_values($all_schools);

			}elseif ($hb_type == 'NORMAL') {

				if($hb_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');

        			}else{
        	
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');
              }

                foreach ($query as $school) {
           $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
           array_push($all_schools, $school_name);
        }

        $data = array_count_values($all_schools);

		}

		return $data;

	}

	public function get_hb_gender_wise_students_data_table_model($start_hb,$end_hb, $hb_type, $hb_gender, $school_name)
	    {  		

	            //$date_hb = substr($date_hb,0,-3);
	            
	     if($hb_type == 'SEVERE') {
  
        if($hb_gender == 'Male'){

        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male','doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->get('ttwreis_himglobin_report_col');

                    }else{

        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female','doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereLte('doc_data.widget_data.page1.Student Details.HB_latest.hb',8)->get('ttwreis_himglobin_report_col');
                }            

    }elseif ($hb_type == 'MODERATE') {

            if($hb_gender == 'Male'){

        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male','doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->get('ttwreis_himglobin_report_col');

                    }else{
            
        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female','doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb', 8,10)->get('ttwreis_himglobin_report_col');
                }

    }elseif ($hb_type == 'MILD') {

                if($hb_gender == 'Male'){

        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male','doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->get('ttwreis_himglobin_report_col');

                    }else{
            
        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',10.1,12)->get('ttwreis_himglobin_report_col');
              }

            }elseif ($hb_type == 'NORMAL') {

                if($hb_gender == 'Male'){

        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');

                    }else{
            
        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start_hb, $end_hb)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.hb',12,18)->get('ttwreis_himglobin_report_col');
              }

            }

        return $query;

    }

	/*BMI bar for new dahsboard */
	public function get_bmi_gender_wise_data_count_model($start,$end)
	{  
			
		$query['under_weight_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50)->count('healthcare2017619153715384');

		$query['over_weight_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->count('healthcare2017619153715384');

	   	$query['obese_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->count('healthcare2017619153715384');

	   $query['normal_weight_male'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50,24.99)->count('healthcare2017619153715384');

		$query['under_weight_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50)->count('healthcare2017619153715384');

		$query['over_weight_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->count('healthcare2017619153715384');

		$query['obese_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',30.00)->count('healthcare2017619153715384');

		$query['normal_weight_female'] = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi',18.50,24.99)->count('healthcare2017619153715384');
		
		return $query;
	}

/*BMI STudent data table new dashboard*/
    public function get_bmi_gender_wise_data_table_model($start, $end, $bmi_type, $bmi_gender)
	{  	
			$all_schools = [];
			$school_name = [];
					
	if($bmi_type == 'UNDER') {
  
		if($bmi_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50)->get('healthcare2017619153715384');

        			}else{

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50)->get('healthcare2017619153715384');
                }
                foreach ($query as $school) {
                   $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
                   array_push($all_schools, $school_name);
                }
                $data = array_count_values($all_schools); 
               
	}elseif ($bmi_type == 'OVER') {

			if($bmi_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->get('healthcare2017619153715384');

        			}else{
        	
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->get('healthcare2017619153715384');
                }

                foreach ($query as $school) {
                   $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
                   array_push($all_schools, $school_name);
                }

                $data = array_count_values($all_schools);

	}elseif ($bmi_type == 'OBESE') {

				if($bmi_gender == 'Male'){

        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 30.00)->get('healthcare2017619153715384');

        			}else{
        	
        $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 30.00)->get('healthcare2017619153715384');
              }

              foreach ($query as $school) {
                 $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
                 array_push($all_schools, $school_name);
              }

              $data = array_count_values($all_schools);          
           

			}elseif ($bmi_type == 'NORMAL') {

				if($bmi_gender == 'Male'){

     $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50,24.99)->get('healthcare2017619153715384');

        			}else{
        	
    $query = $this->mongo_db->select(array('doc_data.widget_data.school_details.School Name'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female'))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50,24.99)->get('healthcare2017619153715384');
              }

              foreach ($query as $school) {
                 $school_name  = $school['doc_data']['widget_data']['school_details']['School Name'];
                 array_push($all_schools, $school_name);
              }

              $data = array_count_values($all_schools);

			}

		return $data;

	}

	public function get_bmi_gender_wise_students_data_table_model($start_bmi,$end_bmi, $bmi_type, $bmi_gender, $school_name)
		{  	
		
		if($bmi_type == 'UNDER') {
	  
			if($bmi_gender == 'Male'){

	   			$query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50)->get('healthcare2017619153715384');

	        			}else{

	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female' ,'doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereLte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50)->get('healthcare2017619153715384');
	                }
	               

		}elseif ($bmi_type == 'OVER') {

				if($bmi_gender == 'Male'){

	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->get('healthcare2017619153715384');

	        			}else{
	        	
	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female','doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 25,29.99)->get('healthcare2017619153715384');
	                }

	              

		}elseif ($bmi_type == 'OBESE') {

					if($bmi_gender == 'Male'){

	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 30.00)->get('healthcare2017619153715384');

	        			}else{
	        	
	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female','doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereGte('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 30.00)->get('healthcare2017619153715384');
	              }


				}elseif ($bmi_type == 'NORMAL') {

					if($bmi_gender == 'Male'){

	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Male' ,'doc_data.widget_data.school_details.School Name' => $school_name))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50,24.99)->get('healthcare2017619153715384');

	        			}else{
	        	
	        $query = $this->mongo_db->where(array('doc_data.widget_data.page1.Student Details.Gender' => 'Female','doc_data.widget_data.school_details.School Name' => $school_name ))->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start_bmi, $end_bmi)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.bmi', 18.50,24.99)->get('healthcare2017619153715384');
	              }
	              	         
	          }

			return $query;

		}

	public function get_sanitation_report_pie_schools_data($date = FALSE)
	{
		// Variables
		$all_schools               = array();
		$all_schools_district      = array();
		$all_schools_name      	   = array();
		$submitted_schools 	       = array();
		$submitted_school_district = array();
		$submitted_school_name     = array();
		$not_submitted_schools	   = array();
		$schools_data              = array();
		$not_submitted_dist        = array();
		
		// $schools_list = $this->get_all_schools();
		
		// foreach($schools_list as $school_data)
		// {
			// array_push($all_schools_district,$school_data['dt_name']);
			// array_push($all_schools_name,$school_data['school_name']);
		// }
		
		// $all_schools['district'] = $all_schools_district; 
		// $all_schools['school']   = $all_schools_name; 
		
		// if ($date) {
			// $today_date = $date;
		// } else {
			// $today_date = $this->today_date;
		// }
		
		// $query = $this->mongo_db->select ( array (
				// "doc_data.widget_data" 
		// ) )->whereLike ( 'doc_data.widget_data.page4.Declaration Information.Date:',$today_date )->get ( $this->sanitation_app_col );
		
		// foreach ( $query as $doc ) {
			    // if(!in_array($doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'],$submitted_school_name))
				// {
					// array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] );
					// array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'] );
		        // }
		// }
		
		// $submitted_schools['district']     = $submitted_school_district;
		// $submitted_schools['school']       = $submitted_school_name;
		// $not_submitted_schools['district'] = array();
		// $not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		// foreach($not_submitted_schools['school'] as $index => $school_name)
		// {
		   // $dist_array    = explode(",",$school_name);
		   // $dist_array[1] = strtolower($dist_array[1]);
		   // array_push($not_submitted_dist,ucfirst($dist_array[1]));
		// }
		// $not_submitted_schools['district']   = $not_submitted_dist;
		// $schools_data['submitted']     		 = $submitted_schools;
		// $schools_data['submitted_count']     = count($submitted_schools['school']);
		// $schools_data['not_submitted'] 		 = $not_submitted_schools;
		// $schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		
		
		//
		
		$not_submitted_dist        = array();
		
		$all_schools_mobile        = array();
		$all_schools_cpn      	   = array();
		$submitted_school_mob 	   = array();
		$submitted_school_person   = array();
		$not_submitted_school_mob 	   = array();
		$not_submitted_school_person   = array();
		
		$schools_list = $this->get_all_schools();
		
		foreach($schools_list as $school_data)
		{
			array_push($all_schools_district,$school_data['dt_name']);
			array_push($all_schools_name,$school_data['school_name']);
			$all_schools_mobile[$school_data['school_name']] = $school_data['school_mob'];
			$all_schools_cpn[$school_data['school_name']] = $school_data['contact_person_name'];
		}
		
		$all_schools['district'] = $all_schools_district; 
		$all_schools['school']   = $all_schools_name; 
		
		if ($date) {
			$today_date = $date;
		} else {
			$today_date = $this->today_date;
		}
		
		$query = $this->mongo_db->select ( array (
				"doc_data.widget_data" 
		) )->whereLike ( 'doc_data.widget_data.page4.Declaration Information.Date:',$today_date )->get ( $this->sanitation_app_col_v2 );
		
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====716=='.print_r($query,true));
		//log_message('debug','$schools_data=====get_absent_pie_schools_data=====717=='.print_r($today_date,true));
		
		foreach ( $query as $doc ) {
			    if(!in_array($doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'],$submitted_school_name))
				{
					array_push ( $submitted_school_district,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['District'] );
					array_push ( $submitted_school_name,$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name'] );
					
					if(isset($all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']])){
						array_push ( $submitted_school_mob,$all_schools_mobile[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']] );
						array_push ( $submitted_school_person,$all_schools_cpn[$doc ['doc_data'] ['widget_data'] ['page4'] ['School Information'] ['School Name']] );
					}else{
						array_push ( $submitted_school_mob,"" );
						array_push ( $submitted_school_person,"" );
					}
					
		        }
		}
		
		$submitted_schools['district']     = $submitted_school_district;
		$submitted_schools['school']       = $submitted_school_name;
		$submitted_schools['mobile']       = $submitted_school_mob;
		$submitted_schools['person_name']  = $submitted_school_person;
		
		$not_submitted_schools['district'] = array();
		$not_submitted_schools['school']   = array_values(array_diff($all_schools['school'],$submitted_schools['school']));
		foreach($not_submitted_schools['school'] as $index => $school_name)
		{
		   $dist_array    = explode(",",$school_name);
		   $dist_array[1] = strtolower($dist_array[1]);
		   array_push($not_submitted_dist,ucfirst($dist_array[1]));
		   
			if(isset($all_schools_mobile[$school_name])){
				array_push ( $not_submitted_school_mob,$all_schools_mobile[$school_name] );
				array_push ( $not_submitted_school_person,$all_schools_cpn[$school_name] );
			}else{
				array_push ( $not_submitted_school_mob,"" );
				array_push ( $not_submitted_school_person,"" );
			}
		   
		}
		$not_submitted_schools['district']   = $not_submitted_dist;
		$not_submitted_schools['mobile']       = $not_submitted_school_mob;
		$not_submitted_schools['person_name']  = $not_submitted_school_person;
		
		$schools_data['submitted']     		 = $submitted_schools;
		$schools_data['submitted_count']     = count($submitted_schools['school']);
		$schools_data['not_submitted'] 		 = $not_submitted_schools;
		$schools_data['not_submitted_count'] = count($not_submitted_schools['school']);
		
		//
		
		return $schools_data;
	}

	/* Daily attendance bar*/
	public function get_daily_attendance_report_model($today_date, $district, $school_name)
	{
		$array_empty = [];
		//$dist_id = $this->get_all_district ();
		if($district == 'All' && $school_name == 'All'){
			$query = $this->mongo_db->select ( array ("doc_data.widget_data") )->whereLike ('history.last_stage.time', $today_date )->get ( $this->absent_app_col );
		}elseif ($district != 'All' && $school_name == 'All') {
			$query = $this->mongo_db->select ( array ("doc_data.widget_data") )->where('doc_data.widget_data.page1.Attendence Details.District', $district)->whereLike ('history.last_stage.time', $today_date )->get ( $this->absent_app_col );
		}elseif ($district != 'All' && $school_name != 'All') {
			$query = $this->mongo_db->select ( array ("doc_data.widget_data") )->where('doc_data.widget_data.page1.Attendence Details.Select School', $school_name)->whereLike ('history.last_stage.time', $today_date )->get ( $this->absent_app_col );
		}
		
		       
	       $r2h = 0;
	       $sick = 0;
	       $attended = 0;
	       $restroom = 0;
	       $count =0;
	       foreach ( $query as $report )
	       {
	           if (strtolower ( $report ['doc_data']['widget_data']['page1']['Attendence Details']['District'] ))
	           {
	               $count ++;
	               $sick = $sick + intval ( $report['doc_data']['widget_data']['page1']['Attendence Details']['Sick']);
	               $restroom = $restroom + intval ( $report['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom'] );                
	               $r2h = $r2h + intval ( $report['doc_data']['widget_data']['page1']['Attendence Details']['R2H'] );
	               $attended = $attended + intval ( $report['doc_data']['widget_data']['page1']['Attendence Details'] ['Attended'] );
	           }
	        $data["sick"] = $sick;
	        $data['r2h'] = $r2h;
	        $data['restroom'] = $restroom;
	        $data['attended'] = $attended;
       }    
     	
     	$data['label'] = 'Sick';
     	$data['value'] = $sick;
     	if($data['value'] != 0){
     		array_push($array_empty, $data);
     	}
     	$data['label'] = 'R2H';
     	$data['value'] = $r2h;
     	if($data['value'] != 0){
     		array_push($array_empty, $data);
     	}
     	$data['label'] = 'RestRoom';
     	$data['value'] = $restroom;
     	if($data['value'] != 0){
     		array_push($array_empty, $data);
     	}
     	$data['label'] = 'Attendance';
     	$data['value'] = $attended;
     	if($data['value'] != 0){
     	array_push($array_empty, $data);
     	}

     	     	/*$data['label'] = 'Absent';
     	$data['value'] = $absent;
     	array_push($array_empty, $data);*/

     	//echo print_r($data, true); exit();
     	
     	if(!empty($array_empty)){
     		return $array_empty;
     	}else{
     		return 'No Data Found';
     	}
     	
       
	}

	/*Attendace data schoolwise new dashboard*/
	public function get_attendance_data_for_bar_schools($date, $attendance_type, $district, $school)
	{
		$school_name_with_count = [];
		if($district == 'All' && $school == 'All')
		{
			switch ($attendance_type) {
				case 'R2H':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.R2H' => array('$ne' => '0')))->get('healthcare20161015173311279');
					foreach ($query as $data) {
						$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
						$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['R2H'];
						
						if($saas['value'] != '00' || $saas['value'] != '0'){
							array_push($school_name_with_count, $saas);          		
						}
					
					}

					return $school_name_with_count;
					break;
				case 'Sick':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Sick' => array('$ne' => '0')))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Sick'];
		          		if($saas['value'] != '00' || $saas['value'] != '0'){
							array_push($school_name_with_count, $saas);       		
						}
		          		
		          	}
					return $school_name_with_count;
					break;
				case 'RestRoom':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page2.Attendence Details.RestRoom' => array('$ne' => '0')))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom'];
		          		if($saas['value'] != '00' || $saas['value'] != '0'){
							array_push($school_name_with_count, $saas);     		
						}
		          		
		          	}
					return $school_name_with_count;
					break;
				case 'Attendance':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Attended' => array('$ne' => '0')))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Attended'];
		          		if($saas['value'] != '00' || $saas['value'] != '0'){
							array_push($school_name_with_count, $saas);     		
						}
		          		
		          	}
					return $school_name_with_count;
					break;
				
				default:
					# code...
					break;
			}

		}elseif ($district != 'All' && $school == 'All') {
			switch ($attendance_type) {
				case 'R2H':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.R2H' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.District' => $district ))->get('healthcare20161015173311279');
					foreach ($query as $data) {
						$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
						$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['R2H'];
						
						array_push($school_name_with_count, $saas);          		
					
					}

					return $school_name_with_count;
					break;
				case 'Sick':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Sick' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.District' => $district))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Sick'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				case 'RestRoom':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page2.Attendence Details.RestRoom' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.District' => $district))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				case 'Attendance':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Attended' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.District' => $district))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Attended'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				
				default:
					# code...
					break;
			}
		}elseif ($district != 'All' && $school != 'All') {
			switch ($attendance_type) {
				case 'R2H':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.R2H' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school ))->get('healthcare20161015173311279');
					foreach ($query as $data) {
						$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
						$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['R2H'];
						
						array_push($school_name_with_count, $saas);          		
					
					}

					return $school_name_with_count;
					break;
				case 'Sick':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Sick' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Sick'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				case 'RestRoom':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page2.Attendence Details.RestRoom' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				case 'Attendance':
					$query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Select School')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Attended' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

		          	foreach ($query as $data) {
		          		$saas['label'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Select School'];
		          		$saas['value'] = $data['doc_data']['widget_data']['page1']['Attendence Details']['Attended'];
		          		
		          		array_push($school_name_with_count, $saas);
		          	}
					return $school_name_with_count;
					break;
				
				default:
					# code...
					break;
			}
		}

	}

// Regular follwoups

     public function get_regular_followup_cases_from_requests()
    {
        
        $query=$this->mongo_db->where(array('regular_follow_up.Active_status'=> 1))->get($this->request_app_col_static_html);

        return $query;
    }

    public function get_regular_followup_closed_cases()
    {
        $query = $this->mongo_db->where('regular_follow_up.Active_status', 0)->get($this->request_app_col_static_html);
        
        return $query;
    }

//Followupdate alert

	public function get_today_followup_dates_alert($date)
	{
		$follow = $this->mongo_db->select(array('regular_follow_up'))->where(array('regular_follow_up.Follow_Up'=>array('$exists'=>true)))->get($this->request_app_col_static_html);

		$count = 0;

		foreach($follow as $fol){
			
			$end_data = end($fol['regular_follow_up']['Follow_Up']);
			
			$date = $end_data['next_scheduled_date'];

			$today = date('Y-m-d');

			if($today == $date){
				$count++;
			}
		}

		return $count;
	}

/*school information model*/	

	public function getschoolsInformation_model()
	{

		$final = [];

	  	$this->mongo_db->switchDatabase ($this->common_db ['common_db']);

	  	$district = $this->mongo_db->command(array('distinct' => 'panacea_schools_list' , 'key' => "district_name"));	
	  	  	
	    array_multisort($district['values'] );

	  	foreach ($district['values'] as $key => $value)
	  	{
	  	
	  		 $boy = $this->mongo_db->where('district_name', $value)->where(array('school_name' => array('$regex' => "B.,")))->count( 'panacea_schools_list');

	  		 $girl = $this->mongo_db->where('district_name', $value)->where(array('school_name' => array('$regex' => "G.,")))->count( 'panacea_schools_list');	  		

	  		 $data['dist'] = $value; 				
	  		 $data['boy_scl'] = $boy;
	  		 $data['grl_scl'] = $girl;
	  		 array_push($final, $data);	  		
	  	}
	     return $final;

	}

	public function get_excel_for_screening_overall($dist, $scl, $academic)
    {
    	ini_set('memory_limit', '10G');

    	if($academic == '2015-2016'){
    		$span = 'healthcare201671115519757_screening_final_2015-16';
    	}elseif($academic == '2016-2017'){
    		$span = 'healthcare201671115519757_screening_final_2016-17';
    	}elseif ($academic == '2017-2018') {
    		$span = 'healthcare201671115519757_screening_final_2017-18';
    	}elseif ($academic == '2018-2019') {
    		$span = 'healthcare201671115519757_screening_final_2019';
    	}elseif ($academic == '2019-2020') {
    		$span = 'healthcare201671115519757';
    	}

    	$page3andpage9exists = array("doc_data.widget_data.page3.Physical Exam"=> array('$exists' =>true), 
			     "doc_data.widget_data.page9.Dental Check-up"=>array('$exists' =>true));

    	if ($dist == 'All' && $scl == 'All') {
    		$query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->where($page3andpage9exists)->get($span);
    	}elseif ($dist != 'All' && $scl == 'All') {

    		$query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Hospital Unique ID' => 1))->where($page3andpage9exists)->where(array('doc_data.widget_data.page2.Personal Information.District' => $dist ))->get($span);

    	}elseif ($dist != 'All' && $scl != 'All') {

    		$query = $this->mongo_db->orderBy(array('doc_data.widget_data.page1.Personal Information.Student Health ID'=> 1))->where($page3andpage9exists)->where(array('doc_data.widget_data.page2.Personal Information.School Name' => $scl))->get($span);
			
    	}

    	return $query;
    }

	public function get_excel_for_requests_span($district, $scl, $start_date, $end_date)
    {
    	$start = strval($start_date);
    	$end = strval($end_date);

    	if ($district == 'All' && $scl == 'All') {

    		$request['Normal'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal"))->get('healthcare2016108181933756_static_html');

    		$request['Emergency'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency"))->get('healthcare2016108181933756_static_html');

    		$request['Chronic'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic"))->get('healthcare2016108181933756_static_html');
    		
    	}elseif ($district != 'All' && $scl == 'All') {

    		$request['Normal'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal", "doc_data.widget_data.page1.District.field_ref"=>$district))->get('healthcare2016108181933756_static_html');

    		$request['Emergency'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency", "doc_data.widget_data.page1.District.field_ref"=>$district))->get('healthcare2016108181933756_static_html');

    		$request['Chronic'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic", "doc_data.widget_data.page1.District.field_ref"=>$district))->get('healthcare2016108181933756_static_html');

    	}elseif ($district != 'All' && $scl != 'All') {

    		$request['Normal'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Normal", "doc_data.widget_data.page1.School Name.field_ref"=>$scl))->get('healthcare2016108181933756_static_html');

    		$request['Emergency'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Emergency", "doc_data.widget_data.page1.School Name.field_ref"=>$scl))->get('healthcare2016108181933756_static_html');

    		$request['Chronic'] = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Request Type' => "Chronic", "doc_data.widget_data.page1.School Name.field_ref"=>$scl))->get('healthcare2016108181933756_static_html');
    	}

    	return $request;

    }

    public function get_excel_for_attendance_span($dist, $scl, $start_date, $end_date)
    {
    	$start = strval($start_date);
    	$end = strval($end_date);

    	if ($dist == 'All' && $scl =='All') {
    		
    		$request = $this->mongo_db->whereGte('history.last_stage.time', $start)->whereLte('history.last_stage.time', $end)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20161015173311279');


    	}elseif ($dist != 'All' && $scl =='All') {
    		
    		$request = $this->mongo_db->whereGte('history.last_stage.time', $start)->whereLte('history.last_stage.time', $end)->where('doc_data.widget_data.page1.Attendence Details.District', $dist)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20161015173311279');

    	}elseif ($dist != 'All' && $scl !='All') {
    		
    		$request = $this->mongo_db->whereGte('history.last_stage.time', $start)->whereLte('history.last_stage.time', $end)->where('doc_data.widget_data.page1.Attendence Details.Select School', $scl)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20161015173311279');

    	}

    	return $request;

    }


    public function get_excel_for_sanitation_span($dist, $scl, $start, $end)
    {
    	//$start = strval($start_date);
    	//$end = strval($end_date);

    	if($dist == 'All' && $scl =='All'){

    		//$request = $this->mongo_db->whereGte(array('history.last_stage.time'=>array('$regex'=>$start) ))->whereLte(array('history.last_stage.time'=>array('$regex'=>$end) ))->orderBy(array('history.last_stage.time' => 1))->get($this->sanitation_app_col_v2);
    		$request = [];
    		$query = $this->mongo_db->whereBetween('doc_data.widget_data.page4.Declaration Information.Date:', $start, $end)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20171211809800_version_2');
    		if(isset($query) && !empty($query)){
    			foreach ($query as $data) {
    				//echo print_r($data, true);
    				$send = $data['doc_data']['widget_data']['daily']['Campus']['Cleanliness Of Campus'];
    				if(isset($send) && !empty($send)){
    					array_push($request, $data);
    				}
    			}
    		}

    	}elseif ($dist != 'All' && $scl =='All') {

    		$request = $this->mongo_db->whereGte('history.last_stage.time', $start)->whereLte('history.last_stage.time', $end)->where('doc_data.widget_data.page4.School Information.District', $dist)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20171211809800_version_2');

    	}elseif ($dist != 'All' && $scl !='All') {
    		
    		$request = $this->mongo_db->whereGte('history.last_stage.time', $start)->whereLte('history.last_stage.time', $end)->where('doc_data.widget_data.page4.School Information.School Name', $scl)->orderBy(array('history.last_stage.time' => 1))->get('healthcare20171211809800_version_2');

    	}

    	return $request;

    }

    public function get_excel_for_hb_span($dist, $scl, $start, $end)
    {
    	ini_set('memory_limit', '2G');

    	if($dist == 'All' && $scl == 'All'){
    		$query = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->get('ttwreis_himglobin_report_col');

    	} elseif ($dist != 'All' && $scl == 'All') {
    		
    		$query = $this->mongo_db->where('doc_data.widget_data.school_details.District', $dist)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->get('ttwreis_himglobin_report_col');

    	}elseif ($dist != 'All' && $scl != 'All') {
    		$query = $this->mongo_db->where('doc_data.widget_data.school_details.School Name', $scl)->whereBetween('doc_data.widget_data.page1.Student Details.HB_latest.month', $start, $end)->get('ttwreis_himglobin_report_col');
    	}

    	return $query;

    }
    public function get_excel_for_bmi_span($dist, $scl, $start, $end)
    {
    	ini_set('memory_limit', '2G');

    	if($dist == 'All' && $scl == 'All'){
    		$query = $this->mongo_db->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->get('healthcare2017619153715384');

    	} elseif ($dist != 'All' && $scl == 'All') {
    		
    		$query = $this->mongo_db->where('doc_data.widget_data.school_details.District', $dist)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->get('healthcare2017619153715384');

    	}elseif ($dist != 'All' && $scl != 'All') {
    		$query = $this->mongo_db->where('doc_data.widget_data.school_details.School Name', $scl)->whereBetween('doc_data.widget_data.page1.Student Details.BMI_latest.month', $start, $end)->get('healthcare2017619153715384');
    	}

    	return $query;

    }

     public function tribal_covid_cases_model($passing_date)
    {
    	$get_details = $this->mongo_db->select('doc_data.widget_data')->whereLike('history.time', $passing_date)->where('doc_data.widget_data.page1.Problem Info.Emergency.Disease', 'Covid-19')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->get('healthcare2016108181933756_static_html');

        return $get_details;
    }

    public function get_covid_cases_students_model($start, $end)
    {    
     $get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->where('doc_data.widget_data.page1.Problem Info.Emergency.Disease', 'Covid-19')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->get('healthcare2016108181933756_static_html');
     
     return $get_details;
    }  

     public function get_covid_cured_cases_students_model($start, $end)
    {
    
     $get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->where(array("doc_data.widget_data.page1.Problem Info.Emergency.Disease" => "Covid-19","doc_data.widget_data.page2.Review Info.Status" => "Cured"))->get('healthcare2016108181933756_static_html');
     
     return $get_details;

    }

     public function get_excel_covid_cured_cases_model($start_date, $end_date)
    {
    	$get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start_date), 'history.time', array('$lte'=>$end_date))->where(array("doc_data.widget_data.page1.Problem Info.Emergency.Disease" => "Covid-19","doc_data.widget_data.page2.Review Info.Status" => "Cured"))->get('healthcare2016108181933756_static_html');
     
     return $get_details;
    }

    function get_data($start_date,$end_date, $selectedDistrict, $selectedSchool)
    {

    	$final_data = array();
    	$final_data_symptom = array();
    	$general_diseases_array = array();
    	$emergency_diseases_array = array();
    	$chronic_diseases_array = array();

    	if(($selectedDistrict == "All" && $selectedSchool == "All") || ($selectedDistrict == "All" && $selectedSchool == "All_ini"))
    	{
    		$condition = array (
    			"history.time" => array ('$gte' => $start_date,'$lte' => $end_date)
					//"history.time" => array ('$regex' => $selectedMonth)
					//"history.0.time" => array ('$regex' => "2019-11-06")
				);

	    	$all_general_diseases= $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Normal",'query'=>$condition));
	    	
	    			
					foreach ($all_general_diseases['values'] as $index=>$value)
					{
						foreach ($value as $symptom_category => $symptom_names) {
						
							if(!empty($symptom_names) && $symptom_names != array())
							{
								foreach ($symptom_names as $symptom)
								{	
									if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Normal.$symptom_category"=>$symptom))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 10)
										{
											$general['label'] = $symptom;
											$general['y'] = $qry;
											$general['symptom_category'] = $symptom_category;
											array_push($final_data, $general);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
		      		}
		      		
				// Emergency Cases
	    	$all_emergency_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Emergency",'query'=>$condition));
				foreach ($all_emergency_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Emergency.$symptom_category"=>$symptom))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$emergency['label'] = $symptom;
											$emergency['y'] = $qry;
											$emergency['symptom_category'] = $symptom_category;
											array_push($final_data, $emergency);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					}


				// Chronic Cases
	    	$all_chronic_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Chronic",'query'=>$condition));
				foreach ($all_chronic_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Chronic.$symptom_category"=>$symptom))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$chronic['label'] = $symptom;
											$chronic['y'] = $qry;
											$chronic['symptom_category'] = $symptom_category;
											array_push($final_data, $chronic);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					}

	    	 return $final_data;
    	}

			/////////
    	elseif($selectedDistrict != "All" && $selectedSchool == "All")
    	{
    		$selectedDistrict = strtoupper($selectedDistrict);
    		$selectedSchool = strtoupper($selectedSchool);

    		$condition = array (
					//"history.time" => array ('$regex' => $selectedMonth),
    				"history.time" => array ('$gte' => $start_date,'$lte' => $end_date),
					'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict
				);


				//$qry = $this->mongo_db->where(array('doc_data.widget_data.page1.Problem Info.Normal'=>$value, 'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict))->whereLike('history.0.time', $selectedMonth)->count($this->request_app_col_static_html);

				// Normal Cases
				$all_general_diseases= $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Normal",'query'=>$condition));

					foreach ($all_general_diseases['values'] as $index=>$value) {
						foreach ($value as $symptom_category => $symptom_names) {
							if(!empty($symptom_names) && $symptom_names != array())
							{
								foreach ($symptom_names as $symptom) {
									
									if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Normal.$symptom_category"=>$symptom,'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										
										if($qry > 0)
										{
											$general['label'] = $symptom;
											$general['y'] = $qry;
											$general['symptom_category'] = $symptom_category;
											array_push($final_data, $general);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					 }



				// Emergency Cases
				$all_emergency_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Emergency",'query'=>$condition));
				foreach ($all_emergency_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Emergency.$symptom_category"=>$symptom ,'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$emergency['label'] = $symptom;
											$emergency['y'] = $qry;
											$emergency['symptom_category'] = $symptom_category;
											array_push($final_data, $emergency);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					}


				// Chronic Cases
				$all_chronic_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Chronic",'query'=>$condition));
				foreach ($all_chronic_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {

						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {
								
								if(!in_array($symptom,$final_data_symptom))
									{
										$test = array("doc_data.widget_data.page1.Problem Info.Chronic.$symptom_category"=>$symptom);
										$test2 = array('history.time' => $selectedMonth);
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Chronic.$symptom_category"=>$symptom ,'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$chronic['label'] = $symptom;
											$chronic['y'] = $qry;
											$chronic['symptom_category'] = $symptom_category;
											array_push($final_data, $chronic);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					}

				

				 return $final_data;
    	}
    	elseif($selectedDistrict != "All" && $selectedSchool != "All")
    	{
    		$selectedDistrict = strtoupper($selectedDistrict);
    		$selectedSchool = strtoupper($selectedSchool);

    		$condition = array (
					//"history.time" => array ('$regex' => $selectedMonth),
    			"history.time" => array ('$gte' => $start_date,'$lte' => $end_date),
					'doc_data.widget_data.page1.Student Info.District.field_ref' => $selectedDistrict,
					'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $selectedSchool
				);

    		// Normal Cases
				$all_general_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Normal",'query'=>$condition));
				foreach ($all_general_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Normal.$symptom_category"=>$symptom, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $selectedSchool))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$general['label'] = $symptom;
											$general['y'] = $qry;
											$general['symptom_category'] = $symptom_category;
											array_push($final_data, $general);
											array_push($final_data_symptom, $symptom);
										}
									}
								}
							}
						}
					}

	    	// Emergency Cases
				$all_emergency_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Emergency",'query'=>$condition));
				foreach ($all_emergency_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Emergency.$symptom_category"=>$symptom, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $selectedSchool))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$emergency['label'] = $symptom;
											$emergency['y'] = $qry;
											$emergency['symptom_category'] = $symptom_category;
											array_push($final_data, $emergency);
											array_push($final_data_symptom, $symptom);
										}
									}
						}

					}
				}
			}

				// Chronic Cases
				$all_chronic_diseases = $this->mongo_db->command(array('distinct' => "healthcare2016108181933756_static_html" ,'key' => "doc_data.widget_data.page1.Problem Info.Chronic",'query'=>$condition));
				foreach ($all_chronic_diseases['values'] as $index=>$value) {
					foreach ($value as $symptom_category => $symptom_names) {
						if(!empty($symptom_names) && $symptom_names != array())
						{
							foreach ($symptom_names as $symptom) {

								if(!in_array($symptom,$final_data_symptom))
									{
										$qry = $this->mongo_db->where(array("doc_data.widget_data.page1.Problem Info.Chronic.$symptom_category"=>$symptom, 'doc_data.widget_data.page1.Student Info.School Name.field_ref' => $selectedSchool))->whereBetween('history.time', $start_date, $end_date)->count('healthcare2016108181933756_static_html');
										if($qry > 0)
										{
											$chronic['label'] = $symptom;
											$chronic['y'] = $qry;
											$chronic['symptom_category'] = $symptom_category;
											array_push($final_data, $chronic);
											array_push($final_data_symptom, $symptom);
										}
									}
						}

					}
				}
			}

	         return $final_data;
    	}

	 }


 public function get_students_list_based_on_request_symptom($symptomName, $symptomCategory, $selectedMonth_start, $selectedMonth_end, $selectedDistrict, $selectedSchool)
	 {
	 		$merged_or_array = array();
			$merged_and_array = array();

	 	if(($selectedDistrict == "All" && $selectedSchool == "All"))
		{
				
			$normal = array("doc_data.widget_data.page1.Problem Info.Normal.$symptomCategory" => array('$in' => array($symptomName)));
			$emergency = array("doc_data.widget_data.page1.Problem Info.Emergency.$symptomCategory" => array('$in' => array($symptomName)));
			$chronic = array("doc_data.widget_data.page1.Problem Info.Chronic.$symptomCategory" => array('$in' => array($symptomName)));
			//$month = array('history.time' => array('$regex' => $selectedMonth));
			$month = array('history.time' => array('$gte' => $selectedMonth_start ,'$lte' => $selectedMonth_end));

			array_push($merged_or_array, $normal);
			array_push($merged_or_array, $emergency);
			array_push($merged_or_array, $chronic);
			array_push($merged_and_array, $month);

			$result = [ ];

			$pipeline = [
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true
							)
					),
					array (
							'$match' => array (
									'$or' => $merged_or_array,
									'$and' => $merged_and_array
							)
					)
			];

			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline
			) );

			if($response['ok'])
			{
				$doc = $response['result'];

			}

				return $doc;

    	}
    	elseif($selectedDistrict != "All" && $selectedSchool == "All")
    	{
    		
			$normal = array("doc_data.widget_data.page1.Problem Info.Normal.$symptomCategory" => array('$in' => array($symptomName)));
			$emergency = array("doc_data.widget_data.page1.Problem Info.Emergency.$symptomCategory" => array('$in' => array($symptomName)));
			$chronic = array("doc_data.widget_data.page1.Problem Info.Chronic.$symptomCategory" => array('$in' => array($symptomName)));
			//$month = array('history.time' => array('$regex' => $selectedMonth));
			$month = array('history.time' => array('$gte' => $selectedMonth_start ,'$lte' => $selectedMonth_end));
			$district = array('doc_data.widget_data.page1.Student Info.District.field_ref' => array('$in' => array($selectedDistrict)));

			array_push($merged_or_array, $normal);
			array_push($merged_or_array, $emergency);
			array_push($merged_or_array, $chronic);
			array_push($merged_and_array, $month);
			array_push($merged_and_array, $district);

			$result = [ ];

			$pipeline = [
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true
							)
					),
					array (
							'$match' => array (
									'$or' => $merged_or_array,
									'$and' => $merged_and_array
							)
					)
			];

			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline
			) );

			
			if($response['ok'])
			{
				$doc = $response['result'];

			}

				return $doc;
    	}
    	elseif($selectedDistrict != "All" && $selectedSchool != "All")
    	{
    		$normal = array("doc_data.widget_data.page1.Problem Info.Normal.$symptomCategory" => array('$in' => array($symptomName)));
			$emergency = array("doc_data.widget_data.page1.Problem Info.Emergency.$symptomCategory" => array('$in' => array($symptomName)));
			$chronic = array("doc_data.widget_data.page1.Problem Info.Chronic.$symptomCategory" => array('$in' => array($symptomName)));
				//$month = array('history.time' => array('$regex' => $selectedMonth));
			$month = array('history.time' => array('$gte' => $selectedMonth_start ,'$lte' => $selectedMonth_end));
			$district = array('doc_data.widget_data.page1.Student Info.District.field_ref' => array('$in' => array($selectedDistrict)));
			$school = array('doc_data.widget_data.page1.Student Info.School Name.field_ref' => array('$in' => array($selectedSchool)));

			array_push($merged_or_array, $normal);
			array_push($merged_or_array, $emergency);
			array_push($merged_or_array, $chronic);
			array_push($merged_and_array, $month);
			array_push($merged_and_array, $district);
			array_push($merged_and_array, $school);

			$result = [ ];

			$pipeline = [
					array (
							'$project' => array (
									"doc_data.widget_data" => true,
									"history" => true
							)
					),
					array (
							'$match' => array (
									'$or' => $merged_or_array,
									'$and' => $merged_and_array
							)
					)
			];

			$response = $this->mongo_db->command ( array (
					'aggregate' => $this->request_app_col_static_html,
					'pipeline' => $pipeline
			) );


			if($response['ok'])
			{
				$doc = $response['result'];

			}

			return $doc;
    	}
	 }

	 public function total_requests_pie_with_filters_model($req_type, $dist, $scl, $academic)
{
	if($academic == '2015-2016'){
		$start_date = '2015-05-20';
		$end_date = '2016-05-20';
	}elseif($academic == '2016-2017'){
		$start_date = '2016-05-21';
		$end_date = '2017-05-20';
	}elseif ($academic == '2017-2018') {
		$start_date = '2017-05-21';
		$end_date = '2018-05-20';
	}elseif ($academic == '2018-2019') {
		$start_date = '2018-05-21';
		$end_date = '2019-05-20';
	}elseif ($academic == '2019-2020') {
		$start_date = '2019-05-21';
		$end_date = '2020-05-20';
	}elseif ($academic == '2020-2021') {
		$start_date = '2020-05-21';
		$end_date = '2021-05-20';
	}

	$subtype = [];
	//$main_subtype = [];
	$problems = [];
	//$sub_cont = [];
	if($dist == 'All' && $scl == 'All_dist'){
		switch ($req_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency'))->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				/*foreach ($emer as $em) {
					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];

					if(is_array($data1) && !empty($data1)){
						foreach ($data1 as $key => $value) {
						array_push($subtype, $value);
						}
					}
					if(is_array($data2) && !empty($data2)){
						foreach ($data2 as $key => $value) {
						array_push($subtype, $value);
						}
					}
				}*/

				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Chronic'))->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];

				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}
				/*foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					array_push($empty, $data1);
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					array_push($empty, $data2);
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					array_push($empty, $data3);
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					array_push($empty, $data4);
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					array_push($empty, $data5);
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					array_push($empty, $data6);
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					array_push($empty, $data7);
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					array_push($empty, $data8);
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					array_push($empty, $data9);
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					array_push($empty, $data10);
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					array_push($empty, $data11);
					/*$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					array_push($empty, $data12);
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					array_push($empty, $data13);

					foreach ($data1 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data2 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data3 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data4 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data5 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data6 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data7 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data8 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data9 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data10 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data11 as $key => $value) {
						array_push($subtype, $value);
					}
					
					foreach ($data13 as $key => $value) {
						array_push($subtype, $value);
					}
				
				}*/

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;
				break;

			case 'Normal':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Normal'))->where('doc_data.widget_data.page2.Review Info.Request Type','Normal')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				/*foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					array_push($empty, $data1);
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					array_push($empty, $data2);
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					array_push($empty, $data3);
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					array_push($empty, $data4);
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					array_push($empty, $data5);
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					array_push($empty, $data6);
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					array_push($empty, $data7);
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					array_push($empty, $data8);
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					array_push($empty, $data9);
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					array_push($empty, $data10);
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					array_push($empty, $data11);
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					array_push($empty, $data12);
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					array_push($empty, $data13);

					foreach ($data1 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data2 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data3 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data4 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data5 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data6 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data7 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data8 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data9 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data10 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data11 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data12 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data13 as $key => $value) {
						array_push($subtype, $value);
					}				
				}*/
				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}
				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency', 'doc_data.widget_data.page1.Problem Info.Chronic', 'doc_data.widget_data.page1.Problem Info.Normal'))->where('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				$empty = [];

				/*foreach ($emer as $key => $em) {
					$data14 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$data15 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					array_push($empty, $data1);
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					array_push($empty, $data2);
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					array_push($empty, $data3);
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					array_push($empty, $data4);
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					array_push($empty, $data5);
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					array_push($empty, $data6);
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					array_push($empty, $data7);
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					array_push($empty, $data8);
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					array_push($empty, $data9);
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					array_push($empty, $data10);
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					array_push($empty, $data11);
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					array_push($empty, $data12);
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					array_push($empty, $data13);

					$data16 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					array_push($empty, $data1);
					$data17 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					array_push($empty, $data2);
					$data18 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					array_push($empty, $data3);
					$data19 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					array_push($empty, $data4);
					$data20 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					array_push($empty, $data5);
					$data21 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					array_push($empty, $data6);
					$data22 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					array_push($empty, $data7);
					$data23 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					array_push($empty, $data8);
					$data24 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					array_push($empty, $data9);
					$data25 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					array_push($empty, $data10);
					$data26 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					array_push($empty, $data11);
					$data27 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					array_push($empty, $data12);
					$data28 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					array_push($empty, $data13);

					foreach ($data14 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data15 as $key => $value) {
						array_push($subtype, $value);
					}


					foreach ($data1 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data2 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data3 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data4 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data5 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data6 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data7 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data8 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data9 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data10 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data11 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data12 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data13 as $key => $value) {
						array_push($subtype, $value);
					}

					foreach ($data16 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data17 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data18 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data19 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data20 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data21 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data22 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data23 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data24 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data25 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data26 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data27 as $key => $value) {
						array_push($subtype, $value);
					}
					foreach ($data28 as $key => $value) {
						array_push($subtype, $value);
					}
				}*/

				foreach ($emer as $em) {

					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);
					$filter1 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);
					$filter2 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);
				

					foreach ($filter as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter1 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter2 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;
			
			default:
				# code...
				break;
		}
	}elseif ($dist != 'All' && $scl == 'All_dist' || $dist != 'All' && $scl == 'All') {
		switch ($req_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Chronic'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;
				break;

			case 'General':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Normal'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency', 'doc_data.widget_data.page1.Problem Info.Chronic', 'doc_data.widget_data.page1.Problem Info.Normal'))->where(array('doc_data.widget_data.page2.Review Info.Status'=> 'Cured', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				foreach ($emer as $em) {

					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);
					$filter1 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);
					$filter2 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);


					foreach ($filter as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter1 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter2 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;


				break;
			
			default:
				# code...
				break;
		}
	}elseif ($dist != 'All' && $scl != 'All_dist' || $dist != 'All' && $scl != 'All') {
		switch ($req_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Chronic'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;
				break;

			case 'General':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Normal'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.0.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				foreach ($emer as $em) {
					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);

					foreach ($filter as $key => $value) {

						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
						
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1.Problem Info.Emergency', 'doc_data.widget_data.page1.Problem Info.Chronic', 'doc_data.widget_data.page1.Problem Info.Normal'))->where(array('doc_data.widget_data.page2.Review Info.Status'=> 'Cured', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.0.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				foreach ($emer as $em) {

					$filter = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']);
					$filter1 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']);
					$filter2 = array_filter($em['doc_data']['widget_data']['page1']['Problem Info']['Normal']);


					foreach ($filter as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter1 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}

					foreach ($filter2 as $key => $value) {
						if(is_array($value)){
							foreach($value as $datas){
								array_push($subtype, $datas);
							}
						}
					}
				}

				$final = array_count_values($subtype);

				foreach ($final as $key => $value) {
					$out['label'] = $key;
					$out['value'] = $value;
					array_push($problems, $out);
				}

				return $problems;


				break;
			
			default:
				# code...
				break;
		}
	}

}

public function get_schools_by_symptom_for_requests($symptom, $academic, $dist, $scl, $request_type)
{

	$years = explode("-", $academic);

	$start_date = "$years[0]-05-21";
	$end_date = "$years[1]-05-20";

	$schools =[];

	if($dist == 'All' && $scl == 'All_dist' || $dist == 'All' && $scl == 'All')
	{
		
		switch ($request_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where('doc_data.widget_data.page2.Review Info.Request Type','Emergency')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
						foreach ($emer as $em) {
							$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
							if(is_array($data1) && !empty($data1)){
								$check1 = in_array($symptom, $data1);
							}

							if(!empty($check1))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}
							$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
							$check2 = in_array($symptom, $data2);
							if(!empty($check2))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}

						}

						$final = array_count_values($schools);

						//echo print_r($final, true); exit();

				return $final;
				break;

			
			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where('doc_data.widget_data.page2.Review Info.Request Type','Chronic')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
												
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
												
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
												
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
												
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
												
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
												
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
												
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
												
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
												
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
												
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					/*$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
												
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}*/
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
												
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}

				
				$final = array_count_values($schools);

				return $final;
				break;

			case 'Normal':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where('doc_data.widget_data.page2.Review Info.Request Type','Normal')->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}


				$final = array_count_values($schools);

				return $final;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				$empty = [];

				foreach ($emer as $key => $em) {
					$data14 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$check14 = in_array($symptom, $data14);
							
					if(!empty($check14))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data15 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
					$check15 = in_array($symptom, $data15);
							
					if(!empty($check15))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};

					$data16 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check16 = in_array($symptom, $data16);
							
					if(!empty($check16))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data17 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check17 = in_array($symptom, $data17);
							
					if(!empty($check17))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data18 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check18 = in_array($symptom, $data18);
							
					if(!empty($check18))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data19 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check19 = in_array($symptom, $data19);
							
					if(!empty($check19))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data20 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check20 = in_array($symptom, $data20);
							
					if(!empty($check20))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data21 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check21 = in_array($symptom, $data21);
							
					if(!empty($check21))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data22 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check22 = in_array($symptom, $data22);
							
					if(!empty($check22))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data23 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check23 = in_array($symptom, $data23);
							
					if(!empty($check23))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data24 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check24 = in_array($symptom, $data24);
							
					if(!empty($check24))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data25 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check25 = in_array($symptom, $data25);
							
					if(!empty($check25))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data26 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check26 = in_array($symptom, $data26);
							
					if(!empty($check26))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data27 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check27 = in_array($symptom, $data27);
							
					if(!empty($check27))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data28 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check28 = in_array($symptom, $data28);
							
					if(!empty($check28))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

				}
				
				$final = array_count_values($schools);

				return $final;

				break;
			
			default:
				# code...
				break;
		}

		
	}elseif ($dist != 'All' && $scl == 'All_dist' || $dist != 'All' && $scl == 'All') {
		
	
		switch ($request_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Emergency', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
						foreach ($emer as $em) {
							$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
							$check1 = in_array($symptom, $data1);
							
							if(!empty($check1))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}
							$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
							$check2 = in_array($symptom, $data2);
							if(!empty($check2))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}

						}

						

						$final = array_count_values($schools);

						//echo print_r($final, true); exit();

				return $final;
				break;

			
			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Chronic', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
												
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
												
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
												
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
												
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
												
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
												
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
												
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
												
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
												
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
												
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
												
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
												
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}

				
				$final = array_count_values($schools);

				return $final;
				break;

			case 'Normal':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Normal', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}


				$final = array_count_values($schools);

				return $final;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Status'=> 'Cured', 'doc_data.widget_data.page1.Student Info.District.field_ref'=> $dist))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				

				$empty = [];

				foreach ($emer as $key => $em) {
					$data14 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$check14 = in_array($symptom, $data14);
							
					if(!empty($check14))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data15 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
					$check15 = in_array($symptom, $data15);
							
					if(!empty($check15))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};

					$data16 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check16 = in_array($symptom, $data16);
							
					if(!empty($check16))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data17 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check17 = in_array($symptom, $data17);
							
					if(!empty($check17))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data18 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check18 = in_array($symptom, $data18);
							
					if(!empty($check18))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data19 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check19 = in_array($symptom, $data19);
							
					if(!empty($check19))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data20 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check20 = in_array($symptom, $data20);
							
					if(!empty($check20))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data21 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check21 = in_array($symptom, $data21);
							
					if(!empty($check21))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data22 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check22 = in_array($symptom, $data22);
							
					if(!empty($check22))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data23 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check23 = in_array($symptom, $data23);
							
					if(!empty($check23))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data24 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check24 = in_array($symptom, $data24);
							
					if(!empty($check24))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data25 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check25 = in_array($symptom, $data25);
							
					if(!empty($check25))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data26 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check26 = in_array($symptom, $data26);
							
					if(!empty($check26))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data27 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check27 = in_array($symptom, $data27);
							
					if(!empty($check27))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data28 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check28 = in_array($symptom, $data28);
							
					if(!empty($check28))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

				}
				
				$final = array_count_values($schools);

				return $final;

				break;
			
			default:
				# code...
				break;
		}

		
	}elseif ($dist != 'All' && $scl != 'All_dist' || $dist != 'All' && $scl != 'All') {
		

		switch ($request_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
						foreach ($emer as $em) {
							$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
							$check1 = in_array($symptom, $data1);
							
							if(!empty($check1))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}
							$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
							$check2 = in_array($symptom, $data2);
							if(!empty($check2))
							{
								array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

							}

						}

						

						$final = array_count_values($schools);

						//echo print_r($final, true); exit();

				return $final;
				break;

			
			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
												
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
												
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
												
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
												
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
												
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
												
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
												
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
												
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
												
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
												
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
												
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
												
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}

				
				$final = array_count_values($schools);

				return $final;
				break;

			case 'Normal':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');


				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
				}


				$final = array_count_values($schools);

				return $final;

				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Status'=> 'Cured', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				$empty = [];

				foreach ($emer as $key => $em) {
					$data14 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$check14 = in_array($symptom, $data14);
							
					if(!empty($check14))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data15 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
					$check15 = in_array($symptom, $data15);
							
					if(!empty($check15))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};

					$data16 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check16 = in_array($symptom, $data16);
							
					if(!empty($check16))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data17 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check17 = in_array($symptom, $data17);
							
					if(!empty($check17))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data18 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check18 = in_array($symptom, $data18);
							
					if(!empty($check18))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					};
					$data19 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check19 = in_array($symptom, $data19);
							
					if(!empty($check19))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data20 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check20 = in_array($symptom, $data20);
							
					if(!empty($check20))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data21 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check21 = in_array($symptom, $data21);
							
					if(!empty($check21))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data22 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check22 = in_array($symptom, $data22);
							
					if(!empty($check22))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data23 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check23 = in_array($symptom, $data23);
							
					if(!empty($check23))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data24 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check24 = in_array($symptom, $data24);
							
					if(!empty($check24))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data25 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check25 = in_array($symptom, $data25);
							
					if(!empty($check25))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data26 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check26 = in_array($symptom, $data26);
							
					if(!empty($check26))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data27 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check27 = in_array($symptom, $data27);
							
					if(!empty($check27))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}
					$data28 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check28 = in_array($symptom, $data28);
							
					if(!empty($check28))
					{
						array_push($schools, $em['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref']);

					}

				}
				
				$final = array_count_values($schools);

				return $final;

				break;
			
			default:
				# code...
				break;
		}

		
	}
}

public function get_students_by_requests_symptom($symptom, $academic, $dist, $scl, $request_type)
{
	$years = explode("-", $academic);

	$start_date = "$years[0]-05-21";
	$end_date = "$years[1]-05-20";

	$schools = [];

		switch ($request_type) {
			case 'Emergency':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Emergency', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');


					foreach ($emer as $em) {
						$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
						$check1 = in_array($symptom, $data1);
						
						if(!empty($check1))
						{
							array_push($schools, $em);

						}
						$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
						$check2 = in_array($symptom, $data2);
						if(!empty($check2))
						{
							array_push($schools, $em);

						}

					}


				
				return $schools;
				break;

			case 'Chronic':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Chronic', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');
				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
												
					if(!empty($check2))
					{
						array_push($schools, $em);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
												
					if(!empty($check3))
					{
						array_push($schools, $em);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
												
					if(!empty($check4))
					{
						array_push($schools, $em);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
												
					if(!empty($check5))
					{
						array_push($schools, $em);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
												
					if(!empty($check6))
					{
						array_push($schools, $em);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
												
					if(!empty($check7))
					{
						array_push($schools, $em);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
												
					if(!empty($check8))
					{
						array_push($schools, $em);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
												
					if(!empty($check9))
					{
						array_push($schools, $em);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
												
					if(!empty($check10))
					{
						array_push($schools, $em);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
												
					if(!empty($check11))
					{
						array_push($schools, $em);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
												
					if(!empty($check12))
					{
						array_push($schools, $em);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
												
					if(!empty($check13))
					{
						array_push($schools, $em);

					}
				}

				
				return $schools;
				break;

			case 'Normal':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Request Type'=> 'Normal', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereNe('doc_data.widget_data.page2.Review Info.Status','Cured')->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');


				$empty = [];
				foreach ($emer as $em) {

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em);

					}
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em);

					}
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em);

					}
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em);

					}
				}


				return $schools;
				break;

			case 'Cured':
				$emer = $this->mongo_db->select(array('doc_data.widget_data.page1'))->where(array('doc_data.widget_data.page2.Review Info.Status'=> 'Cured', 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->whereBetween('history.time', $start_date, $end_date)->get('healthcare2016108181933756_static_html');

				$empty = [];

				foreach ($emer as $key => $em) {
					$data14 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Disease'];
					$check14 = in_array($symptom, $data14);
							
					if(!empty($check14))
					{
						array_push($schools, $em);

					}
					$data15 = $em['doc_data']['widget_data']['page1']['Problem Info']['Emergency']['Bites'];
					$check15 = in_array($symptom, $data15);
							
					if(!empty($check15))
					{
						array_push($schools, $em);

					}

					$data1 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Eyes'];
					$check1 = in_array($symptom, $data1);
							
					if(!empty($check1))
					{
						array_push($schools, $em);

					}
					$data2 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Ent'];
					$check2 = in_array($symptom, $data2);
							
					if(!empty($check2))
					{
						array_push($schools, $em);

					}
					$data3 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Central_nervous_system'];
					$check3 = in_array($symptom, $data3);
							
					if(!empty($check3))
					{
						array_push($schools, $em);

					}
					$data4 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Respiratory_system'];
					$check4 = in_array($symptom, $data4);
							
					if(!empty($check4))
					{
						array_push($schools, $em);

					}
					$data5 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Cardio_vascular_system'];
					$check5 = in_array($symptom, $data5);
							
					if(!empty($check5))
					{
						array_push($schools, $em);

					}
					$data6 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Gastro_intestinal'];
					$check6 = in_array($symptom, $data6);
							
					if(!empty($check6))
					{
						array_push($schools, $em);

					}
					$data7 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Blood'];
					$check7 = in_array($symptom, $data7);
							
					if(!empty($check7))
					{
						array_push($schools, $em);

					}
					$data8 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Kidney'];
					$check8 = in_array($symptom, $data8);
							
					if(!empty($check8))
					{
						array_push($schools, $em);

					}
					$data9 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['VandM'];
					$check9 = in_array($symptom, $data9);
							
					if(!empty($check9))
					{
						array_push($schools, $em);

					}
					$data10 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Bones'];
					$check10 = in_array($symptom, $data10);
							
					if(!empty($check10))
					{
						array_push($schools, $em);

					};
					$data11 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Skin'];
					$check11 = in_array($symptom, $data11);
							
					if(!empty($check11))
					{
						array_push($schools, $em);

					};
					$data12 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Endo'];
					$check12 = in_array($symptom, $data12);
							
					if(!empty($check12))
					{
						array_push($schools, $em);

					};
					$data13 = $em['doc_data']['widget_data']['page1']['Problem Info']['Chronic']['Others'];
					$check13 = in_array($symptom, $data13);
							
					if(!empty($check13))
					{
						array_push($schools, $em);

					};

					$data16 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['General'];
					$check16 = in_array($symptom, $data16);
							
					if(!empty($check16))
					{
						array_push($schools, $em);

					};
					$data17 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Head'];
					$check17 = in_array($symptom, $data17);
							
					if(!empty($check17))
					{
						array_push($schools, $em);

					};
					$data18 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Eyes'];
					$check18 = in_array($symptom, $data18);
							
					if(!empty($check18))
					{
						array_push($schools, $em);

					};
					$data19 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Ent'];
					$check19 = in_array($symptom, $data19);
							
					if(!empty($check19))
					{
						array_push($schools, $em);

					}
					$data20 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Respiratory_system'];
					$check20 = in_array($symptom, $data20);
							
					if(!empty($check20))
					{
						array_push($schools, $em);

					}
					$data21 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Cardio_vascular_system'];
					$check21 = in_array($symptom, $data21);
							
					if(!empty($check21))
					{
						array_push($schools, $em);

					}
					$data22 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gastro_intestinal'];
					$check22 = in_array($symptom, $data22);
							
					if(!empty($check22))
					{
						array_push($schools, $em);

					}
					$data23 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Genito_urinary'];
					$check23 = in_array($symptom, $data23);
							
					if(!empty($check23))
					{
						array_push($schools, $em);

					}
					$data24 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Gynaecology'];
					$check24 = in_array($symptom, $data24);
							
					if(!empty($check24))
					{
						array_push($schools, $em);

					}
					$data25 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Endo_crinology'];
					$check25 = in_array($symptom, $data25);
							
					if(!empty($check25))
					{
						array_push($schools, $em);

					}
					$data26 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Musculo_skeletal_syatem'];
					$check26 = in_array($symptom, $data26);
							
					if(!empty($check26))
					{
						array_push($schools, $em);

					}
					$data27 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Central_nervous_system'];
					$check27 = in_array($symptom, $data27);
							
					if(!empty($check27))
					{
						array_push($schools, $em);

					}
					$data28 = $em['doc_data']['widget_data']['page1']['Problem Info']['Normal']['Psychiartic'];
					$check28 = in_array($symptom, $data28);
							
					if(!empty($check28))
					{
						array_push($schools, $em);

					}

				}
				
				return $schools;
				break;
			
			default:
				# code...
				break;
		}
		

	
}


public function get_students_for_admitted($start_date, $end_date, $scl, $request_type)
	{
			$start = strval($start_date);
		    $end = strval($end_date);
		    //$schools = [];
		    switch ($request_type) {
		    	case 'Admitted':
		    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Hospitalized", 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->get($this->request_app_col_static_html);

		    		//echo print_r($requests, true); exit();
		    		/*foreach ($requests as $scl) {

		    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
		    			
		    			array_push($schools, $scl_name);
		    		}

		    		$final = array_count_values($schools);*/

		    		return $requests;
		    		break;
		    	case 'Review':
		    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Review", 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->get($this->request_app_col_static_html);

		    		//echo print_r($requests, true); exit();
		    		/*foreach ($requests as $scl) {

		    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
		    			
		    			array_push($schools, $scl_name);
		    		}

		    		$final = array_count_values($schools);*/

		    		return $requests;
		    		break;
		    	case 'Out-Patient':
		    		$requests = $this->mongo_db->select(array('doc_data.widget_data.page1'))->whereGte('history.0.time', $start)->whereLte('history.0.time', $end)->where(array('doc_data.widget_data.page2.Review Info.Status' => "Out-Patient", 'doc_data.widget_data.page1.Student Info.School Name.field_ref'=> $scl))->get($this->request_app_col_static_html);

		    		//echo print_r($requests, true); exit();
		    		/*foreach ($requests as $scl) {

		    			$scl_name = $scl['doc_data']['widget_data']['page1']['Student Info']['School Name']['field_ref'];
		    			
		    			array_push($schools, $scl_name);
		    		}

		    		$final = array_count_values($schools);*/

		    		return $requests;
		    		break;
		    	
		    	default:
		    		# code...
		    		break;
		    }

	}

	/*Sanitation Data */
public function get_schools_list_based_on_sanitation_type($date, $sanitaion_type)
{
	$final_array = [];

	if($sanitaion_type == 'Not Submitted'){
		$query = $this->get_sanitation_report_pie_schools_data($date);

		$schools = $query['not_submitted']['school'];

		return $schools;
		
	}elseif ($sanitaion_type == 'Submitted') {
		$query = $this->get_sanitation_report_pie_schools_data($date);
		$schools = $query['submitted']['school'];
		
		foreach ($schools as $school) {
			
			$campus = $this->mongo_db->whereLike ( 'doc_data.widget_data.page4.Declaration Information.Date:',$date )->where('doc_data.widget_data.page4.School Information.School Name', $school)->get($this->sanitation_app_col_v2);
		
		if(isset($campus[0]['doc_data']['widget_data']['daily']['Campus'])){
			
				$cleaning_campus = $campus[0]['doc_data']['widget_data']['daily']['Campus'];
				$cleaning_toitel = $campus[0]['doc_data']['widget_data']['daily']['Toilets'];
				$cleaning_kitchen = $campus[0]['doc_data']['widget_data']['daily']['Kitchen'];
		}
			

			$data['School_Name'] = $school;
			$data['Campus'] = $cleaning_campus;
			$data['Toilets'] = $cleaning_toitel;
			$data['Kitchen'] = $cleaning_kitchen;

			array_push($final_array, $data);
			
		}

		return $final_array;
	}elseif ($sanitaion_type == 'Animals') {

		$query = $this->mongo_db->select(array('doc_data.widget_data.page4.School Information.School Name'))->whereLike('doc_data.widget_data.page4.Declaration Information.Date:', $date)->where('doc_data.widget_data.daily.Campus.Animals Around Campus', 'Yes')->get($this->sanitation_app_col_v2);

		foreach ($query as $data) {
			$scl_name = $data['doc_data']['widget_data']['page4']['School Information']['School Name'];
			array_push($final_array, $scl_name);
		}

		return $final_array;

	}elseif ($sanitaion_type == 'Washrooms Required') {
		$query = $this->mongo_db->select(array('doc_data.widget_data.page4.School Information.School Name'))->whereLike('doc_data.widget_data.page4.Declaration Information.Date:', $date)->where('doc_data.widget_data.daily.Toilets.Any Damages To The Toilets', 'Yes')->get($this->sanitation_app_col_v2);

		foreach ($query as $data) {
			$scl_name = $data['doc_data']['widget_data']['page4']['School Information']['School Name'];
			array_push($final_array, $scl_name);
		}

		return $final_array;
	}

	
}

public function get_attendance_data_for_bar_students($symptom, $school, $date)

{
	$school_name_with_count = [];
    $students_personal_info =[];

    if ($symptom == 'R2H') {              
              $query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.R2H')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.R2H' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

        foreach ($query as $data) {
         $ss = $data['doc_data']['widget_data']['page1']['Attendence Details']['R2H UID'];
         $dd = explode(',',  $ss);

         foreach ($dd as $key => $value) {
          $personal_query = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $value)->get('ttwreis_screening_report_col_2020-2021');          
       array_push( $students_personal_info, $personal_query);
         }
        }

    }elseif($symptom == 'Sick')  {              
              $query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Sick')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Sick' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

        foreach ($query as $data) {
              $ss = $data['doc_data']['widget_data']['page1']['Attendence Details']['Sick UID'];
              $dd = explode(',',  $ss);

       foreach ($dd as $key => $value) {
            $personal_query = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $value)->get('ttwreis_screening_report_col_2020-2021');          
       array_push( $students_personal_info, $personal_query);
         }
        }

    }elseif ($symptom == 'RestRoom') {              
              $query = $this->mongo_db->select('doc_data.widget_data.page2.Attendence Details.RestRoom')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page2.Attendence Details.RestRoom' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

        foreach ($query as $data) {
              $ss = $data['doc_data']['widget_data']['page2']['Attendence Details']['RestRoom UID'];
              $dd = explode(',',  $ss);

       foreach ($dd as $key => $value) {
            $personal_query = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $value)->get('ttwreis_screening_report_col_2020-2021');          
       array_push( $students_personal_info, $personal_query);
         }
        }

    }elseif ($symptom == 'Attendance')
    {              
              $query = $this->mongo_db->select('doc_data.widget_data.page1.Attendence Details.Attended')->whereLike('history.last_stage.time', $date)->where(array('doc_data.widget_data.page1.Attendence Details.Attended' => array('$ne' => '0'), 'doc_data.widget_data.page1.Attendence Details.Select School' => $school))->get('healthcare20161015173311279');

        foreach ($query as $data) {
              $ss = $data['doc_data']['widget_data']['page2']['Attendence Details']['Absent UID'];
              $dd = explode(',',  $ss);

       foreach ($dd as $key => $value) {
            $personal_query = $this->mongo_db->where('doc_data.widget_data.page1.Personal Information.Hospital Unique ID', $value)->get('ttwreis_screening_report_col_2020-2021');          
       array_push( $students_personal_info, $personal_query);
         }
        }
    }


    return $students_personal_info;	
}

	public function get_excel_for_students_reports_model($district, $scl ,$collection_year)
    {           

        $query = $this->mongo_db->select('dt_name')->where ( '_id', new MongoId ( "$district" ) )->get ( 'ttwreis_district_backup' );
      

        if(!empty($query[0]['dt_name']))
        {
            $query = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=>$query[0]['dt_name'] , 'doc_data.widget_data.page2.Personal Information.School Name'=> $scl))->get($collection_year);
           
            return $query;  
        }
    }

    /*Classes Updation acknowledgement*/
	public function get_classes_update_students_count_both_yrs()
	{
		$final_data = [];
		$get_transefered_scls = $this->mongo_db->command(array('distinct'=>'ttwreis_screening_report_col_2022-2023', 'key'=>'doc_data.widget_data.page2.Personal Information.School Name'));
		$schools = $get_transefered_scls['values'];

		foreach ($schools as $key => $value) {
			$prev_col = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $value)->count($this->screening_app_col_tt_2021_2022);

			$current_col = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=> $value, 'doc_properties.previous_doc_id'=>array('$exists'=> true)))->count('ttwreis_screening_report_col_2022-2023');

			$passed_out_col = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $value)->count('ttwreis_screening_report_col_2022-2023_passed_out');

			$other_cls = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $value)->count('ttwreis_other_classes_screening_data_2022-2023');

			$newly_joined = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name'=> $value, 'doc_properties.previous_doc_id'=>array('$exists'=> false)))->count('ttwreis_screening_report_col_2022-2023');

			if(isset($current_col) && !empty($current_col)){
				$data['school'] = $value;
				$data['prev_yr_count'] = $prev_col;
				$data['current_yr_count'] = $current_col;
				$data['passed_out_count'] = $passed_out_col;
				$data['other_cls_count'] = $other_cls;
				$data['newly_joined_count'] = $newly_joined;

				if(isset($data['school']) && !empty($data['school'])){
					array_push($final_data, $data);
				}
			}
			

		}
	
		return $final_data;
	}
	/*End Classes Updation acknowledgement*/

	/*Upgrade Classes*/
	public function migrate_student_personal_info($school_name) {

		//$get_screening_academic_years = 'ttwreis_screening_report_col_2020-2021';

		$get_screening_academic_years = 'ttwreis_screening_report_col_2022-2023';

		//$get_screening_passed_out_academic_years = $this->get_screening_passed_out_academic_years();
		//$get_screening_passed_out_academic_years = 'ttwreis_screening_report_col_2020-2021_passed_out';

		$get_screening_passed_out_academic_years = 'ttwreis_screening_report_col_2022-2023_passed_out';

		$others_in_class = array("TC Issued");

		$query = $this->mongo_db->select(array('doc_data.widget_data.page1', 'doc_data.widget_data.page2', 'doc_properties'))->where('doc_data.widget_data.page2.Personal Information.School Name', $school_name)->get("ttwreis_screening_report_col_2021-2022");

		$is_exists = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school_name)->get($get_screening_academic_years);
		if($is_exists)
		{
			return true;
		}
		else
		{
			$time = date('Y-m-d H:i:s');
			$class_count = 1;
			
			foreach($query as $school)
			{
				$document_id = get_unique_id();
					$prev_document_id_2019_20 = $school["doc_properties"]["doc_id"];

					if(isset($school["doc_properties"]["previous_doc_id"]) && !empty($school["doc_properties"]["previous_doc_id"])){
						$prev_document_id_2020_21 = $school["doc_properties"]["previous_doc_id"];
					}else{
						$prev_document_id_2020_21 = "Nil";
					}
					
					$class = $school['doc_data']["widget_data"]["page2"]["Personal Information"]["Class"];
					if((intval($class) == 10)){
					   $class_passed_out = "2021-22"." 10th passed out";
				   }else if((intval($class) == 12)){
					   $class_passed_out = "2021-22"." 12th passed out";
				   } else if(($class == "Degree 3rd")){
					   $class_passed_out = "2021-22"." Degree 3rd passed out";
				   } else if(isset($class) && !empty($class) && ($class == "Degree 1st" || $class == "Degree 2nd")){
					   			if($class == "Degree 1st"){
					   				$class = "Degree 2nd";
					   			}else if($class == "Degree 2nd"){
					   				$class = "Degree 3rd";
					   			}

					   }
				   else{
					   if(isset($class) && !empty($class) && ($class != "") && ($class != " ") && (intval($class) <= 11)){
						   $class++;
					   }
				   }
			  $class = (string) $class;
			 
				if($school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] != "10" && $school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] != "12" && $school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] != "Degree 3rd" && (!in_array($school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"], $others_in_class)))
				{
					if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"])){
						$gender = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"];
					}else{
						$gender = "";
					}

					if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"])){

							$type = gettype($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"]);
							
							if($type == "integer"){
								$age_no = intval($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"]);

								$age = $age_no+1;

							}else{
								$age_no = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"];

								$age = $age_no+1;
							}
							
						}else{
							$age = "";
						}

					$doc_data = '{"doc_data" : { "widget_data" : { "page1" : { "Personal Information" : { "Hospital Unique ID" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Hospital Unique ID"].'", "Name" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Name"].'" , "Photo" : "", "Date of Birth" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Date of Birth"].'", "Mobile": {"country_code" : "91", "mob_num" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Mobile"]["mob_num"].'" },"Gender" : "'.$gender.'", "Age":"'.$age.'" } }, "page2" : { "Personal Information": {"AD No": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["AD No"].'", "Class": "'.$class.'", "Section": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Section"].'", "District": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["District"].'", "School Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["School Name"].'", "Father Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Father Name"].'", "Date of Exam": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Date of Exam"].'" } }, "page3":[], "page4":[], "page5":[], "page6":[], "page7":[], "page8":[], "page9":[] }}, "doc_properties" : { "doc_id" : "'.$document_id.'", "previous_doc_id" : "'.$prev_document_id_2020_21.'", "previous_doc_id_2019_20" : "'.$prev_document_id_2019_20.'", "status" : 1, "_version" : 1, "doc_owner" : "PANACEA", "unique_id" : "", "doc_flow" : "new"}, "history" : {"last_stage" : { "current_stage" : "stage1", "approval" : "true", "submitted_by" : "ttwreis.user@gmail.com", "time" : "'.$time.'" } }}';
			
					$doc_data_array =json_decode($doc_data,true);
					if(isset($doc_data_array) && !empty($doc_data_array)){
							$this->mongo_db->insert ( "ttwreis_screening_report_col_2022-2023", $doc_data_array );
						}
			
				}
				elseif($school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] == "10" || $school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] == "12" || $school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"] == "Degree 3rd")
				{
					if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"])){
						$gender = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"];
					}else{
						$gender = "";
					}

					if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"])){
						$age_no = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"];
						$age = $age++;
					}else{
						$age = "";
					}

					$doc_data_passed = '{"doc_data" : { "widget_data" : { "page1" : { "Personal Information" : { "Hospital Unique ID" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Hospital Unique ID"].'", "Name" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Name"].'" , "Photo" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Photo"].'", "Date of Birth" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Date of Birth"].'","Mobile": {"country_code" : "91", "mob_num" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Mobile"]["mob_num"].'" },"Gender" : "'.$gender.'", "Age":"'.$age.'" } }, "page2" : { "Personal Information": {"AD No": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["AD No"].'", "Class": "'.$class_passed_out.'", "Section": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Section"].'", "District": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["District"].'", "School Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["School Name"].'", "Father Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Father Name"].'", "Date of Exam": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Date of Exam"].'" } }, "page3":[], "page4":[], "page5":[], "page6":[], "page7":[], "page8":[], "page9":[] }}, "doc_properties" : { "doc_id" : "'.$document_id.'", "previous_doc_id" : "'.$prev_document_id_2020_21.'", "previous_doc_id_2019_20" : "'.$prev_document_id_2019_20.'", "status" : 1, "_version" : 1, "doc_owner" : "PANACEA", "unique_id" : "", "doc_flow" : "new"}, "history" : {"last_stage" : { "current_stage" : "stage1", "approval" : "true", "submitted_by" : "ttwreis.user@gmail.com", "time" : "'.$time.'" } }}';

						$doc_data_array_passed =json_decode($doc_data_passed,true);
						if(isset($doc_data_array_passed) && !empty($doc_data_array_passed)){
							$this->mongo_db->insert ( $get_screening_passed_out_academic_years, $doc_data_array_passed );
						}
						
					}elseif(in_array($school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"], $others_in_class)){

						if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"])){
							$gender = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Gender"];
						}else{
							$gender = "";
						}

						if(isset($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"]) && !empty($school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"])){
							$age_no = $school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Age"];
							$age = $age++;
						}else{
							$age = "";
						}

						$doc_data_other_cls = '{"doc_data" : { "widget_data" : { "page1" : { "Personal Information" : { "Hospital Unique ID" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Hospital Unique ID"].'", "Name" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Name"].'" , "Photo" : "", "Date of Birth" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Date of Birth"].'", "Mobile": {"country_code" : "91", "mob_num" : "'.$school["doc_data"]["widget_data"]["page1"]["Personal Information"]["Mobile"]["mob_num"].'" },"Gender" : "'.$gender.'", "Age":"'.$age.'" } }, "page2" : { "Personal Information": {"AD No": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["AD No"].'", "Class": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Class"].'","Section": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Section"].'", "District": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["District"].'", "School Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["School Name"].'", "Father Name": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Father Name"].'", "Date of Exam": "'.$school["doc_data"]["widget_data"]["page2"]["Personal Information"]["Date of Exam"].'" } }, "page3":[], "page4":[], "page5":[], "page6":[], "page7":[], "page8":[], "page9":[] }}, "doc_properties" : { "doc_id" : "'.$document_id.'", "previous_doc_id" : "'.$prev_document_id_2020_21.'", "previous_doc_id_2019_20" : "'.$prev_document_id_2019_20.'", "status" : 1, "_version" : 1, "doc_owner" : "PANACEA", "unique_id" : "", "doc_flow" : "new"}, "history" : {"last_stage" : { "current_stage" : "stage1", "approval" : "true", "submitted_by" : "ttwreis.user@gmail.com", "time" : "'.$time.'" } }}';

						$doc_data_array_others =json_decode($doc_data_other_cls,true);

						if(isset($doc_data_array_others) && !empty($doc_data_array_others)){
							$this->mongo_db->insert ( "ttwreis_other_classes_screening_data_2021-2022", $doc_data_array_others );
						}
				}
					
					$iterate_data = $class_count++;
					if(count($query) == $iterate_data)
					{
						$year_1 = Date('Y');
        				$year_2 = $year_1 + 1;
        				$academic_years = $year_1.'-'.$year_2;

						$school_status = array(
							"school_name" => $school_name,
							"District_name"	=> $school["doc_data"]["widget_data"]["page2"]["Personal Information"]["District"],
							"migration_status" => "success",
							"migrated_date"    => date('Y-m-d')
						);
						$qry = $this->mongo_db->insert ( "ttwreis_screening_report_migration_status_".$academic_years, $school_status );
					}
			}
		}
	}

/*End Upgrade classes*/

	public function show_sanitation_submitted_pics($school, $date)
	{
		$query = $this->mongo_db->where(array('doc_data.widget_data.page4.School Information.School Name'=>$school, 'doc_data.widget_data.page4.Declaration Information.Date:'=>$date))->get($this->sanitation_app_col_v2);

		return $query;
	}

	public function requests_notes_model($today_date)
    {
    	$date = substr($today_date,0,-3); 
    	
	    $notes_query = $this->mongo_db->select('uid', 'datetime','note')->where(array('datetime' => array('$regex' => $date)))->get('ttwreis_ehr_notes');
    	
	    return $notes_query;
    }

    public function get_request_notes_based_on_time_span_model($start, $end)
    {       	
   
    $query = $this->mongo_db->where('datetime', array('$gte'=>$start), 'datetime', array('$lte'=>$end))->get('ttwreis_ehr_notes');


    return $query;

    }

    // Requests notes excel//
	
	public function get_excel_for_request_notes_data($start, $end)
	{			

		 $query = $this->mongo_db->select(array("uid","note","datetime","Name","Class","School_Name","username"))->where('datetime', array('$gte'=>$start), 'datetime', array('$lte'=>$end))->get('ttwreis_ehr_notes');
		

		return $query;
	}

	/*Maximum raised requests counts*/
	
	function maximum_raised_requests_script_model($start_date, $end_date, $request_count) 
    {
        $unique_id_array = array();
        $array_morethan_three = array();
        $result_data = array();
        $date = new DateTime ( $start_date );
        $start_date = $date->format ( 'Y-m-d' );
        $date_end = new DateTime ( $end_date );
        $end_date = $date_end->format ( 'Y-m-d' );

      
        $dates ['start_date'] = $start_date;
        $dates ['end_date'] = $end_date;

     
     $last_three_months = $this->mongo_db->select('doc_data.widget_data.page1.Student Info.Unique ID')->whereBetween('history.0.time', $dates ['start_date'], $dates ['end_date'] )->get($this->request_app_col_static_html);
       
        

        foreach ($last_three_months as $data) {
            $unique_id = $data['doc_data']['widget_data']['page1']['Student Info']['Unique ID'];

            array_push($unique_id_array, $unique_id);

        }


        $vals = array_count_values(array_filter($unique_id_array));

            
            foreach ($vals as $key => $value) {
            if($value >= $request_count)
            {
                $morethan_three_ids = $key;


                array_push( $array_morethan_three, $morethan_three_ids);

            }

            }

            foreach ($array_morethan_three as $unique_id) {
                
           
                $query = $this->mongo_db->select(array('doc_data.widget_data'))->where('doc_data.widget_data.page1.Student Info.Unique ID', $unique_id)->get($this->request_app_col_static_html);

                array_push($result_data, $query[0]);
            }
            
            return $result_data;

    }

/*Gender Wise Counts*/    

    public function get_students_data_genderwise($district_name, $school_name)
    {
    	if($district_name == 'All' && $school_name =='All')
		{	
			//Total schools		
			$this->mongo_db->switchDatabase($this->common_db['common_db']);
			$data['total_schools'] = $this->mongo_db->count('ttwreis_schools');

			//Female Schools
			$data['female_schools'] = $this->mongo_db->where(array('school_name'=> array('$regex' => '(G).,', '$options' => 'i')))->count('ttwreis_schools');

			//Male Schools
			$data['male_schools'] = $this->mongo_db->where(array('school_name'=> array('$regex' => '(B).,', '$options' => 'i')))->count('ttwreis_schools');

			$data['degree_col'] = $this->mongo_db->where(array('school_name'=> array('$regex' => 'TTWRDC.', '$options' => 'i')))->count('ttwreis_schools');

			$this->mongo_db->switchDatabase($this->common_db['dsn']);

			//Coeducation Schools
			$data['coedu_schools'] = "1";

			// For the Total Students
			$data['total_students'] = $this->mongo_db->count($this->screening_app_col_tt_2021_2022);

			//For Total Male Students
			$data['total_male_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(B).,', '$options' => 'i')))->count($this->screening_app_col_tt_2021_2022);

			//For Total Female Students
			$data['total_female_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(G).,', '$options' => 'i')))->count($this->screening_app_col_tt_2021_2022);

    	}elseif($district_name != 'All' && $school_name =='All')
    	{
    		//Total schools		
    		$this->mongo_db->switchDatabase($this->common_db['common_db']);
    		$data['total_schools'] = $this->mongo_db->where('dt_name', $district_name)->count('ttwreis_schools');

    		//Female Schools
    		$data['female_schools'] = $this->mongo_db->where(array('dt_name'=> $district_name, 'school_name'=> array('$regex' => '(G).,', '$options' => 'i')))->count('ttwreis_schools');

    		//Male Schools
    		$data['male_schools'] = $this->mongo_db->where(array('dt_name'=> $district_name, 'school_name'=> array('$regex' => '(B).,', '$options' => 'i')))->count('ttwreis_schools');

    		//Degree Schools
    		$data['degree_col'] = $this->mongo_db->where(array('dt_name'=> $district_name, 'school_name'=> array('$regex' => 'TTWRDC.', '$options' => 'i')))->count('ttwreis_schools');


    		$this->mongo_db->switchDatabase($this->common_db['dsn']);

    		

    		$district = $this->mongo_db->select(array('dt_name'))->where ( '_id', new MongoId ( $district_name ) )->get ( 'ttwreis_district' );

    		// For the Total Students
    		$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.District', $district[0]['dt_name'])->count($this->screening_app_col_tt_2021_2022);

    		//For Total Male Students
    		$data['total_male_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=> $district[0]['dt_name'], 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(B).,', '$options' => 'i')))->count($this->screening_app_col_tt_2021_2022);

    		//For Total Female Students
    		$data['total_female_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.District'=> $district[0]['dt_name'], 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(G).,', '$options' => 'i')))->count($this->screening_app_col_tt_2021_2022);

    	}elseif($district_name != 'All' && $school_name !='All')
    	{
    		
    		// For the Total Students
    		$data['total_students'] = $this->mongo_db->where('doc_data.widget_data.page2.Personal Information.School Name', $school_name)->count($this->screening_app_col_tt_2021_2022);

    		

    		if(preg_match("/(G).,/i", $school_name))
    		{
    			//For Total Female Students
    			$data['total_female_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name' => $school_name))->count($this->screening_app_col_tt_2021_2022);
    			$data['total_male_students'] = 0;
    		}
    		else
    		{
    			//For Total Male Students
    			$data['total_male_students'] = $this->mongo_db->where(array('doc_data.widget_data.page2.Personal Information.School Name' => $school_name))->count($this->screening_app_col_tt_2021_2022);

    			$data['total_female_students'] =0;
    		}

    		
    	}

    	return $data;
    }

/* Get Classes wise Male and Female Students */

	public function	get_classes_wise_male_female_data($district_name, $school_name)
	{
		
		$school_class = [];

		if($district_name == "All" && $school_name == "All")
		{
			$classes = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022, 'key' => "doc_data.widget_data.page2.Personal Information.Class"));

		 	foreach ($classes['values'] as $value) {

				$females_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(G).,', '$options' => 'i'))));
		    	$males_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(B).,', '$options' => 'i'))));

		    	$gender['female'] = count($females_count['values']);
		    	$gender['male'] = count($males_count['values']);
		    	$gender['total_students'] = count($males_count['values']) + count($females_count['values']);

				$data['class'] =  $value." Class";
				$data['count'] =  $gender;

				array_push($school_class, $data);

			}
		}
		elseif ($district_name != "All" && $school_name == "All") {

			$district = $this->mongo_db->select(array('dt_name'))->where ( '_id', new MongoId ( $district_name ) )->get ( 'ttwreis_district_backup' );

			
			$classes = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022, 'key' => "doc_data.widget_data.page2.Personal Information.Class", 'query'=>array('doc_data.widget_data.page2.Personal Information.District' => $district[0]['dt_name'])));

			foreach ($classes['values'] as $value) {

				$females_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.District' => $district[0]['dt_name'], 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(G).,', '$options' => 'i'))));
		    	$males_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.District' => $district[0]['dt_name'], 'doc_data.widget_data.page2.Personal Information.School Name' => array('$regex' => '(B).,', '$options' => 'i'))));

		    	$gender['female'] = count($females_count['values']);
		    	$gender['male'] = count($males_count['values']);
		    	$gender['total_students'] = count($males_count['values']) + count($females_count['values']);

				$data['class'] =  $value." Class";
				$data['count'] =  $gender;

				array_push($school_class, $data);

			}
		}
		elseif ($district_name != "All" && $school_name != "All") {
			$classes = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022, 'key' => "doc_data.widget_data.page2.Personal Information.Class", 'query'=>array('doc_data.widget_data.page2.Personal Information.School Name' => $school_name)));

			foreach ($classes['values'] as $value) {

				$counts = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.School Name' => $school_name)));
		    	//$males_count = $this->mongo_db->command(array('distinct' => $this->screening_app_col_tt_2021_2022 ,'key' => "doc_data.widget_data.page1.Personal Information.Hospital Unique ID",'query'=>array('doc_data.widget_data.page2.Personal Information.Class'=>$value, 'doc_data.widget_data.page2.Personal Information.School Name' => $school_name)));

		    	if(preg_match("/(G).,/i", $school_name))
		    	{
    		    	$gender['female'] = count($counts['values']);
    		    	$gender['male'] = 0;
    		    	$gender['total_students'] = $gender['female'] + $gender['male'];

    				$data['class'] =  $value." Class";
    				$data['count'] =  $gender;
		    	}
		    	else
		    	{
			    	$gender['female'] = 0;
			    	$gender['male'] = count($counts['values']);
			    	$gender['total_students'] = $gender['female'] + $gender['male'];

					$data['class'] =  $value." Class";
					$data['count'] =  $gender;
		    	}

				array_push($school_class, $data);

			}
		}

		return $school_class;
	}



public function get_schools_by_district_name($dist_id)
	{
		$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
			$query = $this->mongo_db->select ( array (
					'school_name'
					 
			) )->orderBy ( array (
					'school_name' => 1 
			) )->where ( 'district_name', strtoupper($dist_id) )->get ('ttwreis_schools_list');
			$this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
			return $query;

	}


public function ttwreis_dr_not_responded_docs_model($passing_date)
   {

      $get_details = $this->mongo_db->whereLike('history.time', $passing_date)->whereNe(array('history.current_stage' => 'Doctor' , 'doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->get('healthcare2016108181933756_static_html');

      return $get_details;
   }

   public function get_doctor_not_responded_span_model($start, $end)
    {  
    	
    	$query = $this->mongo_db->whereBetween('history.time' , $start,$end)->whereNe(array('history.current_stage' => 'Doctor' , 'doc_data.widget_data.page2.Review Info.Status' => 'Cured'))->get('healthcare2016108181933756_static_html');

    	return $query;
    }

    /*Global Search through Names */

    public function get_entered_related_data($data)
	{
		if(!preg_match("/_/", $data)){
			
		$query = $this->mongo_db->select(array('doc_data.widget_data.page1','doc_data.widget_data.page2'))->whereLike('doc_data.widget_data.page1.Personal Information.Name', $data)->get($this->screening_app_col_tt_2020_2021);
		}
		//echo print_r($query, true); exit();
		return $query;
	}

	public function get_blood_group($blood_group = "All") {



			$get_transefered_scls = $this->mongo_db->command(array('distinct'=>'panacea_blood_donors', 'key'=>'blood group'));
			$blood_group = $get_transefered_scls['values'];




		if ($blood_group == "All") {

			$query = $this->mongo_db->orderBy ( array ('blood_group' => 1 ) )->get ( 'panacea_blood_donors' );

		} else {

			$query = $this->mongo_db->where ( 'blood_group', $blood_group )->orderBy ( array ('blood_group' => 1 ) )->get ( 'panacea_blood_donors' );

		}

		
		return $query;
	}

	/* Get Blood Group Data */

	public function get_blood_group_wise_data_modal($blood, $district)
	{
		
			if($district == "All")
			{
				$data['Apositive'] = $this->mongo_db->where('doc_data.blood group', "A+ve")->count('panacea_blood_donors');

				$data['Anegative'] = $this->mongo_db->where('doc_data.blood group', "A-ve")->count('panacea_blood_donors');

				$data['ABpositive'] = $this->mongo_db->where('doc_data.blood group', "AB+ve")->count('panacea_blood_donors');

				$data['ABnegative'] = $this->mongo_db->where('doc_data.blood group', "AB-ve")->count('panacea_blood_donors');

				$data['Bpositive'] = $this->mongo_db->where('doc_data.blood group', "B+ve")->count('panacea_blood_donors');

				$data['Bnegative'] = $this->mongo_db->where('doc_data.blood group', "B-ve")->count('panacea_blood_donors');

				$data['Opositive'] = $this->mongo_db->where('doc_data.blood group', "O+ve")->count('panacea_blood_donors');

				$data['Onegative'] = $this->mongo_db->where('doc_data.blood group', "O-ve")->count('panacea_blood_donors');

				return $data;
			}
			else
			{
				$data['Apositive'] = $this->mongo_db->where(array('doc_data.blood group' => "A+ve" , "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['Anegative'] = $this->mongo_db->where(array('doc_data.blood group' => "A-ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['ABpositive'] = $this->mongo_db->where(array('doc_data.blood group'=> "AB+ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['ABnegative'] = $this->mongo_db->where(array('doc_data.blood group' => "AB-ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['Bpositive'] = $this->mongo_db->where(array('doc_data.blood group' => "B+ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['Bnegative'] = $this->mongo_db->where(array('doc_data.blood group' => "B-ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				$data['Opositive'] = $this->mongo_db->where(array('doc_data.blood group' =>  "O+ve", "doc_data.district" => $district))->count('panacea_blood_donors');
				
				$data['Onegative'] = $this->mongo_db->where(array('doc_data.blood group' => "O-ve", "doc_data.district" => $district))->count('panacea_blood_donors');

				return $data;

			}

		
		
	}

	public function get_blood_group_clicking_data_modal($blood_group, $district)
	{

			if($district == 'All' && $blood_group == 'All'){

				$data = $this->mongo_db->select("doc_data.donor name","doc_data.primary contact","doc_data.blood group","doc_data.district","doc_data.address")->get('panacea_blood_donors');

				return $data;

			}elseif($district == "All" && $blood_group != "All"){


				$data = $this->mongo_db->where('doc_data.blood group', $blood_group)->get('panacea_blood_donors');

				return $data;
			

			}elseif($district != "All" && $blood_group != "All"){

				$data = $this->mongo_db->where(array('doc_data.blood group' => $blood_group, "doc_data.district" => $district))->get('panacea_blood_donors');

				return $data;
			}
	}

	public function get_blood_groupwise_data_based_on_selected($blood,$district)
	{

		if($district == 'All' && $blood == 'All'){

			$data = $this->mongo_db->select("doc_data.donor name","doc_data.primary contact","doc_data.blood group","doc_data.district","doc_data.address")->get('panacea_blood_donors');
		

		}elseif($district != "All" && $blood == "All"){


			$data = $this->mongo_db->where('doc_data.district', $district)->get('panacea_blood_donors');			
		

		}elseif($district == "All" && $blood != "All"){


			$data = $this->mongo_db->where('doc_data.blood group', $blood)->get('panacea_blood_donors');			
		

		}elseif($district != "All" && $blood != "All"){

			$data = $this->mongo_db->where(array('doc_data.blood group' => $blood, "doc_data.district" => $district))->get('panacea_blood_donors');

		}
		return $data;
	}


 public function napkin_distribution_reports_model()
    {    	
    	
	   $query = $this->mongo_db->select('doc_data.school name', 'doc_data.contact details','doc_data.strength','doc_data.packs distributed count','doc_data.date of distribution')->get('tt_napkin_distribution_schools');
    	
	    return $query;
	    
    }


  public function import_detailed_school_information_model($doc_data, $history)
    {
    		$form_data = array ();
    		
			$form_data ['doc_data'] = $doc_data;
			
			$form_data ['history'] = $history;			
			
			$query = $this->mongo_db->insert ( "tt_schools_contact_information", $form_data );

			return $query;
    }


 public function schools_overall_information_model()
    {    	
    	
	    $query = $this->mongo_db->select('doc_data.school_name', 'doc_data.rco_details','doc_data.rhso_details','doc_data.district','doc_data.principal_details','doc_data.hs_details','doc_data.job_type','doc_data.qualification','doc_data.care_taker_details','doc_data.deo_details','doc_data.strength')->get('tt_schools_contact_information');
    	
	    return $query;
    }


     public function get_hs_jobtype_based_on_span_model($district_name,$hs_job_type)
    {

    	if ($district_name == "All" && $hs_job_type == "All") {

    		$query = $this->mongo_db->select("doc_data")->get('tt_schools_contact_information');

    	}elseif ($district_name == "All" && $hs_job_type != "All") {

    		$query = $this->mongo_db->select("doc_data")->where("doc_data.job_type" , $hs_job_type)->get('tt_schools_contact_information');
    		
    	}elseif ($district_name != "All" && $hs_job_type == "All") {

    		$query = $this->mongo_db->select("doc_data")->where("doc_data.district" , $district_name)->get('tt_schools_contact_information');
    		
    	}elseif ($district_name != "All" && $hs_job_type != "All") {

    		$query = $this->mongo_db->select("doc_data")->where(array("doc_data.district" => $district_name,"doc_data.job_type" => $hs_job_type ))->get('tt_schools_contact_information');
    		
    	} 

    	return $query;    	

    }


     public function get_ro_plants_incinarators_data_model()
    {
    	$totalWorking = 0;
    	$notWorking = 0;
    	$partialWorking = 0;
    	$notAvailable = 0;

    	$query = $this->mongo_db->get('tt_schools_contact_information');

    	if($query){

    		foreach ($query as $data) {


    			if($data['doc_data']['ro_plants'] != "NIL"){

    				if($data['doc_data']['ro_plants'] == $data['doc_data']['ro_active']){

    					$totalWorking++;

    				}elseif ($data['doc_data']['ro_plants'] == $data['doc_data']['ro_inactive']) {
    					
    					$notWorking++;

    				}elseif (($data['doc_data']['ro_plants'] != $data['doc_data']['ro_active'])  && ($data['doc_data']['ro_plants'] != $data['doc_data']['ro_inactive'])) {
    					
    					$partialWorking++;
    				}

    			}else{

    				$notAvailable++;
    			}
    			
    			
    		}

    	}


    	$datas['totalwork'] = $totalWorking;
    	$datas['notwork'] = $notWorking;
    	$datas['partialwork'] = $partialWorking;
    	$datas['notavailable'] = $notAvailable;

    	

    	return $datas;
    }



 public function get_ro_plants_schools_drill_model($status)
    {

    	$query = $this->mongo_db->get('tt_schools_contact_information');

    	if($status == "Active RO Plants"){

    		$FullActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['ro_plants'] != "NIL"){

    					if($data['doc_data']['ro_plants'] == $data['doc_data']['ro_active']){

    						array_push($FullActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $FullActive;

    	}elseif ($status == "Inactive RO Plants") {

    		$InActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['ro_plants'] != "NIL"){

    					if($data['doc_data']['ro_plants'] == $data['doc_data']['ro_inactive']){

    						array_push($InActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $InActive;

    	}elseif ($status == "Partially Active RO Plants") {

    		$PartiallyActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['ro_plants'] != "NIL"){

    					if(($data['doc_data']['ro_plants'] != $data['doc_data']['ro_active'])  && ($data['doc_data']['ro_plants'] != $data['doc_data']['ro_inactive'])){

    						array_push($PartiallyActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $PartiallyActive;

    	}elseif ($status == "Not Available RO Plants") {

    		$NotAvailable = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['ro_plants'] == "NIL"){
    					
    						array_push($NotAvailable, $data);    					

    				}
    				
    				
    			}

    		}

    		return $NotAvailable;
    	}
    	
    }






      public function get_incinarator_data_model()
    {
    	$totalWorking = 0;
    	$notWorking = 0;
    	$partialWorking = 0;
    	$notAvailable = 0;

    	$query = $this->mongo_db->get('tt_schools_contact_information');

    	if($query){

    		foreach ($query as $data) {


    			if($data['doc_data']['incinerators_availability'] != "NIL"){

    				if($data['doc_data']['incinerators_availability'] == $data['doc_data']['active']){

    					$totalWorking++;

    				}elseif ($data['doc_data']['incinerators_availability'] == $data['doc_data']['inactive']) {
    					
    					$notWorking++;

    				}elseif (($data['doc_data']['incinerators_availability'] != $data['doc_data']['active'])  && ($data['doc_data']['incinerators_availability'] != $data['doc_data']['inactive'])) {
    					
    					$partialWorking++;
    				}

    			}else{

    				$notAvailable++;
    			}
    			
    			
    		}

    	}


    	$datas['totalwork'] = $totalWorking;
    	$datas['notwork'] = $notWorking;
    	$datas['partialwork'] = $partialWorking;
    	$datas['notavailable'] = $notAvailable;

    	

    	return $datas;
    }


     public function get_incinarators_schools_drill_model($status)
    {

    	$query = $this->mongo_db->get('tt_schools_contact_information');

    	if($status == "Active Incinerators"){

    		$FullActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['incinerators_availability'] != "NIL"){

    					if($data['doc_data']['incinerators_availability'] == $data['doc_data']['active']){

    						array_push($FullActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $FullActive;

    	}elseif ($status == "Inactive Incinerators") {

    		$InActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['incinerators_availability'] != "NIL"){

    					if($data['doc_data']['incinerators_availability'] == $data['doc_data']['inactive']){

    						array_push($InActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $InActive;

    	}elseif ($status == "Partially Active Incinerators") {

    		$PartiallyActive = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['incinerators_availability'] != "NIL"){

    					if(($data['doc_data']['incinerators_availability'] != $data['doc_data']['active'])  && ($data['doc_data']['incinerators_availability'] != $data['doc_data']['inactive'])){

    						array_push($PartiallyActive, $data);

    					}

    				}
    				
    				
    			}

    		}

    		return $PartiallyActive;

    	}elseif ($status == "Not Available Incinerators") {

    		$NotAvailable = [];

    		if($query){

    			foreach ($query as $data) {


    				if($data['doc_data']['incinerators_availability'] == "NIL"){
    					
    						array_push($NotAvailable, $data);    					

    				}
    				
    				
    			}

    		}

    		return $NotAvailable;
    	}
    	
    }

     public function health_assistancts_status_modal($today_date)
    {

    	$date = substr($today_date,0,-3); 


    	$exists_request = array('history.submitted_by' => array('$regex' => 'ttwreis.cc'),'history.submitted_user_type' => 'CCUSER','history.time'=>array('$regex' => $date));


		$query = $this->mongo_db->select('doc_data.widget_data','history')->where($exists_request)->get($this->request_app_col_static_html);


	    return $query;

    }

     public function get_hs_submitted_records_based_on_span_model($start, $end, $cc_mail)		
	{			 
		$query = $this->mongo_db->whereGte('history.time', $start)->whereLte('history.time', $end)->where(array('history.submitted_user_type' => "CCUSER", 'history.submitted_by'=>$cc_mail))->get($this->request_app_col_static_html);
	   
	    return $query;

	}


	 public function tribal_deadth_cases_model($passing_date)
    {

    	$get_details = $this->mongo_db->select('doc_data.widget_data')->whereLike('history.time', $passing_date)->where('doc_data.widget_data.page2.Review Info.Status','Expired')->get($this->request_app_col_static_html);

        return $get_details;
    }

    public function get_deadth_cases_students_model($start, $end)
    {
    
     $get_details = $this->mongo_db->select('doc_data.widget_data')->where('history.time', array('$gte'=>$start), 'history.time', array('$lte'=>$end))->where('doc_data.widget_data.page2.Review Info.Status','Expired')->get($this->request_app_col_static_html);
     
     return $get_details;

    }

     public function import_staff_covid_cases_model($doc_data, $history)
    {
    		$form_data = array ();
    		
			$form_data ['doc_data'] = $doc_data;
			
			$form_data ['history'] = $history;			
			
			$query = $this->mongo_db->insert ( "tt_staff_covid_cases_data", $form_data );

			return $query;
    }


 public function ttwreis_staff_covid_cases_model()

    {
    	$staff_covid = [];

    	$datasss = [];

    	$query = $this->mongo_db->select(array('doc_data.district'))->get("tt_staff_covid_cases_data");

    	foreach ($query as $data) {

    		$district = $data['doc_data']['district'];

    		array_push($staff_covid, $district);	
    	}

    	$returns = array_count_values($staff_covid);
    	
    	foreach ($returns as $key => $value) {

    		$datas['name'] = $key;
    		$datas['y'] = $value;
    		$datas['drilldown'] = $key;

    		array_push($datasss, $datas);
    	}
    	
    	return $datasss;

    }


    public function get_staff_covid_cases_district_drill_modal($district)
    {

    	if ($district == "All") {
    		
    		$data = $this->mongo_db->get('tt_staff_covid_cases_data');

    	}elseif ($district != "All") {
    		
    	$data = $this->mongo_db->where('doc_data.district' , $district)->get('tt_staff_covid_cases_data');

    	}

    	return $data;

    }

    public function get_cc_user_names()
	{
	    $this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
	    $query = $this->mongo_db->select(array('username', 'email'))->where(array('email' => array('$regex' => "ttwreis"), 'active'=>1))->get('ttwreis_cc');
	    $this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );
	    return $query;
	}

	public function get_cc_work_based_on_span($start, $end, $rhso_name=null)
{  
	$empty = [];

	$this->mongo_db->switchDatabase ( $this->common_db ['common_db'] );
    $query = $this->mongo_db->select(array('email', 'name'))->where(array('email' => array('$regex' => "ttwreis"), 'active'=>1))->get('ttwreis_cc');
    $this->mongo_db->switchDatabase ( $this->common_db ['dsn'] );

	/*//$email = str_replace('@', '#', $rhso_name);
	$type_list = $this->mongo_db->command(array('distinct'=>'cc_user_work_tracking', 'key'=>'call_type'));
	$call_types = $type_list['values'];*/

	foreach ($query as $user_name) {
		$other_query = $this->mongo_db->select(array("call_type"))->where(array('email_id'=> $user_name['email'], "call_type"=>"Other"))->whereBetween('date_time' , $start,$end)->count('cc_user_work_tracking_ttwreis');
		$request_query = $this->mongo_db->select(array("call_type"))->where(array('email_id'=> $user_name['email'], "call_type"=>"Request"))->whereBetween('date_time' , $start,$end)->count('cc_user_work_tracking_ttwreis');
		$attendance_query = $this->mongo_db->select(array("call_type"))->where(array('email_id'=> $user_name['email'], "call_type"=>"Attendence"))->whereBetween('date_time' , $start,$end)->count('cc_user_work_tracking_ttwreis');

		$data["user"] = $user_name["email"];
		$data["username"] = $user_name["name"];
		$data["other_count"] = $other_query;
		$data["request_count"] = $request_query;
		$data["attendance_count"] = $attendance_query;
		array_push($empty, $data);
	}

	return $empty;
}



    /*
		end
	*/



    //**********************************************************************************//


	
		
}
