<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');


class Code_gen_lib extends CI_Controller
{
	
	public $controller_name;
	public $coll_name;
	public $model_name;
	public $appName;
	public $appDescription;
	public $apptype;
	public $appexpiry;
	public $appcategory;
	public $company_name;
	public $companyaddress;
	public $model_name_for_calls;
	public $scaffold_code;
	public $scaffold_model_type;
	public $customer_folder;
    public $version;
	public $pagenumber;
	public $arrayjson;
	public $json_str;
	public $workflow;
	public $pages;

	public $errors;

	public $actual_language;
	public $languages;

	public $scaffold_delete_bd;
	public $scaffold_bd;
	public $scaffold_routes;
	public $scaffold_menu;

	public $create_controller;
	public $create_model;	
	public $create_view_create;
	public $create_view_list;

	public $tab;
	public $tabx2;
	public $tabx3;
	public $tabx4;
	public $tabx5;
	public $tabx6;
	public $tabx7;
	public $sl;

	public $there_is_an_image;
	public $there_is_a_file;
	public $there_is_a_photo;
	public $there_is_a_multilanguage_field;
	public $array_thumbnails_uploads;
	public $array_required_fields_uploads;

	public $there_is_a_relational_field;
	public $relational_field;
	public $relational_controller;
	public $relational_model;
	public $section_class;
	public $element_class;

	public function __construct()
	{

		$this->ci = &get_instance();
		$this->ci->load->library('ion_auth');
		
		
		// Load MongoDB library,
		// We assign the it to "mongo_db" variable.
		$this->ci->load->library('mongo_db', 'mongo_db');
		
		$this->actual_language 	= $this->ci->config->item('prefix_language');
		$this->languages 		= $this->ci->config->item('languages');
		
		$this->config           = $this->ci->config;

		$this->errors 	        = FALSE;

		$this->tab 		        = chr(9);
		$this->tabx2 	        = chr(9).chr(9);
		$this->tabx3 	        = chr(9).chr(9).chr(9);
		$this->tabx4 	        = chr(9).chr(9).chr(9).chr(9);
		$this->tabx5 	        = chr(9).chr(9).chr(9).chr(9).chr(9);
		$this->tabx6 	        = chr(9).chr(9).chr(9).chr(9).chr(9).chr(9);
		$this->tabx7 	        = chr(9).chr(9).chr(9).chr(9).chr(9).chr(9).chr(9);
		$this->sl  		        = chr(13).chr(10);
	
	}

    
    // --------------------------------------------------------------------

	/**
	 * Creating controller,model and view(list view) for respective apps 
	 *
	 * @param	array	data
	 * 
	 * @author  Selva
	 */

    public function create_mvc($data)
    {
    	$this->init_data($data);
    	$this->prepare_json();

    	//check is multilanguage is activated
		$result = $this->check_array_language();

		if ($result === FALSE)
		{
			return $this->errors;
		}

		//create the controller
		if ($this->create_controller)
		{
			$result = $this->create_controller();

			if ($result === FALSE)
			{
				return $this->errors;
			}
		}

		//create the model
		if ($this->create_model)
		{	
			if ($this->scaffold_model_type === "activerecord")
			{
				$result = $this->create_model_ar();
			} 
			else if ($this->scaffold_model_type === "phpactiverecord")
			{
				$result = $this->create_model();
			} 			

			if ($result === FALSE)
			{
				return $this->errors;
			}
		}


		//create the list view
		if ($this->create_view_list)
		{
			$result = $this->create_view_list();

			if ($result === FALSE)
			{
				return $this->errors;
			}
		}


		//modify routes.php
		if ($this->scaffold_routes)
		{
			$result = $this->modify_routes();

			if ($result === FALSE)
			{
				return $this->errors;
			}
		}


		if ($this->there_is_a_relational_field)
		{
			
			$result = $this->add_relational_link_to_list();

			if ($result === FALSE)
			{
				return $this->errors;
			}

		}

		return TRUE;

    }

     // --------------------------------------------------------------------

	/**
	 * Initializing variables
	 *
	 * @author  Selva
	 *
	 * @param	array  	$data  
	 * 
	 */

    private function init_data($data)
    {
    	$this->controller_name			=	$data['controller_name'];
		$this->coll_name				=	substr($this->controller_name, 0,strpos($this->controller_name, "_"));
		$this->customer_folder          =   TENANT;
		$this->company_name             =   TENANT;
		$this->model_name				=	$data['model_name'];
		$this->model_name_for_calls		=	$data['model_name'];
		$this->scaffold_delete_bd		=	$data['scaffold_delete_bd'];
		$this->scaffold_bd 				=	$data['scaffold_bd'];
		$this->scaffold_routes 			=	$data['scaffold_routes'];
		$this->scaffold_menu 			=	$data['scaffold_menu'];
		$this->create_controller		=	$data['create_controller'];
		$this->create_model				=	$data['create_model'];
		$this->create_view_list			=	$data['create_view_list'];
		$this->scaffold_model_type		= 	$data['scaffold_model_type'];
		$this->appName                  =   $data['app_name'];
		$this->apptype                  =   $data['app_type'];
		$this->arrayjsonfull            =   $data['app_template'];
		$this->workflow                 =   $data['workflow'];
		$this->pages                    =   $data['pages'];
    }

    // --------------------------------------------------------------------

	/**
	 * prepare json
	 *
	 * @author  Selva
	 *
	 * 
	 */

	private function prepare_json()
	{
        $data= "";

		$this->there_is_an_image 					= FALSE;
		$this->there_is_a_file						= FALSE;
		$this->there_is_a_photo						= FALSE;
		$this->there_is_a_multilanguage_field		= FALSE;

		$this->there_is_a_relational_field			= FALSE;
		$this->relational_field 					= FALSE;
		$this->relational_controller 				= FALSE;
		$this->relational_model		 				= FALSE;

		$this->array_thumbnails_uploads				= array();
		$this->array_required_fields_uploads		= array();

		foreach ($this->arrayjsonfull as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
      		if ($value['type'] == 'image')
			{
				$this->there_is_an_image = TRUE;

				if ($value['multilanguage'] === "TRUE")
				{
					foreach ($this->languages as $prefix=>$language)
					{
						if ( isset ($value['thumbnail']) )
							if ($value['thumbnail'])
								array_push($this->array_thumbnails_uploads, $index."_".$prefix);

				
						if ($value['required'] === 'TRUE')
							array_push($this->array_required_fields_uploads, $index."_".$prefix);
						
						
													
					}
				}
				else
				{
					if ( isset ($value['thumbnail']) )
						if ($value['thumbnail'])
							array_push($this->array_thumbnails_uploads, $index);

					if ($value['required'] === 'TRUE')
						array_push($this->array_required_fields_uploads, $index);
					
				}

			}

			if ($value['type'] == 'file')
			{
				$this->there_is_a_file = TRUE;

				if ($value['multilanguage'] === "TRUE")
				{
					foreach ($this->languages as $prefix=>$language)
					{
						if ( isset ($value['thumbnail']) )
							if ($value['thumbnail'])
								array_push($this->array_thumbnails_uploads, $index."_".$prefix);

				
						if ($value['required'] === 'TRUE')
							array_push($this->array_required_fields_uploads, $index."_".$prefix);

							
						
					}
				}
				else
				{
					if ( isset ($value['thumbnail']) )
						if ($value['thumbnail'])
							array_push($this->array_thumbnails_uploads, $index);

					if ($value['required'] === 'TRUE')
						array_push($this->array_required_fields_uploads, $index);
						
					
				}
			}
			
			if ($value['type'] == 'photo')
			{
				$this->there_is_a_photo = TRUE;

				if ($value['multilanguage'] === "TRUE")
				{
					foreach ($this->languages as $prefix=>$language)
					{
						if ( isset ($value['thumbnail']) )
							if ($value['thumbnail'])
								array_push($this->array_thumbnails_uploads, $index."_".$prefix);

				
						if ($value['required'] === 'TRUE')
							array_push($this->array_required_fields_uploads, $index."_".$prefix);

							
						
					}
				}
				else
				{
					if ( isset ($value['thumbnail']) )
						if ($value['thumbnail'])
							array_push($this->array_thumbnails_uploads, $index);

					if ($value['required'] === 'TRUE')
						array_push($this->array_required_fields_uploads, $index);
						
					
				}
			}

			if ($value['type'] == 'hidden')
			{
				$this->there_is_a_relational_field	=	TRUE;
				$this->relational_field				=	$index;
				$this->relational_controller		=   $value['controller'];
				$this->relational_model				= 	$value['model'];
			}

			 
			if (isset($value['multilanguage']))
				if ($value['multilanguage'] === 'TRUE')
					$this->there_is_a_multilanguage_field	=	TRUE;


      	}
      }
  }
		
        if ($this->arrayjsonfull)
		{
			$this->arrayjson	=	$this->arrayjsonfull;
		}
		else
		{
			$this->errors = lang('scaffolds_error_json');
			return FALSE;
		}

	 }  


	function check_array_language()
	{
		
		if ($this->there_is_a_multilanguage_field)
		{
			if ($this->languages == NULL or $this->actual_language == NULL)
			{
				$this->errors = lang('scaffolds_not_array_languages');
				return FALSE;
			}
			else
			{
				return TRUE;
			}
		}
		else
		{
			return TRUE;
		}

	}

	public function delete_table_bd()
	{
		
		/*$sql = "DROP TABLE IF EXISTS ".$this->controller_name.";";
		  $result = $this->ci->db->query($sql); */
		

		$result = $this->ci->mongo_db->dropCollection($this->coll_name);
		

		if ($result)
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_del_bd')."<br> <pre>$sql_table</pre>";
			return FALSE;
		}
	}
	
  
	 // --------------------------------------------------------------------

	/**
	 * create controller for respective app
	 *
	 * @access  private
	 * @author  Selva
	 *
	 * 
	 */

	private function create_controller()
	{
		
		$data = "";

		$data .= "

<?php defined('BASEPATH') OR exit('No direct script access allowed');

class ".ucfirst($this->controller_name)." extends MY_Controller
{
    /**
	 * Holds the name of MongoDB collections
	 *
	 * @var array
	 */
   public \$collections = array();
   
	function __construct()
	{
		parent::__construct();
";

if ($this->scaffold_model_type == "activerecord")
{
	$data .= $this->sl.$this->tabx3."\$this->ci =& get_instance();";
	$data .= $this->sl.$this->tabx3."\$this->upload_info = array();";
	$data .= $this->sl.$this->tabx3."\$this->load->library('ion_auth');";
	$data .= $this->sl.$this->tabx3."\$this->load->helper('paas');";
	$data .= $this->sl.$this->tabx3."\$this->load->model('".$this->customer_folder."/".$this->model_name."','".$this->model_name."_calls');";
    $data .= $this->sl.$this->tabx3."\$this->collections = \$this->config->item('collections','ion_auth');";
}

$data .= "
	}


	public function index()
	{	
	  if (!\$this->ci->ion_auth->logged_in())
	  {
		//redirect them to the login page
		redirect(URC.'auth/login');
	  }
";

$data.="
		//load view
		\$this->load->view('".$this->customer_folder."/".$this->controller_name."/list');
	}

	// ------------------------------------------------------------------------

	/**
	 * Helper: Retrieve the data for retrieval and mapper fields
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	public function fetch_retriever_data()
	{
	   \$retrieval_list = array();
	   
	   
	   \$query_param 	 = \$this->input->post('query_param');
	   \$query_value 	 = \$this->input->post('query_value');
	   \$collection_name = \$this->input->post('collection_name');
	   \$to_be_retrieved = \$this->input->post('to_be_retrieved');
	   \$to_be_retrieved = json_decode(\$to_be_retrieved);
	   
	   \$query_param = str_replace(\"_\",\".\",\$query_param);
	   
	   foreach(\$to_be_retrieved as \$index => \$value)
	   {
	      \$value = str_replace(\"_\",\".\",\$value);
	      \$value = \"doc_data.widget_data.\".\$value;
		  array_push(\$retrieval_list,\$value);
	   }
	   
	   //fetch document 
	   \$document = \$this->".$this->model_name_for_calls."_calls->fetch_retriever_data_model(\$query_param,\$query_value,\$retrieval_list,\$collection_name);
	   
	   \$this->output->set_output(json_encode(\$document));
	}
	
    function web_doc_search()
	{
	  // POST DATA
	  \$page_number  = \$this->input->post('page_number');
	  \$operation    = \$this->input->post('operation');
	  \$from         = \$this->input->post('from');
	  \$to           = \$this->input->post('to');
	  
	  \$items_per_page = 10;
	  \$total_rows     = \$this->".$this->model_name_for_calls."_calls->web_doc_search_count(\$operation,\$from,\$to);
	  
	  //fetch documents 
	  \$documents = \$this->".$this->model_name_for_calls."_calls->web_doc_search_with_pagination(\$items_per_page,\$page_number,\$operation,\$from,\$to);
	  
	  \$total = ceil(\$total_rows/\$items_per_page);
	  
	  // OUTPUT ARRAY
	  \$data['total_pages'] = \$total;
	  \$data['documents']   = \$documents;
	  
	  \$doc_data = json_encode(\$data);
      \$this->output->set_output(\$doc_data);
	}
	
	function create(\$page = NULL) 
	{
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//create control variables
		\$data['title']		= 	'Create ".$this->controller_name."';
		\$data['updType']	= 	'create';
		\$form_data_aux 	= 	array();
		";

	  	foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
      		switch ($value['type'])
      		{
        		case 'selectbd':
        			if ($this->scaffold_model_type == "phpactiverecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find('all', array('order' => '".$value['options']['order']."' ));".$this->sl.$this->sl.$this->tabx2;	
					}
					else if ($this->scaffold_model_type == "activerecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$this->load->model('".strtolower($value['options']['model'])."');";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find_all('".$value['options']['order']."');".$this->sl.$this->sl.$this->tabx2;	
					}
        		break;
        	}
        }
        }
        }

        if ($this->there_is_a_relational_field)
        {
			$data .= "\$data['".$index."'] = ( \$this->uri->segment(3) )  ? \$this->uri->segment(3) : \$this->input->post('".$index."', TRUE);";
        	$data .= $this->sl.$this->tabx2."\$data['page'] = ( \$this->uri->segment(4) )  ? \$this->uri->segment(4) : \$this->input->post('page', TRUE);";
        }
        else
        {
			$data .= "\$data['page'] = ( \$this->uri->segment(3) )  ? \$this->uri->segment(3) : \$this->input->post('page', TRUE);";
        }

		
        $data .= "

        \$user = \$this->ion_auth->user()->row();
        \$username = str_replace(\"@\",\"#\",\$user->email);
	    \$usercollection=\$username.'_web_apps';
	    \$app_collection = \$this->".$this->model_name_for_calls."_calls->get_permissions_for_create('".$this->coll_name."',\$usercollection);
	    \$permissions = \$app_collection['permissions'];
        \$stage_name = array_keys(\$permissions);

		//Rules for validation
		\$validation = '_validation';
		\$stage = str_replace(' ','',\$stage_name[0]);
		\$this->{\$stage.\$validation}();

         \$form_new_data = array();
		//validate the fields of form
		if (\$this->form_validation->run() == FALSE) 
		{
            \$data['template'] = \$this->".$this->model_name_for_calls."_calls->get_template();
            //load the view and the layout
			\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);
		}
		else
		{
			//Validation OK!
			\$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();
			";



			if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
			{
				if (count($this->array_thumbnails_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= explode(\",\", \"".implode(",", $this->array_thumbnails_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= array();";
				}

				if (count($this->array_required_fields_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= explode(\",\", \"".implode(",", $this->array_required_fields_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= array();";
				}
				
				


				foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
		      		switch ($value['type'])
		      		{
		      			case 'image':
		      			case 'file':
						case 'photo':

		      				$aux = "";

		      				if ($value['multilanguage'] == "TRUE")
		      				{
		      					foreach ($this->languages as $prefix=>$language)
		      					{
		      						$aux .= $index."_".$prefix.","; 	
		      					}

		      					$aux = substr( $aux, 0, -1 );

$data .="

			//uploads fields for $index
			\$array_fields_".$index." = explode(\",\", \"$aux\");
";						
	      				}

		      			break;
		      		}
		      	}
		      }
		      	}

$data .= "
			\$this->load->library('upload');
			\$this->load->library('image_lib');

			//////////////////////////////////////////////////////////////////////////////////////////////////////////////
      
            foreach (\$_FILES as \$index => \$value)
			{
				if (\$value['name'] != '')
				{
					";

		foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
	      		switch ($value['type'])
	      		{
	      			case 'image':
	      			case 'file':
					case 'photo':

	      				$aux = "";

	      				$file_index_name = str_replace(' ','',$index);

	      				if ($value['multilanguage'] == "TRUE")
	      				{
	      					foreach ($this->languages as $prefix=>$language)
	      					{
	      						$aux .= $index."_".$prefix.", "; 	
	      					}

	      					$aux = substr( $aux, 0, -2 );

$data .="
					//uploads rules for \$index					
					if (in_array(\$index, \$array_fields_".$index."))
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));
                         
                         //upload the image
					if ( ! \$this->upload->do_upload(\$index))
					{
						\$data['upload_error'][\$index] = \$this->upload->display_errors(\"<span class='error'>\", \"</span>\");
						
						//load the view and the layout
					\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

						return FALSE;
					}
					else
					{
						//create an array to send to image_lib library to create the thumbnail
						array_push(\$this->upload_info,\$this->upload->data());

						//Save the name of old files to delete
						array_push(\$files_to_delete, \$data['".$this->model_name."'][\$index]);

						//Initializing the imagelib library to create the thumbnail

						if (in_array(\$index, \$array_thumbnails))
						{

							//thumbnails rules for \$index		
						if (in_array(\$index, \$array_fields_".$index."))
						{
							\$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						}

						//create the thumbnail
							if ( ! \$this->image_lib->resize())
							{
								\$data['upload_error'][\$index] = \$this->image_lib->display_errors(\"<span class='error'>\", \"</span>\");

								//load the view and the layout
							\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

								return FALSE;
							}

						}

					}
				}
			
";						
	      				}
	      				else
	      				{
	      					$sect       = str_replace(' ','',$sectionname);
	      					$file_index = "page".$pageno."_".$sect."_".$file_index_name;
$data .="
					//uploads rules for \$index
					if (\$index == '".$file_index."')
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));

						//upload the image
					    if ( ! \$this->upload->do_upload(\$index))
					    {
						   \$data['upload_error'][\$index] = \$this->upload->display_errors(\"<span class='error'>\", \"</span>\");
						
						    //load the view and the layout
					       \$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

						    return FALSE;
					     }
					     else
					     {
							//create an array to send to image_lib library to create the thumbnail
							array_push(\$this->upload_info,\$this->upload->data());

							//Save the name of old files to delete
							array_push(\$files_to_delete, \$data['".$this->model_name."']['\$index']);

							//Initializing the imagelib library to create the thumbnail

							if (in_array(\$index, \$array_thumbnails))
						    {

						    	//thumbnails rules for \$index
						       if (\$index == '".$index."')
						       {
							      \$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						       }

						       //create the thumbnail
							if ( ! \$this->image_lib->resize())
							{
								\$data['upload_error'][\$index] = \$this->image_lib->display_errors(\"<span class='error'>\", \"</span>\");

								//load the view and the layout
							\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

								return FALSE;
							}
                        }

                     }   
							
					}			
";	
	      				}


	      			break;
	      		}
	      	}
	      }
	      	}
			$data.="
			}
			else
				{
					if (in_array(\$index, \$array_required))
					{
						\$data['upload_error'][\$index] = \"<span class='error'>\".lang('upload_no_file_selected').\"</span>\";

						//load the view and the layout
						\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

						return FALSE;
					}
					
					
				}
			}
			/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			";
}

    $data .="
	      

	        \$pagenumber = array();
	        \$page_data  = array();
	        \$file_count = 0;
	       
	        foreach (\$app_template as \$pageno => \$pages)
		    {
		    	array_push(\$pagenumber,\$pageno);
		    }

            \$pagecount = count(\$pagenumber);

            

            for(\$i=1;\$i<=\$pagecount;\$i++)
		    {
		    	array_push(\$page_data,\$app_template[\$i]);
            }

            
	         	 
                 for(\$ii=0;\$ii<\$pagecount;\$ii++)
                 {
                 	\$widget            = array();
					\$widget_final      = array();
                 	\$previous_section  = \"\";
                 	\$pgno = \$ii +1;
	         	 foreach(\$page_data[\$ii] as \$section => \$index_array)
	         	 {
	         	 	\$widget[\$section] = array();
	         	 	\$widget_data = array();
	         	 	unset(\$index_array['dont_use_this_name']);
	         	 	foreach(\$index_array as \$index => \$value)
	         	 	{
	         	 		\$index_name    = str_replace(' ','',\$index);
	         	 		\$sec           = str_replace(' ','',\$section);
	         	 		\$setvalue_name = \"page\".\$pgno.\"_\".\$sec.\"_\".\$index_name;
						\$tem           = array();
						
						\$wid_get = \$this->construct_form_data_doc_create(\$value,\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name);
						
						\$widget_final = array_merge_recursive(\$widget_final,\$wid_get);
					}
	         	       
					   \$form_data['doc_data']['widget_data']['page'.\$pgno] = \$widget_final;
                    }
				 }
";

	       
           
$data .="
           // GRAPH
		  \$graph_check = \$this->input->post('create_doc_graph');
		  
		  if(\$graph_check)
		  {
		    \$graph = array();
	        
			\$graph_info = json_decode(\$graph_check);
			foreach(\$graph_info as \$graph_name => \$graph_data)
			{
			  array_push(\$graph,\$graph_data);
			}
			\$form_data['doc_data']['graph_data'] = \$graph;
		  }

          \$form_data['doc_data']['stage_name'] = '".$this->coll_name."';

          \$form_data['first_stage_name'] = \$stage_name[0];

          \$form_data['doc_data']['user_name']  = \$username;
		  
		  \$form_data['doc_data']['chart_data']  = '';

          \$approval_history = array();

          \$approval_data = array(
              \"current_stage\" => \$stage_name[0],
              \"approval\" => \"true\",
              \"submitted_by\" => \$username,
              \"time\" => date('Y-m-d H:i:s'));

          array_push(\$approval_history,\$approval_data);

          \$form_data['history'] = \$approval_history;
		  
		  \$stagewise_users = \$this->extract_users_with_stages();
		  
		  \$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->chk_user_new(\$stagewise_users,\$username,\$stage_name[0]);
		  
";

            

			if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
				$data .= $this->sl.$this->tabx3."\$form_data = array_merge(\$form_data, \$form_data_aux);
			";

            $data.="if ( \$this->".$this->model_name." ) // Whether the user is authorised
		  {";

			// run insert model to write data to db
			if ($this->scaffold_model_type === 'phpactiverecord')
			{
			$data .= "

			\$".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->web_create(\$form_data);

			if ( \$".$this->model_name."->is_valid() ) // the information has therefore been successfully saved in the db
			{
				\$this->session->set_flashdata('message',lang('web_create_success'));
			}
			
			if ( $".$this->model_name."->is_invalid() )
			{
				\$this->session->set_flashdata('message', array( 'type' => 'error', 'text' => \$".$this->model_name."->errors->full_messages() ));
			}

			";
			}
			else if ($this->scaffold_model_type === 'activerecord')
			{
			$data .= "

			 
			\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->web_create(\$form_data);
			
			
           if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
			{
				\$this->session->set_flashdata('message',lang('web_create_success'));
			}
			else
			{
				\$this->session->set_flashdata('message',lang('web_create_failed'));
			}
            }
			else
			{
			  \$this->session->set_flashdata('message',lang('web_create_user_unauthorized'));
			}
			";		
			}

			$data.="redirect('web/index');"."
		
	  	} 
	}
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: Construct form data (for web stage)
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	public function construct_form_data_doc_create(\$value,\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name)
	{
		switch (\$value['type'])
		      		   {
		        		case 'text':
		        		case 'textarea':
						case 'number':
						case 'password':
						case 'range':
						if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								if(array_key_exists(\"parent\",\$value))
								{
									if(\$value['parent'] == \"retriever\")
									{
										\$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							            \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
									}
								}
								else
								{
									\$tem[\$section] = array(\$index => set_value(\$setvalue_name));
									\$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								}
								
							}
							else
							{
                                if(array_key_exists(\"parent\",\$value))
								{
									if(\$value['parent'] == \"retriever\")
									{
										\$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							            \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
									}
								}
								else
								{
								  \$widget[\$section] = array(
									\$index => set_value(\$setvalue_name)
									);
								}
							}
							 

							  \$previous_section = \$section;
							  
						}
                        break;

						case 'mobile':
						if(\$value['key'] == \"TRUE\")
						{
						    \$country_code = \$_POST[\$setvalue_name.'_country_code'];
							\$number       = \$_POST[\$setvalue_name.'_mob_num'];
							
							if(\$section == \$previous_section)
							{
								\$val = array(\$index => array('country_code'=>\$country_code,'mob_num'=>\$number));
							    \$tem[\$section] = \$val;
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{
                                \$val = array('country_code'=>\$country_code,'mob_num'=>\$number);
								\$widget[\$section] = array(
									\$index => \$val
									);
							}
							 

							  \$previous_section = \$section;
							  
						}
						break;
						
                        case 'checkbox' :
                        if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
						       \$tem[\$section] = array(\$index => \$_POST['ac_'.\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST['ac_'.\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;
							  
						}

                        break;

                        case 'date':
		        		case 'time':
		        		case 'month':
		        		case 'color':

		        		if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST[\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;
							  
						}


		        		break;

		        		case 'MChoice':

		        		if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST[\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;
							  
						}
		        		break;

		        		case 'select':
		        		case 'selectbd':
		        		case 'radio':
		        		case 'datepicker':
		        		case 'hidden':

		        		if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => set_value(\$setvalue_name));
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

\$widget[\$section] = array(
									\$index => set_value(\$setvalue_name)
									);
							}
							 

							  \$previous_section = \$section;
							  
						}
                        break;

                        case 'file':
                        case 'image':
						case 'photo':
                        if(\$value['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
                                  if (\$index == \$index)
					              {
						              \$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', \$index));
					               }
					              \$tem[\$section] =  array(
									\$index => array(
										\"file_client_name\" =>\$this->upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$this->upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$this->upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$this->upload_info[\$file_count]['file_size'])
									);
							       \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
					        }
					        else
					        {
					        	\$widget[\$section] = array(
									\$index => array(
										\"file_client_name\" =>\$this->upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$this->upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$this->upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$this->upload_info[\$file_count]['file_size'])
									);


					        }

					        \$previous_section = \$section;
					    }

					    \$file_count++;
                        break;
						
						case 'retriever':
						\$wi_dget = array();
					    \$wi_dget = \$this->construct_form_data_doc_create(\$value['properties'],\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name);
						\$widget = array_merge(\$widget,\$wi_dget);
						break;
						
						case 'mapper':
						if(\$value['properties']['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => array(\"field_ref\"=>\$value['field_ref']));
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(\$index => array(\"field_ref\"=>\$value['field_ref']));
							}
							 

							  \$previous_section = \$section;
							  
						}
						break;
					}
					
					return \$widget;
		
	}
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: listing previous stages for disapprove feature (for web stage)
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	function extract_users_with_stages()
	{
	  \$allstages            = array();
	  \$stageindex           = array();
	  \$perstagedata         = array();
	  \$workflow_type        = array();
	  \$singlestagedata      = array();
	  \$parallelstagedata    = array();
	  \$conditionalstagedata = array();
	  \$authorization_data   = array();
	  
	  \$workflow_with_id = \$this->".$this->model_name_for_calls."_calls->get_workflow();

      foreach(\$workflow_with_id as \$workflow_data)
      {
        \$workflow = \$workflow_data['workflow'];
      }

      foreach (\$workflow as \$stagename => \$stagedata)
      {
        array_push(\$allstages,\$stagename);
	    array_push(\$perstagedata,\$stagedata);
      }
   
      \$count = count(\$perstagedata);

      for (\$i = 0; \$i < \$count; \$i++)
	  {
	     array_push(\$workflow_type,\$perstagedata[\$i]['Workflow_Type']);
		 
         
		 if(\$workflow_type[\$i] == 'single')
         {
			\$singlestagedata = \$this->single_stage_for_users_check(\$allstages[\$i],\$perstagedata[\$i]['UsersList']);
			
			\$authorization_data = array_merge(\$authorization_data,\$singlestagedata);
         }
		 elseif(\$workflow_type[\$i] == 'parallel')
		 {
			\$arrayPar = \$perstagedata[\$i];
			unset(\$arrayPar['Workflow_Type']);
			\$parallelstagedata = \$this->parallel_stage_for_users_check(\$arrayPar);
			\$authorization_data = array_merge(\$authorization_data,\$parallelstagedata);
		 }
		 elseif(\$workflow_type[\$i] == 'conditional')
		 {
			\$arrayCon = \$perstagedata[\$i];
			\$conditionalstagedata = \$this->conditional_stage_for_users_check(\$arrayCon);
			\$authorization_data = array_merge(\$authorization_data,\$conditionalstagedata);
		 }   
	
	  }
	  
	  return \$authorization_data;
	}
	
	 // ---------------------------------------------------------------------------------------

	/**
	 * Helper: single stage processing in extracting users for authorizing users
	 *
	 * @return object
	 *  
	 * @author Selva 
	 */

	 function single_stage_for_users_check(\$stagename,\$users)
	 {
	    \$stage_details = array();
		
		\$stage_details[\$stagename] = \$users;
		return \$stage_details;
     }
	 
	 // ---------------------------------------------------------------------------------------

	/**
	 * Helper: parallel stage processing in extracting users for authorizing users
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	 function parallel_stage_for_users_check(\$arrayPar)
	 {

	 	\$branchs              = array();
	 	\$parallelbranches     = array();
	 	\$parallelperstagedata = array();
	 	\$parallelbranchwtype  = array();
	 	\$parallelstagedata    = array();

	 	foreach(\$arrayPar as \$paral => \$para)
	    {
	      array_push(\$branchs,\$paral);
	    }

	    foreach (\$branchs as \$perbranch)
	    {

            \$parallelstagenames   = array();

	      if(isset(\$parallelperstagedata))
	      {
	         array_shift(\$parallelperstagedata);
	      }
	      if(isset(\$parallelbranches))
	      {
	         array_shift(\$parallelbranches);
	      }


	      foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
	      {
	         array_push(\$parallelbranches,\$branchname);
	         array_push(\$parallelperstagedata,\$branch);
	      }

           \$parallelstagecount = count(\$parallelperstagedata);

	      for(\$kk=0;\$kk<\$parallelstagecount;\$kk++)
	      {
	         array_push(\$parallelbranchwtype,\$parallelperstagedata[\$kk]['Workflow_Type']);
	         if(\$parallelbranchwtype[\$kk]==\"single\")
	         {
	
	            if(isset(\$parallelperstagedata[\$kk-1]))
	            {
	              unset(\$parallelperstagedata[\$kk-1]);
	            }
	
	            if(isset(\$parallelstagenames[\$kk-1]))
	            {
	              unset(\$parallelstagenames[\$kk-1]);
	            }

	            
	           foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
	           {
	             if(\$branch['Workflow_Type']==\"single\")
	             {
	               array_push(\$parallelstagenames,\$branchname);
	             }
	            }
	            
	             \$singlestagedata = \$this->single_stage_for_users_check(\$parallelstagenames[\$kk],\$branch['UsersList']); 
                 \$parallelstagedata = array_merge(\$parallelstagedata,\$singlestagedata);

                 
	         }

	         if(\$parallelbranchwtype[\$kk]==\"parallel\")
	         {
	         	\$arrayParnew = \$parallelperstagedata[\$kk];
	            unset(\$arrayParnew['Workflow_Type']);
	            \$this->parallel_stage_for_users_check(\$arrayParnew);

	         }

	         if(\$parallelbranchwtype[\$kk]==\"conditional\")
	         {
	         	\$arrayCon = \$parallelperstagedata[\$kk];
	         	\$this->conditional_stage_for_users_check(\$arrayCon);
             }
	      } 
	      
	    }  

         return \$parallelstagedata;	

     }



     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: conditional stage processing in extracting users for authorizing users
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	 function conditional_stage_for_users_check(\$arrayCon)
	 {

	 	\$arrayPar                           = array();
	    \$approveddata                       = array();
	    \$disapproveddata                    = array();
	    \$conditionalperstagedata            = array();
	    \$conditionalapprovedwtype           = array();
		\$conditionaldisapprovedwtype        = array();
		\$conditionaldisapprovedperstagedata = array();
		\$conditionalperstagedata            = array();
		\$approvedstagenames                 = array();
		\$disapprovedstagenames              = array();
		\$conditionalapprovedstagedata       = array();
		\$conditionaldisapprovedstagedata    = array();
		\$conditionalstagedata               = array();
		\$approvedstage                      = array();
		\$disapprovedstage                   = array();
	
		array_push(\$approvedstage,\$arrayCon['approved']);
		array_push(\$disapprovedstage,\$arrayCon['disapproved']);
	
	
	//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
	
		foreach(\$approvedstage as \$worktemplate => \$temp)
		{
		  foreach(\$temp as \$stagename => \$t)
		  {
		     array_push(\$conditionalperstagedata,\$t);
		  }
		}
		
		\$conditionalperstagedatacount = count(\$conditionalperstagedata);
		for(\$ii = 0;\$ii < \$conditionalperstagedatacount; \$ii++)
		{
		  array_push(\$conditionalapprovedwtype,\$conditionalperstagedata[\$ii]['Workflow_Type']);
		  if(\$conditionalapprovedwtype[\$ii]==\"single\")
		  {
		  	foreach(\$approvedstage as \$worktemplate => \$temp)
			{
	            foreach(\$temp as \$stagename => \$t)
				{
	               if(\$t['Workflow_Type']==\"single\")
	                {
	                   array_push(\$approvedstagenames,\$stagename);
	                }
	             }
	         }	

		    \$approveddata = \$this->single_stage_for_users_check(\$approvedstagenames[\$ii],\$conditionalperstagedata[\$ii]['UsersList']);
		    \$conditionalstagedata = array_merge(\$conditionalstagedata,\$approveddata);
		 }
		if(\$conditionalapprovedwtype[\$ii]==\"parallel\")
		{
		\$arrayPar = \$conditionalperstagedata[\$ii];
		unset(\$arrayPar['Workflow_Type']);
		\$this->parallel_stage_for_users_check(\$arrayPar);
		}
		if(\$conditionalapprovedwtype[\$ii]==\"conditional\")
		{
		\$arrayConnew = \$conditionalperstagedata[\$ii];
		\$this->conditional_stage_for_users_check(\$arrayConnew);
		
		}
		}
		
	//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//
		foreach(\$disapprovedstage as \$worktemplate => \$temp)
		{
		  foreach(\$temp as \$stagename => \$t)
		  {
		     array_push(\$conditionaldisapprovedperstagedata,\$t);
		  }
		}
		
		\$conditionaldisapprovedstagescount = count(\$conditionaldisapprovedperstagedata);
		for(\$jj = 0;\$jj < \$conditionaldisapprovedstagescount; \$jj++)
		{
		array_push(\$conditionaldisapprovedwtype,\$conditionaldisapprovedperstagedata[\$jj]['Workflow_Type']);
		if(\$conditionaldisapprovedwtype[\$jj]==\"single\")
		{
			foreach(\$disapprovedstage as \$worktemplate => \$temp)
			{
	           foreach(\$temp as \$stagename => \$t)
			   {
	              if(\$t['Workflow_Type']==\"single\")
	              {
	                array_push(\$disapprovedstagenames,\$stagename);
	              }
	          }
	        }
			
		  \$disapproveddata = \$this->single_stage_for_users_check(\$disapprovedstagenames[\$jj],\$conditionaldisapprovedperstagedata[\$jj]['UsersList']);
		  \$conditionalstagedata = array_merge(\$conditionalstagedata,\$disapproveddata);
		}
		if(\$conditionaldisapprovedwtype[\$jj]==\"parallel\")
		{
		\$arrayPar = \$conditionaldisapprovedperstagedata[\$jj];
		unset(\$arrayPar['Workflow_Type']);
		\$this->parallel_stage_for_users_check(\$arrayPar);
		}
		if(\$conditionaldisapprovedwtype[\$jj]==\"conditional\")
		{
		  \$arrayConnew = \$conditionaldisapprovedperstagedata[\$jj];
		  \$this->conditional_stage_for_users_check(\$arrayConnew);
		}
            	
      }

       return \$conditionalstagedata;
     }
 
function disapprove(\$page = NULL)
	{
	
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
	
		//Validation OK!
		\$form_data = array(
				'reason' => \$this->input->post('reason', TRUE),
				'disapprover' => \$this->input->post('disapprover', TRUE),
				'user' => \$this->input->post('drop', TRUE),
				'stagename' => \$this->input->post('stage', TRUE),
				'doc_id' => \"1\",
		);
			
			
		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->disapprove(\$form_data);
	
		if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
		{
			\$this->session->set_flashdata('message',lang('web_disapprover_success'));
		}
		else
		{
			\$this->session->set_flashdata('message',lang('web_disapprover_failed'));
		}
	
		
		redirect('web/index');
	}
	
	// ---------------------------------------------------------------------------------------

	/**
	 * Helper: download file from web stage
	 *
	 *@author Selva 
	 */

	public function web_file_download(\$relpath)
	{
		\$path = str_replace('=','/',\$relpath);
		\$this->external_file_download(\$path);
    }

   // ---------------------------------------------------------------------------------------

	/**
	 * Helper: download file from device stage
	 *
	 *@author Selva 
	 */

   public function device_file_download()
   {
  	   \$filedata = file_get_contents('php://input');
  	   \$data     = json_decode(\$filedata,true);
  	   \$path     = \$data['path'];
       \$this->external_file_download(\$path);   
   }
   
   //------------------------------------------------------------------------------------

	/**
	 * Helper: finish document from device stage
	 *
	 *@author Selva
	 */
   
   public function dynamic_document_forward()
  {
	
    \$postdata = \$_POST['data'];
	if (isset(\$postdata))
	{
		// Get the data
		\$imageData=\$postdata;
		
		// Remove the headers (data:,) part.
		// A real application should use them according to needs such as to check image type
		\$filteredData=substr(\$imageData, strpos(\$imageData, ',')+1);
		
		\$this->_page_data = \$filteredData;
		// Need to decode before saving since the data we received is already base64 encoded
		\$unencodedData=base64_decode(\$filteredData);

		//echo 'unencodedData'.\$unencodedData;

		// Save file. This example uses a hard coded filename for testing,
		// but a real application can specify filename in POST variable

		//Seprating image data
		\$imgData=substr(\$imageData, 0, strpos(\$imageData, '&')-1);
		
		\$array_data = json_decode(\$imageData, TRUE);
	
	if(isset(\$_FILES))
    {
    	\$this->load->library('upload');
	    \$this->load->library('image_lib');
		
		\$device_upload_info         = array();
		\$external_files_upload_info = array();
		\$external_final             = array();
		\$chart_final             	= array();
		\$consent_final				= array();
		\$profile_settings_final     = array();
					
		//==============template upload==================
		\$template_files_upload_info = array();
		\$template_final             = array();
		
		foreach (\$_FILES as \$index => \$value)
	   {
		 
         if (strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')=== false && strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')=== false && \$value['name'] != ''  && strpos(\$index,'CHART_IMAGE')=== false && strpos(\$index,'CONSENT_IMAGE')=== false && strpos(\$index,'TEMPLATE_IMAGE')=== false)
	     {  
            \$index_new = str_replace('_',' ',\$index);
		   \$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."',\$index_new));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"file upload failed\";
		         return FALSE;
		    }
		    else
		    {
		        array_push(\$device_upload_info,\$this->upload->data());
			}
         }
		 
		  if(strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->external_file_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"external file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$external_files_upload_info = \$this->upload->data();
			
			    \$external_data_array = array(
										  \$index => array(
										\"file_client_name\" =>\$external_files_upload_info['client_name'],
										\"file_encrypted_name\" =>\$external_files_upload_info['file_name'],
										\"file_path\" =>\$external_files_upload_info['file_relative_path'],
										\"file_size\" =>\$external_files_upload_info['file_size']
														)

                	                         );

                \$external_final = array_merge(\$external_final,\$external_data_array);
		        
			}
		    
		 }
		 
		 if(strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->profile_settings_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"profile logo file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$profile_files_upload_info = \$this->upload->data();
			
			    \$profile_file_data_array = array(
										  \"file_client_name\" =>\$profile_files_upload_info['client_name'],
										  \"file_encrypted_name\" =>\$profile_files_upload_info['file_name'],
										  \"file_path\" =>\$profile_files_upload_info['file_relative_path'],
										  \"file_size\" =>\$profile_files_upload_info['file_size']
												);

                \$profile_settings_final = array_merge(\$profile_settings_final,\$profile_file_data_array);
		        
			}
		    
		 }
		 if(strpos(\$index,'CHART_IMAGE')!== false)
		 {	
		 	\$this->upload->initialize(\$this->chart_file_attachment_upload_options('".$this->controller_name."',\$index));
		 	if ( ! \$this->upload->do_upload(\$index))
		 	{
		 		echo \"chart file upload failed\";
		 		return FALSE;
		 	}
		 	else
		 	{
		 		\$chart_files_upload_info = \$this->upload->data();
		 			
		 		\$chart_data_array = array(
 					\"file_client_name\" =>\$chart_files_upload_info['client_name'],
 					\"file_encrypted_name\" =>\$chart_files_upload_info['file_name'],
 					\"file_path\" =>\$chart_files_upload_info['file_relative_path'],
 					\"file_size\" =>\$chart_files_upload_info['file_size']
		 		);
		 
		 		\$chart_final = array_merge(\$chart_final,\$chart_data_array);
		 	}
		 }
		 
		 if(strpos(\$index,'CONSENT_IMAGE')!== false)
		 {
		  
		 \$this->upload->initialize(\$this->consent_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"consent file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$consent_files_upload_info = \$this->upload->data();
		 
		 	\$consent_data_array = array(
		 			\"file_client_name\" =>\$consent_files_upload_info['client_name'],
		 			\"file_encrypted_name\" =>\$consent_files_upload_info['file_name'],
		 			\"file_path\" =>\$consent_files_upload_info['file_relative_path'],
		 			\"file_size\" =>\$consent_files_upload_info['file_size']
		 	);
		 		
		 	\$consent_final = array_merge(\$consent_final,\$consent_data_array);
		 		
		 }
		 	
		 }
		 
		 if(strpos(\$index,'TEMPLATE_IMAGE')!== false)
		 {
		 	
		 \$this->upload->initialize(\$this->template_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"template file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$template_files_upload_info = \$this->upload->data();
		 		
		 	\$template_data_array = array(
		 			\$index => array(
		 					\"file_client_name\" =>\$template_files_upload_info['client_name'],
		 					\"file_encrypted_name\" =>\$template_files_upload_info['file_name'],
		 					\"file_path\" =>\$template_files_upload_info['file_relative_path'],
		 					\"file_size\" =>\$template_files_upload_info['file_size']
		 			)
		 	);
		 
		 	\$template_final = array_merge(\$template_final,\$template_data_array);
		 
		 }
		 
		 }
       }
	   
	   if(isset(\$array_data['doc_data']['template_attachments']))
       {
       
       	\$template_merged_data = array_merge(\$array_data['doc_data']['template_attachments'],\$template_final);
       	\$array_data['doc_data']['template_attachments'] = array_replace_recursive(\$array_data['doc_data']['template_attachments'],\$template_merged_data);
       }
       else
       {
       	\$array_data['doc_data']['template_attachments'] = \$template_final;
       }
	   
	     if(isset(\$array_data['doc_data']['external_attachments']))
	   {
			   
			    \$external_merged_data = array_merge(\$array_data['doc_data']['external_attachments'],\$external_final);
                \$array_data['doc_data']['external_attachments'] = array_replace_recursive(\$array_data['doc_data']['external_attachments'],\$external_merged_data);
		}
		else
		{
		         \$array_data['doc_data']['external_attachments'] = \$external_final;
		} 
		
		if(isset(\$array_data['doc_data']['profile_settings']))
	    {
		    \$array_data['doc_data']['profile_settings']['logo'] = \$profile_settings_final;
		}
		
		if(isset(\$array_data['doc_data']['chart_data']))
		{
			\$array_data['doc_data']['chart_data']['chart_image'] = \$chart_final;
		}
		
		if(isset(\$array_data['doc_data']['consent_data']))
		{
			\$array_data['doc_data']['consent_data']['consent_image'] = \$consent_final;
		}


        \$pagenumber       = array();
	    \$page_data        = array();
	    \$data_array       = array();
	    \$final            = array();
		\$file_count = 0;

	    \$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();

	    foreach (\$app_template as \$pageno => \$pages)
        {
		  	array_push(\$pagenumber,\$pageno);
        }

     	\$pagecount = count(\$pagenumber);

     	for(\$i=1;\$i<=\$pagecount;\$i++)
	 	{
			 array_push(\$page_data,\$app_template[\$i]);
     	}

     	for(\$ii=0;\$ii<\$pagecount;\$ii++)
     	{
            \$pgno = \$ii +1;
	     foreach(\$page_data[\$ii] as \$section => \$index_array)
	     {
	        unset(\$index_array['dont_use_this_name']);
	        foreach(\$index_array as \$index => \$value)
	        {
			    \$setvalue_name = str_replace(' ','_',\$index);
				
                switch (\$value['type'])
		      	{
		        		case 'file':
		        		case 'image':
						case 'photo':
                          
                              if(\$device_upload_info)
							{
								foreach(\$_FILES as \$file_element_name => \$file_element_data)
								{
								   
									if(\$setvalue_name==\$file_element_name)
								    {
									    \$file_element = array(
										  \$index => array(
										\"file_client_name\" =>\$device_upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$device_upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$device_upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$device_upload_info[\$file_count]['file_size']
														)

                	                         );
											 
										\$data_array = array(
                				              \"page\".\$pgno =>array(
                					            \$section => \$file_element));

                	                       \$final = array_merge_recursive(\$final,\$data_array);
										\$file_count++;
									}
								}
							}
                               
		        		break;
		        }
		     }
		 }
	 }
	 
	 }
	 
	  if(isset(\$array_data['doc_data']['widget_data']))
	  {
	       \$merged_data = array_merge(\$array_data['doc_data']['widget_data'],\$final);
           \$array_data['doc_data']['widget_data'] = array_replace_recursive(\$array_data['doc_data']['widget_data'],\$merged_data);
	  }
	  else
	  {
	       \$array_data['doc_data']['widget_data'] = \$final;
	  } 
         	
	    if(!isset(\$array_data['doc_data']['patient_uniqueID']) || \$array_data['doc_data']['patient_uniqueID'] == '')
	    {
				if (isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Mobile']['mob_num']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Name']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Date of birth'])) 
				{
					\$patient_details = \$this->".$this->model_name_for_calls."_calls->patient_register(\$array_data);
					\$array_data['doc_data']['patient_uniqueID'] = \$patient_details['unique_id'];
				}
		}
					
		// link doc
		\$doc_linking_id      = \$_POST['doc_linking_id'];
		\$form_user_unique_id = \$_POST['unique_id'];
		
		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->dynamic_doc_forward_model(\$array_data,\$doc_linking_id,\$form_user_unique_id);
				
	    if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
		{
			echo 'successfull-document-input';
		}
		else
		{
			echo 'document-input-failed';
		}
	}
  }
   
   //------------------------------------------------------------------------------------

	/**
	 * Helper: Notification to the forwarded user
	 *
	 *@author Selva
	 */
	 
   public function dynamic_document_notification()
   {
     \$unique_id      = \$this->input->post('unique_id');
     \$forwarded_from = \$this->input->post('forwarded_from');
     \$forwarded_to   = \$this->input->post('forwarded_to');
     \$doc_linking_id = \$this->input->post('doc_linking_id');
	 
	 \$result = \$this->".$this->model_name_for_calls."_calls->dynamic_doc_notification_model(\$unique_id,\$forwarded_from,\$forwarded_to,\$doc_linking_id);
	 
	 if(\$result)
	 {
	   echo \"SUCCESS\";
	 }
	 else
	 {
	   echo \"FAIL\";
	 }
   
   }

   //------------------------------------------------------------------------------------

	/**
	 * Helper: finish document from device stage
	 *
	 *@author Selva
	 */
   
   public function dynamic_document_finish()
  {
	
    \$postdata = \$_POST['data'];
	if (isset(\$postdata))
	{
		// Get the data
		\$imageData=\$postdata;
		
		// Remove the headers (data:,) part.
		// A real application should use them according to needs such as to check image type
		\$filteredData=substr(\$imageData, strpos(\$imageData, ',')+1);
		
		\$this->_page_data = \$filteredData;
		// Need to decode before saving since the data we received is already base64 encoded
		\$unencodedData=base64_decode(\$filteredData);

		//echo 'unencodedData'.\$unencodedData;

		// Save file. This example uses a hard coded filename for testing,
		// but a real application can specify filename in POST variable

		//Seprating image data
		\$imgData=substr(\$imageData, 0, strpos(\$imageData, '&')-1);
		
		\$array_data = json_decode(\$imageData, TRUE);
	
	if(isset(\$_FILES))
    {
    	\$this->load->library('upload');
	    \$this->load->library('image_lib');
		
		\$device_upload_info         = array();
		\$external_files_upload_info = array();
		\$external_final             = array();
		\$chart_final             	= array();
		\$consent_final				= array();
		\$profile_settings_final     = array();
					
		//==============template upload==================
		\$template_files_upload_info = array();
		\$template_final             = array();
		
		foreach (\$_FILES as \$index => \$value)
	   {
		 
         if (strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')=== false && strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')=== false && \$value['name'] != ''  && strpos(\$index,'CHART_IMAGE')=== false && strpos(\$index,'CONSENT_IMAGE')=== false && strpos(\$index,'TEMPLATE_IMAGE')=== false)
	     {  
            \$index_new = str_replace('_',' ',\$index);
		   \$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."',\$index_new));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"file upload failed\";
		         return FALSE;
		    }
		    else
		    {
		        array_push(\$device_upload_info,\$this->upload->data());
			}
         }
		 
		  if(strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->external_file_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"external file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$external_files_upload_info = \$this->upload->data();
			
			    \$external_data_array = array(
										  \$index => array(
										\"file_client_name\" =>\$external_files_upload_info['client_name'],
										\"file_encrypted_name\" =>\$external_files_upload_info['file_name'],
										\"file_path\" =>\$external_files_upload_info['file_relative_path'],
										\"file_size\" =>\$external_files_upload_info['file_size']
														)

                	                         );

                \$external_final = array_merge(\$external_final,\$external_data_array);
		        
			}
		    
		 }
		 
		 if(strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->profile_settings_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"profile logo file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$profile_files_upload_info = \$this->upload->data();
			
			    \$profile_file_data_array = array(
										  \"file_client_name\" =>\$profile_files_upload_info['client_name'],
										  \"file_encrypted_name\" =>\$profile_files_upload_info['file_name'],
										  \"file_path\" =>\$profile_files_upload_info['file_relative_path'],
										  \"file_size\" =>\$profile_files_upload_info['file_size']
												);

                \$profile_settings_final = array_merge(\$profile_settings_final,\$profile_file_data_array);
		        
			}
		    
		 }
		 if(strpos(\$index,'CHART_IMAGE')!== false)
		 {	
		 	\$this->upload->initialize(\$this->chart_file_attachment_upload_options('".$this->controller_name."',\$index));
		 	if ( ! \$this->upload->do_upload(\$index))
		 	{
		 		echo \"chart file upload failed\";
		 		return FALSE;
		 	}
		 	else
		 	{
		 		\$chart_files_upload_info = \$this->upload->data();
		 			
		 		\$chart_data_array = array(
 					\"file_client_name\" =>\$chart_files_upload_info['client_name'],
 					\"file_encrypted_name\" =>\$chart_files_upload_info['file_name'],
 					\"file_path\" =>\$chart_files_upload_info['file_relative_path'],
 					\"file_size\" =>\$chart_files_upload_info['file_size']
		 		);
		 
		 		\$chart_final = array_merge(\$chart_final,\$chart_data_array);
		 	}
		 }
		 
		 if(strpos(\$index,'CONSENT_IMAGE')!== false)
		 {
		  
		 \$this->upload->initialize(\$this->consent_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"consent file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$consent_files_upload_info = \$this->upload->data();
		 
		 	\$consent_data_array = array(
		 			\"file_client_name\" =>\$consent_files_upload_info['client_name'],
		 			\"file_encrypted_name\" =>\$consent_files_upload_info['file_name'],
		 			\"file_path\" =>\$consent_files_upload_info['file_relative_path'],
		 			\"file_size\" =>\$consent_files_upload_info['file_size']
		 	);
		 		
		 	\$consent_final = array_merge(\$consent_final,\$consent_data_array);
		 		
		 }
		 	
		 }
		 
		 if(strpos(\$index,'TEMPLATE_IMAGE')!== false)
		 {
		 	
		 \$this->upload->initialize(\$this->template_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"template file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$template_files_upload_info = \$this->upload->data();
		 		
		 	\$template_data_array = array(
		 			\$index => array(
		 					\"file_client_name\" =>\$template_files_upload_info['client_name'],
		 					\"file_encrypted_name\" =>\$template_files_upload_info['file_name'],
		 					\"file_path\" =>\$template_files_upload_info['file_relative_path'],
		 					\"file_size\" =>\$template_files_upload_info['file_size']
		 			)
		 	);
		 
		 	\$template_final = array_merge(\$template_final,\$template_data_array);
		 
		 }
		 
		 }
       }
	   
	   if(isset(\$array_data['doc_data']['template_attachments']))
       {
       
       	\$template_merged_data = array_merge(\$array_data['doc_data']['template_attachments'],\$template_final);
       	\$array_data['doc_data']['template_attachments'] = array_replace_recursive(\$array_data['doc_data']['template_attachments'],\$template_merged_data);
       }
       else
       {
       	\$array_data['doc_data']['template_attachments'] = \$template_final;
       }
	   
	     if(isset(\$array_data['doc_data']['external_attachments']))
	   {
			   
			    \$external_merged_data = array_merge(\$array_data['doc_data']['external_attachments'],\$external_final);
                \$array_data['doc_data']['external_attachments'] = array_replace_recursive(\$array_data['doc_data']['external_attachments'],\$external_merged_data);
		}
		else
		{
		         \$array_data['doc_data']['external_attachments'] = \$external_final;
		} 
		
		if(isset(\$array_data['doc_data']['profile_settings']))
	    {
		    \$array_data['doc_data']['profile_settings']['logo'] = \$profile_settings_final;
		}
		
		if(isset(\$array_data['doc_data']['chart_data']))
		{
			\$array_data['doc_data']['chart_data']['chart_image'] = \$chart_final;
		}
		
		if(isset(\$array_data['doc_data']['consent_data']))
		{
			\$array_data['doc_data']['consent_data']['consent_image'] = \$consent_final;
		}


        \$pagenumber       = array();
	    \$page_data        = array();
	    \$data_array       = array();
	    \$final            = array();
		\$file_count = 0;

	    \$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();

	    foreach (\$app_template as \$pageno => \$pages)
        {
		  	array_push(\$pagenumber,\$pageno);
        }

     	\$pagecount = count(\$pagenumber);

     	for(\$i=1;\$i<=\$pagecount;\$i++)
	 	{
			 array_push(\$page_data,\$app_template[\$i]);
     	}

     	for(\$ii=0;\$ii<\$pagecount;\$ii++)
     	{
            \$pgno = \$ii +1;
	     foreach(\$page_data[\$ii] as \$section => \$index_array)
	     {
	        unset(\$index_array['dont_use_this_name']);
	        foreach(\$index_array as \$index => \$value)
	        {
			    \$setvalue_name = str_replace(' ','_',\$index);
				
                switch (\$value['type'])
		      	{
		        		case 'file':
		        		case 'image':
						case 'photo':
                          
                              if(\$device_upload_info)
							{
								foreach(\$_FILES as \$file_element_name => \$file_element_data)
								{
								   
									if(\$setvalue_name==\$file_element_name)
								    {
									    \$file_element = array(
										  \$index => array(
										\"file_client_name\" =>\$device_upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$device_upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$device_upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$device_upload_info[\$file_count]['file_size']
														)

                	                         );
											 
										\$data_array = array(
                				              \"page\".\$pgno =>array(
                					            \$section => \$file_element));

                	                       \$final = array_merge_recursive(\$final,\$data_array);
										\$file_count++;
									}
								}
							}
                               
		        		break;
		        }
		     }
		 }
	 }
	 
	 }
	 
	  if(isset(\$array_data['doc_data']['widget_data']))
	  {
	       \$merged_data = array_merge(\$array_data['doc_data']['widget_data'],\$final);
           \$array_data['doc_data']['widget_data'] = array_replace_recursive(\$array_data['doc_data']['widget_data'],\$merged_data);
	  }
	  else
	  {
	       \$array_data['doc_data']['widget_data'] = \$final;
	  } 
         	
	    if(!isset(\$array_data['doc_data']['patient_uniqueID']) || \$array_data['doc_data']['patient_uniqueID'] == '')
	    {
				if (isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Mobile']['mob_num']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Name']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Date of birth'])) 
				{
					\$patient_details = \$this->".$this->model_name_for_calls."_calls->patient_register(\$array_data);
					\$array_data['doc_data']['patient_uniqueID'] = \$patient_details['unique_id'];
				}
		}
					
		// link doc
		\$doc_linking_id      = \$_POST['doc_linking_id'];
		\$form_user_unique_id = \$_POST['unique_id'];
		
		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->dynamic_doc_finish_model(\$array_data,\$doc_linking_id,\$form_user_unique_id);
				
	    if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
		{
				echo 'successfull-document-input';
		}
		else
		{
				echo 'document-input-failed';
		}
	}
  }
	 
	 
  //------------------------------------------------------------------------------------

	/**
	 * Helper: submit data from device stage
	 *
	 *@author Vikas (Modified by Selva) 
	 */


  public function device_submit()
  {
	
    \$postdata = \$_POST['data'];
	if (isset(\$postdata))
	{
		// Get the data
		\$imageData=\$postdata;
		
		// Remove the headers (data:,) part.
		// A real application should use them according to needs such as to check image type
		\$filteredData=substr(\$imageData, strpos(\$imageData, ',')+1);
		
		\$this->_page_data = \$filteredData;
		// Need to decode before saving since the data we received is already base64 encoded
		\$unencodedData=base64_decode(\$filteredData);

		//echo 'unencodedData'.\$unencodedData;

		// Save file. This example uses a hard coded filename for testing,
		// but a real application can specify filename in POST variable

		//Seprating image data
		\$imgData=substr(\$imageData, 0, strpos(\$imageData, '&')-1);
		
		\$array_data = json_decode(\$imageData, TRUE);
	
	if(isset(\$_FILES))
    {
    	\$this->load->library('upload');
	    \$this->load->library('image_lib');
		
		\$device_upload_info         = array();
		\$external_files_upload_info = array();
		\$external_final             = array();
		\$chart_final             	= array();
		\$consent_final				= array();
		\$profile_settings_final     = array();
					
		//==============template upload==================
		\$template_files_upload_info = array();
		\$template_final             = array();
		
		foreach (\$_FILES as \$index => \$value)
	   {
		 
         if (strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')=== false && strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')=== false && \$value['name'] != ''  && strpos(\$index,'CHART_IMAGE')=== false && strpos(\$index,'CONSENT_IMAGE')=== false && strpos(\$index,'TEMPLATE_IMAGE')=== false)
	     {  
            \$index_new = str_replace('_',' ',\$index);
		   \$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."',\$index_new));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"file upload failed\";
		         return FALSE;
		    }
		    else
		    {
		        array_push(\$device_upload_info,\$this->upload->data());
			}
         }
		 
		  if(strpos(\$index,'DFF_EXTERENAL_FILE_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->external_file_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"external file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$external_files_upload_info = \$this->upload->data();
			
			    \$external_data_array = array(
										  \$index => array(
										\"file_client_name\" =>\$external_files_upload_info['client_name'],
										\"file_encrypted_name\" =>\$external_files_upload_info['file_name'],
										\"file_path\" =>\$external_files_upload_info['file_relative_path'],
										\"file_size\" =>\$external_files_upload_info['file_size']
														)

                	                         );

                \$external_final = array_merge(\$external_final,\$external_data_array);
		        
			}
		    
		 }
		 
		 if(strpos(\$index,'DFF_PROFILE_SETTINGS_ATTACHMENT')!== false)
		 {
			
		    \$this->upload->initialize(\$this->profile_settings_attachment_upload_options('".$this->controller_name."',\$index));
	        if ( ! \$this->upload->do_upload(\$index))
		    {
		  	     echo \"profile logo file upload failed\";
		         return FALSE;
		    }
		    else
		    {
			    \$profile_files_upload_info = \$this->upload->data();
			
			    \$profile_file_data_array = array(
										  \"file_client_name\" =>\$profile_files_upload_info['client_name'],
										  \"file_encrypted_name\" =>\$profile_files_upload_info['file_name'],
										  \"file_path\" =>\$profile_files_upload_info['file_relative_path'],
										  \"file_size\" =>\$profile_files_upload_info['file_size']
												);

                \$profile_settings_final = array_merge(\$profile_settings_final,\$profile_file_data_array);
		        
			}
		    
		 }
		 if(strpos(\$index,'CHART_IMAGE')!== false)
		 {	
		 	\$this->upload->initialize(\$this->chart_file_attachment_upload_options('".$this->controller_name."',\$index));
		 	if ( ! \$this->upload->do_upload(\$index))
		 	{
		 		echo \"chart file upload failed\";
		 		return FALSE;
		 	}
		 	else
		 	{
		 		\$chart_files_upload_info = \$this->upload->data();
		 			
		 		\$chart_data_array = array(
 					\"file_client_name\" =>\$chart_files_upload_info['client_name'],
 					\"file_encrypted_name\" =>\$chart_files_upload_info['file_name'],
 					\"file_path\" =>\$chart_files_upload_info['file_relative_path'],
 					\"file_size\" =>\$chart_files_upload_info['file_size']
		 		);
		 
		 		\$chart_final = array_merge(\$chart_final,\$chart_data_array);
		 	}
		 }
		 
		 if(strpos(\$index,'CONSENT_IMAGE')!== false)
		 {
		  
		 \$this->upload->initialize(\$this->consent_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"consent file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$consent_files_upload_info = \$this->upload->data();
		 
		 	\$consent_data_array = array(
		 			\"file_client_name\" =>\$consent_files_upload_info['client_name'],
		 			\"file_encrypted_name\" =>\$consent_files_upload_info['file_name'],
		 			\"file_path\" =>\$consent_files_upload_info['file_relative_path'],
		 			\"file_size\" =>\$consent_files_upload_info['file_size']
		 	);
		 		
		 	\$consent_final = array_merge(\$consent_final,\$consent_data_array);
		 		
		 }
		 	
		 }
		 
		 if(strpos(\$index,'TEMPLATE_IMAGE')!== false)
		 {
		 	
		 \$this->upload->initialize(\$this->template_file_attachment_upload_options('".$this->controller_name."',\$index));
		 if ( ! \$this->upload->do_upload(\$index))
		 {
		 	echo \"template file upload failed\";
		 	return FALSE;
		 }
		 else
		 {
		 	\$template_files_upload_info = \$this->upload->data();
		 		
		 	\$template_data_array = array(
		 			\$index => array(
		 					\"file_client_name\" =>\$template_files_upload_info['client_name'],
		 					\"file_encrypted_name\" =>\$template_files_upload_info['file_name'],
		 					\"file_path\" =>\$template_files_upload_info['file_relative_path'],
		 					\"file_size\" =>\$template_files_upload_info['file_size']
		 			)
		 	);
		 
		 	\$template_final = array_merge(\$template_final,\$template_data_array);
		 
		 }
		 
		 }
       }
	   
	   if(isset(\$array_data['doc_data']['template_attachments']))
       {
       
       	\$template_merged_data = array_merge(\$array_data['doc_data']['template_attachments'],\$template_final);
       	\$array_data['doc_data']['template_attachments'] = array_replace_recursive(\$array_data['doc_data']['template_attachments'],\$template_merged_data);
       }
       else
       {
       	\$array_data['doc_data']['template_attachments'] = \$template_final;
       }
	   
	     if(isset(\$array_data['doc_data']['external_attachments']))
	   {
			   
			    \$external_merged_data = array_merge(\$array_data['doc_data']['external_attachments'],\$external_final);
                \$array_data['doc_data']['external_attachments'] = array_replace_recursive(\$array_data['doc_data']['external_attachments'],\$external_merged_data);
		}
		else
		{
		         \$array_data['doc_data']['external_attachments'] = \$external_final;
		} 
		
		if(isset(\$array_data['doc_data']['profile_settings']))
	    {
		    \$array_data['doc_data']['profile_settings']['logo'] = \$profile_settings_final;
		}
		
		if(isset(\$array_data['doc_data']['chart_data']))
		{
			\$array_data['doc_data']['chart_data']['chart_image'] = \$chart_final;
		}
		
		if(isset(\$array_data['doc_data']['consent_data']))
		{
			\$array_data['doc_data']['consent_data']['consent_image'] = \$consent_final;
		}


        \$pagenumber       = array();
	    \$page_data        = array();
	    \$data_array       = array();
	    \$final            = array();
		\$file_count = 0;

	    \$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();

	    foreach (\$app_template as \$pageno => \$pages)
        {
		  	array_push(\$pagenumber,\$pageno);
        }

     	\$pagecount = count(\$pagenumber);

     	for(\$i=1;\$i<=\$pagecount;\$i++)
	 	{
			 array_push(\$page_data,\$app_template[\$i]);
     	}

     	for(\$ii=0;\$ii<\$pagecount;\$ii++)
     	{
            \$pgno = \$ii +1;
	     foreach(\$page_data[\$ii] as \$section => \$index_array)
	     {
	        unset(\$index_array['dont_use_this_name']);
	        foreach(\$index_array as \$index => \$value)
	        {
			    \$setvalue_name = str_replace(' ','_',\$index);
				
                switch (\$value['type'])
		      	{
		        		case 'file':
		        		case 'image':
						case 'photo':
                          
                              if(\$device_upload_info)
							{
								foreach(\$_FILES as \$file_element_name => \$file_element_data)
								{
								   
									if(\$setvalue_name==\$file_element_name)
								    {
									    \$file_element = array(
										  \$index => array(
										\"file_client_name\" =>\$device_upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$device_upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$device_upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$device_upload_info[\$file_count]['file_size']
														)

                	                         );
											 
										\$data_array = array(
                				              \"page\".\$pgno =>array(
                					            \$section => \$file_element));

                	                       \$final = array_merge_recursive(\$final,\$data_array);
										\$file_count++;
									}
								}
							}
                               
		        		break;
		        }
		     }
		 }
	 }
	 
	  if(isset(\$array_data['doc_data']['widget_data']))
	  {
	       \$merged_data = array_merge(\$array_data['doc_data']['widget_data'],\$final);
           \$array_data['doc_data']['widget_data'] = array_replace_recursive(\$array_data['doc_data']['widget_data'],\$merged_data);
	  }
	  else
	  {
	       \$array_data['doc_data']['widget_data'] = \$final;
	  }

    } 

     \$approval_history = array();
     \$approval_data = array();


     \$approval_data = array(
       \"current_stage\" => \$array_data['doc_data']['current_stage_name'],
       \"approval\" => \"true\",
       \"submitted_by\" => \$array_data['doc_data']['user_name'],
       \"time\" => date('Y-m-d H:i:s'));
     

       if(\$array_data['doc_data']['stage_name'] == '".$this->coll_name."')
	   {

		array_push(\$approval_history,\$approval_data);
		\$array_data['history'] = \$approval_history;
		
	   }
	   else
	   {

          \$approval_history = \$this->".$this->model_name_for_calls."_calls->get_approval_history(\$array_data['doc_properties']['doc_id']);
       
          array_push(\$approval_history,\$approval_data); 

         \$array_data['history'] = \$approval_history;
	  }
	   
	   \$doc_properties = \$array_data['doc_properties'];
	   \$doc_flow       = \$doc_properties['doc_flow'];
	    
	   \$stagewise_users = \$this->extract_users_with_stages();

		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->chk_user_new(\$stagewise_users,\$array_data['doc_data']['user_name'],\$array_data['doc_data']['current_stage_name']);
		
		if(\$doc_flow=='new')
		{
		   if(\$array_data['doc_data']['stage_name'] == '".$this->coll_name."')
	       {
				if(\$this->".$this->model_name.")
				{
					if(!isset(\$array_data['doc_data']['patient_uniqueID']) || \$array_data['doc_data']['patient_uniqueID'] == ''){
						if (isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Mobile']['mob_num']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Name']) && isset(\$array_data['doc_data']['widget_data']['page1']['Section Name']['Date of birth'])) {
							\$patient_details = \$this->".$this->model_name_for_calls."_calls->patient_register(\$array_data);
							\$array_data['doc_data']['patient_uniqueID'] = \$patient_details['unique_id'];
						}
					}
					
					\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->create(\$array_data);
				}
	       }
	       else
		   {
				if(\$this->".$this->model_name.")
				{
				     \$stage_users = \$this->".$this->model_name_for_calls."_calls->fetch_stage_users(\$stagewise_users,\$array_data['doc_data']['current_stage_name']);
					 
					\$user=\$array_data['doc_data']['user_name'].'_docs';
					\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->update_attributes(\$array_data['doc_properties']['doc_id'],\$stage_users,\$array_data);	
				}
	       }
	
			if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
			{
				echo 'successfull-document-input';
			}
			else
			{
				echo 'document-input-failed';
			}
		}
		else if(\$doc_flow=='existing')
		{
		     \$existing_doc_details = \$this->".$this->model_name_for_calls."_calls->fetch_existing_document(\$array_data['doc_properties']['doc_id']);
			
			 if(isset(\$existing_doc_details['doc_data']['external_attachments']))
	         {
			    \$external_merged_data = array_merge(\$existing_doc_details['doc_data']['external_attachments'],\$external_final);
                \$array_data['doc_data']['external_attachments'] = array_replace_recursive(\$array_data['doc_data']['external_attachments'],\$external_merged_data);
			 }
			 else
			 {
		         \$array_data['doc_data']['external_attachments'] = \$external_final;
		     } 
			
		    if(\$this->".$this->model_name.")
			{
			     \$stage_users = \$this->".$this->model_name_for_calls."_calls->fetch_stage_users(\$stagewise_users,\$array_data['doc_data']['current_stage_name']);
				
			   \$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->update_attributes(\$array_data['doc_properties']['doc_id'],\$stage_users,\$array_data);	
			}
			
			if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
			{
				echo 'successfull-document-input';
			}
			else
			{
				echo 'document-input-failed';
			}
		}
		
	}
  }
	
	// ---------------------------------------------------------------------------------------

	/**
	 * Helper: Profile settings attachment configuration
	 *
	 *@author Selva 
	 */
	 
	private function profile_settings_attachment_upload_options(\$controller,\$field)
	{
	   \$config = array();

		if (strpos(\$field,'DFF_PROFILE_SETTINGS_ATTACHMENT')!== false)
		{
			\$config['upload_path']   = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/profile_settings/';
			\$config['allowed_types'] = '*';
			\$config['max_size']      = '2048';
			\$config['encrypt_name']  = TRUE;
		}
			  //create controller upload folder if not exists
		if (!is_dir(\$config['upload_path']))
		{
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/profile_settings/\",0777,TRUE);
		}


		return \$config;
    }

    function username()
   {
      redirect('web/username');
   }
   

	function search(\$field = FALSE, \$value = FALSE) 
	{

			//search the item to show in edit form
			\$data = \$this->".$this->model_name_for_calls."_calls->find(\$field, \$value);
			
			\$str_data = json_encode(\$data);
			//\$sub_str_data = substr(\$str_data,1,strlen(\$str_data)-1);
			
			
			\$this->output
						->set_header(\"HTTP/1.0 200 OK\")
						->set_content_type('application/json')
						->set_output(\$str_data);
			

	}


	function get_doc(\$field = FALSE, \$value = FALSE, \$usercol = FALSE) 
	{
			//search the item to show in edit form
			\$data =\$this->".$this->model_name_for_calls."_calls->find(\$field, \$value);
			
			\$datastage = \$this->".$this->model_name_for_calls."_calls->finduserstage(\$usercol, \$field, \$value);
			
			
			\$data[0]['stage_name'] = \$datastage;
			
			
			\$str_data = json_encode(\$data[0]);
			\$sq_data = '['.\$str_data.']';
			
			\$this->output
						->set_header(\"HTTP/1.0 200 OK\")
						->set_content_type('application/json')
						->set_output(\$str_data);
	
	}
	

	function edit(\$id = FALSE, \$page = 1) 
	{
";
if ($this->there_is_a_relational_field)
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//get the \$id and sanitize
		\$id = ( \$this->uri->segment(5) )  ? \$this->uri->segment(5) : \$this->input->post('id', TRUE);
		\$id = ( \$id != 0 ) ? filter_var(\$id, FILTER_VALIDATE_INT) : NULL;

		//get the relation and sanitize
		\$data['".$this->relational_field."'] = (\$this->uri->segment(6)) ? \$this->uri->segment(6) : \$this->input->post('".$this->relational_field."', TRUE);
		\$data['".$this->relational_field."'] = ( \$data['".$this->relational_field."'] != 0 ) ? filter_var(\$data['".$this->relational_field."'], FILTER_VALIDATE_INT) : NULL;

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(6) )  ? \$this->uri->segment(6) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if its no correct
		if (!\$id or !\$data['".$this->relational_field."']){
			\$this->session->set_flashdata('message',lang('web_object_not_exist'));
			redirect(\"".$this->customer_folder."/".$this->controller_name."/\".\$data['".$this->relational_field."']);
		}
";
}
else
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//get the \$id and sanitize
		\$id = ( \$this->uri->segment(4) )  ? \$this->uri->segment(4) : \$this->input->post('id', TRUE);
		\$id = ( \$id != 0 ) ? filter_var(\$id, FILTER_VALIDATE_INT) : NULL;

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(5) )  ? \$this->uri->segment(5) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if it's not correct
		if (!\$id){
			\$this->session->set_flashdata('message',lang('web_object_not_exist') );
			redirect(\"".$this->customer_folder."/".$this->controller_name."/\");
		}
";
}


$data .= "
		//variables for check the upload
		\$form_data_aux			= array();
		\$files_to_delete 		= array();
		";

	  	foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
    		foreach($pages as $pagedata)
    		{
    			 foreach($pagedata as $index => $value)
    			 {
      		switch ($value['type'])
      		{
        		case 'selectbd':

        			if ($this->scaffold_model_type == "phpactiverecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find('all', array('order' => '".$value['options']['order']."' ));".$this->sl;
					}
					else if ($this->scaffold_model_type == "activerecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$this->load->model('".strtolower($value['options']['model'])."');";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find_all('".$value['options']['order']."');
        			";	
					}

        		break;
        	}
            }
          }
       }
		
        $data .= "
		//Rules for validation
		\$this->set_rules(\$id);
        \$form_new_data = array();
		//create control variables
		\$data['title'] = lang('web_edit');
		\$data['updType'] = 'edit';
		\$data['page'] = \$page;

       \$user = \$this->ion_auth->user()->row();
	   \$username = \$user->email;

		if (\$this->form_validation->run() == FALSE) // validation hasn't been passed
		{
			//search the item to show in edit form
			\$".$this->coll_name."_edit = \$this->".$this->model_name_for_calls."_calls->find('_id',\$id);
            \$data['".$this->model_name."'] = json_decode(json_encode(\$".$this->coll_name."_edit),TRUE);
	            \$stage = \$this->".$this->model_name_for_calls."_calls->get_stage_name(\$username);
                \$data['stagename'] = \$stage;
             	\$data['template'] = \$this->".$this->model_name_for_calls."_calls->get_template();
             	//load the view and the layout
			   \$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage.'', \$data);
		}
		else
		{";

if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
{
				if (count($this->array_thumbnails_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= explode(\",\", \"".implode(",", $this->array_thumbnails_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= array();";
				}

				if (count($this->array_required_fields_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= explode(\",\", \"".implode(",", $this->array_required_fields_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= array();";
				}
				
				


				foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
		      		switch ($value['type'])
		      		{
		      			case 'image':
		      			case 'file':
						case 'photo':

		      				$aux = "";

		      				if ($value['multilanguage'] == "TRUE")
		      				{
		      					foreach ($this->languages as $prefix=>$language)
		      					{
		      						$aux .= $index."_".$prefix.","; 	
		      					}

		      					$aux = substr( $aux, 0, -1 );

$data .="

			//uploads fields for $index
			\$array_fields_".$index." = explode(\",\", \"$aux\");
";						
	      				}

		      			break;
		      		}
		      	}
		      }
		      	}





$data .= "
			\$data['".$this->model_name."'] = ".$this->model_name_for_calls."::find(\$this->input->post('id', TRUE));

			\$this->load->library('upload');
			\$this->load->library('image_lib');

			foreach (\$_FILES as \$index => \$value)
			{
				if (\$value['name'] != '')
				{
";

			foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
	      		switch ($value['type'])
	      		{
	      			case 'image':
	      			case 'file':

	      				$aux = "";

	      				if ($value['multilanguage'] == "TRUE")
	      				{
	      					foreach ($this->languages as $prefix=>$language)
	      					{
	      						$aux .= $index."_".$prefix.", "; 	
	      					}

	      					$aux = substr( $aux, 0, -2 );

$data .="
					//uploads rules for \$index					
					if (in_array(\$index, \$array_fields_".$index."))
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));
					}
";						
	      				}
	      				else
	      				{
$data .="
					//uploads rules for \$index
					if (\$index == '".$index."')
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));
					}
";	
	      				}


	      			break;
	      		}
	      	}
	      }
	      	}


$data .= "
					//upload the image
					if ( ! \$this->upload->do_upload(\$index))
					{
						\$data['upload_error'][\$index] = \$this->upload->display_errors(\"<span class='error'>\", \"</span>\");
						
						//load the view and the layout
					\$this->load->view('".$this->customer_folder."/".$this->controller_name."/create', \$data);

						return FALSE;
					}
					else
					{
						//create an array to send to image_lib library to create the thumbnail
						\$info_upload = \$this->upload->data();

						//Save the name an array to save on BD before
						\$form_data_aux[\$index]		=	\$info_upload[\"file_name\"];

						//Save the name of old files to delete
						array_push(\$files_to_delete, \$data['".$this->model_name."']->\$index);

						//Initializing the imagelib library to create the thumbnail

						if (in_array(\$index, \$array_thumbnails))
						{
";
			foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
	      		switch ($value['type'])
	      		{
	      			case 'image':

	      				$aux = "";

	      				if ($value['multilanguage'] == "TRUE")
	      				{
	      					foreach ($this->languages as $prefix=>$language)
	      					{
	      						$aux .= $index."_".$prefix.", "; 	
	      					}

	      					$aux = substr( $aux, 0, -2 );

$data .="
						//thumbnails rules for \$index		
						if (in_array(\$index, \$array_fields_".$index."))
						{
							\$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						}
";						
	      				}
	      				else
	      				{
$data .="
						//thumbnails rules for \$index
						if (\$index == '".$index."')
						{
							\$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						}
";

	      				}

	      			break;
	      		}
	      	}
	      }
	      	}

$data .= "						
							//create the thumbnail
							if ( ! \$this->image_lib->resize())
							{
								\$data['upload_error'][\$index] = \$this->image_lib->display_errors(\"<span class='error'>\", \"</span>\");

								//load the view and the layout
							\$this->load->view('".$this->customer_folder."/".$this->controller_name."/create', \$data);

								return FALSE;
							}
						}
					}
				}

			}		
";

		
}


$data .= "	
             \$user = \$this->ion_auth->user()->row();
		    \$username = \$user->email;
			// build array for the model
			\$form_data = array( 	";

							foreach ($this->arrayjson as $pageno => $pages )
					    	{
					    		unset($pages['dont_use_this_name']);
                                foreach($pages as $pagedata)
                                {
                                	unset($pagedata['dont_use_this_name']);
                                	foreach($pagedata as $index => $value)
                                	{
					    		$index_name = str_replace(' ','',$index);
					      		switch ($value['type'])
					      		{
					        		case 'text':
									//case 'SBreak':
					        		case 'textarea':
									case 'number':
									case 'password':
									case 'range':
									
					        			if ( $value['multilanguage'] == "TRUE")
	{
					        				foreach ($this->languages as $prefix=>$language)
					        				{
					        					$data .= $this->sl.$this->tabx7."'".$index."_".$prefix."' => set_value('".$index_name."_".$prefix."'), ";
					        				}

					        			}
					        			else
					        			{
					        				$data .= $this->sl.$this->tabx7."'".$index."' => set_value('".$index_name."'), ";
					        			}

					        		break;

					        		case 'date':
		        		            case 'time':
		        		            case 'month':
		        		            case 'color':

		        		              if ( $value['multilanguage'] == "TRUE")
		        			             {
		        				             foreach ($this->languages as $prefix=>$language)
		        				             {
		        					             $data .= $this->sl.$this->tabx4."'".$index."_".$prefix."' => \$_POST['".$index_name."_".$prefix."'], ";
		        				             }

		        			              }
		        			          else
		        			              {
		        				                 $data .= $this->sl.$this->tabx4."'".$index."' => \$_POST['".$index_name."'], ";
		        			              }
		        		                break;
									
									case 'checkbox':
						
										$data .= $this->sl.$this->tabx4."'".$index."' => implode(', ', \$_POST['ac_".$index_name."']), ";
						
									break;
									
									case 'MChoice':
						
										$data .= $this->sl.$this->tabx4."'".$index."' => implode(', ', \$_POST['".$index_name."']), ";
						
									break;
					        		
									case 'select':
					        		case 'selectbd':
					        		case 'radio':
					        		case 'datepicker':
					        		case 'hidden':

					        			$data .= $this->sl.$this->tabx7."'".$index."' => set_value('".$index_name."'), ";

					        		break;
					        	}
					        }
					       }
					        }

					        $data = substr( $data, 0, -2 );

					        $data .= "
						);

                while (list(\$key, \$value) = each(\$form_data)) {
                  if(!is_null(\$value) && !empty(\$value))
                  {
                  	\$form_new_data['index'][\$key] = \$value;
                  }
                 }

                 \$stagename  = \$this->input->post('stagename',TRUE);  
               \$form_new_data['stage_name'] = \$stagename;

			//add the aux form data to the form data array to save
			//\$form_data = array_merge(\$form_data_aux, \$form_data);
		
			//find the item to update
			".( ($this->scaffold_model_type == 'phpactiverecord') ? "\$".$this->model_name." = ".$this->model_name_for_calls."::find(\$this->input->post('id', TRUE));": "" )."
			".( ($this->scaffold_model_type == 'activerecord') ? "\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->web_update_attributes(\$id, \$form_new_data,\$username);" : "\$this->".$this->model_name.'_calls->update_attributes($form_new_data);' )."
			".( ($this->scaffold_model_type == 'activerecord') ? "\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->create_ver(\$form_new_data, \$id);" : "\$this->".$this->model_name.'_calls->create_ver($form_new_data);' )."

			// the information has therefore been successfully saved in the db
			".( ($this->scaffold_model_type == 'phpactiverecord') ? "if ( \$".$this->model_name."->is_valid()) ": "if ( \$this->".$this->model_name.") " )."
			{
";
			if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
			{
$data .= "				
				//delete the old images
				foreach (\$files_to_delete as \$index)
				{";
					if ($this->there_is_an_image)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/'.\$index) )
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/'.\$index);
					
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/thumbs/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/thumbs/'.\$index);";
					}

					if ($this->there_is_a_file)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index);";
					}
					if ($this->there_is_a_photo)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index);";
					}
$data .= "
				}
";
					
			}
$data .= "
				\$this->session->set_flashdata('message',lang('web_edit_success'));
				
			}

			".( ($this->scaffold_model_type == 'phpactiverecord') ? "if ( \$".$this->model_name."->is_invalid()) ": "else" )."
			{
				\$this->session->set_flashdata('message',lang('web_edit_failed'));
				
			}

				redirect('web/index');
	  	} 
	}


   function view(\$id = FALSE, \$page = 1) 
	{
";
if ($this->there_is_a_relational_field)
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//get the \$id and sanitize
		\$id = ( \$this->uri->segment(5) )  ? \$this->uri->segment(5) : \$this->input->post('id', TRUE);
		\$id = ( \$id != 0 ) ? filter_var(\$id, FILTER_VALIDATE_INT) : NULL;

		//get the relation and sanitize
		\$data['".$this->relational_field."'] = (\$this->uri->segment(6)) ? \$this->uri->segment(6) : \$this->input->post('".$this->relational_field."', TRUE);
		\$data['".$this->relational_field."'] = ( \$data['".$this->relational_field."'] != 0 ) ? filter_var(\$data['".$this->relational_field."'], FILTER_VALIDATE_INT) : NULL;

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(6) )  ? \$this->uri->segment(6) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if its no correct
		if (!\$id or !\$data['".$this->relational_field."']){
			\$this->session->set_flashdata('message',lang('web_object_not_exist'));
			redirect(\"".$this->customer_folder."/".$this->controller_name."/\".\$data['".$this->relational_field."']);
		}
";
}
else
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//get the \$id and sanitize
		\$id = ( \$this->uri->segment(4) )  ? \$this->uri->segment(4) : \$this->input->post('id', TRUE);
		\$id = ( \$id != 0 ) ? filter_var(\$id, FILTER_VALIDATE_INT) : NULL;

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(5) )  ? \$this->uri->segment(5) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if it's not correct
		if (!\$id){
			\$this->session->set_flashdata('message',lang('web_object_not_exist') );
			redirect('web/index');
		}
";
}


$data .= "
		//variables for check the upload
		\$form_data_aux			= array();
		\$files_to_delete 		= array();
		";

	  	foreach ($this->arrayjson as $pageno => $pages )
    	{
    		foreach($pages as $pagedata)
    		{
    			unset($pagedata['dont_use_this_name']);
    			foreach($pagedata as $index => $value)
    			{
      		switch ($value['type'])
      		{
        		case 'selectbd':

        			if ($this->scaffold_model_type == "phpactiverecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find('all', array('order' => '".$value['options']['order']."' ));".$this->sl;
					}
					else if ($this->scaffold_model_type == "activerecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$this->load->model('".strtolower($value['options']['model'])."');";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find_all('".$value['options']['order']."');
        			";	
					}

        		break;
        	}
        }
        }
        }
		
        $data .= "
		\$data['updType'] = 'view';
		\$data['page'] = \$page;
        \$".$this->coll_name."_edit = \$this->".$this->model_name_for_calls."_calls->find('doc_id',\$id);
        \$data['".$this->model_name."'] = json_decode(json_encode(\$".$this->coll_name."_edit),TRUE);
        \$data['template'] = \$this->".$this->model_name_for_calls."_calls->get_template();
             	//load the view and the layout
	    \$this->load->view('".$this->customer_folder."/".$this->controller_name."/print_view', \$data);
		

	}

	function file_required(\$default='',\$field)
	{
	   if(\$_FILES[\$field]['name']!='')
	   {
		   return TRUE;
	   }
	   else
	   {
	     \$this->form_validation->set_message('file_required','%s field is required');
		 return FALSE;
	     
	   }
	
	}

   function doc_access(\$id = FALSE, \$page = 1) 
	{
";
if ($this->there_is_a_relational_field)
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		if(!isset(\$id) || empty(\$id))
		{
		  \$id = \$this->input->post('docid', TRUE);
        }

		//get the relation and sanitize
		\$data['".$this->relational_field."'] = (\$this->uri->segment(5)) ? \$this->uri->segment(5) : \$this->input->post('".$this->relational_field."', TRUE);
		\$data['".$this->relational_field."'] = ( \$data['".$this->relational_field."'] != 0 ) ? filter_var(\$data['".$this->relational_field."'], FILTER_VALIDATE_INT) : NULL;

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(6) )  ? \$this->uri->segment(6) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if its not correct
		if (!\$id or !\$data['".$this->relational_field."']){
			\$this->session->set_flashdata('message',lang('web_object_not_exist'));
			redirect(\"".$this->customer_folder."/".$this->controller_name."/\".\$data['".$this->relational_field."']);
		}
";
}
else
{
$data .= "
		
		if (!\$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		//get the \$id
		if(!isset(\$id) || empty(\$id))
		{
		  \$id = \$this->input->post('docid', TRUE);
        }

		//get the \$page and sanitize
		\$page = ( \$this->uri->segment(5) )  ? \$this->uri->segment(5) : \$this->input->post('page', TRUE);
		\$page = ( \$page != 0 ) ? filter_var(\$page, FILTER_VALIDATE_INT) : NULL;

		//redirect if it's not correct
		if (!\$id){
			\$this->session->set_flashdata('message',lang('web_object_not_exist') );
			redirect('web/index');
		}
";
}


$data .= "
		//variables for check the upload
		\$form_data_aux			= array();
		\$files_to_delete 		= array();
		\$this->upload_info     = array();
		";

	  	foreach ($this->arrayjson as $pageno => $pages)
    	{
    		foreach($pages as $pagedata)
    		{
    			unset($pagedata['dont_use_this_name']);
    			foreach($pagedata as $index => $value)
    			{
      		switch ($value['type'])
      		{
        		case 'selectbd':

        			if ($this->scaffold_model_type == "phpactiverecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find('all', array('order' => '".$value['options']['order']."' ));".$this->sl;
					}
					else if ($this->scaffold_model_type == "activerecord")
					{
						$data .= $this->sl.$this->tabx2."//Load the model for the select 1:N";
						$data .= $this->sl.$this->tabx2."\$this->load->model('".strtolower($value['options']['model'])."');";
						$data .= $this->sl.$this->tabx2."\$data['array_".strtolower($value['options']['model'])."']	= 	".$value['options']['model']."::find_all('".$value['options']['order']."');
        			";	
					}

        		break;
        	}
        }
       }
        }
		
        $data .= "

        \$user = \$this->ion_auth->user()->row();
        \$username = str_replace(\"@\",\"#\",\$user->email);
	    \$usercollection=\$username.'_web_docs';
	    \$doc_collection = \$this->".$this->model_name_for_calls."_calls->get_stage_for_doc_access('".$this->coll_name."',\$usercollection,\$id);
        \$stage_name = \$doc_collection['stg_name'];
        \$stageobj   = \$doc_collection['stage'];


		//Rules for validation
		\$validation = '_validation';
		\$stage = str_replace(' ','',\$stage_name);
		\$this->{\$stage.\$validation}();


        \$form_new_data = array();
		//create control variables
		\$data['title'] = 'Document Access';
		\$data['updType'] = 'Document Access';
		\$data['id'] = \$id;
		\$data['page'] = \$page;


		if (\$this->form_validation->run() == FALSE) // validation hasn't been passed
		{
			//search the item to show in edit form
			\$".$this->coll_name."_edit = \$this->".$this->model_name_for_calls."_calls->find('doc_id',\$id);
            \$data['".$this->model_name."'] = json_decode(json_encode(\$".$this->coll_name."_edit),TRUE);
            \$data['stagename'] = \$stage_name;
            \$data['template'] = \$this->".$this->model_name_for_calls."_calls->get_template();
			
			 \$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();
          
            \$pagenumber  = array();
	        \$page_data   = array();
	        \$file_count  = 0;
	       
	        foreach (\$app_template as \$pageno => \$pages)
		    {
		    	array_push(\$pagenumber,\$pageno);
		    }

            \$pagecount = count(\$pagenumber);

            for(\$i=1;\$i<=\$pagecount;\$i++)
		    {
		    	array_push(\$page_data,\$app_template[\$i]);
            }

            \$mapper_document = array();
	         	 
                 for(\$ii=0;\$ii<\$pagecount;\$ii++)
                 {
                 	\$widget       = array();
					\$widget_final = array();
                 	\$previous_section = \"\";
                 	\$pgno = \$ii +1;
	         	 foreach(\$page_data[\$ii] as \$section => \$index_array)
	         	 {
	         	 	\$widget_data = array();
	         	 	unset(\$index_array['dont_use_this_name']);
	         	 	foreach(\$index_array as \$index => \$value)
	         	 	{
	         	 		switch (\$value['type'])
						{
							case 'retriever':
						  \$query_param     = \$value['field_ref'];
						  \$collection_name = \$value['coll_ref'];
						  \$to_be_retrieved = \$value['retrieve_list'];
						  
						  \$query_param = str_replace(\"_\",\".\",\$query_param);
						  \$page = 'page'.\$pgno;
						  
						  \$query_value = \$".$this->coll_name."_edit['doc_data']['widget_data'][\$page][\$section][\$index];
						  
						  
						  \$retrieval_list = array();
						  
						  foreach(\$to_be_retrieved as \$index => \$value)
						  {
							\$value = str_replace(\"_\",\".\",\$value);
							\$value = \"doc_data.widget_data.\".\$value;
							array_push(\$retrieval_list,\$value);
						  }
						  
						  //fetch document 
						  \$mapper_document = \$this->".$this->model_name_for_calls."_calls->fetch_retriever_data_model(\$query_param,\$query_value,\$retrieval_list,\$collection_name);
						  break;
						}
                 
					}
				 }
				 }
				 
				 if(isset(\$mapper_document) && !empty(\$mapper_document))
				 {
					\$data['mapper_doc'] = json_decode(json_encode(\$mapper_document[0]),TRUE);
				 }
				 
            //load the view and the layout
		   \$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name.'', \$data);
		}
		else
		{
	            \$app_template = \$this->".$this->model_name_for_calls."_calls->get_template_for_create();
          ";

if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
{
				if (count($this->array_thumbnails_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= explode(\",\", \"".implode(",", $this->array_thumbnails_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_thumbnails 	= array();";
				}

				if (count($this->array_required_fields_uploads))
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= explode(\",\", \"".implode(",", $this->array_required_fields_uploads)."\");";
				}
				else
				{
					$data .= $this->sl.$this->tabx3."\$array_required 	= array();";
				}


				foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
		      		switch ($value['type'])
		      		{
		      			case 'image':
		      			case 'file':
						case 'photo':

		      				$aux = "";

		      				if ($value['multilanguage'] == "TRUE")
		      				{
		      					foreach ($this->languages as $prefix=>$language)
		      					{
		      						$aux .= $index."_".$prefix.","; 	
		      					}

		      					$aux = substr( $aux, 0, -1 );

$data .="

			//uploads fields for $index
			\$array_fields_".$index." = explode(\",\", \"$aux\");
";						
	      				}

		      			break;
		      		}
		      	}
		      }
		      	}





$data .= "
			\$data['".$this->model_name."'] = ".$this->model_name_for_calls."::find('doc_id',\$id);

			\$this->load->library('upload');
			\$this->load->library('image_lib');

//////////////////////////////////////////////////////////////////////////////////////////////////////////////
      
            foreach (\$_FILES as \$index => \$value)
			{
				if (\$value['name'] != '')
				{
					";

		foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
	      		switch ($value['type'])
	      		{
	      			case 'image':
	      			case 'file':
					case 'photo':

	      				$aux = "";

	      				$file_index_name = str_replace(' ','',$index);

	      				if ($value['multilanguage'] == "TRUE")
	      				{
	      					foreach ($this->languages as $prefix=>$language)
	      					{
	      						$aux .= $index."_".$prefix.", "; 	
	      					}

	      					$aux = substr( $aux, 0, -2 );

$data .="
					//uploads rules for \$index					
					if (in_array(\$index, \$array_fields_".$index."))
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));
                         
                         //upload the image
					if ( ! \$this->upload->do_upload(\$index))
					{
						\$data['upload_error'][\$index] = \$this->upload->display_errors(\"<span class='error'>\", \"</span>\");
						
						//load the view and the layout
					\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name.'', \$data);

						return FALSE;
					}
					else
					{
						//create an array to send to image_lib library to create the thumbnail
						array_push(\$this->upload_info,\$this->upload->data());

						//Save the name of old files to delete
						//array_push(\$files_to_delete, \$data['".$this->model_name."']['\$index']);

						//Initializing the imagelib library to create the thumbnail

						if (in_array(\$index, \$array_thumbnails))
						{

							//thumbnails rules for \$index		
						if (in_array(\$index, \$array_fields_".$index."))
						{
							\$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						}

						//create the thumbnail
							if ( ! \$this->image_lib->resize())
							{
								\$data['upload_error'][\$index] = \$this->image_lib->display_errors(\"<span class='error'>\", \"</span>\");

								//load the view and the layout
							\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name.'', \$data);

								return FALSE;
							}

						}

					}
				}
			
";						
	      				}
	      				else
	      				{
	      					$sect       = str_replace(' ','',$sectionname);
	      					$file_index = "page".$pageno."_".$sect."_".$file_index_name;
$data .="
					//uploads rules for \$index
					if (\$index == '".$file_index."')
					{
						\$this->upload->initialize(\$this->set_upload_options('".$this->controller_name."', '".$index."'));

						//upload the image
					    if ( ! \$this->upload->do_upload(\$index))
					    {
						   \$data['upload_error'][\$index] = \$this->upload->display_errors(\"<span class='error'>\", \"</span>\");
						
						    //load the view and the layout
					       \$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name.'', \$data);

						    return FALSE;
					     }
					     else
					     {
							//create an array to send to image_lib library to create the thumbnail
							array_push(\$this->upload_info,\$this->upload->data());

							//Save the name of old files to delete
							//array_push(\$files_to_delete, \$data['".$this->model_name."']['\$index']);

							//Initializing the imagelib library to create the thumbnail

							if (in_array(\$index, \$array_thumbnails))
						    {

						    	//thumbnails rules for \$index
						       if (\$index == '".$index."')
						       {
							      \$this->image_lib->initialize(\$this->set_thumbnail_options(\$info_upload, '".$this->controller_name."', '".$index."'));
						       }

						       //create the thumbnail
							if ( ! \$this->image_lib->resize())
							{
								\$data['upload_error'][\$index] = \$this->image_lib->display_errors(\"<span class='error'>\", \"</span>\");

								//load the view and the layout
							\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name.'', \$data);

								return FALSE;
							}
                        }

                     }   
							
					}			
";	
	      				}


	      			break;
	      		}
	      	}
	      }
	      	}
			$data.="
			}
			else
				{
					if (in_array(\$index, \$array_required))
					{
						\$data['upload_error'][\$index] = \"<span class='error'>\".lang('upload_no_file_selected').\"</span>\";

						//load the view and the layout
						\$this->load->view('".$this->customer_folder."/".$this->controller_name."/'.\$stage_name[0].'', \$data);

						return FALSE;
					}
					
					
				}
			}
			/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
			";
}

$data .="
            \$pagenumber  = array();
	        \$page_data   = array();
	        \$file_count  = 0;
	       
	        foreach (\$app_template as \$pageno => \$pages)
		    {
		    	array_push(\$pagenumber,\$pageno);
		    }

            \$pagecount = count(\$pagenumber);

            

            for(\$i=1;\$i<=\$pagecount;\$i++)
		    {
		    	array_push(\$page_data,\$app_template[\$i]);
            }

            
	         	 
                 for(\$ii=0;\$ii<\$pagecount;\$ii++)
                 {
                 	\$widget       = array();
					\$widget_final = array();
                 	\$previous_section = \"\";
                 	\$pgno = \$ii +1;
	         	 foreach(\$page_data[\$ii] as \$section => \$index_array)
	         	 {
	         	 	//\$widget[\$section] = array();
	         	 	\$widget_data = array();
	         	 	unset(\$index_array['dont_use_this_name']);
	         	 	foreach(\$index_array as \$index => \$value)
	         	 	{
	         	 		\$index_name    = str_replace(' ','',\$index);
	         	 		\$sec           = str_replace(' ','',\$section);
	         	 		\$setvalue_name = \"page\".\$pgno.\"_\".\$sec.\"_\".\$index_name;
                        \$tem           = array();
						
						\$wid_get = \$this->construct_form_data_doc_access(\$value,\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name);
						
						\$widget_final = array_merge_recursive(\$widget_final,\$wid_get);
						
	         	 	}
	         	 }

	         	

	         	\$form_data['doc_data']['widget_data']['page'.\$pgno] = \$widget_final;

	         	 
	         	 }";


$data .= "	
			
               \$stagename  = \$this->input->post('stagename',TRUE);  
               \$form_data['stage_name'] = \$stagename;
               \$form_data['stageobj']   = \$stageobj;
              


               \$approval_history = array();
               \$approval_data = array();

                 \$approval_data = array(
                    \"current_stage\" => \$stage_name,
                    \"approval\" => \"true\",
                    \"submitted_by\" => \$username,
                    \"time\" => date('Y-m-d H:i:s'));

               \$approval_history = \$this->".$this->model_name_for_calls."_calls->get_approval_history(\$id);
       
               array_push(\$approval_history,\$approval_data); 

              \$form_data['history'] = \$approval_history;
			  
			  \$stagewise_users = \$this->extract_users_with_stages();
			  
			  \$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->chk_user_new(\$stagewise_users,\$username,\$form_data['stage_name']);
			  
			  if ( \$this->".$this->model_name.")
			  {

		      \$stage_users = \$this->".$this->model_name_for_calls."_calls->fetch_stage_users(\$stagewise_users,\$form_data['stage_name']);

			//find the item to update
			".( ($this->scaffold_model_type == 'phpactiverecord') ? "\$".$this->model_name." = ".$this->model_name_for_calls."::find(\$this->input->post('id', TRUE));": "" )."
			".( ($this->scaffold_model_type == 'activerecord') ? "\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->web_update_attributes(\$id, \$form_data,\$stage_users);" : "\$this->".$this->model_name.'_calls->web_update_attributes($form_data,$stage_users);' )."
			

			// the information has therefore been successfully saved in the db
			".( ($this->scaffold_model_type == 'phpactiverecord') ? "if ( \$".$this->model_name."->is_valid()) ": "if ( \$this->".$this->model_name.") " )."
			{
";
			if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
			{
$data .= "				
				//delete the old images
				foreach (\$files_to_delete as \$index)
				{";
					if ($this->there_is_an_image)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/'.\$index) )
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/'.\$index);
					
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/thumbs/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/img/thumbs/'.\$index);";
					}

					if ($this->there_is_a_file)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index);";
					}
					if ($this->there_is_a_photo)
					{
$data .= "
					if ( is_file(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index) )	
						unlink(UPLOADFOLDER.'public/uploads/".$this->controller_name."/files/'.\$index);";
					}
$data .= "
				}
";
					
			}
$data .= "
                //\$usercollection=\$username.'_web_docs';
		        //\$this->".$this->model_name_for_calls."_calls->processed('".$this->coll_name."',\$id,\$usercollection,\$stage_name);
				\$this->session->set_flashdata('message',lang('docs_sub_success'));
				
			}

			".( ($this->scaffold_model_type == 'phpactiverecord') ? "if ( \$".$this->model_name."->is_invalid()) ": "else" )."
			{
				\$this->session->set_flashdata('message',lang('docs_sub_failed'));
				
			}
			}
			else
			{
			    \$this->session->set_flashdata('message',lang('docs_user_unauthorized'));
			
			}

				redirect('web/index');
	  	} 
	}";
$data .= "

   public function construct_form_data_doc_access(\$value,\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name)
	{
		switch (\$value['type'])
		      		{
		        		case 'text':
		        		case 'textarea':
						case 'number':
						case 'password':
						case 'range':
						if(\$value['key'] == \"TRUE\")
						{
							if(array_key_exists(\"parent\",\$value))
							{
								if(\$value['parent'] == \"retriever\")
								{
									\$check_value = \$_POST[\$setvalue_name];
								}
							}
							else
							{
								\$check_value = set_value(\$setvalue_name);
							}
							
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							if(\$section == \$previous_section)
							{
						        \$tem[\$section] = array(\$index => \$check_value);;
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
							}
							else
							{
								\$widget[\$section] = array(\$index => \$check_value);
							    
							}
							 

							  \$previous_section = \$section;
							}
							  
						}
                        break;
                        
						case 'mobile':
						if(\$value['key'] == \"TRUE\")
						{
							\$check_value = \$_POST[\$setvalue_name.'_mob_num'];
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							    \$country_code = \$_POST[\$setvalue_name.'_country_code'];
							    \$number       = \$_POST[\$setvalue_name.'_mob_num'];
							
								if(\$section == \$previous_section)
								{
								    \$val = array(\$index => array('country_code'=>\$country_code,'mob_num'=>\$number));
									\$tem[\$section] = \$val;
									\$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
									
								}
								else
								{
								    \$val = array('country_code'=>\$country_code,'mob_num'=>\$number);

									\$widget[\$section] = array(
										\$index => \$val
										);
								}
								 
                                \$previous_section = \$section;

							}
							  
						}
						break;
						
                        case 'checkbox' :
                        if(\$value['key'] == \"TRUE\")
						{
							\$check_value = \$_POST['ac_'.\$setvalue_name];
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => \$_POST['ac_'.\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST['ac_'.\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;
							}
							  
						}

                        break;

                        //case 'date':
		        		case 'time':
		        		case 'month':
		        		case 'color':

		        		if(\$value['key'] == \"TRUE\")
						{
							\$check_value = \$_POST[\$setvalue_name];
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST[\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;

							}
							  
						}


		        		break;

		        		case 'MChoice':

		        		if(\$value['key'] == \"TRUE\")
						{
							\$check_value = \$_POST[\$setvalue_name];
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => \$_POST[\$setvalue_name]);
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => \$_POST[\$setvalue_name]
									);
							}
							 

							  \$previous_section = \$section;
							}
							  
						}
		        		break;

		        		case 'select':
		        		case 'selectbd':
		        		case 'radio':
		        		case 'datepicker':
		        		case 'hidden':
						case 'date':

		        		if(\$value['key'] == \"TRUE\")
						{
							\$check_value = set_value(\$setvalue_name);
							if(!is_null(\$check_value) && !empty(\$check_value))
							{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => set_value(\$setvalue_name));
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(
									\$index => set_value(\$setvalue_name)
									);
							}
							 

							  \$previous_section = \$section;
							}
							  
						}
                        break;

                        case 'file':
                        case 'image':
						case 'photo':
                        if(\$value['key'] == \"TRUE\")
						{
							if(\$this->upload_info)
							{
								foreach(\$_FILES as \$file_element_name => \$file_element_data)
								{
									if(\$setvalue_name==\$file_element_name)
								    {
							if(\$section == \$previous_section)
							{
                               \$tem[\$section] =  array(
									\$index => array(
										\"file_client_name\" =>\$this->upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$this->upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$this->upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$this->upload_info[\$file_count]['file_size'])
									);
							       \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
					        }
					        else
					        {
					          \$widget[\$section] = array(
									\$index => array(
										\"file_client_name\" =>\$this->upload_info[\$file_count]['client_name'],
										\"file_encrypted_name\" =>\$this->upload_info[\$file_count]['file_name'],
										\"file_path\" =>\$this->upload_info[\$file_count]['file_relative_path'],
										\"file_size\" =>\$this->upload_info[\$file_count]['file_size'])
									);


					        }

					        \$previous_section = \$section;
					        \$file_count++;
					    }
					    }
					}
				}
					    
                        break;
						
						case 'retriever':
						\$wi_dget = array();
						\$wi_dget = \$this->construct_form_data_doc_access(\$value['properties'],\$section,\$previous_section,\$tem,\$index,\$widget,\$setvalue_name);
						\$widget = array_merge(\$widget,\$wi_dget);
						break;
						
						case 'mapper':
						if(\$value['properties']['key'] == \"TRUE\")
						{
							if(\$section == \$previous_section)
							{
								
							    \$tem[\$section] = array(\$index => array(\"field_ref\"=>\$value['field_ref']));
							    \$widget[\$section] = array_merge(\$widget[\$section],\$tem[\$section]);
								
							}
							else
							{

								\$widget[\$section] = array(\$index => array(\"field_ref\"=>\$value['field_ref']));
							}
							 

							  \$previous_section = \$section;
							  
						}
						break;
					}
					
					return \$widget;
	}

function get_pre()
	{
		\$stage = \$this->".$this->model_name_for_calls."_calls->get_per();
		\$this->session->set_flashdata(\$stage);
	}


    // ------------------------------------------------------------------------

	/**
	 * Helper: listing previous stages for disapprove feature (for web stage)
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function list_previous_stages_for_disapprove(\$doc_id)
	{
		\$disapprove = array();

		\$approval_history = \$this->".$this->model_name_for_calls."_calls->get_approval_history(\$doc_id);
		foreach(\$approval_history as \$history)
		{
           array_push(\$disapprove,\$history);
		}

		 \$this->output->set_output(json_encode(\$disapprove));
	}
	
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: get previous stages for disapprove feature by using the finished stage name (Dropped)
	 *
	 * @return array
	 *  
	 * @author Selva (Dropped by Selva, May be re-used)
	 */

    function get_previous_stages_for_disapprove(\$data,\$doc_id)
    {
      \$finished_stage = array();
      \$finished_stage =\$this->".$this->model_name_for_calls."_calls->get_finished_stage_name(\$doc_id);
      \$key = array_search(\$finished_stage,\$data);
      if(\$key)
      {
      return array_slice(\$data,0,\$key);
      }
      else
      {
      	return array(\$data[0]);
      }
    }

    // ------------------------------------------------------------------------

	/**
	 * Helper: listing previous stages for disapprove feature (Dropped)
	 *
	 * @return array
	 *  
	 * @author Selva (Dropped by Selva, May be re-used)
	 */

	function list_previous_stages_for_disapprove_old(\$doc_id)
	{
		\$allstages            = array();
		\$perstagedata         = array();
		\$workflow_type        = array();
		\$singlestagedata      = array();
		\$parallelstagedata    = array();
		\$conditionalstagedata = array();
		\$disapprovedata       = array();

		\$workflow_with_id = \$this->".$this->model_name_for_calls."_calls->get_workflow();


         foreach(\$workflow_with_id as \$workflow_data)
         {
            \$workflow = \$workflow_data['workflow'];
         }

         foreach (\$workflow as \$stagename => \$stagedata)
         {
        	array_push(\$allstages,\$stagename);
	        array_push(\$perstagedata,\$stagedata);

         }	

         \$count = count(\$perstagedata);

         for (\$i = 0; \$i < \$count; \$i++)
	     {
	        array_push(\$workflow_type,\$perstagedata[\$i]['Workflow_Type']);
            if(\$workflow_type[\$i] == 'single')
        	{
                \$singlestagedata = \$this->single_stage_for_disapprove_listing(\$allstages[\$i]);
                 array_push(\$disapprovedata,\$singlestagedata);
        	}
        	elseif(\$workflow_type[\$i] == 'parallel')
        	{
        		\$arrayPar = \$perstagedata[\$i];
        		unset(\$arrayPar['Workflow_Type']);
                \$parallelstagedata = \$this->parallel_stage_for_disapprove_listing(\$arrayPar);
                \$disapprovedata = array_merge(\$disapprovedata,\$parallelstagedata);
        	}
        	elseif(\$workflow_type[\$i] == 'conditional')
        	{
        		\$arrayCon = \$perstagedata[\$i];
                \$conditionalstagedata = \$this->conditional_stage_for_disapprove_listing(\$arrayCon);
                \$disapprovedata = array_merge(\$disapprovedata,\$conditionalstagedata);
        	}	

        }

        \$disapprove = \$this->get_previous_stages_for_disapprove(\$disapprovedata,\$doc_id);
        \$this->output->set_output(json_encode(\$disapprove));

	 }


     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: single stage processing in listing previous stages for disapprove feature (Dropped)
	 *
	 * @return string
	 *  
	 * @author Selva (Dropped by Selva, May be re-used)
	 */

	 function single_stage_for_disapprove_listing(\$stagename)
	 {
        return \$stagename;
     }


     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: parallel stage processing in listing previous stages for disapprove feature (Dropped)
	 *
	 * @return array
	 *  
	 * @author Selva (Dropped by Selva, May be re-used)
	 */

	 function parallel_stage_for_disapprove_listing(\$arrayPar)
	 {

	 	\$branchs              = array();
	 	\$parallelbranches     = array();
	 	\$parallelperstagedata = array();
	 	\$parallelbranchwtype  = array();
	 	\$parallelstagedata    = array();

	 	foreach(\$arrayPar as \$paral => \$para)
	    {
	      array_push(\$branchs,\$paral);
	    }

	    foreach (\$branchs as \$perbranch)
	    {

            \$parallelstagenames   = array();

	      if(isset(\$parallelperstagedata))
	      {
	         array_shift(\$parallelperstagedata);
	      }
	      if(isset(\$parallelbranches))
	      {
	         array_shift(\$parallelbranches);
	      }


	      foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
	      {
	         array_push(\$parallelbranches,\$branchname);
	         array_push(\$parallelperstagedata,\$branch);
	      }

           \$parallelstagecount = count(\$parallelperstagedata);

	      for(\$kk=0;\$kk<\$parallelstagecount;\$kk++)
	      {
	         array_push(\$parallelbranchwtype,\$parallelperstagedata[\$kk]['Workflow_Type']);
	         if(\$parallelbranchwtype[\$kk]==\"single\")
	         {
	
	            if(isset(\$parallelperstagedata[\$kk-1]))
	            {
	              unset(\$parallelperstagedata[\$kk-1]);
	            }
	
	            if(isset(\$parallelstagenames[\$kk-1]))
	            {
	              unset(\$parallelstagenames[\$kk-1]);
	            }

	            
	           foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
	           {
	             if(\$branch['Workflow_Type']==\"single\")
	             {
	               array_push(\$parallelstagenames,\$branchname);
	             }
	            }
	            
	             \$singlestagedata = \$this->single_stage_for_disapprove_listing(\$parallelstagenames[\$kk]); 
                 array_push(\$parallelstagedata,\$singlestagedata);

                 
	         }

	         if(\$parallelbranchwtype[\$kk]==\"parallel\")
	         {
	         	\$arrayParnew = \$parallelperstagedata[\$kk];
	            unset(\$arrayParnew['Workflow_Type']);
	            \$this->parallel_stage_for_disapprove_listing(\$arrayParnew);

	         }

	         if(\$parallelbranchwtype[\$kk]==\"conditional\")
	         {
	         	\$arrayCon = \$parallelperstagedata[\$kk];
	         	\$this->conditional_stage_for_disapprove_listing(\$arrayCon);

	         }
	      } 
	      
	    }  

         return \$parallelstagedata;	

     }



     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: conditional stage processing in listing previous stages for disapprove feature (Dropped)
	 *
	 * @return array
	 *  
	 * @author Selva (Dropped by Selva, May be re-used)
	 */

	 function conditional_stage_for_disapprove_listing(\$arrayCon)
	 {

	 	\$arrayPar                           = array();
	    \$approveddata                       = array();
	    \$disapproveddata                    = array();
	    \$conditionalperstagedata            = array();
	    \$conditionalapprovedwtype           = array();
		\$conditionaldisapprovedwtype        = array();
		\$conditionaldisapprovedperstagedata = array();
		\$conditionalperstagedata            = array();
		\$approvedstagenames                 = array();
		\$disapprovedstagenames              = array();
		\$conditionalapprovedstagedata       = array();
		\$conditionaldisapprovedstagedata    = array();
		\$conditionalstagedata               = array();
		\$approvedstage                      = array();
		\$disapprovedstage                   = array();
	
		array_push(\$approvedstage,\$arrayCon['approved']);
		array_push(\$disapprovedstage,\$arrayCon['disapproved']);
	
	
	//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
	
		foreach(\$approvedstage as \$worktemplate => \$temp)
		{
		  foreach(\$temp as \$stagename => \$t)
		  {
		     array_push(\$conditionalperstagedata,\$t);
		  }
		}
		
		\$conditionalperstagedatacount = count(\$conditionalperstagedata);
		for(\$ii = 0;\$ii < \$conditionalperstagedatacount; \$ii++)
		{
		  array_push(\$conditionalapprovedwtype,\$conditionalperstagedata[\$ii]['Workflow_Type']);
		  if(\$conditionalapprovedwtype[\$ii]==\"single\")
		  {
		  	foreach(\$approvedstage as \$worktemplate => \$temp){
	            foreach(\$temp as \$stagename => \$t){
	               if(\$t['Workflow_Type']==\"single\")
	                {
	                   array_push(\$approvedstagenames,\$stagename);
	                }
	             }
	         }	

		    \$approveddata = \$this->single_stage_for_disapprove_listing(\$approvedstagenames[\$ii]);
		    array_push(\$conditionalstagedata,\$approveddata);
		 }
		if(\$conditionalapprovedwtype[\$ii]==\"parallel\")
		{
		\$arrayPar = \$conditionalperstagedata[\$ii];
		unset(\$arrayPar['Workflow_Type']);
		\$this->parallel_stage_for_disapprove_listing(\$arrayPar);
		}
		if(\$conditionalapprovedwtype[\$ii]==\"conditional\")
		{
		\$arrayConnew = \$conditionalperstagedata[\$ii];
		\$this->conditional_stage_for_disapprove_listing(\$arrayConnew);
		
		}
		}
		
	//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//
		foreach(\$disapprovedstage as \$worktemplate => \$temp){
		foreach(\$temp as \$stagename => \$t){
		array_push(\$conditionaldisapprovedperstagedata,\$t);
		}
		}
		
		\$conditionaldisapprovedstagescount = count(\$conditionaldisapprovedperstagedata);
		for(\$jj = 0;\$jj < \$conditionaldisapprovedstagescount; \$jj++)
		{
		array_push(\$conditionaldisapprovedwtype,\$conditionaldisapprovedperstagedata[\$jj]['Workflow_Type']);
		if(\$conditionaldisapprovedwtype[\$jj]==\"single\")
		{
			foreach(\$disapprovedstage as \$worktemplate => \$temp){
	           foreach(\$temp as \$stagename => \$t){
	          if(\$t['Workflow_Type']==\"single\")
	         {
	              array_push(\$disapprovedstagenames,\$stagename);
	          }
	          }
	          }
		\$disapproveddata = \$this->single_stage_for_disapprove_listing(\$disapprovedstagenames[\$jj]);
		array_push(\$conditionalstagedata,\$disapproveddata);
		}
		if(\$conditionaldisapprovedwtype[\$jj]==\"parallel\")
		{
		\$arrayPar = \$conditionaldisapprovedperstagedata[\$jj];
		unset(\$arrayPar['Workflow_Type']);
		\$this->parallel_stage_for_disapprove_listing(\$arrayPar);
		}
		if(\$conditionaldisapprovedwtype[\$jj]==\"conditional\")
		{
		\$arrayConnew = \$conditionaldisapprovedperstagedata[\$jj];
		\$this->conditional_stage_for_disapprove_listing(\$arrayConnew);
		}
            	
      }

       return \$conditionalstagedata;
     }


      // ---------------------------------------------------------------------------------------

	/**
	 * Helper: disapprove from web stage
	 *
	 * @return boolean
	 *  
	 * @author Vikas (Modified by Selva) 
	 */

	 function web_disapprove()
	 {
        \$approval_history = array();

		 //POST DATA
        \$redirected_stage   = \$this->input->post('redirected_stage',TRUE);
		\$current_stage      = \$this->input->post('current_stage',TRUE);
        \$user  			 = \$this->input->post('user',TRUE);
        \$doc_id 			 = \$this->input->post('docid',TRUE);
		\$reason             = \$this->input->post('reason',TRUE);
		\$notification_param = json_decode(base64_decode(\$this->input->post('notification_param',TRUE)));
        
        \$redirected_stage = str_replace(\"#\",\" \",\$redirected_stage);
		\$current_stage    = str_replace(\"#\",\" \",\$current_stage);
        

        \$userdetails = \$this->ion_auth->user()->row();
        \$disapproving_user = str_replace('@','#',\$userdetails->email);
        \$usercollection=\$disapproving_user.'_web_docs';
	    \$doc_collection = \$this->".$this->model_name_for_calls."_calls->get_stage_for_doc_access('".$this->coll_name."',\$usercollection,\$doc_id);
        \$stage_name = \$doc_collection['stg_name'];

		\$approval_data = array(
				 \"current_stage\"    => \$stage_name,
                 \"approval\"         => \"false\",
                 \"disapproved_by\"   => \$disapproving_user,
                 \"time\"             => date('Y-m-d H:i:s'),
                 \"reason\"           => \$reason,
                 \"redirected_stage\" => \$redirected_stage,
                 \"redirected_user\"  => \$user);

		 \$approval_history = \$this->".$this->model_name_for_calls."_calls->get_approval_history(\$doc_id);

		 array_push(\$approval_history,\$approval_data);
			
		\$stage_type = \$this->get_stage_type_by_stagename_for_disapprove(\$redirected_stage);

		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->web_disapprove(\$doc_id,\$approval_history,\$user,\$redirected_stage,\$disapproving_user,\$stage_type[0],\$current_stage,\$notification_param,\$reason);
	
		if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
		{
			\$this->session->set_flashdata('message',lang('web_disapprover_success'));
		}
		else
		{
			\$this->session->set_flashdata('message',lang('web_disapprover_failed'));
		}
	
	        redirect('web/index');
        }


    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: disapprove from device stage
	 *
	 * @return boolean
	 *  
	 * @author Selva 
	 */

	 function device_disapprove()
	 {

	 	// Get the data
	 	\$imageData = file_get_contents(\"php://input\");

		if (isset(\$imageData))
		{
			// Remove the headers (data:,) part.
			// A real application should use them according to needs such as to check image type
			\$filteredData=substr(\$imageData, strpos(\$imageData, ',')+1);
	
			\$this->_page_data = \$filteredData;
			// Need to decode before saving since the data we received is already base64 encoded
			\$unencodedData=base64_decode(\$filteredData);
	
			//echo 'unencodedData'.\$unencodedData;
	
			// Save file. This example uses a hard coded filename for testing,
			// but a real application can specify filename in POST variable
	
			//Seprating image data
			\$imgData=substr(\$imageData, 0, strpos(\$imageData, '&')-1);
	
			\$disapproved_data = json_decode(\$imageData, TRUE);

			\$approval_data = array(
				\"current_stage\" => \$disapproved_data['current_stage'],
                 \"approval\" => \"false\",
                 \"disapproved_by\" => \$disapproved_data['username'],
                 \"time\" => date('Y-m-d H:i:s'),
                 \"reason\" => \$disapproved_data['reason'],
                 \"redirected_stage\" => \$disapproved_data['redirected_stage'],
                 \"redirected_user\" => \$disapproved_data['redirected_user']
                 );

           \$approval_history = array();

		   \$approval_history = \$this->".$this->model_name_for_calls."_calls->get_approval_history(\$disapproved_data['doc_id']);

           array_push(\$approval_history,\$approval_data);

           \$stage_type = \$this->get_stage_type_by_stagename_for_disapprove(\$disapproved_data['redirected_stage']);
			
			
		\$this->".$this->model_name." = \$this->".$this->model_name_for_calls."_calls->device_disapprove(\$disapproved_data['doc_id'],\$approval_history,\$disapproved_data['redirected_user'],\$disapproved_data['redirected_stage'],\$disapproved_data['username'],\$stage_type[0],\$disapproved_data['reason'],\$disapproved_data['notification_param'],\$disapproved_data['current_stage']);

	}
	
		if ( \$this->".$this->model_name." ) // the information has therefore been successfully saved in the db
		{
			echo 'Disapproval successfull';
		}
		else
		{
			echo 'Disapproval Failed';
		}

	 }


	 // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Extract the users list by given stage name for disapprove feature
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function get_stage_type_by_stagename_for_disapprove(\$stage)
    {
    	\$allstages              = array();
		\$perstagedata           = array();
		\$workflow_type          = array();
		\$stagetype              = array();
		\$singlestagetype        = array();
		\$parallelstagetype      = array();
		\$conditionalstagetype   = array();
		
        \$workflow_with_id = \$this->".$this->model_name_for_calls."_calls->get_workflow();


         foreach(\$workflow_with_id as \$workflow_data)
         {
            \$workflow = \$workflow_data['workflow'];
         }

         foreach (\$workflow as \$stagename => \$stagedata)
         {
        	array_push(\$allstages,\$stagename);
	        array_push(\$perstagedata,\$stagedata);

         }	

         \$count = count(\$perstagedata);

         for (\$i = 0; \$i < \$count; \$i++)
	     {
	        array_push(\$workflow_type,\$perstagedata[\$i]['Workflow_Type']);
            if(\$workflow_type[\$i] == 'single')
        	{
                \$singlestagetype = \$this->check_single_stage_for_stage_type(\$stage,\$allstages[\$i],\$perstagedata[\$i]);
                if(\$singlestagetype)
                {
                  \$stagetype = array_merge(\$stagetype,\$singlestagetype); 
	            }
        	}
        	elseif(\$workflow_type[\$i] == 'parallel')
        	{
        		\$arrayPar = \$perstagedata[\$i];
        		unset(\$arrayPar['Workflow_Type']);
                \$parallelstagetype = \$this->check_parallel_stage_for_stage_type(\$stage,\$arrayPar);
                if(\$parallelstagetype)
                {
                  \$stagetype = array_merge(\$stagetype,\$parallelstagetype);
                }
        	}
        	elseif(\$workflow_type[\$i] == 'conditional')
        	{
        		\$arrayCon = \$perstagedata[\$i];
                \$conditionalstagetype = \$this->check_conditional_stage_for_stage_type(\$stage,\$arrayCon);
                if(\$conditionalstagetype)
                {
                  \$stagetype = array_merge(\$stagetype,\$conditionalstagetype);
                }
        	}	

        }

         return \$stagetype;

    }

    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: check the single stage for the stage type and return stage type if stagename match
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function check_single_stage_for_stage_type(\$stage,\$stagename,\$perstagedata)
    {
    	\$stagetype = array();

        if(\$stage === \$stagename)
    	{
            array_push(\$stagetype,\$perstagedata['Stage_Type']);
            return \$stagetype;
    	}

    }

    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: check the parallel stage for the stage type (for disapprove feature)
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function check_parallel_stage_for_stage_type(\$stage,\$arrayPar)
	{

		\$stagetype             = array();
        \$arrayCon              = array();
        \$branchs               = array();
        \$parallelperstagedata  = array();
        \$parallelbranches      = array();
        \$parallelbranchwtype   = array();
        \$parallelstagedata     = array();
        \$parallelstagedatauser = array();

        foreach(\$arrayPar as \$paral => \$para)
        {
           array_push(\$branchs,\$paral);
        }
            
        foreach (\$branchs as \$perbranch)
        {
           \$parallelstagenames = array();
                
           if(isset(\$parallelperstagedata)) 
           { 
                array_shift(\$parallelperstagedata);
           }
           if(isset(\$parallelbranches)) 
           { 
                array_shift(\$parallelbranches);
           }

           foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
           {
               array_push(\$parallelbranches,\$branchname);
               array_push(\$parallelperstagedata,\$branch);
           }
                
          \$parallelstagecount = count(\$parallelperstagedata);
                
                for(\$kk=0;\$kk<\$parallelstagecount;\$kk++)
                {
                    array_push(\$parallelbranchwtype,\$parallelperstagedata[\$kk]['Workflow_Type']);
                    if(\$parallelbranchwtype[\$kk]==\"single\")
                    {
                    	
                    	if(isset(\$parallelperstagedata[\$kk-1])) 
                    		{ 
                    			unset(\$parallelperstagedata[\$kk-1]);
                    		 }

                    		 if(isset(\$parallelstagenames[\$kk-1])) 
                    		{ 
                    			unset(\$parallelstagenames[\$kk-1]);
                    		 }
                    	foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch){
                         if(\$branch['Workflow_Type']==\"single\")
                            {
               	                array_push(\$parallelstagenames,\$branchname);
                             }
                         }
                         
                         \$parallelstagedatastage = \$this->check_single_stage_for_stage_type(\$stage,\$parallelstagenames[\$kk],\$parallelperstagedata[\$kk]);
                         if(\$parallelstagedatastage)
                         {
                          array_push(\$stagetype,\$parallelstagedatastage);
                         } 

                     
                    }
                    if(\$parallelbranchwtype[\$kk]==\"parallel\")
                    {
                        \$arrayParnew = \$parallelperstagedata[\$kk];
                         unset(\$arrayParnew['Workflow_Type']);
                        \$this->check_parallel_stage_for_stage_type(\$stage,\$arrayParnew);
                    }
                    if(\$parallelbranchwtype[\$kk]==\"conditional\")
                    {
                       \$arrayCon = \$parallelperstagedata[\$kk];
                       \$this->check_conditional_stage_for_stage_type(\$stage,\$arrayCon);
                        
                    }
                }
       
}
             return \$stagetype;
    




	}


	// ---------------------------------------------------------------------------------------

	/**
	 * Helper: check the conditional stage for the stage type (for disapprove feature)
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	 function check_conditional_stage_for_stage_type(\$stage,\$arrayCon)
	 {

          \$arrayPar                           = array();
          \$approvedstage                      = array();
          \$disapprovedstage                   = array();
          \$conditionalperstagedata            = array();
          \$conditionalapprovedwtype           = array();
          \$conditionaldisapprovedwtype        = array();
          \$conditionaldisapprovedperstagedata = array();
          \$conditionalperstagedata            = array();
          \$approvedstagenames                 = array();
          \$disapprovedstagenames              = array();
          \$stagetype                          = array();
          \$approvedstagetype                  = array();
          \$disapprovedstagetype               = array();
          \$conditionalapprovedstagedata       = array();
          \$conditionaldisapprovedstagedata    = array();

          array_push(\$approvedstage,\$arrayCon['approved']);
          array_push(\$disapprovedstage,\$arrayCon['disapproved']);

//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
            
             
            foreach(\$approvedstage as \$worktemplate => \$temp){
            	
                foreach(\$temp as \$stagename => \$t){
                       array_push(\$conditionalperstagedata,\$t);
         }
        }
        
         \$conditionalperstagedatacount = count(\$conditionalperstagedata);
         for(\$ii = 0;\$ii < \$conditionalperstagedatacount; \$ii++)
         {
            array_push(\$conditionalapprovedwtype,\$conditionalperstagedata[\$ii]['Workflow_Type']);
             if(\$conditionalapprovedwtype[\$ii]==\"single\")
              {
              	foreach(\$approvedstage as \$worktemplate => \$temp){
                  foreach(\$temp as \$stagename => \$t){
                      if(\$t['Workflow_Type']==\"single\")
                      {
                      	array_push(\$approvedstagenames,\$stagename);
                      }
                   }
                  }
                  \$approvedstagetype = \$this->check_single_stage_for_stage_type(\$stage,\$approvedstagenames[\$ii],\$conditionalperstagedata[\$ii]);
                  if(\$approvedstagetype)
                  {
                    array_push(\$stagetype,\$approvedstagetype);
                  }
              }
              if(\$conditionalapprovedwtype[\$ii]==\"parallel\")
               {
                   \$arrayPar = \$conditionalperstagedata[\$ii];
                   unset(\$arrayPar['Workflow_Type']);
                   \$this->check_parallel_stage_for_stage_type(\$stage,\$arrayPar);
                }
              if(\$conditionalapprovedwtype[\$ii]==\"conditional\")
                {
                    \$arrayConnew = \$conditionalperstagedata[\$ii];
                    \$this->check_conditional_stage_for_stage_type(\$stage,\$arrayConnew);
                        
                }
         }
             
//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//      
       
         foreach(\$disapprovedstage as \$worktemplate => \$temp){
               foreach(\$temp as \$stagename => \$t){
                    array_push(\$conditionaldisapprovedperstagedata,\$t);
            }
         }
          
          \$conditionaldisapprovedstagescount = count(\$conditionaldisapprovedperstagedata);
         for(\$jj = 0;\$jj < \$conditionaldisapprovedstagescount; \$jj++)
         {
         
           array_push(\$conditionaldisapprovedwtype,\$conditionaldisapprovedperstagedata[\$jj]['Workflow_Type']);
                    if(\$conditionaldisapprovedwtype[\$jj]==\"single\")
                    {
                      foreach(\$disapprovedstage as \$worktemplate => \$temp){
                        foreach(\$temp as \$stagename => \$t){
                      if(\$t['Workflow_Type']==\"single\")
                      {
                      	array_push(\$disapprovedstagenames,\$stagename);
                      }
                   }
                  } 	
                      \$disapprovedstagetype = \$this->check_single_stage_for_stage_type(\$stage,\$disapprovedstagenames[\$jj],\$conditionaldisapprovedperstagedata[\$jj]);
                       if(\$disapprovedstagetype)
                       {
                        array_push(\$stagetype,\$disapprovedstagetype);
                       }
                    }
                    if(\$conditionaldisapprovedwtype[\$jj]==\"parallel\")
                    {
                      \$arrayPar = \$conditionaldisapprovedperstagedata[\$jj];
                       unset(\$arrayPar['Workflow_Type']);
                       \$this->check_parallel_stage_for_stage_type(\$stage,\$arrayPar);  
                        
                    }
                    if(\$conditionaldisapprovedwtype[\$jj]==\"conditional\")
                    {
                  
                       \$arrayConnew = \$conditionaldisapprovedperstagedata[\$jj];
                       \$this->check_conditional_stage_for_stage_type(\$stage,\$arrayConnew);
                    }
                          

        }
        
         return \$stagetype;
        } 




	function get_all(\$doc_id = FALSE)
{
		\$workflow = \$this->".$this->model_name_for_calls."_calls->get_all();
		
		\$user_obj = \$this->ion_auth->user()->row();
		\$user_array = json_decode(json_encode(\$user_obj),true);
		\$workdata['username'] = \$user_array['email'];
		
		\$workdata['all'] = array();
	
		\$workdata['full'] = \$workflow;
		
		foreach (\$workflow as \$stages => \$stage){
			
			if(\$stage['Workflow_Type'] == 'single'){
				
			\$user = \$stage['UsersList'];
			array_push(\$workdata['all'], \$stages);
			foreach ( \$user as \$ur){
				\$email = str_replace(\"#\", \"@\", \$ur);
				\$workdata['vitals'][\$stages][\$ur] = \$this->".$this->model_name_for_calls."_calls->user_vitals(\$email);
			}
		  }else if(\$stage['Workflow_Type'] == 'conditional'){
		  	\$app_array = \$stage['approved'];
		  	\$dis_array = \$stage['disapproved'];
		  	
		  	foreach (\$app_array as \$stages => \$stage){
		  	array_push(\$workdata['all'], \$stages);
		  	\$user = \$stage['UsersList'];
		  	foreach ( \$user as \$ur){
		  		\$email = str_replace(\"#\", \"@\", \$ur);
		  		\$workdata['vitals'][\$stages][\$ur] = \$this->".$this->model_name_for_calls."_calls->user_vitals(\$email);
		  	}
		  	}
		  	
		  	foreach (\$dis_array as \$stages => \$stage){
		  		array_push(\$workdata['all'], \$stages);
		  		\$user = \$stage['UsersList'];
		  		foreach ( \$user as \$ur){
		  			\$email = str_replace(\"#\", \"@\", \$ur);
		  			\$workdata['vitals'][\$stages][\$ur] = \$this->".$this->model_name_for_calls."_calls->user_vitals(\$email);
		  		}
		  	}
		  	
		  }else if(\$stage['Workflow_Type'] == 'parallel'){
		  	\$par_array = \$stage;
		  	unset(\$par_array['Workflow_Type']);
		  	foreach (\$par_array as \$branch){
		  		foreach (\$branch as  \$stages => \$stage){
		  		array_push(\$workdata['all'], \$stages);
		  		\$user = \$stage['UsersList'];
		  		foreach ( \$user as \$ur){
		  			\$email = str_replace(\"#\", \"@\", \$ur);
		  			\$workdata['vitals'][\$stages][\$ur] = \$this->".$this->model_name_for_calls."_calls->user_vitals(\$email);
		  		}
		  	  }
		  	}
		  }
		}
		
		if(\$doc_id != FALSE){
			\$document = \$this->".$this->model_name_for_calls."_calls->find('doc_id',\$doc_id);
			if(\$document['stage_name'] ==  '".$this->coll_name."')
			{
				\$workdata['match'] = \$workdata['all'][0];
			}else{
			\$workdata['match'] = \$document['stage_name'];
			}
		}else{
			\$workdata['match'] = \$workdata['all'][0];
		}
		\$this->output->set_output(json_encode(\$workdata));
	}

	
	function get_widget(\$id = FALSE)
	{
		\$widgets = \$this->".$this->model_name_for_calls."_calls->get_widget();
	
		\$this->output->set_output(json_encode(\$widgets));
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Insert graph values from web stage
	 *
	 *  
	 * @author Selva 
	 */
	 
	function insert_graph_values()
	{
	   \$final_values    = array();
	   \$temp_graph_data = array();
	   \$new_graph_data  = array();
	   
	   //POST DATA
       \$doc_id     = \$this->input->post('docid',TRUE);
	   \$graph_type = \$this->input->post('graph_type',TRUE);
	   \$birth_date = \$this->input->post('birth_date',TRUE);
       \$x_axis_en  = \$this->input->post('x_axis',TRUE);
	   \$y_axis_en  = \$this->input->post('y_axis',TRUE);
	   \$values_en  = \$this->input->post('values',TRUE);
	    
	   \$x_axis_decoded = base64_decode(\$x_axis_en);
	   \$x_axis         = json_decode(\$x_axis_decoded,true);
	   
	   \$y_axis_decoded = base64_decode(\$y_axis_en);
	   \$y_axis         = json_decode(\$y_axis_decoded,true);

       \$values_decoded = base64_decode(\$values_en);
	   \$values         = json_decode(\$values_decoded,true);
	   
	   \$graph_raw_data = \$this->".$this->model_name_for_calls."_calls->fetch_graph_values_model(\$doc_id);
	   
	   foreach(\$graph_raw_data as \$data)
	   {
		 if(isset(\$data['doc_data']['graph_data'])&& is_array(\$data['doc_data']['graph_data']) && !empty(\$data['doc_data']['graph_data']))
		 {
		     \$graph_data = \$data['doc_data']['graph_data']; 
	   
		     \$new_data['graph_type'] = \$graph_type;
			 \$new_data['date_birth'] = \$birth_date;
		     \$new_data['x_axis']     = \$x_axis;
		     \$new_data['y_axis']     = \$y_axis;
		     \$new_data['values']     = \$values;
	
	         array_push(\$temp_graph_data,\$new_data);
	         \$new_graph_data = array_merge(\$temp_graph_data,\$graph_data);
	     }
		 else
		 { 
		    \$new_data['graph_type'] = \$graph_type;
			\$new_data['date_birth'] = \$birth_date;
			\$new_data['x_axis']     = \$x_axis;
			\$new_data['y_axis']     = \$y_axis;
			\$new_data['values']     = \$values;
			
			array_push(\$new_graph_data,\$new_data);
		 }
	   }
	   \$this->".$this->model_name_for_calls."_calls->update_graph_values_model(\$doc_id,\$new_graph_data);
	   
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Update graph values from web stage
	 *
	 *  
	 * @author Selva 
	 */
	 
	function update_graph_values()
	{
	   \$final_values        = array();
	   \$updated_graph_data  = array();
	   \$temp_graph_data     = array();
	   \$new_graph_data      = array();
	   
	   //POST DATA
       \$doc_id     	= \$this->input->post('docid',TRUE);
	   \$graph_type 	= \$this->input->post('graph_type',TRUE);
	   \$values_encoded = \$this->input->post('values',TRUE);
	   \$measure_date   = \$this->input->post('measure_date',TRUE);
	   
	   \$values_decoded = base64_decode(\$values_encoded);
	   \$values         = json_decode(\$values_decoded,true);
	   \$today = Date('Y-m-d');
	   
	   \$graph_raw_data = \$this->".$this->model_name_for_calls."_calls->fetch_graph_values_model(\$doc_id);
	   
	   foreach(\$graph_raw_data as \$data)
	   {
		 if(isset(\$data['doc_data']['graph_data'])&& is_array(\$data['doc_data']['graph_data']) && !empty(\$data['doc_data']['graph_data']))
		 {
		    \$graph_data = \$data['doc_data']['graph_data']; 
			 
			foreach(\$graph_data as \$g_index => \$g_data)
		    {
			   \$graph_type_from_doc = \$g_data['graph_type'];
				
			   if(\$graph_type_from_doc == \$graph_type)
			   {
			      if(\$today==\$measure_date)
				  {
				      array_shift(\$g_data['values']['current_axis_val']);
					  \$final_values = array_merge_recursive(\$g_data['values']['current_axis_val'],\$values['current_axis_val']);
					  \$g_data['values']['current_axis_val'] = \$final_values;
					  array_push(\$updated_graph_data,\$g_data);
					  unset(\$graph_data[\$g_index]);
					  \$new_graph_data = array_merge_recursive(\$graph_data,\$updated_graph_data);
				  }
				  else
				  {
				     \$final_values = array_merge_recursive(\$g_data['values']['current_axis_val'],\$values['current_axis_val']);
				    \$g_data['values']['current_axis_val'] = \$final_values;
				     array_push(\$updated_graph_data,\$g_data);
				     unset(\$graph_data[\$g_index]);
				     \$new_graph_data =  array_merge_recursive(\$graph_data,\$updated_graph_data);
				  
				  }
			   }
				
			}
		  }
	   }
	   
	   \$this->".$this->model_name_for_calls."_calls->update_graph_values_model(\$doc_id,\$new_graph_data);	   
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Fetch graph values to plot graph
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	function fetch_graph_values()
	{
	   //POST DATA
       \$doc_id     = \$this->input->post('docid',TRUE);
	   \$graph_type = \$this->input->post('graph_type',TRUE);
	   \$graph_raw_data = \$this->".$this->model_name_for_calls."_calls->fetch_graph_values_model(\$doc_id);
	   foreach(\$graph_raw_data as \$data)
	   {
	     \$graph_data = \$data['doc_data']['graph_data']; 
		 if(isset(\$graph_data) && is_array(\$graph_data))
		 {
		   foreach(\$graph_data as \$data)
		   {
		     if(isset(\$data['graph_type']) && !empty(\$data['graph_type']))
			 {
				 \$graph_type_from_doc = \$data['graph_type']; 
				 if(\$graph_type_from_doc == \$graph_type)
				 {
				   \$this->output->set_output(json_encode(\$data));
				 }
		     }
	       }
	   
	     }
		 else
		 {
		   \$this->output->set_output('');
		 }
	   }
	   
	 }

	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: search from web stage
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function web_search()
	{
	  // POST DATA
	  \$page_number = \$this->input->post('page_number'); 
	  \$pre_field   = \$this->input->post('field');
	  \$value       = \$this->input->post('value');
	  \$field_type  = \$this->input->post('type');
	  \$post_field  = str_replace(\"#\",' ',\$pre_field);
		
	  \$field = \"doc_data.\".\"widget_data.\".\$post_field;
	  \$limit = 10;
	
	  \$docs = \$this->".$this->model_name_for_calls."_calls->web_search(\$page_number,\$limit,\$field,\$value,\$field_type);
	  \$this->output->set_output(json_encode(\$docs));
	}

    function search_device()
	{
		\$postdata = file_get_contents('php://input');
		
	    \$data 	     = json_decode(\$postdata);
		\$field 	 = \$data->field;
		\$value 	 = \$data->value;
		\$field_type = \$data->type;
		
        if(\$field_type==\"mobile\")
		{
		   \$field = \$field.\".mob_num\";
		}
		
		\$search_field = \"doc_data.\".\"widget_data.\".\$field;
		\$data = \$this->".$this->model_name_for_calls."_calls->find_device(\$search_field,\$value);
		
	
		\$str_data = json_encode(\$data);
		
		\$this->output
						->set_header(\"HTTP/1.0 200 OK\")
						->set_content_type('application/json')
						->set_output(\$str_data);
			
	}

	function web_history(\$limit, \$offset, \$operation,\$from,\$to)
	{

        //search the item to show in edit form
		\$data = \$this->".$this->model_name_for_calls."_calls->web_history(\$limit,\$offset,\$from,\$to,\$operation);
		
		\$str_data = json_encode(\$data);

		\$this->output->set_output(\$str_data);
	}
	
	function history(\$limit = FALSE, \$offset = FALSE, \$operation)
	{
		\$postdata = file_get_contents('php://input');
		
		\$data      = json_decode(\$postdata);
		\$doc_owner = \$data->company_name;
		
		if (\$operation == 'range')
		{
			\$from = \$data->from;
			\$to = \$data->to;
		}
		else
		{
		    \$from = FALSE;
			\$to = FALSE;
		}
		//search the item to show in edit form
		\$data = \$this->".$this->model_name_for_calls."_calls->history(\$limit,\$offset,\$from,\$to,\$operation,\$doc_owner);
		
		\$str_data = json_encode(\$data);
		
		\$this->output
						->set_header(\"HTTP/1.0 200 OK\")
						->set_content_type('application/json')
						->set_output(\$str_data);
			
	}
	
	private function external_file_attachment_upload_options(\$controller,\$field)
	{
	   \$config = array();

		if (strpos(\$field,'DFF_EXTERENAL_FILE_ATTACHMENT')!== false)
		{
		\$config['upload_path'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/external_files/';
		\$config['allowed_types'] = '*';
		\$config['max_size'] = '4096';
		\$config['encrypt_name'] = TRUE;
		}
			  //create controller upload folder if not exists
		if (!is_dir(\$config['upload_path']))
		{
		mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/external_files/\",0777,TRUE);
		}
		return \$config;
	}
	
	private function template_file_attachment_upload_options(\$controller,\$field)
	{
		\$config = array();
	
		if (strpos(\$field,'TEMPLATE_IMAGE')!== false)
		{
			\$config['upload_path'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/template_files/';
			\$config['allowed_types'] = '*';
			\$config['max_size'] = '4096';
			\$config['encrypt_name'] = TRUE;
		}
		//create controller upload folder if not exists
		if (!is_dir(\$config['upload_path']))
		{
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/template_files/\",0777,TRUE);
		}
	
		return \$config;
	
	}
	
	private function chart_file_attachment_upload_options(\$controller,\$field)
	{
	   \$config = array();

	if (strpos(\$field,'CHART_IMAGE')!== false)
	{
	\$config['upload_path'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/chart_files/';
	\$config['allowed_types'] = '*';
	\$config['max_size'] = '10240';
	\$config['encrypt_name'] = TRUE;
	}
		  //create controller upload folder if not exists
	if (!is_dir(\$config['upload_path']))
	{
	mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/chart_files/\",0777,TRUE);
	}
	return \$config;
	}
	
	private function consent_file_attachment_upload_options(\$controller,\$field)
	{
	   \$config = array();

	if (strpos(\$field,'CONSENT_IMAGE')!== false)
	{
	\$config['upload_path'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/consent_files/';
	\$config['allowed_types'] = '*';
	\$config['max_size'] = '10240';
	\$config['encrypt_name'] = TRUE;
	}
		  //create controller upload folder if not exists
	if (!is_dir(\$config['upload_path']))
	{
	mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/consent_files/\",0777,TRUE);
	}
	return \$config;
	}

";


  $data.="
	private function set_paginate_options(".(($this->there_is_a_relational_field) ? "\$$this->relational_field" : "").")
	{
		\$config = array();
        \$config['base_url'] = URL . '".$this->customer_folder."'.'/'.'".$this->controller_name."".(($this->there_is_a_relational_field) ? "/'.\$$this->relational_field" : "'").".'/index';
		\$config['use_page_numbers'] = TRUE;

	    \$config['per_page'] = 10;
";

if ($this->there_is_a_relational_field)
{

	if ($this->scaffold_model_type == 'phpactiverecord')
	{	
		$data .= "
		\$config['total_rows'] = \$this->".$this->model_name."_calls->count(array('conditions' => array('".$this->relational_field." = ?', \$".$this->relational_field.")));

		\$config['uri_segment'] = 4;";
		} 
	else if ($this->scaffold_model_type == 'activerecord')
	{
		$data .= "
		\$config['total_rows'] = \$this->".$this->model_name."_calls->count(\$".$this->relational_field.");

		\$config['uri_segment'] = 4;";
		} 
}
else

$data .= "
		\$config['total_rows'] = \$this->".$this->model_name."_calls->count();

		\$config['uri_segment'] = 2;";

$data .= "

	    \$config['first_link'] = \"<< \".lang('web_first');
	    \$config['first_tag_open'] = \"<span class='pag'>\";
		\$config['first_tag_close'] = '</span>';

		\$config['last_link'] = lang('web_last') .\" >>\";
		\$config['last_tag_open'] = \"<span class='pag'>\";
		\$config['last_tag_close'] = '</span>';

		\$config['next_link'] = FALSE;
		\$config['next_tag_open'] = \"<span class='pag'>\";
		\$config['next_tag_close'] = '</span>';

		\$config['prev_link'] = FALSE;
		\$config['prev_tag_open'] = \"<span class='pag'>\";
		\$config['prev_tag_close'] = '</span>';

	    \$config['cur_tag_open'] = \"<span class='pag pag_active'>\";
	    \$config['cur_tag_close'] = '</span>';

	    \$config['num_tag_open'] = \"<span class='pag'>\";
	    \$config['num_tag_close'] = '</span>';

	    \$config['full_tag_open'] = \"<div class='navigation'>\";
	    \$config['full_tag_close'] = '</div>';

	    \$choice = \$config[\"total_rows\"] / \$config[\"per_page\"];
	    //\$config[\"num_links\"] = round(\$choice);

	    return \$config;
	}

		";


if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
{
$data .= "
	private function set_upload_options(\$controller, \$field)
	{	
		//upload an image options
		\$config = array();
		
		if (strpos(\$field,'DFF_EXTERENAL_FILE_ATTACHMENT')!== false)
		{
			\$config['upload_path'] 	= UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/external_files/';
			\$config['allowed_types'] 	= '*';
			\$config['max_size'] 		= '4096';
			\$config['encrypt_name']    = TRUE;
		}
";	
}		
	  	foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
      		switch ($value['type'])
      		{
        		case 'image':

$data .= "
		if (\$field == '$index')
		{
			\$config['upload_path'] 	= UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/img/';
			\$config['allowed_types'] 	= '".$value['upload']['allowed_types']."';
			\$config['encrypt_name']	= ".$value['upload']['encrypt_name'].";
			\$config['max_width']  		= '".$value['upload']['max_width']."';
			\$config['max_height']  	= '".$value['upload']['max_height']."';
			\$config['max_size'] 		= '".$value['upload']['max_size']."';
		}

";
        		break;

        		case 'file':

$data .= "
		if (\$field == '$index')
		{
			\$config['upload_path'] 		= UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/files/';
			\$config['allowed_types'] 	= '".$value['upload']['allowed_types']."';
			\$config['max_size'] 		= '".$value['upload']['max_size']."';
			\$config['encrypt_name']		= ".$value['upload']['encrypt_name'].";
		}

";
        		break;
				
				case 'photo':

$data .= "
		if (\$field == '$index')
		{
			\$config['upload_path'] 		= UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/photo/';
			\$config['allowed_types'] 	    = '".$value['upload']['allowed_types']."';
			\$config['min_size'] 		    = '".$value['upload']['min_size']."';
			\$config['max_size'] 		    = '".$value['upload']['max_size']."';
			\$config['encrypt_name']		= ".$value['upload']['encrypt_name'].";
		}

";
        		break;

        	}
        }
    }
        }


if ($this->there_is_an_image or $this->there_is_a_file or $this->there_is_a_photo)
{
$data .= "
		//create controller upload folder if not exists
		if (!is_dir(\$config['upload_path']))
		{
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/files/external_files/\",0777,TRUE);
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/photo/\",0777,TRUE);
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/img/\",0777,TRUE);
			mkdir(UPLOADFOLDERDIR.\"public/uploads/\$controller/img/thumbs/\",0777,TRUE);
		}
			
		return \$config;
	}
";	
}		


if ($this->there_is_an_image)
{
$data .= "
	
	private function set_thumbnail_options(\$info_upload, \$controller, \$field)
	{	
		\$config = array();
		\$config['image_library'] = 'gd2';
		\$config['source_image'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/img/'.\$info_upload[\"file_name\"];
		\$config['new_image'] = UPLOADFOLDERDIR.'public/uploads/'.\$controller.'/img/thumbs/'.\$info_upload[\"file_name\"];
		\$config['create_thumb'] = TRUE;
";	
}	

	  	foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
      		switch ($value['type'])
      		{
        		case 'image':

$data .= "
		if (\$field == 'page'.$pageno.$index'')
		{
			\$config['maintain_ratio'] = ".$value['thumbnail']['maintain_ratio'].";
			\$config['master_dim'] = '".$value['thumbnail']['master_dim']."';
			\$config['width'] = ".$value['thumbnail']['width'].";
			\$config['height'] = ".$value['thumbnail']['height'].";
			\$config['thumb_marker'] = '';
		}
";
        		break;
        	}
        }
    }
        }

 if ($this->there_is_an_image)
{
$data .= "
		return \$config;
	}
";	
}	

       $this->validation_rules_for_stages($data);

	} 

   // --------------------------------------------------------------------

	/**
	 * Creating validation rules for web stages - Initial process 
	 *
	 * @author  Selva
	 *
	 * @param	string	data 
	 * 
	 */

	private function validation_rules_for_stages($data)
	{

	    //**************************** single **********************************************//
	 	$stages                             = array();
		$app_temp                           = array();
		$app_temp1                          = array();
		$perstagedata                       = array();
		$singlestagedata                    = array();
		$allstages                          = array();
		$single_c_data                      = array();
		$controller_data                    = '';


		//******************************** parallel **************************************//
		$parallelstageusers                 = array();
		$parallelstype                      = array();
		$parallelvp                         = array();
		$parallelep                         = array();
		$workflow_type                      = array();
		$arrayPar                           = array();
		$parallelapp_temp1                  = array();
		$branchs                            = array();
		$parallelperstagedata               = array();
		$parallelbranches                   = array();
		$parallel_c_data                    = array();

	
		//******************************** conditional **************************************//
		$conditionalstageusers              = array();
		$approvedstype                      = array();
		$disapprovedstype                   = array();
		$conditionalapp_temp1               = array();
		$conditionalapp_temp2               = array();
		$conditionalstages                  = array();
		$conditionaldisapprovedstages       = array();
		$conditionaldisapprovedstageusers   = array();
		$conditionalperstagedata            = array();
		$approvedst                         = array();
		$disapprovedstage                   = array();
		$conditionaldisapprovedperstagedata = array();
		$approvedvp                         = array();
		$approvedep                         = array();
		$disapprovedvp                      = array();
		$disapprovedep                      = array();
		$arrayCon                           = array();
		$conditional_c_data                 = array();
	
	
		//*********************************************************************************//
	
		foreach($this->workflow as $worktemplate => $temp)
		{
			array_push($allstages,$worktemplate);
			array_push($perstagedata,$temp);
		}

		$count = count($perstagedata);
		for ($i = 0; $i < $count; $i++)
		{
		
		array_push($workflow_type,$perstagedata[$i]['Workflow_Type']);
        
	   ///////////////////////////////////////////////////////////////////////---single---////////////////////////////////////////////////////////////////////////////////////////////////////////////
	          
	      if($workflow_type[$i] == "single")
	      {
	         $single_c_data = $this->process_single_stage_for_validation_rules($perstagedata[$i],$allstages[$i]);
	         $controller_data  = $controller_data.$single_c_data;
	      }

	       if($workflow_type[$i] == "parallel")
	      {
	      	 $arrayPar = $perstagedata[$i];
	         unset($arrayPar['Workflow_Type']);
	         $parallel_c_data = $this->process_parallel_stage_for_validation_rules($arrayPar);
	         log_message('debug','$parallel_c_data=======================================4862'.print_r($parallel_c_data,true));
	         $controller_data  = $controller_data.$parallel_c_data;
	         log_message('debug','$controller_data=======================================4864'.print_r($controller_data,true));
	      }

	       if($workflow_type[$i] == "conditional")
	      {
	      	 $arrayCon = $perstagedata[$i];
	         $conditional_c_data = $this->process_conditional_stage_for_validation_rules($arrayCon);
	         $controller_data  = $controller_data.$conditional_c_data;
	      }

	    }

	    $tdata = $data.$controller_data;

	    $tdata.="
	}";

	     $this->create_folder_if_no_exists(APPPATH.'controllers/'.$this->customer_folder);
	if ( $this->save_file($this->controller_name, "controllers/".$this->customer_folder."/", trim( $tdata ) ) === TRUE )
		return TRUE;
	else
		return FALSE;
    }

    // --------------------------------------------------------------------

	/**
	 * Creating validation rules for web stages - processing single stage
	 *
	 * @author  Selva
	 *
	 * @param	array	singlestagedata
	 * @param	string	stage name
	 * 
	 */

    private function process_single_stage_for_validation_rules($singlestagedata,$stage)
    {
        $permissions  = array();
		$vp           = array();
		$ep           = array();
		$stype        = array();
		$stageindex   = array();
		$newdata      = '';

		array_push($vp,$singlestagedata['View_Permissions']);
		array_push($ep,$singlestagedata['Edit_Permissions']);
		array_push($stype,$singlestagedata['Stage_Type']);
		array_push($stageindex,$singlestagedata['index']);

		$permissions['View_Permissions'] = $vp[0];
		$permissions['Edit_Permissions'] = $ep[0];
		$permissions['index']            = $stageindex[0];
		
		if($stype[0]=="web")
		{
			$newdata = $this->set_validation_rules($this->arrayjsonfull,$stage,$permissions,$this->company_name,$this->controller_name);
		}
		else if($stype[0]=="hybrid")
		{
			$newdata = $this->set_validation_rules($this->arrayjsonfull,$stage,$permissions,$this->company_name,$this->controller_name);
		}

		return $newdata;

    }


    // --------------------------------------------------------------------

	/**
	 * Creating validation rules for web stages - processing parallel stage
	 *
	 * @author  Selva
	 *
	 * @param	array	parallel stage data
	 * 
	 */

    private function process_parallel_stage_for_validation_rules($arrayPar)
    {

       
	   $arrayCon                    = array();
	   $branchs                     = array();
	   $parallelperstagedata        = array();
	   $parallelbranches            = array();
	   $parallelbranchwtype         = array();
	   $parallelstagedata           = array();
	   $parallelstagecontrollerdata = '';
	   
	
	   foreach($arrayPar as $paral => $para)
	   {
	       array_push($branchs,$paral);
	   }
	
	   foreach ($branchs as $perbranch)
	   {
	         $parallelstagenames = array();
	
	        if(isset($parallelperstagedata))
	        {
				array_shift($parallelperstagedata);
	        }
			if(isset($parallelbranches))
			{
				array_shift($parallelbranches);
			}
			if(isset($parallelbranchwtype))
			{
				array_shift($parallelbranchwtype);
			}
			
	    foreach($arrayPar[$perbranch] as $branchname => $branch)
	    {
	       array_push($parallelbranches,$branchname);
	       array_push($parallelperstagedata,$branch);
	    }
	
	       $parallelstagecount = count($parallelperstagedata);
	
	      for($kk=0;$kk<$parallelstagecount;$kk++)
	     {
	         array_push($parallelbranchwtype,$parallelperstagedata[$kk]['Workflow_Type']);
	         if($parallelbranchwtype[$kk]=="single")
	        {
	           if(isset($parallelperstagedata[$kk-1]))
			   {
					unset($parallelperstagedata[$kk-1]);
			   }
	
			   if(isset($parallelstagenames[$kk-1]))
			   {
	                unset($parallelstagenames[$kk-1]);
	           }
	
	
	          foreach($arrayPar[$perbranch] as $branchname => $branch)
	          {
	        	if($branch['Workflow_Type']=="single")
	         	{
					array_push($parallelstagenames,$branchname);
	        	}
	      	  }
	
	      	   $stagecontrollerdata = $this->process_single_stage_for_validation_rules($parallelperstagedata[$kk],$parallelstagenames[$kk]);
	           $parallelstagecontrollerdata = $parallelstagecontrollerdata.$stagecontrollerdata;
	        }

	        if($parallelbranchwtype[$kk]=="parallel")
	        {
	
				$arrayParnew = $parallelperstagedata[$kk];
				unset($arrayParnew['Workflow_Type']);
				$this->process_parallel_stage_for_validation_rules($arrayParnew);
	        }

	       if($parallelbranchwtype[$kk]=="conditional")
	       {
	
				$arrayCon = $parallelperstagedata[$kk];
				$this->process_conditional_stage_for_validation_rules($arrayCon);
	
	       }
	    }

	}

	  return $parallelstagecontrollerdata;

    }


    // --------------------------------------------------------------------

	/**
	 * Creating validation rules for web stages - processing conditional stage
	 *
	 * @author  Selva
	 *
	 * @param	array	conditional stage data
	 * 
	 */

    private function process_conditional_stage_for_validation_rules($arrayCon)
    {

        $arrayPar                           = array();
		$approvedstage                      = array();
		$disapprovedstage                   = array();
		$conditionalperstagedata            = array();
		$conditionalapprovedwtype           = array();
		$conditionaldisapprovedwtype        = array();
		$conditionaldisapprovedperstagedata = array();
		$conditionalperstagedata            = array();
		$conditionalstagedata               = array();
		$approvedstagenames                 = array();
		$disapprovedstagenames              = array();
		$disapprovedconditionalstagedata    = array();
		$conditionalstagecontrollerdata     = '';
	
		array_push($approvedstage,$arrayCon['approved']);
		array_push($disapprovedstage,$arrayCon['disapproved']);

	//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
		foreach($approvedstage as $worktemplate => $temp)
		{
	      foreach($temp as $stagename => $t)
	      {
	          array_push($conditionalperstagedata,$t);
	       }
	    }
		$conditionalperstagedatacount = count($conditionalperstagedata);
	
		for($ii = 0;$ii < $conditionalperstagedatacount; $ii++)
		{
			array_push($conditionalapprovedwtype,$conditionalperstagedata[$ii]['Workflow_Type']);
	        if($conditionalapprovedwtype[$ii]=="single")
	        {
	              foreach($approvedstage as $worktemplate => $temp)
	              {
	                 foreach($temp as $stagename => $t)
	                 {
	                   if($t['Workflow_Type']=="single")
	                    {
							array_push($approvedstagenames,$stagename);
	                     }
	                 }
	              }	

			  $approvedstagecontrollerdata = $this->process_single_stage_for_validation_rules($conditionalperstagedata[$ii],$approvedstagenames[$ii]);
			  $conditionalstagecontrollerdata = $conditionalstagecontrollerdata.$approvedstagecontrollerdata;

	        } 

	       if($conditionalapprovedwtype[$ii]=="parallel")
	       {
				$arrayPar = $conditionalperstagedata[$ii];
				unset($arrayPar['Workflow_Type']);
				$this->process_parallel_stage_for_validation_rules($arrayPar);
		   }

		   if($conditionalapprovedwtype[$ii]=="conditional")
		   {
				$arrayConnew = $conditionalperstagedata[$ii];
				$this->process_conditional_stage_for_validation_rules($arrayConnew);
	
	       }
	    }
	
	//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//
	
		foreach($disapprovedstage as $worktemplate => $temp)
	    {
	       foreach($temp as $stagename => $t)
	       {
				array_push($conditionaldisapprovedperstagedata,$t);
	       }
	    }
			$conditionaldisapprovedstagescount = count($conditionaldisapprovedperstagedata);
			for($jj = 0;$jj < $conditionaldisapprovedstagescount; $jj++)
			{
	
				array_push($conditionaldisapprovedwtype,$conditionaldisapprovedperstagedata[$jj]['Workflow_Type']);
				if($conditionaldisapprovedwtype[$jj]=="single")
				{
					foreach($disapprovedstage as $worktemplate => $temp)
					{
						foreach($temp as $stagename => $t)
						{
							if($t['Workflow_Type']=="single")
							{
								array_push($disapprovedstagenames,$stagename);
							}
						}
					}

				  $disapprovedstagecontrollerdata = $this->process_single_stage_for_validation_rules($conditionaldisapprovedperstagedata[$jj],$disapprovedstagenames[$jj]);
				  $conditionalstagecontrollerdata = $conditionalstagecontrollerdata.$disapprovedstagecontrollerdata;

				}

				if($conditionaldisapprovedwtype[$jj]=="parallel")
				{	
					$arrayPar = $conditionaldisapprovedperstagedata[$jj];
					unset($arrayPar['Workflow_Type']);
					$this->process_parallel_stage_for_validation_rules($arrayPar);
	
			    }

				if($conditionaldisapprovedwtype[$jj]=="conditional")
				{
					$arrayCon = $conditionaldisapprovedperstagedata[$jj];
					$this->process_conditional_stage_for_validation_rules($arrayCon);
				}
	        }

	        return $conditionalstagecontrollerdata;
       
    }
    

    

	private function create_model()
	{
		
		$data = "
<?php
class ".$this->model_name_for_calls." extends ActiveRecord\Model {

	
	static \$validates_presence_of = array(";

		$there_are_requireds = FALSE;
		

		foreach ($this->arrayjson as $pageno => $pages)
    	{
    		unset($pages['dont_use_this_name']);
           foreach($pages as $sectionname => $pagedata)
           {
           	 foreach($pagedata as $index => $value)
           	 {
      		switch ($value['type'])
      		{
        		case 'text':
				case 'SBreak':
        		case 'textarea':
				case 'number':
				case 'password':
                 case 'date':
				case 'time':
				case 'range':
				case 'color':
				case 'month':
	if ($value['required'] == "TRUE")
        			{
	        			if ( $value['multilanguage'] == "TRUE")
	        			{
	        				foreach ($this->languages as $prefix=>$language)
	        				{
	        					$data .= $this->sl.$this->tabx2."array('".$index."_".$prefix."'), ";
	        				}
	        			}
	        			else
	        			{
	        				$data .= $this->sl.$this->tabx2."array('".$index."'), ";
	        			}

	        			$there_are_requireds = TRUE;
						
        			}

        		break;

        		case 'checkbox':
				case 'MChoice':
        		case 'select':
        		case 'selectbd':
        		case 'radio':
        		case 'datepicker':


        			if ($value['required'] == "TRUE")
        			{
	        			$data .= $this->sl.$this->tabx2."array('".$index."'), ";	        			
	        			$there_are_requireds = TRUE;
						
        			}        		

        		break;

        		case 'hidden':

	        			$data .= $this->sl.$this->tabx2."array('".$index."'), ";	        			
	        			$there_are_requireds = TRUE;
						

        		break;
        	}
        }
    }
        }

        if ($there_are_requireds)
        	$data = substr( $data, 0, -2 );
		
		

        $data .="	
    );


	static function paginate_all(\$limit, \$page".( ($this->there_is_a_relational_field)  ? ", \$$this->relational_field" : "" ).")
	{
		\$offset = \$limit * ( \$page - 1) ;

		\$result = ".$this->model_name_for_calls."::find('all', array(".( ($this->there_is_a_relational_field)  ? "'conditions' => '$this->relational_field = '.\$$this->relational_field.'', " : "" )."'limit' => \$limit, 'offset' => \$offset, 'order' => 'id DESC' ) );

		if (\$result)
		{
			return \$result;
		}
		else
		{
			return FALSE;
		}
	}


}
		";

        
		if ( $this->save_file($this->model_name, "models/", trim( $data ) ) === TRUE )
			return TRUE;
		else
			return FALSE;
	}


	private function create_model_ar()
	{
		$data = "
<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class ".$this->model_name_for_calls." extends CI_Model{

	function __construct()
    {
        // Call the Model constructor
        parent::__construct();
		 \$this->load->config('mongodb');
		 \$this->collections = \$this->config->item('collections','ion_auth');
		 \$this->_configvalue = \$this->config->item('default');
		 \$this->load->helper('paas');
		// Load MongoDB library,
		\$this->load->library('mongo_db');
		\$this->load->config('email');
		\$this->load->model('api_model');
		\$this->load->model('analytics_model');
		\$this->load->library('bhashsms');
    }
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: Retrieve data for mapper fields
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	public function fetch_retriever_data_model(\$query_param,\$query_value,\$retrieval_list,\$collection_name)
	{
	  \$query_param = \"doc_data.widget_data.\".\$query_param;
	  \$value = \$this->mongo_db->select(\$retrieval_list)->where(array(\$query_param => \$query_value))->get(\$collection_name);
	  return \$value;
	}
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: Document Search Category Count 
	 *
	 * @return int
	 *  
	 * @author Selva 
	 */
	 
	function web_doc_search_count(\$operation,\$from,\$to)
	{
	  switch(\$operation)
	  {
	     case 'all_docs':
    	\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	\$this->mongo_db->where(array('doc_properties.status' => 1));
    	\$query = \$this->mongo_db->get('".$this->coll_name."');
    	 return count(\$query);
		 break;
		
		 case 'last_doc':
		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
		\$this->mongo_db->limit(1);
    	\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	\$this->mongo_db->where(array('doc_properties.status' => 1));
    	\$query = \$this->mongo_db->get('".$this->coll_name."');
    	 return count(\$query);
		 break;
		
		 case '10_doc':
		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
		\$this->mongo_db->limit(10);
    	\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	\$this->mongo_db->where(array('doc_properties.status' => 1));
    	\$query = \$this->mongo_db->get('".$this->coll_name."');
    	 return count(\$query);
		 break;
		
		 case 'hr':
		\$time_to   = date('Y-m-d H:i:s');
        \$time_from = date('Y-m-d H:i:s', strtotime('-1 hour'));
   
    	\$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
    	\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	\$this->mongo_db->where(array('doc_properties.status' => 1));
    	\$query = \$this->mongo_db->get('".$this->coll_name."');
    	 return count(\$query);
		 break;
		
		 case 'today':
		\$today = date(\"Y-m-d\");
    		
		\$this->mongo_db->whereLike('history.last_stage.time',\$today);
		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
		\$this->mongo_db->where(array('doc_properties.status' => 1));
		\$query = \$this->mongo_db->get('".$this->coll_name."');
		 return count(\$query);
		 break;
		
		 case 'range':
		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    	\$this->mongo_db->whereBetween('history.last_stage.time',\$from,\$to);
    	\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	\$this->mongo_db->where(array('doc_properties.status' => 1));
    	\$query = \$this->mongo_db->get('".$this->coll_name."');
    	 return count(\$query);
		 break;
	  }
	}
	
	// ------------------------------------------------------------------------

	/**
	 * Helper: Web search  
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	function web_doc_search_with_pagination(\$limit,\$page,\$operation,\$from,\$to)
	{
	    \$offset = \$limit * ( \$page - 1) ;
		
		switch(\$operation)
		{
		   case 'all_docs':
    	  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
		  \$this->mongo_db->limit(\$limit);
    	  \$this->mongo_db->offset(\$offset);
    	  \$this->mongo_db->select(array('doc_data','doc_properties'),array());
          \$this->mongo_db->where(array('doc_properties.status' => 1));
    	  \$query = \$this->mongo_db->get('".$this->coll_name."');
    	   return \$query;
		   break;
		  
		   case 'last_doc':
		  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    	  \$this->mongo_db->limit(1);
    	  \$this->mongo_db->select(array('doc_data','doc_properties'),array());
          \$this->mongo_db->where(array('doc_properties.status' => 1));
    	  \$query = \$this->mongo_db->get('".$this->coll_name."');
    	   return \$query;
		   break;
		  
		   case '10_doc':
		  \$offset = \$limit * ( \$offset - 1) ;
    	  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    	  \$this->mongo_db->limit(\$limit);
    	  \$this->mongo_db->offset(\$offset);
          \$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	  \$this->mongo_db->where(array('doc_properties.status' => 1));
    	  \$query = \$this->mongo_db->get('".$this->coll_name."');
    	   return \$query;
		   break;
		  
		   case 'hr':
		  \$time_to   = date('Y-m-d H:i:s');
		  \$time_from = date('Y-m-d H:i:s', strtotime('-1 hour'));
		  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
		  \$this->mongo_db->limit(\$limit);
		  \$this->mongo_db->offset(\$offset);
		  \$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
		  \$this->mongo_db->select(array('doc_data','doc_properties'),array());
		  \$this->mongo_db->where(array('doc_properties.status' => 1));
		  \$query = \$this->mongo_db->get('".$this->coll_name."');
		   return \$query;
		   break;
		  
		   case 'today':
		  \$today = date(\"Y-m-d\");
    	  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    	  \$this->mongo_db->limit(\$limit);
    	  \$this->mongo_db->offset(\$offset);
    	  \$this->mongo_db->whereLike('history.last_stage.time',\$today);
    	  \$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	  \$this->mongo_db->where(array('doc_properties.status' => 1));
    	  \$query = \$this->mongo_db->get('".$this->coll_name."');
    	   return \$query;
		   break;
		  
		   case 'range':
		  \$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    	  \$this->mongo_db->limit(\$limit);
    	  \$this->mongo_db->offset(\$offset);
    	  \$this->mongo_db->whereBetween('history.last_stage.time',\$from,\$to);
    	  \$this->mongo_db->select(array('doc_data','doc_properties'),array());
    	  \$this->mongo_db->where(array('doc_properties.status' => 1));
    	  \$query = \$this->mongo_db->get('".$this->coll_name."');
    	   return \$query;
		   break;
		
		}
		
	}
	
	function create_ver(\$data, \$id)
    {
    	
		\$_id = ".$this->model_name_for_calls."::high_id('".$this->coll_name."_shadow');
		\$ver = ".$this->model_name_for_calls."::version_inc(\$id-1);
		\$query = \$this->mongo_db->insertDocument_ver('".$this->coll_name."_shadow', \$data, \$_id, \$id, '".$this->appName."', \$ver);  
    	return \$query;
    }

	function patient_register(\$data)
    {
		if(isset(\$data['doc_data']['widget_data']['page1']['Section Name']['Date of birth'])){
			\$user = [];
		
			\$this->mongo_db->switchDatabase(\$this->_configvalue['common_db']);
			\$all_uniqueID = \$this->mongo_db->select(array('unique_id'))->getWhere(\$this->collections['form_users'], array('company_name' => TENANT));
		
			if(!empty(\$all_uniqueID)){
				foreach (\$all_uniqueID as \$uID){
					array_push(\$user, \$uID['unique_id']);
				}
				\$maxID = max(\$user);
				\$uid_str = substr(\$maxID, strlen(\$maxID)-9);
				\$uid = intval(\$uid_str);
				\$inc = \$uid+1;
				\$unique_id = TENANT.\$inc;
			}else{
				\$unique_id = TENANT.\"100110001\";
			}
			\$unique_id	= \$unique_id;
			\$mobile		= \$data['doc_data']['widget_data']['page1']['Section Name']['Mobile'];
			\$name		= \$data['doc_data']['widget_data']['page1']['Section Name']['Name'];
			\$date_of_birth = \$data['doc_data']['widget_data']['page1']['Section Name']['Date of birth'];
			\$sender		= str_replace('#', '@', \$data['doc_data']['user_name']);
		
			//-------------hash password--------------------
			\$this->store_salt      = \$this->config->item('store_salt', 'ion_auth');
			\$this->salt_length     = \$this->config->item('salt_length', 'ion_auth');
			\$salt = substr(md5(uniqid(rand(), true)), 0, \$this->salt_length);
			\$password = \$salt . substr(sha1(\$salt . \$mobile['mob_num']), 0, -\$this->salt_length);
			\$user = array(
					'unique_id'		=> \$unique_id,
					'dob'     		=> \$date_of_birth,
					'patient_name'	=> \$name,
					'password'		=> \$password,
					'company_name'	=> TENANT,
					'mobile'  		=> \$mobile,
					'grouped_under' => \$sender,
			);
			\$message = 'Hi '.\$name.',
	Your document is submitted, please keep: '.\$unique_id.' as unique id and your mobile number as your password to login to '.URI.'index.php/patient_login/login.
	Thanks';
			\$sms = \$this->bhashsms->send_sms(\$mobile['mob_num'],\$message);
			\$query = \$this->mongo_db->insert(\$this->collections['form_users'], \$user);
			
			// Birthday message to user
			\$b_message = \"Hi \".\$name.\", many more happy returns of the day. With best wishes,\n\".\$sender.\"\n\".TENANT.\"\";
			//\$dateofbirth = explode('-',\$date_of_birth);
			//\$b_date   = \$dateofbirth[2].'/'.\$dateofbirth[1];
			
			if(isset(\$date_of_birth) && !empty(\$dateofbirth))
			{
			  \$dateofbirth = explode('-',\$date_of_birth);
			  \$b_date   = \$dateofbirth[2].'/'.\$dateofbirth[1];
			}
			else
			{
		      \$b_date = \"\";
			}
			
			\$b_array = array(
					'message' 	=> \$b_message,
					'date'    	=> \$b_date,
					'event'   	=> 'birthday',
					'mobile'    => \$mobile,
					'sender_name' => \$sender);

			\$this->mongo_db->insert(\$this->collections['form_users_events'],\$b_array);
			
			\$this->mongo_db->switchDatabase(\$this->_configvalue['dsn']);
			\$reply = array(
					'unique_id'		=> \$unique_id,
					'sms_reply'		=> \$message,
					'query_reply'	=> \$query
			);
			return \$reply;
		}else{
			
			\$user = [];
		
			\$this->mongo_db->switchDatabase(\$this->_configvalue['common_db']);
			\$all_uniqueID = \$this->mongo_db->select(array('unique_id'))->getWhere(\$this->collections['form_users'], array('company_name' => TENANT));
		
			if(!empty(\$all_uniqueID)){
				foreach (\$all_uniqueID as \$uID){
					array_push(\$user, \$uID['unique_id']);
				}
				\$maxID = max(\$user);
				\$uid_str = substr(\$maxID, strlen(\$maxID)-9);
				\$uid = intval(\$uid_str);
				\$inc = \$uid+1;
				\$unique_id = TENANT.\$inc;
			}else{
				\$unique_id = TENANT.\"100110001\";
			}
			\$unique_id	= \$unique_id;
			\$mobile		= \$data['doc_data']['widget_data']['page1']['Section Name']['Mobile'];
			\$name		= \$data['doc_data']['widget_data']['page1']['Section Name']['Name'];
			\$sender		= str_replace('#', '@', \$data['doc_data']['user_name']);
		
			//-------------hash password--------------------
			\$this->store_salt      = \$this->config->item('store_salt', 'ion_auth');
			\$this->salt_length     = \$this->config->item('salt_length', 'ion_auth');
			\$salt = substr(md5(uniqid(rand(), true)), 0, \$this->salt_length);
			\$password = \$salt . substr(sha1(\$salt . \$mobile['mob_num']), 0, -\$this->salt_length);
			\$user = array(
					'unique_id'		=> \$unique_id,
					'patient_name'	=> \$name,
					'password'		=> \$password,
					'company_name'	=> TENANT,
					'mobile'  		=> \$mobile,
					'grouped_under' => \$sender,
			);
			\$message = 'Hi,
You are registered to the clinic, login to www.tlstec.com/patient using ID: '.\$unique_id.' and mobile number as password.';
			\$sms = \$this->bhashsms->send_sms(\$mobile['mob_num'],\$message);
			\$query = \$this->mongo_db->insert(\$this->collections['form_users'], \$user);
			
			\$this->mongo_db->switchDatabase(\$this->_configvalue['dsn']);
			\$reply = array(
					'unique_id'		=> \$unique_id,
					'sms_reply'		=> \$message,
					'query_reply'	=> \$query
			);
			return \$reply;
		
		}
    }
	
	function create(\$data)
    {
    	\$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	\$time_doc = date('Y-m-d H:i:s');
    	\$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
		\$id  = get_unique_id();
		\$_id = get_unique_id();
		\$ver = ".$this->model_name_for_calls."::version_inc(\$_id);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."_shadow', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertStut('status', '".$this->coll_name."', \$id, '".$this->appName."'); 
		\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');
		
		 //notify parameters
		\$parameters = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param   = \$parameters[0]['notify_parameters'];
		\$field   = \$param[0]['field'];
		\$pageno  = \$param[0]['page'];
		\$section = \$param[0]['section'];
		\$value   = \$data['doc_data']['widget_data']['page'.\$pageno][\$section][\$field];
		\$notification_param = array(
			\$field => \$value
			);
        
		// customized sms notification
		\$final_msg          = array();
		\$mobile_number_list = array();
		
        \$sms_content_array = \$this->mongo_db->select(array('sms_content'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		if(isset(\$sms_content_array[0]['sms_content']))
		{
			\$sms_content = \$sms_content_array[0]['sms_content'];
			foreach(\$sms_content as \$stage_name => \$stage_data)
			{
			  if(\$stage_name === \$data['doc_data']['current_stage_name'])
			  {
				 \$send_to = \$stage_data['send_to'];
				 \$message = \$stage_data['message'];
				 
				 //send to
				 foreach(\$send_to as \$index => \$mob_path)
				 {
					 \$mobile_path = str_replace(\"#\",\" \",\$mob_path);
					 \$mobile_data = explode('.',\$mobile_path);
					 \$pagno       = \$mobile_data[0];
					 \$secname     = \$mobile_data[1];
					 \$fiename     = \$mobile_data[2];
					 \$destination_no = \$data['doc_data']['widget_data'][\$pagno][\$secname][\$fiename];
					 array_push(\$mobile_number_list,\$destination_no);
				}
				 
				 // message
				 foreach(\$message as \$index => \$msg_data)
				 {
				   if(\$msg_data['source']==='message_text')
				   {
					  \$mes = \$msg_data['text'];
					  array_push(\$final_msg,\$mes);
				   }
				   else if(\$msg_data['source']==='message_variable')
				   {
					  \$label = \$msg_data['label'];
					  \$path  = \$msg_data['path'];
					  \$path_array = explode('.',\$path);
					  \$pagenumber  = \$path_array[0];
					  \$sectionname = \$path_array[1];
					  \$fieldname   = \$path_array[2];
					  \$sms_value_   = \$data['doc_data']['widget_data'][\$pagenumber][\$sectionname][\$fieldname];
					  array_push(\$final_msg,\$sms_value_);
					}
				 }
			  }
			}
			
			\$msg_content = implode(\"\",\$final_msg);
			
			foreach(\$mobile_number_list as \$phone_number)
			{
			  \$country_code = \$phone_number['country_code'];
			  \$number       = \$phone_number['mob_num'];
			  \$sms = \$this->bhashsms->send_sms(\$number,\$msg_content);
			}	
        }
		
		\$stagename = \$data['doc_data']['stage_name']; 
		\$from_stage = \$data['doc_data']['current_stage_name'];
		\$from_user      = \$data['doc_data']['user_name'];
		".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$id,\$stagename,\$from_stage,\$from_user,\$notification_param); 
    	return \$query;
    }

	function web_create(\$data)
    {
    	\$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	\$time_doc = date('Y-m-d H:i:s');
    	\$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
		\$id  = get_unique_id();
		\$_id = get_unique_id();
		\$ver = ".$this->model_name_for_calls."::version_inc(\$_id);
		\$from_stage = \$data['first_stage_name'];
		 unset(\$data['first_stage_name']);
		\$query = \$this->mongo_db->insert_document_from_web_stage('".$this->coll_name."', \$data, \$id, \$id, '".$this->appName."', \$ver,'".$this->coll_name."',".$this->pages.");
		\$query = \$this->mongo_db->insert_document_from_web_stage('".$this->coll_name."_shadow', \$data, \$_id, \$id, '".$this->appName."', \$ver,'".$this->coll_name."',".$this->pages.");
		\$query = \$this->mongo_db->insertStut('status', '".$this->coll_name."', \$id,'".$this->appName."');
		\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');

		//notify parameters
		\$parameters = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param   = \$parameters[0]['notify_parameters'];
		\$field   = \$param[0]['field'];
		\$pageno  = \$param[0]['page'];
		\$section = \$param[0]['section'];
		\$value   = \$data['doc_data']['widget_data']['page'.\$pageno][\$section][\$field];
		\$notification_param = array(
			\$field => \$value
			);
			
		// customized sms notification
		\$final_msg          = array();
		\$mobile_number_list = array();
		
        \$sms_content_array = \$this->mongo_db->select(array('sms_content'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		if(isset(\$sms_content_array[0]['sms_content']))
		{
			\$sms_content = \$sms_content_array[0]['sms_content'];
			foreach(\$sms_content as \$stage_name => \$stage_data)
			{
			  if(\$stage_name === \$from_stage)
			  {
				 \$send_to = \$stage_data['send_to'];
				 \$message = \$stage_data['message'];
				 
				 //send to
				 foreach(\$send_to as \$index => \$mob_path)
				 {
					 \$mobile_path = str_replace(\"#\",\" \",\$mob_path);
					 \$mobile_data = explode('.',\$mobile_path);
					 \$pagno       = \$mobile_data[0];
					 \$secname     = \$mobile_data[1];
					 \$fiename     = \$mobile_data[2];
					 \$destination_no = \$data['doc_data']['widget_data'][\$pagno][\$secname][\$fiename];
					 array_push(\$mobile_number_list,\$destination_no);
				}
				 
				 // message
				 foreach(\$message as \$index => \$msg_data)
				 {
				   if(\$msg_data['source']==='message_text')
				   {
					  \$mes = \$msg_data['text'];
					  array_push(\$final_msg,\$mes);
				   }
				   else if(\$msg_data['source']==='message_variable')
				   {
					  \$label = \$msg_data['label'];
					  \$path  = \$msg_data['path'];
					  \$path_array = explode('.',\$path);
					  \$pagenumber  = \$path_array[0];
					  \$sectionname = \$path_array[1];
					  \$fieldname   = \$path_array[2];
					  \$sms_value_   = \$data['doc_data']['widget_data'][\$pagenumber][\$sectionname][\$fieldname];
					  if(is_array(\$sms_value_))
					  {
					     foreach(\$sms_value_ as \$value)
						 {
						    array_push(\$final_msg,\$value);
						 }
					    
					  }
					  else
					  {
					    array_push(\$final_msg,\$sms_value_);
					  }
					}
				 }
			  }
			}
			
			\$msg_content = implode(\"\",\$final_msg);
			
			foreach(\$mobile_number_list as \$phone_number)
			{
			  \$country_code = \$phone_number['country_code'];
			  \$number       = \$phone_number['mob_num'];
			  \$sms = \$this->bhashsms->send_sms(\$number,\$msg_content);
			}	
        }
		\$stagename = \$data['doc_data']['stage_name']; 
		".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$id,\$stagename,\$from_stage,\$data['doc_data']['user_name'],\$notification_param);  
		 return \$query;
    }
    
    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: disapprove from web stage
	 *
	 * @return boolean
	 *  
	 * @author Selva
	 */

    function web_disapprove(\$doc_id,\$data,\$user,\$redirected_stage,\$current_user,\$stage_type,\$from_stage,\$notification_param,\$reason)
    {

    	\$ver = ".$this->model_name_for_calls."::version_inc(\$doc_id);

    	\$_id = get_unique_id();

    	\$appid = '".$this->coll_name."';

    	\$query = \$this->mongo_db->where('doc_properties.doc_id', \$doc_id)->set('history',\$data)->update('".$this->coll_name."');

    	\$query = \$this->mongo_db->insert_document_from_web_stage('".$this->coll_name."_shadow', \$data, \$_id, \$doc_id, '".$this->appName."', \$ver, \$appid);

    	if(\$stage_type==\"device\")
    	{
	    	\$exist = \$this->mongo_db->getWhere(\$user.'_docs', array('app_id' => \$appid, 'doc_id' => \$doc_id));
	    	if(strlen(implode('', \$exist)) ==\"\")
	    	{
	    		\$doc_array = array(
	    				'app_id' 			 => \$appid,
	    				'doc_id' 			 => \$doc_id,
	    				'stage' 			 => \$redirected_stage,
	    				'stg_name' 			 => \$redirected_stage,
	    				'app_name' 			 => '".$this->appName."',
	    				'status' 			 => 'new',
	    				'approval' 			 => 'false',
						'from_stage'         => \$from_stage,
						'from_user'          => \$current_user,
						'doc_received_time'  => date('Y-m-d H:i:s'),
						'notification_param' => \$notification_param,
						'reason'             => \$reason);

	    	\$query = \$this->mongo_db->insert(\$user.'_docs', \$doc_array);
	    	
	    	}
	    	else
	    	{
	    	\$query = \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->set(array('status'=>'new','approval'=>'false','from_stage'=> \$from_stage,'from_user'=> \$current_user,'doc_received_time' => date('Y-m-d H:i:s'),'notification_param'=>\$notification_param,'reason'=> \$reason))->update(\$user.'_docs');

	    	}
       

           \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->delete(\$current_user.'_web_docs');
    
    	    return \$query;

    	    }
           else if(\$stage_type==\"web\")
	       {

	       	 \$exist = \$this->mongo_db->getWhere(\$user.'_web_docs', array('app_id' => \$appid, 'doc_id' => \$doc_id));
	    	if(strlen(implode('', \$exist)) ==\"\")
	    	{
	    		\$doc_array = array(
	    				'app_id' 			 => \$appid,
	    				'doc_id' 			 => \$doc_id,
	    				'stage' 			 => \$redirected_stage,
	    				'stg_name' 			 => \$redirected_stage,
	    				'app_name' 			 => '".$this->appName."',
	    				'status' 			 => 'new',
	    				'approval' 			 => 'false',
						'from_stage'         => \$from_stage,
						'from_user'          => \$current_user,
						'doc_received_time'  => date('Y-m-d H:i:s'),
						'notification_param' => \$notification_param,
						'reason'             => \$reason);

	    	\$query = \$this->mongo_db->insert(\$user.'_web_docs', \$doc_array);
	    	
	    	}
	    	else
	    	{
	    	\$query = \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->set(array('status'=>'new','approval'=>'false','from_stage'=> \$from_stage,'from_user'=> \$current_user,'doc_received_time' => date('Y-m-d H:i:s'),'notification_param'=>\$notification_param,'reason'=> \$reason))->update(\$user.'_web_docs');

	    	}
       

           \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->delete(\$current_user.'_web_docs');
    
    	    return \$query;

    	    }
    	
    }

     
     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: disapprove from device stage
	 *
	 * @return boolean
	 *  
	 * @author Selva 
	 */


     function device_disapprove(\$doc_id,\$data,\$user,\$redirected_stage,\$current_user,\$stage_type,\$reason,\$notification_param,\$from_stage)
    {

    	\$ver = ".$this->model_name_for_calls."::version_inc(\$doc_id);

    	\$_id = get_unique_id();

    	\$appid = '".$this->coll_name."';

    	\$query = \$this->mongo_db->where('doc_properties.doc_id', \$doc_id)->set('history',\$data)->update('".$this->coll_name."');

    	\$query = \$this->mongo_db->insertDocument('".$this->coll_name."_shadow', \$data, \$_id, \$doc_id, '".$this->appName."', \$ver);

  
    	
	    	if(\$stage_type==\"device\")
    	{
	    	\$exist = \$this->mongo_db->getWhere(\$user.'_docs', array('app_id' => \$appid, 'doc_id' => \$doc_id));
	    	if(strlen(implode('', \$exist)) ==\"\")
	    	{
	    		\$doc_array = array(
	    				'app_id' => \$appid,
	    				'doc_id' => \$doc_id,
	    				'stage' => \$redirected_stage,
	    				'stg_name' => \$redirected_stage,
	    				'app_name' => '".$this->appName."',
	    				'status' => 'new',
	    				'approval' => 'false',
	    				'from_stage'         => \$from_stage,
	    				'from_user'          => \$current_user,
	    		        'notification_param' => \$notification_param,
	    				'doc_received_time'  => date('Y-m-d H:i:s'),
	    		        'reason'             => \$reason);

	    	\$query = \$this->mongo_db->insert(\$user.'_docs', \$doc_array);
	    	
	    	}
	    	else
	    	{
	    	\$query = \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->set(array('status'=>'new','approval'=>'false','notification_param'=>\$notification_param,'from_stage'=>\$from_stage,'from_user'=>\$current_user,'reason'=>\$reason))->update(\$user.'_docs');

	    	}
       

           \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->delete(\$current_user.'_docs');
    
    	    return \$query;

    	    }
           else if(\$stage_type==\"web\")
	       {

	       	 \$exist = \$this->mongo_db->getWhere(\$user.'_web_docs', array('app_id' => \$appid, 'doc_id' => \$doc_id));
	    	if(strlen(implode('', \$exist)) ==\"\")
	    	{
	    		\$doc_array = array(
	    				'app_id' => \$appid,
	    				'doc_id' => \$doc_id,
	    				'stage' => \$redirected_stage,
	    				'stg_name' => \$redirected_stage,
	    				'app_name' => '".$this->appName."',
	    				'status' => 'new',
	    				'approval' => 'false',
	    				'from_stage'         => \$from_stage,
	    				'from_user'          => \$current_user,
	    		        'notification_param' => \$notification_param,
	    				'doc_received_time'  => date('Y-m-d H:i:s'),
	    		        'reason'             => \$reason);

	    	\$query = \$this->mongo_db->insert(\$user.'_web_docs', \$doc_array);
	    	
	    	}
	    	else
	    	{
	    	\$query = \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->set(array('status'=>'new','approval'=>'false','notification_param'=>\$notification_param,'from_stage'=>\$from_stage,'from_user'=>\$current_user,'reason'=>\$reason))->update(\$user.'_web_docs');

	    	}
       

           \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id' => \$doc_id))->delete(\$current_user.'_docs');
    
    	    return \$query;

    	    }    	
    }


     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: get approval history from document collection
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function get_approval_history(\$doc_id)
    {
    	\$query = \$this->mongo_db->select(array('history'))->where(array('doc_properties.doc_id'=> \$doc_id))->get('".$this->coll_name."');
    	return \$query[0]['history'];
    }
	
	function group_workflow_stage_names(\$appid)
	{
	    \$perstagedata_         = array();
	    \$workflow_type_        = array();
	    \$allstages_            = array();
	    \$stage_name_           = array();
	    \$singlestagename_      = array();
	    \$parallelstagename_    = array();
	    \$conditionalstagename_ = array();
		
	  \$workflow_template_with_id = \$this->mongo_db->select(array('app_name','workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
    	
      foreach(\$workflow_template_with_id as \$workflow_data)
      {
    	 \$workflow_template = \$workflow_data['workflow'];
		 \$appname           = \$workflow_data['app_name'];
      }

    	foreach (\$workflow_template as \$stage_name => \$stage_array)
    	{
		     	array_push(\$allstages_,\$stage_name);
		     	array_push(\$perstagedata_,\$stage_array);
		}
		
		
		\$count_ = count(\$perstagedata_);
			for (\$ij = 0; \$ij < \$count_; \$ij++)
			{
				array_push(\$workflow_type_,\$perstagedata_[\$ij]['Workflow_Type']);
				
				if(\$workflow_type_[\$ij] == \"single\")
				{
					\$singlestagename_ = \$this->get_single_stage_stagename(\$allstages_[\$ij]);
					array_push(\$stage_name_,\$singlestagename_);
				}
				
				if(\$workflow_type_[\$ij] == \"parallel\")
				{
					\$arrayPar_ = \$perstagedata_[\$ij];
					unset(\$arrayPar_['Workflow_Type']);
					\$parallelstagename_= \$this->get_parallel_stage_stagename(\$arrayPar_);
					\$stage_name_ = array_merge(\$stage_name_,\$parallelstagename_);
				}
				
				if(\$workflow_type_[\$ij] == \"conditional\")
				{
					\$arrayCon = \$perstagedata_[\$ij];
					\$conditionalstagename_ = \$this->get_conditional_stage_stagename(\$arrayCon);
					\$stage_name_ = array_merge(\$stage_name_,\$conditionalstagename_);
				}
		    }
		    return \$stage_name_;

    }
	
	// --------------------------------------------------------------------

	/**
	 * Helper : Get stagename - single stage
	 *
	 * @param string \$stage stage name
	 *
	 * @return string
	 * 
	 * @author  Selva
	 */

    function get_single_stage_stagename(\$stage)
    {
    	return \$stage;
    }

    // --------------------------------------------------------------------

	/**
	 * Helper : Get stagename - parallel stage
	 *
	 * @param  array  \$arrayPar  Parallel workflow json
     *
	 *
	 * @return array
	 *
	 * 
	 * @author  Selva
	 */

    function get_parallel_stage_stagename(\$arrayPar_)
    {
	       
		\$arrayCon              = array();
		\$branchs               = array();
		\$parallel_perstagedata = array();
		\$parallelbranches      = array();
		\$parallelbranchwtype   = array();
		\$parallelstagedata     = array();
		\$stagename             = array();
		
		foreach(\$arrayPar_ as \$paral => \$para)
		{
			array_push(\$branchs,\$paral);
		}
		
		foreach (\$branchs as \$perbranch)
		{
			\$parallelstagenames = array();

			if(isset(\$parallel_perstagedata))
			{
				array_shift(\$parallel_perstagedata);
			}
			if(isset(\$parallelbranches))
			{
				array_shift(\$parallelbranches);
			}
			foreach(\$arrayPar_[\$perbranch] as \$branchname => \$branch)
			{
				array_push(\$parallelbranches,\$branchname);
				array_push(\$parallel_perstagedata,\$branch);
			}
		
			\$parallelstagecount = count(\$parallel_perstagedata);
		
			for(\$kk=0;\$kk<\$parallelstagecount;\$kk++)
			{
				array_push(\$parallelbranchwtype,\$parallel_perstagedata[\$kk]['Workflow_Type']);
				if(\$parallelbranchwtype[\$kk]==\"single\")
				{
					if(isset(\$parallel_perstagedata[\$kk-1]))
					{
						unset(\$parallel_perstagedata[\$kk-1]);
					}
		
					if(isset(\$parallelstagenames[\$kk-1]))
					{
						unset(\$parallelstagenames[\$kk-1]);
					}
		
		
					foreach(\$arrayPar_[\$perbranch] as \$branchname => \$branch)
					{
						if(\$branch['Workflow_Type']==\"single\")
						{
							array_push(\$parallelstagenames,\$branchname);
		
						}
					}
					\$singlestagename = \$this->get_single_stage_stagename(\$parallelstagenames[\$kk]);
					array_push(\$stagename,\$singlestagename);
				}

				if(\$parallelbranchwtype[\$kk]==\"parallel\")
				{
					\$arrayParnew = \$parallel_perstagedata[\$kk];
					unset(\$arrayParnew['Workflow_Type']);
					\$parallelstagename = \$this->get_parallel_stage_stagename(\$arrayParnew);
					\$stagename = array_merge(\$stagename,\$parallelstagename);
				}

				if(\$parallelbranchwtype[\$kk]==\"conditional\")
				{
					\$arrayCon = \$parallel_perstagedata[\$kk];
					\$conditionalstagename = \$this->get_conditional_stage_stagename(\$arrayCon);
					\$stagename = array_merge(\$stagename,\$conditionalstagename);
				}
		    }

	    }

	     return \$stagename;
    } 

    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Get stagename - Conditional stage
	 *
	 * @param  array  \$arrayCon  Conditional workflow json
     *
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function get_conditional_stage_stagename(\$arrayCon)
    {
	    \$arrayPar                           = array();
		\$approvedstage                      = array();
		\$disapprovedstage                   = array();
		\$conditionalperstagedata            = array();
		\$conditionaldisapprovedperstagedata = array();
		\$conditionalapprovedwtype           = array();
		\$conditionaldisapprovedwtype        = array();
		\$conditionalperstagedata            = array();
		\$conditionalapprovedstagename       = array();
		\$conditionaldisapprovedstagename    = array();
		\$approvedstagenames                 = array();
		\$disapprovedstagenames              = array();
		\$disapprovedconditionalstagedata    = array();
		\$stage_name                         = array();
		
		array_push(\$approvedstage,\$arrayCon['approved']);
		array_push(\$disapprovedstage,\$arrayCon['disapproved']);

		//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
		foreach(\$approvedstage as \$worktemplate => \$temp)
		{
		  foreach(\$temp as \$stagename => \$t)
		  {
			array_push(\$conditionalperstagedata,\$t);
		  }
		}

		\$conditionalperstagedatacount = count(\$conditionalperstagedata);
		
		for(\$ii = 0;\$ii < \$conditionalperstagedatacount; \$ii++)
		{
		  array_push(\$conditionalapprovedwtype,\$conditionalperstagedata[\$ii]['Workflow_Type']);
		  if(\$conditionalapprovedwtype[\$ii]==\"single\")
		  {
		    foreach(\$approvedstage as \$worktemplate => \$temp)
		    {
		      foreach(\$temp as \$stagename => \$t)
		      {
		        if(\$t['Workflow_Type']==\"single\")
		        {
					array_push(\$approvedstagenames,\$stagename);
		        }
		      }
		    }		 
		    \$conditionalapprovedstagename = \$this->get_single_stage_stagename(\$approvedstagenames[\$ii]);
		    array_push(\$stage_name,\$conditionalapprovedstagename);
		  }

		  if(\$conditionalapprovedwtype[\$ii]==\"parallel\")
		  {
			\$arrayPar = \$conditionalperstagedata[\$ii];
			unset(\$arrayPar['Workflow_Type']);
			\$approvedparallelstagename = \$this->get_parallel_stage_stagename(\$arrayPar);
		    \$stage_name = array_merge(\$stage_name,\$approvedparallelstagename);
		  }

		  if(\$conditionalapprovedwtype[\$ii]==\"conditional\")
		  {
		    \$arrayConnew = \$conditionalperstagedata[\$ii];
		    \$approvedconditionalstagename = \$this->get_conditional_stage_stagename(\$arrayConnew);
		    \$stage_name = array_merge(\$stage_name,\$approvedconditionalstagename);
		  }
	   }
		
	   //-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//
	   foreach(\$disapprovedstage as \$worktemplate => \$temp)
	   {
		foreach(\$temp as \$stagename => \$t)
		{
		   array_push(\$conditionaldisapprovedperstagedata,\$t);
		}
	   }

	   \$conditionaldisapprovedstagescount = count(\$conditionaldisapprovedperstagedata);

	   for(\$jj = 0;\$jj < \$conditionaldisapprovedstagescount; \$jj++)
	   {
		  array_push(\$conditionaldisapprovedwtype,\$conditionaldisapprovedperstagedata[\$jj]['Workflow_Type']);
		  if(\$conditionaldisapprovedwtype[\$jj]==\"single\")
	      {
		      foreach(\$disapprovedstage as \$worktemplate => \$temp)
		      {
		        foreach(\$temp as \$stagename => \$t)
		        {
		           if(\$t['Workflow_Type']==\"single\")
		           {
		             array_push(\$disapprovedstagenames,\$stagename);
		           }
		        }
		     }

		     \$conditionaldisapprovedstagename = \$this->get_single_stage_stagename(\$disapprovedstagenames[\$jj]);
		     array_push(\$stage_name,\$conditionaldisapprovedstagename);
		  }

		  if(\$conditionaldisapprovedwtype[\$jj]==\"parallel\")
		  {
		    \$arrayPar = \$conditionaldisapprovedperstagedata[\$jj];
		    unset(\$arrayPar['Workflow_Type']);
		    \$disapprovedparallelstagename = \$this->get_parallel_stage_stagename(\$arrayPar);
		    \$stage_name = array_merge(\$stage_name,\$disapprovedparallelstagename);
		  }

		  if(\$conditionaldisapprovedwtype[\$jj]==\"conditional\")
		  {
		    \$arrayConnew = \$conditionaldisapprovedperstagedata[\$jj];
		    \$disapprovedconditionalstagename = \$this->get_conditional_stage_stagename(\$arrayConnew);
		    \$stage_name = array_merge(\$stage_name,\$disapprovedconditionalstagename);
		  }
	   }

		return \$stage_name;

    }
	
	function user_doc_notify(\$appid,\$docid,\$stagename,\$from_stage=FALSE,\$from_user=FALSE,\$notification_param)
	{
	   \$allstages    = array();
	   \$perstagedata = array();
	   
	   \$stage_names = \$this->group_workflow_stage_names(\$appid);
	   
	   if(\$stagename == '".$this->coll_name."')
	   {
	      \$key = 1;
		  \$next_stage_name = \$stage_names[\$key];
	   }
	   else
	   {
	     \$key = array_search(\$stagename,\$stage_names);
		 \$next_stage_name = \$stage_names[\$key+1];
	   }
	   
	   
	  \$workflow_template_with_id = \$this->mongo_db->select(array('workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
	   
	   foreach(\$workflow_template_with_id as \$workflow)
	   {
			\$wtemp = \$workflow['workflow'];
			
		} 
	  foreach(\$wtemp as \$worktemplate => \$template)
        {
        	 array_push(\$allstages,\$worktemplate);
             array_push(\$perstagedata,\$template);
        }

        \$count = count(\$perstagedata);
         for (\$i = 0; \$i < \$count; \$i++) 
         {
         array_push(\$workflow_type,\$perstagedata[\$i]['Workflow_Type']);
         if(\$workflow_type[\$i] == \"single\") 
         {	
		     \$doc_array = array(
				 'app_name' =>\$appname, 
				 'app_id' => \$appid,
				 'doc_id' => \$docid,
				 'stage' => \$next_stage_name,
				 'stg_name' => \$next_stage_name,
				 'status' => 'new',
				 'from_stage' => \$from_stage,
				 'from_user' => \$from_user,
				 'notification_param' => \$notification_param,
				 'doc_received_time' => date('Y-m-d H:i:s'),
				 'approval' => 'true');
				 
           \$this->check_single_stage_for_user_doc_notification(\$allstages[\$i],\$perstagedata[\$i],\$next_stage_name,\$appid,\$docid,\$doc_array);
         }
		 else if(\$workflow_type[\$i] == \"conditional\")
		 {
		    \$this->check_conditional_stage_for_user_doc_notification(\$perstagedata[\$i],\$next_stage_name,\$appid,\$docid,\$doc_array);
		 }
		 else if(\$workflow_type[\$i] == \"parallel\")
		 {
		   \$this->check_parallel_stage_for_user_doc_notification(\$perstagedata[\$i],\$next_stage_name,\$appid,\$docid,\$doc_array);
		 }
	   }
	 }
	 
	 function check_single_stage_for_user_doc_notification(\$stage_name,\$perstagedata,\$next_stage_name,\$appid,\$docid,\$doc_array)
    {
	  if(\$stage_name == \$next_stage_name)
	  {
	    \$users = array();
		array_push(\$stype,\$perstagedata['Stage_Type']);
        array_push(\$users,\$perstagedata['UsersList']);
		foreach(\$users[0] as \$inneruser)
		{
                     if(\$stype[0]=='device')
		             {
		                \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		              }
		              else
		              {
		                   \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                   if(!\$available)
		                   {
		                       \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                       ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                   }
		                   else
		                   {
		                       \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                       ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                   }
		               }
	  
	  }
 	  
      }
    }


    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection
	 *
	 * @param string              \$appid         		Application ID
	 * @param string              \$docid         		Document ID
	 * @param string (or) array   \$stagename     		Stage name
	 * @param string              \$from_stage    		Name of the stage from where the document comes
	 * @param string              \$from_user     		Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Selva 
	 */

    function user_doc_notification(\$appid,\$docid,\$stagename,\$from_stage=FALSE,\$from_user=FALSE,\$notification_param)
    {

    	\$stg          = '';
    	\$stages       = array();
    	\$perstagedata = array();
    	\$users        = array();
		\$stype        = array();
		\$wtype        = array();
    	\$wkeys        = array();
    	\$allstages    = array();

    	\$workflow_template_with_id = \$this->mongo_db->select(array('app_name','workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
    	
    	foreach(\$workflow_template_with_id as \$workflow_data)
    	{
    		\$workflow_template = \$workflow_data['workflow'];
    		\$appid             = \$workflow_data['_id']; 
			\$appname           = \$workflow_data['app_name'];
    	}

    	foreach (\$workflow_template as \$stage_name => \$stage_array)
    	{
    		\$wtype[\$stage_name] = \$stage_array['Workflow_Type'];
    		array_push(\$wkeys,\$stage_name);
    	}


    	array_push(\$stages,array_keys(\$workflow_template));

    	if(is_array(\$stagename))
	    {
	    	foreach(\$stagename as \$stage => \$stg)
    		{
    			\$key = array_search(\$stage,\$stages[0]);
    		}

    		\$is_array_current_stage = \"true\";		
	
	    }
	    else
	    {
	     	if(\$stagename != '".$this->coll_name."')
	    	{
	    		\$key = array_search(\$stagename,\$stages[0]);

	    	}
	    	else
	    	{
	    		\$key = 0;

	        }

	        \$is_array_current_stage = \"false\";
	    }

	    \$stagecheckcount = count(\$stages[0])-1;
 
         if(\$key+1 <= \$stagecheckcount)
		 {

		     if(is_array(\$stagename))
		     {
                foreach(\$stagename as \$stage => \$stg)
		        {
		        	\$workflow_srch = array_search(\$stage,\$wkeys);
		        	\$workflow_type = \$wtype[\$stage];
		        }
		     }
		     else
		     {
		     	if(\$stagename != '".$this->coll_name."')
		        {
		
		        	\$workflow_srch = array_search(\$stagename,\$wkeys);
		        	if(\$workflow_srch > 0 || \$workflow_srch <= count(\$wkeys)-1)
		        	{
		        		\$workflow_type = \$wtype[\$wkeys[\$workflow_srch+1]];
		        		\$workflow_srch = \$workflow_srch+1;
		        	}
		        }
		        else
		        {

		        	\$workflow_type = \$wtype[\$wkeys[1]];
		        	\$workflow_srch = array_search(\$wkeys[1],\$wkeys);
		        	
		        }
		     }

		     foreach(\$workflow_template as \$worktemplate => \$temp)
		     {
		     	array_push(\$allstages,\$worktemplate);
		        array_push(\$perstagedata,\$temp);
		     }

		     if(\$workflow_type == 'single')
		     {
		     	\$this->user_doc_notification_single(\$key,\$stagecheckcount,\$stagename,\$perstagedata,\$appname,\$appid,\$docid,\$stages,\$from_stage,\$from_user,\$notification_param);
		     }
		     else if(\$workflow_type=='conditional')
		     {
		 	    \$arrayCon = \$perstagedata[\$workflow_srch];
		 	    \$this->user_doc_notification_conditional(\$arrayCon,\$docid,\$stages,\$allstages[\$workflow_srch],\$stg,\$stagename,\$appid,\$workflow_template,\$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		     }
		     else if(\$workflow_type=='parallel')
		     {
		     	if(is_array(\$stagename))
		     	{
		     		foreach(\$stagename as \$stage => \$stg)
		     		{
                   		foreach(\$stg as \$branchname_ => \$branchStage_)
                   		{

                   		}
		     		}
		     	}
		     		
		 	    \$arrayPar = \$perstagedata[\$workflow_srch];
		 	    \$this->user_doc_notification_parallel(\$arrayPar,\$workflow_template,\$workflow_type,\$perstagedata,\$wkeys,\$workflow_srch,\$appname,\$appid,\$docid,\$from_stage,\$from_user,\$branchname_,\$branchStage_,\$notification_param);
		     }
		     else if(\$workflow_type=='api')
		     {
		     	Api_model::create_pdf_mod(\$appid,\$docid);
		     }	 

	 }
	 else if(\$is_array_current_stage == \"true\")
	 {
	 	 foreach(\$stagename as \$stage => \$stg)
		 {
		     \$workflow_srch = array_search(\$stage,\$wkeys);
		     \$workflow_type = \$wtype[\$stage];
		 }

		 foreach(\$workflow_template as \$worktemplate => \$temp)
		     {
		        array_push(\$perstagedata,\$temp);
		     }

		     \$allstages = array_keys(\$workflow_template);

		     if(\$workflow_type=='conditional')
		     {
		 	    \$arrayCon = \$perstagedata[\$workflow_srch];
		 	    \$this->user_doc_notification_conditional(\$arrayCon,\$docid,\$stages,\$allstages[\$workflow_srch],\$stg,\$stagename,\$appid,\$workflow_template,\$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		     }
		     else if(\$workflow_type=='parallel')
		     {
		     	foreach(\$stagename as \$stage => \$stg)
		     	{
                   foreach(\$stg as \$branchname_ => \$branchStage_)
                   {

                   }
		     	}
		 	    \$arrayPar = \$perstagedata[\$workflow_srch];
		 	    \$this->user_doc_notification_parallel(\$arrayPar,\$workflow_template,\$workflow_type,\$perstagedata,\$wkeys,\$workflow_srch,\$appname,\$appid,\$docid,\$from_stage,\$from_user,\$branchname_,\$branchStage_,\$notification_param);
		     }

	 }
	 else
	 {
	 	    \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id'=> \$docid))->set(array('status' => 1))->update('status');
			\$this->mongo_db->where(array('app_properties.app_id' => \$appid, 'doc_properties.doc_id'=> \$docid))->set(array('doc_properties.status'=> 1))->update('".$this->coll_name."');
			\$this->modify_last_stage_in_history(\$docid);
			Analytics_model::update_pages_saved(\$appid);

	 }
	 
	 }

     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection - single stage processing
	 *
	 * @param string              \$appid         		Application ID
	 * @param string              \$docid         		Document ID
	 * @param string (or) array   \$stagename     		Stage name
	 * @param string              \$from_stage    		Name of the stage from where the document comes
	 * @param string              \$from_user     		Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Selva 
	 */

	 function user_doc_notification_single(\$key,\$stagecheckcount,\$stagename,\$perstagedata,\$appname,\$appid,\$docid,\$stages,\$from_stage,\$from_user,\$notification_param)
	 {
	 	\$stype = array();
	 	\$users = array();

	    if(\$key != \$stagecheckcount)
	    {
            if(\$stagename != \$appid)
		    {
			    array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		        array_push(\$users,\$perstagedata[\$key+1]['UsersList']);

				\$doc_array = array(
				 'app_name' =>\$appname, 
				 'app_id' => \$appid,
				 'doc_id' => \$docid,
				 'stage' => \$stages[0][\$key+1],
				 'stg_name' => \$stages[0][\$key+1],
				 'status' => 'new',
				 'from_stage' => \$from_stage,
				 'from_user' => \$from_user,
				 'notification_param' => \$notification_param,
				 'doc_received_time' => date('Y-m-d H:i:s'),
				 'approval' => 'true');

				  foreach(\$users[0] as \$inneruser)
				  {

					 if(\$stype[0]=='device')
		             {
		                \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		              }
					  else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		              else
		              {
		                   \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                   if(!\$available)
		                   {
		                       \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                       ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                   }
		                   else
		                   {
		                       \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                       ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                   }
		               }
		
		            }
		   
		        }
                else
		        {
		       	      \$key = 0;
				      array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		       	      array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
		       	             
					  \$doc_array = array(
						 'app_name' =>\$appname, 
						 'app_id' => \$appid,
						 'doc_id' => \$docid,
						 'stage' => \$stages[0][\$key+1],
						 'stg_name' => \$stages[0][\$key+1],
						 'status' => 'new',
						 'from_stage' => \$from_stage,
						 'from_user' => \$from_user,
						 'notification_param' => \$notification_param,
						 'doc_received_time' => date('Y-m-d H:i:s'),
						 'approval' => 'true');

				       foreach(\$users[0] as \$inneruser)
				       {
		     		
		                           if(\$stype[0]=='device')
		                           {
		                               \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                               if(!\$available)
		                               {
		                                  \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                                  ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

		       }

		        }

		     }
	 	
	 }

	 // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection - conditional stage processing
	 *
	 * @param array               \$arrayCon        	Conditional stage workflow data
	 * @param string              \$docid           	Document ID
	 * @param string (or) array   \$stagename       	Stage name
	 * @param string              \$from_stage      	Name of the stage from where the document comes
	 * @param string              \$from_user       	Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Selva 
	 */

      function user_doc_notification_conditional(\$arrayCon,\$docid,\$stages,\$stage_name,\$stg,\$stagename,\$appid,\$workflow_template,\$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param)
	 {

	 	\$perstagedataCon = array();

		\$field       = \$arrayCon['field'];
		\$field_exp   = explode(\".\", \$field);
		\$opt         = \$arrayCon['operator'];
		\$value       = \$arrayCon['value'];
		\$approved    = \$arrayCon['approved'];
		\$disapproved = \$arrayCon['disapproved'];
		        
		\$field_val = \$this->mongo_db->select(array('doc_data.widget_data'))->where(array('doc_properties.doc_id' => \$docid))->get('".$this->coll_name."');
		\$val = \$field_val[0]['doc_data']['widget_data'][\$field_exp[0]][\$field_exp[1]][\$field_exp[2]];

		switch(\$opt)
		{
		    case '>=' :
		    if(\$val >= \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    			
		    }
		    break;

		    case '<=' :
		    if(\$val <= \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '==' :
		    if(\$val == \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '>' :
		    if(\$val > \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '<' :
		    if(\$val < \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '===' :
		    if(\$val === \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '!=' :
		    if(\$val != \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;

		    case '!==' :
		    if(\$val !== \$value)
		    {
		    	".$this->model_name_for_calls."::if_true(\$stages, \$approved,\$stagename, \$stage_name,\$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    else
		    {
		    	".$this->model_name_for_calls."::if_false(\$stages, \$disapproved,\$stagename,\$stage_name, \$appid, \$docid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user,\$notification_param);
		    }
		    break;
		    		
		}

	 }


    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection - parallel stage processing
	 *
	 * @param array               \$arrayPar        	Parallel stage workflow data
	 * @param string              \$docid           	Document ID
	 * @param string (or) array   \$stagename       	Stage name
	 * @param string              \$from_stage      	Name of the stage from where the document comes
	 * @param string              \$from_user       	Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Selva 
	 */

      function user_doc_notification_parallel(\$arrayPar,\$workflow_template,\$workflow_type,\$perstagedata,\$wkeys,\$workflow_srch,\$appname,\$appid,\$docid,\$from_stage,\$from_user,\$branchname=FALSE,\$branchStage=FALSE,\$notification_param)
	 {
	 	 \$perstagedataPar = array();
		 unset(\$arrayPar['Workflow_Type']);
		 \$branchs  = array_keys(\$arrayPar);
		 \$noBranch = count(\$branchs);
		 if(!isset(\$branchname))
		 {
			foreach (\$branchs as \$perbranch)
			{
			    \$stages = array();
			    array_push(\$stages,array_keys(\$arrayPar[\$perbranch]));
			    \$parallel = array(\$wkeys[\$workflow_srch] => array(\$perbranch => \$stages[0][0]));
			    \$stype = array();
			    array_push(\$stype,\$arrayPar[\$perbranch][\$stages[0][0]]['Stage_Type']);
			    \$users = array();
			    array_push(\$users,\$arrayPar[\$perbranch][\$stages[0][0]]['UsersList']);
			    \$doc_array = array(
			        		  'app_name' =>\$appname,
			        	      'app_id' => \$appid,
			        	      'doc_id' => \$docid,
				        	  'stage' => \$parallel,
		    				  'stg_name' => \$stages[0][0],
				              'status' => 'new',
							  'from_stage' => \$from_stage,
					          'from_user' => \$from_user,
					          'notification_param' => \$notification_param,
					          'doc_received_time' => date('Y-m-d H:i:s'),
				              'approval' => 'true');
			
				foreach(\$users as \$user)
				{
				    foreach(\$user as \$inneruser)
				    {
				           if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

				    }
			        	      	
			    }
		    }
		   }
		   else
		   {
		        \$stages = array();
		        \$users = array();
		        
		        array_push(\$stages,array_keys(\$arrayPar[\$branchname]));
		        \$key = array_search(\$branchStage,\$stages[0]);
		        \$stagecheckcount = count(\$stages[0])-1;
		        if(\$key != \$stagecheckcount)
		        {
		        	\$stype = array();
		        	array_push(\$stype,\$arrayPar[\$branchname][\$stages[0][\$key+1]]['Stage_Type']);
			        \$parallel = array(\$wkeys[\$workflow_srch] => array(\$branchname => \$stages[0][\$key+1]));
			        array_push(\$users,\$arrayPar[\$branchname][\$stages[0][\$key+1]]['UsersList']);
			        \$doc_array = array(
			        			'app_name' =>\$appname,
			        			'app_id' => \$appid,
			        			'doc_id' => \$docid,
			        			'stage' => \$parallel,
				              	'stg_name' => \$stages[0][\$key+1],
			        			'status' => 'new',
								'from_stage' => \$from_stage,
								'from_user' => \$from_user,
								'notification_param' => \$notification_param,
								'doc_received_time' => date('Y-m-d H:i:s'),
			        			'approval' => 'true');

			        foreach(\$users[0] as \$inneruser)
			        {
			        	if(\$stype[0]=='device')
		                {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                 }
		                 else
		                 {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

			        	}
		        	  }
		        	  else
		        	  {
		        		 \$chk = '';
		        		 foreach (\$branchs as \$perbranch)
		        		 {
		        			\$last_stage = end(\$arrayPar[\$perbranch]);
		        			\$stype = array();
		        			array_push(\$stype,\$last_stage['Stage_Type']);
		        			\$users = array();
		        			array_push(\$users,\$last_stage['UsersList']);
		        			\$status[0]['status'] = '';

		        			foreach(\$users[0] as \$inneruser)
		        			{
		        				
		        				if(\$status[0]['status'] == 'processed')
		        				{
		        					\$stats[\$perbranch] = 'processed';
		        					break;
		        				}
		        				if(\$stype[0]=='device')
		        				{
		        					\$status = \$this->mongo_db->select(array('status'))->getWhere(\$inneruser.'_docs', array('app_id' => \$appid, 'doc_id' => \$docid));
		        				}
		        				else
		        				{
		        					\$status = \$this->mongo_db->select(array('status'))->getWhere(\$inneruser.'_web_docs', array('app_id' => \$appid, 'doc_id' => \$docid));
		        				}
		        				if(\$status == array()){
		        					\$stats[\$perbranch] = 'new';
		        				}else{
		        					\$stats[\$perbranch] = \$status[0]['status'];
		        				}
		        			}
		        			
		        			\$chk = array_search('new',\$stats);
		        		}
		        		if(\$chk == '')
		        		{
		        			\$stages = array();
		        			array_push(\$stages,array_keys(\$workflow_template));
			        		\$key = array_search(\$wkeys[\$workflow_srch],\$stages[0]);
			        		\$users = array();
		        		    if(\$workflow_type != 'conditional' && \$workflow_type != 'parallel')
		        		    {
		        			   \$stype = array();
		        			   array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		        			   array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
		        		       \$doc_array = array(
		        				'app_name' =>\$appname,
		        				'app_id' => \$appid,
		        				'doc_id' => \$docid,
		        				'stage' => \$stages[0][\$key+1],
			        			'stg_name' => \$stages[0][\$key+1],
		        				'status' => 'new',
								'from_stage' => \$from_stage,
								'from_user' => \$from_user,
								'notification_param' => \$notification_param,
								'doc_received_time' => date('Y-m-d H:i:s'),
		        				'approval' => 'true');

		        		     foreach(\$users[0] as \$inneruser)
		        		     {
		        			    if(\$stype[0]=='device')
		                        {
		                           \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                           if(!\$available)
		                           {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                        }
		                        else
		                        {
		                            \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
		                            if(!\$available)
		                            {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                            }
		                            else
		                            {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                            }
		                        }

		        		    }
		        		}
		        		else
		        		{
		        			\$stagename = \$stages[0][\$key];
		        			".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$docid,\$stagename,\$from_stage,\$from_user,\$notification_param);
		        		  }
		        		}
		        	}
		        
	 }

	 }


     // -------------------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection - conditional stage processing - approved branch flow
	 *
	 * @param array               \$arrayPar        	Parallel stage workflow data
	 * @param string              \$docid           	Document ID
	 * @param string (or) array   \$stagename       	Stage name
	 * @param string              \$from_stage      	Name of the stage from where the document comes
	 * @param string              \$from_user       	Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Vikas ( Modified by Selva ) 
	 */

	 function if_true(\$main_stages, \$approved,\$stagename,\$stage_name,\$appid, \$newid, \$workflow_template, \$perstagedata, \$main_stage_index, \$appname,\$from_stage=FALSE,\$from_user=FALSE,\$notification_param)
   	{
   		\$perstagedataCon = array();

   		if(!is_array(\$stagename))
   		{
   			\$stages = array();
   			\$stype  = array();
   			\$users  = array();

   			array_push(\$stages,array_keys(\$approved));

   			\$stagecheckcount = count(\$stages[0]);

   			\$stagecheck = in_array(\$stagename,\$stages[0]);

   			if(\$stagecheck)
            {
              \$key = array_search(\$stagename,\$stages[0]);
            } 
            else
            {
            	\$key = 0;
            }

            \$workflowtype = \$approved[\$stages[0][\$key]]['Workflow_Type'];

            // Routing based on the workflow type
   			if(\$workflowtype == \"parallel\")
   			{
   				
   			}
   			else if(\$workflowtype == \"conditional\")
   			{
   				\$arrayCon = \$approved[\$stages[0][\$key]];
   				\$this->user_doc_notification_conditional(\$arrayCon,\$newid,\$stages,\$stage_name,\$stg,\$stagename,\$appid,\$workflow_template,\$approved,\$main_stage_index,\$appname,\$from_stage,\$from_user,\$notification_param);
   				
            }
   			else if(\$workflowtype == \"single\")
   			{

   			    //\$conditional_pre = array('approved'=> array(\$stages[0][\$key]));
   			    \$conditional = array(\$stage_name => array('approved'=> array(\$stages[0][\$key])));
   			
   				array_push(\$stype,\$approved[\$stages[0][\$key]]['Stage_Type']);
   				array_push(\$users,\$approved[\$stages[0][\$key]]['UsersList']);

            

   				\$doc_array = array(
   					'app_name' =>\$appname,
   					'app_id' => \$appid,
   					'doc_id' => \$newid,
   					'stage' => \$conditional,
					'stg_name' => \$stages[0][\$key],
   					'status' => 'new',
					'from_stage' => \$from_stage,
					'from_user' => \$from_user,
					'notification_param' => \$notification_param,
					'doc_received_time' => date('Y-m-d H:i:s'),
					'approval' =>'true');
   			foreach(\$users[0] as \$inneruser){
	   			if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }
                 }
   			}
   		}
   		else
   		{
   			\$stages = array();
   			\$users = array();
   			
			array_push(\$stages,array_keys(\$approved));
   			foreach(\$approved as \$disapprove => \$app)
			{
   				array_push(\$perstagedataCon,\$app);
   			}
   			
   			if(is_array(\$stagename))
   			{
   				foreach(\$stagename as \$stg_index => \$branch)
    			{
				  foreach(\$branch as \$branch_index)
				  {
    			    foreach(\$branch_index as \$stg_nam_index => \$stg_nam)
    			    {	
    			      \$key = array_search(\$stg_nam,\$stages[0]);
    			    }
    			  }
				}  
   			}
   			/* else
   			{
   				\$key = array_search(\$stagename,\$stages[0]);
   			} */
   		
   			\$stagecheckcount = count(\$stages[0])-1;
   			if(\$key != \$stagecheckcount)
   			{
   				\$stype = array();
   				array_push(\$stype,\$perstagedataCon[\$key+1]['Stage_Type']);
   				array_push(\$users,\$perstagedataCon[\$key+1]['UsersList']);
   				\$conditional_pre = array('approved'=> array(\$stages[0][\$key+1]));
   			    \$conditional = array(\$main_stages[0][\$main_stage_index] => \$conditional_pre);
   				\$doc_array = array(
   						'app_name' =>\$appname,
   						'app_id' => \$appid,
   						'doc_id' => \$newid,
   						'stage' => \$conditional,
						'stg_name' => \$stages[0][\$key+1],
   						'status' => 'new',
					    'from_stage' => \$from_stage,
					    'from_user' => \$from_user,
					    'notification_param' => \$notification_param,
					    'doc_received_time' => date('Y-m-d H:i:s'),
					    'approval' =>'true');
   				foreach(\$users[0] as \$inneruser){
   					if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

   				}
   			}else{
   				\$wtype = array();
   				\$wkeys = array();
   				foreach (\$workflow_template as \$stage_name => \$stage_array){
   					\$wtype[\$stage_name] = \$stage_array['Workflow_Type'];
   					array_push(\$wkeys, \$stage_name);
   				}
   				\$next_stg = \$main_stages[0][\$main_stage_index+1];
   				\$workflow_type = \$wtype[\$next_stg];
   				\$stages = array();
   				array_push(\$stages,array_keys(\$workflow_template));
   				\$conditional_branch = array_keys(\$stagename);
   				\$key = array_search(\$conditional_branch[0],\$stages[0]);
   				\$allstages = array_keys(\$workflow_template);
   				if(\$workflow_type != 'conditional' && \$workflow_type != 'parallel'){
   					\$stype = array();
   					array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
   					array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
   					\$doc_array = array(
   							'app_name' =>\$appname,
   							'app_id' => \$appid,
   							'doc_id' => \$newid,
   							'stage' => \$stages[0][\$key+1],
							'stg_name' => \$stages[0][\$key+1],
   							'status' => 'new',
							'from_stage' => \$from_stage,
							'from_user' => \$from_user,
							'notification_param' => \$notification_param,
							'doc_received_time' => date('Y-m-d H:i:s'),
							'approval' =>'true');
   					foreach(\$users[0] as \$inneruser){
   						if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

   					}
   				}else{
   					\$stagename = \$main_stages[0][\$main_stage_index];
   					".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$newid,\$stagename,\$from_stage,\$from_user,\$notification_param);
   				}
   			}
   		}
	}

    // ------------------------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection - conditional stage processing - disapproved branch flow
	 *
	 * @param array               \$arrayPar        	Parallel stage workflow data
	 * @param string              \$docid           	Document ID
	 * @param string (or) array   \$stagename       	Stage name
	 * @param string              \$from_stage      	Name of the stage from where the document comes
	 * @param string              \$from_user       	Name of the user who forwaded the document 
	 * @param array               \$notification_param  Array of notification fields
	 *  
	 * @author Vikas ( Modified by Selva ) 
	 */

	function if_false(\$main_stages, \$disapproved,\$stagename, \$stage_name,\$appid, \$newid, \$workflow_template, \$perstagedata, \$main_stage_index, \$appname,\$from_stage=FALSE,\$from_user=FALSE,\$notification_param)
	{
		\$perstagedataCon = array();
	
	if(!is_array(\$stagename))
	{
				\$stages = array();

				array_push(\$stages,array_keys(\$disapproved));

   			   \$stagecheckcount = count(\$stages[0]);

   			   \$stagecheck = in_array(\$stagename,\$stages[0]);

   			   if(\$stagecheck)
               {
              		\$key = array_search(\$stagename,\$stages[0]);
               } 
               else
               {
            		\$key = 0;
               }

               \$workflowtype = \$disapproved[\$stages[0][\$key]]['Workflow_Type'];

               if(\$workflowtype == \"conditional\")
   			   {
   				 \$arrayCon = \$disapproved[\$stages[0][\$key]];
   				 \$this->user_doc_notification_conditional(\$arrayCon,\$newid,\$stages,\$stage_name,\$stg,\$stagename,\$appid,\$workflow_template,\$disapproved,\$main_stage_index,\$appname,\$from_stage,\$from_user,\$notification_param);
   			   }
               else if(\$workflowtype == \"parallel\")
               {

               }
               else if(\$workflowtype == \"single\")
               {
               	\$stages = array();
               	\$stype = array();
               	\$users = array();

				array_push(\$stages,array_keys(\$disapproved));
				array_push(\$stype,\$disapproved[\$stages[0][0]]['Stage_Type']);
				array_push(\$users,\$disapproved[\$stages[0][0]]['UsersList']);

				//\$conditional_pre = array('disapproved'=> array(\$stages[0][\$key]));
   			    \$conditional = array(\$stage_name => array('disapproved'=> array(\$stages[0][\$key])));
				
				\$doc_array = array(
    								'app_name' =>\$appname,
    								'app_id' => \$appid,
    								'doc_id' => \$newid,
    								'stage' => \$conditional,
   									'stg_name' => \$stages[0][\$key],
    								'status' => 'new',
									'from_stage' => \$from_stage,
									'from_user' => \$from_user,
									'notification_param' => \$notification_param,
									'doc_received_time' => date('Y-m-d H:i:s'),
					                'approval' =>'true');
    							foreach(\$users[0] as \$inneruser){
    								if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

    							}
    				}
    			}
    				else
    				{
    				\$stages = array();
    				\$users = array();
    				array_push(\$stages,array_keys(\$disapproved));
    				foreach(\$disapproved as \$disapprove => \$app){
    					array_push(\$perstagedataCon,\$app);
    				}
    				if(is_array(\$stagename))
   			        {
   				        foreach(\$stagename as \$stg_index)
    			        {
    			            foreach(\$stg_index as \$stg_nam_index => \$stg_nam_data)
    			            {
    			                if(is_array(\$stg_nam_data))
    			                {
    			                	foreach(\$stg_nam_data as \$stg_nam)
    			            	    {
	    			                  \$key = array_search(\$stg_nam,\$stages[0]);
	    			                }

    			                }
    			                else
    			                {	
    			                  \$key = array_search(\$stg_nam_data,\$stages[0]);
    			                }   
    			            }
    			        }
   			        }
    				else
    				{
    					\$key = array_search(\$stagename,\$stages[0]);
    				}
    				
    				\$stagecheckcount = count(\$stages[0])-1;
    				if(\$key != \$stagecheckcount){
    					\$stype = array();
    					array_push(\$stype,\$perstagedataCon[\$key+1]['Stage_Type']);
    					array_push(\$users,\$perstagedataCon[\$key+1]['UsersList']);
    					\$conditional_pre = array('disapproved'=> array(\$stages[0][\$key+1]));
   			            \$conditional = array(\$main_stages[0][\$main_stage_index] => \$conditional_pre);
    					\$doc_array = array(
    							'app_name' =>\$appname,
    							'app_id' => \$appid,
    							'doc_id' => \$newid,
    							'stage' => \$conditional,
    							'stg_name' => \$stages[0][\$key+1],
    							'status' => 'new',
								'from_stage' => \$from_stage,
								'from_user' => \$from_user,
								'notification_param' => \$notification_param,
								'doc_received_time' => date('Y-m-d H:i:s'),
					            'approval' =>'true');
    					foreach(\$users[0] as \$inneruser){
    						if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

    					}
    				}else{
    					\$wtype = array();
    					\$wkeys = array();
    					foreach (\$workflow_template as \$stage_name => \$stage_array){
    						\$wtype[\$stage_name] = \$stage_array['Workflow_Type'];
    						array_push(\$wkeys, \$stage_name);
    					}
    					\$next_stg = \$main_stages[0][\$main_stage_index+1];
    					\$workflow_type = \$wtype[\$next_stg];
    					\$stages = array();
    					array_push(\$stages,array_keys(\$workflow_template));
    					\$conditional_branch = array_keys(\$stagename);
   				        \$key = array_search(\$conditional_branch[0],\$stages[0]);
    					\$allstages = array_keys(\$workflow_template);
    					if(\$workflow_type != 'conditional' && \$workflow_type != 'parallel'){
    						\$stype = array();
    						array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
    						array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
    						\$doc_array = array(
    								'app_name' =>\$appname,
    								'app_id' => \$appid,
    								'doc_id' => \$newid,
    								'stage' => \$stages[0][\$key+1],
    								'stg_name' => \$stages[0][\$key+1],
    								'status' => 'new',
									'from_stage' => \$from_stage,
									'from_user' => \$from_user,
									'notification_param' => \$notification_param,
									'doc_received_time' => date('Y-m-d H:i:s'),
					                'approval' =>'true');
    						foreach(\$users[0] as \$inneruser){
    							if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
							else if(\$stype[0]=='hybrid')
		              {
						// device
		                \$device_doc_available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$docid);
		                if(!\$device_doc_available)
		                {
		                    \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
		                else
		                {
		                    \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                    ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                }
						
						// web 
						\$web_doc_available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$docid);
					   if(!\$web_doc_available)
					   {
						   \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
					   else
					   {
						   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$docid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
						   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
					   }
		              }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

    						}
    					}else{
    						\$stagename = \$main_stages[0][\$main_stage_index];
    						".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$newid,\$stagename,\$from_stage,\$from_user);
    					}
    				}
    			}
	}

     // ---------------------------------------------------------------------------------------

	/**
	 * Helper: Populate user's document collection
	 *
	 * 
	 *  
	 * @author Vikas 
	 */

	function user_doc_notification_old(\$appid,\$id,\$stagename,\$from_stage=FALSE,\$from_user=FALSE)
    {    	
        \$stg = '';
    	\$newid = \$id;
    	\$stages = array();
    	\$perstagedata = array();
    	\$users = array();
		\$stype = array();
    	\$workflow_template_with_id = \$this->mongo_db->select(array('app_name','workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
    	foreach(\$workflow_template_with_id as \$workflow){
    		\$workflow_template = \$workflow['workflow'];
    		\$workflow_appid = \$workflow['_id']; 
			\$appname  = \$workflow['app_name'];
    	}
    	\$wtype = array();
    	\$wkeys = array();
    	foreach (\$workflow_template as \$stage_name => \$stage_array){
    		\$wtype[\$stage_name] = \$stage_array['Workflow_Type'];
    		array_push(\$wkeys, \$stage_name);
    	}
    	array_push(\$stages,array_keys(\$workflow_template));
    	
		    if(is_array(\$stagename)){
    		foreach(\$stagename as \$stage => \$stg){
    			\$key = array_search(\$stage,\$stages[0]);
    			if(\$workflow_type == 'conditional'){
    				
    			}elseif(\$workflow_type == 'parallel'){
    				
    				foreach(\$stg as \$branchname => \$branchStage){	
    				}
	    			}
	    		}
	    	}else{
	    		if(\$stagename != '".$this->coll_name."'){
	    			\$key = array_search(\$stagename,\$stages[0]);
	    		}else{
	    			\$key = 0;
	    		}
	    	}
		        	
		    \$stagecheckcount = count(\$stages[0])-1;
		    if(\$key+1 <= \$stagecheckcount){
		       if(is_array(\$stagename)){
		        foreach(\$stagename as \$stage => \$stg){
		        	\$workflow_srch = array_search(\$stage,\$wkeys);
		        	\$workflow_type = \$wtype[\$stage];
			     if(\$workflow_type == 'conditional'){
			      
			     }elseif(\$workflow_type == 'parallel'){
			      
			        foreach(\$stg as \$branchname => \$branchStage){
			        	}
			        }	
		         }
		        }else{
		        	if(\$stagename != '".$this->coll_name."'){
		
		        		\$workflow_srch = array_search(\$stagename,\$wkeys);
		        		if(\$workflow_srch > 0 || \$workflow_srch <= count(\$wkeys)-1)
		        		{
		        			\$workflow_type = \$wtype[\$wkeys[\$workflow_srch+1]];
		        			\$workflow_srch = \$workflow_srch+1;
		        		}
		        	}else{
		        		\$workflow_type = \$wtype[\$wkeys[1]];
		        		\$workflow_srch = array_search(\$wkeys[1],\$wkeys);
		        	}
		        }
		        
		        foreach(\$workflow_template as \$worktemplate => \$temp){
		        	array_push(\$perstagedata,\$temp);
		        }
		        
		        if(\$workflow_type == 'conditional'){
		        	\$arrayCon = \$perstagedata[\$workflow_srch];
		        }
		        if(\$workflow_type == 'parallel'){
		        	\$arrayPar = \$perstagedata[\$workflow_srch];
		        }
		        \$allstages = array_keys(\$workflow_template);
		        if(\$workflow_type != 'conditional' && \$workflow_type != 'parallel' && \$workflow_type != 'api')
		        {
		        if(\$key != \$stagecheckcount){
				if(\$stagename != \$appid){
				array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		        array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
		        \$doc_array = array(
				    'app_name' =>\$appname, 
		        	'app_id' => \$appid,
		        	'doc_id' => \$newid,
		        	'stage' => \$stages[0][\$key+1],
		        	'stg_name' => \$stages[0][\$key+1],
		        	'status' => 'new',
					'from_stage' => \$from_stage,
					'from_user' => \$from_user,
					'doc_received_time' => date('Y-m-d H:i:s'),
		        	'approval' => 'true');
				foreach(\$users[0] as \$inneruser){

					if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }
		
		       }
		   
		   }
		       else{
		       	\$key = 0;
				array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		       	array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
		        \$doc_array = array(
				    'app_name' =>\$appname, 
		        	'app_id' => \$appid,
		        	'doc_id' => \$newid,
		        	'stage' => \$stages[0][\$key+1],
					'stg_name' => \$stages[0][\$key+1],
		        	'status' => 'new',
					'from_stage' => \$from_stage,
					'from_user' => \$from_user,
					'doc_received_time' => date('Y-m-d H:i:s'),
		        	'approval' => 'true');
				foreach(\$users[0] as \$inneruser){
		     		
		           if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

		       }
		     	}
				}
		       else{
		        	\$stagename = \$allstages[\$key+1];
		        	".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$id,\$stagename);
		        }
		    }elseif(\$workflow_type == 'conditional'){
		    	\$perstagedataCon = array();
		    	\$field = \$arrayCon['field'];
		    	\$field_exp = explode(\".\", \$field);
		    	\$opt = \$arrayCon['operator'];
		    	\$value = \$arrayCon['value'];
		    	\$approver = \$arrayCon['approved'];
		    	\$disapproved = \$arrayCon['disapproved'];
		    
		    	\$field_val = \$this->mongo_db->select(array('doc_data.widget_data'))->where(array('doc_properties.doc_id' => \$newid))->get('".$this->coll_name."');
		    	\$val = \$field_val[0]['doc_data']['widget_data'][\$field_exp[0]][\$field_exp[1]][\$field_exp[2]];
		    	switch(\$opt){
		    		case '>=' :
		    			
		    			if(\$val >= \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '<=' :
		    			if(\$val <= \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '==' :
		    			if(\$val == \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '>' :
		    			if(\$val > \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '<' :
		    			if(\$val < \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '===' :
		    			if(\$val === \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '!=' :
		    			if(\$val != \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		case '!==' :
		    			if(\$val !== \$value){
		    			".$this->model_name_for_calls."::if_true(\$stages, \$approver, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}else{
		    			".$this->model_name_for_calls."::if_false(\$stages, \$disapproved, \$perstagedataCon, \$stg, \$stagename, \$appid, \$newid, \$workflow_template, \$perstagedata, \$workflow_srch, \$appname,\$from_stage,\$from_user);
		    			}
		    		break;
		    		
		    	}
		    	
		    }elseif(\$workflow_type == 'parallel'){
		    	\$perstagedataPar = array();
		    	unset(\$arrayPar['Workflow_Type']);
		    	\$branchs = array_keys(\$arrayPar);
		        \$noBranch = count(\$branchs);
		        if(!isset(\$branchname)){
			        foreach (\$branchs as \$perbranch){
			        	\$stages = array();
			        	array_push(\$stages,array_keys(\$arrayPar[\$perbranch]));
			        	\$parallel = array(\$wkeys[\$workflow_srch] => array(\$perbranch => \$stages[0][0]));
			        	\$stype = array();
			        	array_push(\$stype,\$arrayPar[\$perbranch][\$stages[0][0]]['Stage_Type']);
			        	\$users = array();
			        	array_push(\$users,\$arrayPar[\$perbranch][\$stages[0][0]]['UsersList']);
			        	\$doc_array = array(
			        		  'app_name' =>\$appname,
			        	      'app_id' => \$appid,
			        	      'doc_id' => \$newid,
				        	  'stage' => \$parallel,
		    				  'stg_name' => \$stages[0][0],
				              'status' => 'new',
							  'from_stage' => \$from_stage,
					          'from_user' => \$from_user,
					          'doc_received_time' => date('Y-m-d H:i:s'),
				              'approval' => 'true');
			
				              foreach(\$users as \$user){
				              	foreach(\$user as \$inneruser){
				              		if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

				              	}
			        	      	
			        	  }
		        	}
		        }else{
		        	\$stages = array();
		        	array_push(\$stages,array_keys(\$arrayPar[\$branchname]));
		        	\$key = array_search(\$branchStage,\$stages[0]);
		        	\$stagecheckcount = count(\$stages[0])-1;
		        	if(\$key != \$stagecheckcount){
		        		\$stype = array();
		        		array_push(\$stype,\$arrayPar[\$branchname][\$stages[0][\$key+1]]['Stage_Type']);
			        	\$parallel = array(\$wkeys[\$workflow_srch] => array(\$branchname => \$stages[0][\$key+1]));
			        	array_push(\$users,\$arrayPar[\$branchname][\$stages[0][\$key+1]]['UsersList']);
			        	\$doc_array = array(
			        			'app_name' =>\$appname,
			        			'app_id' => \$appid,
			        			'doc_id' => \$newid,
			        			'stage' => \$parallel,
				              	'stg_name' => \$stages[0][0],
			        			'status' => 'new',
								'from_stage' => \$from_stage,
								'from_user' => \$from_user,
								'doc_received_time' => date('Y-m-d H:i:s'),
			        			'approval' => 'true');
			        	foreach(\$users[0] as \$inneruser){
			        		if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

			        	}
		        	}else{
		        		\$chk = '';
		        		foreach (\$branchs as \$perbranch){
		        			\$last_stage = end(\$arrayPar[\$perbranch]);
		        			\$stype = array();
		        			array_push(\$stype,\$last_stage['Stage_Type']);
		        			\$users = array();
		        			array_push(\$users,\$last_stage['UsersList']);
		        			\$status[0]['status'] = '';
		        			foreach(\$users[0] as \$inneruser){
		        				
		        				if(\$status[0]['status'] == 'processed'){
		        					\$stats[\$perbranch] = 'processed';
		        					break;
		        				}
		        				if(\$stype[0]=='device')
		        				{
		        					\$status = \$this->mongo_db->select(array('status'))->getWhere(\$inneruser.'_docs', array('app_id' => \$appid, 'doc_id' => \$newid));
		        				}
		        				else
		        				{
		        					\$status = \$this->mongo_db->select(array('status'))->getWhere(\$inneruser.'_web_docs', array('app_id' => \$appid, 'doc_id' => \$newid));
		        				}
		        				if(\$status == array()){
		        					\$stats[\$perbranch] = 'new';
		        				}else{
		        					\$stats[\$perbranch] = \$status[0]['status'];
		        				}
		        			}
		        			
		        			\$chk = array_search('new',\$stats);
		        		}
		        		if(\$chk == ''){
		        		\$stages = array();
		        		array_push(\$stages,array_keys(\$workflow_template));
		        		\$key = array_search(\$wkeys[\$workflow_srch],\$stages[0]);
		        		\$users = array();
		        		if(\$workflow_type != 'conditional' && \$workflow_type != 'parallel'){
		        			\$stype = array();
		        			array_push(\$stype,\$perstagedata[\$key+1]['Stage_Type']);
		        		array_push(\$users,\$perstagedata[\$key+1]['UsersList']);
		        		\$doc_array = array(
		        				'app_name' =>\$appname,
		        				'app_id' => \$appid,
		        				'doc_id' => \$newid,
		        				'stage' => \$stages[0][\$key+1],
			        			'stg_name' => \$stages[0][\$key+1],
		        				'status' => 'new',
								'from_stage' => \$from_stage,
								'from_user' => \$from_user,
								'doc_received_time' => date('Y-m-d H:i:s'),
		        				'approval' => 'true');
		        		foreach(\$users[0] as \$inneruser){
		        			if(\$stype[0]=='device')
		                   {
		                         \$available = \$this->exists_doc(\$inneruser.'_docs',\$appid,\$newid);
		                         if(!\$available)
		                         {
		                              \$this->mongo_db->insert(\$inneruser.'_docs',\$doc_array);
		                              ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                          else
		                          {
		                          	   \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid))->set(\$doc_array)->update(\$inneruser.'_docs');
		                          	   ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                          }
		                    }
		                    else
		                    {
		                           \$available = \$this->exists_doc(\$inneruser.'_web_docs',\$appid,\$newid);
		                           if(!\$available)
		                           {
		                                \$this->mongo_db->insert(\$inneruser.'_web_docs',\$doc_array);
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                           else
		                           {
		                                \$this->mongo_db->where(array('app_id' => \$appid,'doc_id' => \$newid) )->set(\$doc_array)->update(\$inneruser.'_web_docs');
		                                ".$this->model_name_for_calls."::user_doc_mail_notification(\$inneruser,\$doc_array);
		                           }
		                    }

		        		}
		        		}else{
		        			\$stagename = \$stages[0][\$key];
		        			".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$newid,\$stagename,\$from_stage,\$from_user);
		        		  }
		        		}
		        	}
		        }
		    }elseif (\$workflow_type == 'api'){
		    	Api_model::create_pdf_mod(\$appid,\$newid);
		    }
		}else{
		    \$this->mongo_db->where(array('app_id' => \$appid, 'doc_id'=> \$newid))->set(array('status' => 1))->update('status');
			\$this->mongo_db->where(array('app_properties.app_id' => \$appid, 'doc_properties.doc_id'=> \$newid))->set(array('doc_properties.status'=> 1))->update('".$this->coll_name."');
			\$this->modify_last_stage_in_history(\$newid);
			Analytics_model::update_pages_saved(\$appid);
		}
}

       function modify_last_stage_in_history(\$docid)
       {
       	  \$history = array();

          \$history_with_id = \$this->mongo_db->select(array('history'),array())->where(array('doc_properties.doc_id'=>\$docid,'doc_properties.status'=>1))->get('".$this->coll_name."');
          foreach(\$history_with_id as \$data)
          {
          	 \$history = \$data['history'];
          }

          \$history_count = count(\$history);

          \$last_count = \$history_count - 1 ;

          \$newkey = \"last_stage\";

          \$history[\$newkey] = \$history[\$last_count];
          unset(\$history[\$last_count]);

          \$this->mongo_db->where(array('doc_properties.doc_id'=> \$docid,'doc_properties.status'=> 1))->set(array('history'=>\$history))->update('".$this->coll_name."');
       }


       function user_doc_mail_notification(\$inneruser,\$doc_array)
    {
    	     \$user = str_replace('#','@',\$inneruser);
			 unset(\$doc_array['_id']);
			 
		    //Data
		     \$fromstage     = \$doc_array['from_stage'];
    	     \$fromuser      = str_replace('#','',\$doc_array['from_user']);
			 \$appname       = \$doc_array['app_name'];
			 
			 //\$message = 'Application name:'.\$appname.'&nbsp;'.'Document id:'.\$documentid.'&nbsp;'.'Stage:'.\$stg;
			 
			 \$message = \"<html><p>Hi \".\$user.\" !,<br><br>
			         I have forwarded a document for '\".\$appname.\"'.Please proceed further.</p><br>
							Regards<br>
							 \".\$fromuser.\"<br>
							 \".\$fromstage.\"
							 \"; 
			 
    	     \$fromaddress = \$this->config->item('smtp_user');
             \$this->email->set_newline('\r\n');
             \$this->email->set_crlf( '\r\n');
             \$this->email->from(\$fromaddress,'TLSTEC');
             \$this->email->to(\$user);
             \$this->email->subject('New Document');
             \$this->email->message(\$message);
             \$this->email->send();
   	}
    	
    function find_device(\$field, \$value)
    {
       \$widget_param = array();
	   \$parameters   = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param        = \$parameters[0]['notify_parameters'];
		foreach(\$param as \$param_data)
		{
            \$field_name   = \$param_data['field'];
			\$pageno  = \$param_data['page'];
			\$section = \$param_data['section'];
			\$value_   = 'doc_data.widget_data.'.'page'.\$pageno.'.'.\$section.'.'.\$field_name;
			array_push(\$widget_param,\$value_);
		}
		\$count = count(\$widget_param);
		
		for(\$i=0;\$i<\$count;\$i++)
		{
			 \$this->mongo_db->select(array(\$widget_param[\$i]));
		}
          		
        \$query = \$this->mongo_db->select(array('doc_properties.doc_id'))->where(array('doc_properties.status'=>1))->whereLike(\$field ,\$value)->get('".$this->coll_name."');
        return \$query;
    }
    
    function processed(\$appid,\$doc_id,\$user,\$stage){
    	\$query = \$this->mongo_db->where(array('app_id'=>\$appid,'doc_id' => \$doc_id,'stage'=>\$stage))->set(array('status'=>'processed','approval'=>'true'))->update(\$user);
    	return \$query;
    }

     function web_history(\$limit, \$offset, \$from, \$to, \$operation)
    {
    	if(\$operation == 'last_doc'){
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(1);
    		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
        	\$this->mongo_db->where(array('doc_properties.status' => 1));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}else if(\$operation == '10_doc'){
    		\$offset = \$limit * ( \$offset - 1) ;
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    		\$this->mongo_db->where(array('doc_properties.status' => 1));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}else if(\$operation == 'hr'){
    		\$time_to = date('Y-m-d H:i:s');
    		\$time_from = date('Y-m-d H:i:s', strtotime('-1 hour'));
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
    		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    		\$this->mongo_db->where(array('doc_properties.status' => 1));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}else if(\$operation == 'today'){
    	
    		\$today = date(\"Y-m-d\");
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereLike('history.last_stage.time',\$today);
    		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    		\$this->mongo_db->where(array('doc_properties.status' => 1));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}else if(\$operation == 'range'){
    		\$time_from = \$from;
    		\$time_to = \$to;
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
    		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
    		\$this->mongo_db->where(array('doc_properties.status' => 1));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}

    }
    
    function history(\$limit, \$offset, \$from, \$to, \$operation,\$doc_owner)
    {
    	\$widget_param = array();
	    \$parameters   = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param        = \$parameters[0]['notify_parameters'];
		foreach(\$param as \$param_data)
		{
            \$field   = \$param_data['field'];
			\$pageno  = \$param_data['page'];
			\$section = \$param_data['section'];
			\$value   = 'doc_data.widget_data.'.'page'.\$pageno.'.'.\$section.'.'.\$field;
			array_push(\$widget_param,\$value);
		}
		\$count = count(\$widget_param);

    	if(\$operation == 'last_doc')
    	{
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(1);
    		\$this->mongo_db->select(array('doc_properties.doc_id'));
        	\$this->mongo_db->where(array('doc_properties.status' => 1,'doc_properties.doc_owner'=>\$doc_owner));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}
    	else if(\$operation == '10_doc')
    	{
    		for(\$i=0;\$i<\$count;\$i++)
			{
			  \$this->mongo_db->select(array(\$widget_param[\$i]));
			}

    		\$offset = \$limit * ( \$offset - 1) ;
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->select(array('doc_properties.doc_id'));
    		\$this->mongo_db->where(array('doc_properties.status' => 1,'doc_properties.doc_owner'=>\$doc_owner));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}
    	else if(\$operation == 'hr')
    	{
    		for(\$i=0;\$i<\$count;\$i++)
			{
			  \$this->mongo_db->select(array(\$widget_param[\$i]));
			}

    		\$time_to = date('Y-m-d H:i:s');
    		\$time_from = date('Y-m-d H:i:s', strtotime('-1 hour'));
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
    		\$this->mongo_db->select(array('doc_properties.doc_id'));
    		\$this->mongo_db->where(array('doc_properties.status' => 1,'doc_properties.doc_owner'=>\$doc_owner));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}
    	else if(\$operation == 'today')
    	{
    		for(\$i=0;\$i<\$count;\$i++)
			{
			  \$this->mongo_db->select(array(\$widget_param[\$i]));
			}
    		
    		\$today = date(\"Y-m-d\");
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereLike('history.last_stage.time',\$today);
    		\$this->mongo_db->select(array('doc_properties.doc_id'));
    		\$this->mongo_db->where(array('doc_properties.status' => 1,'doc_properties.doc_owner'=>\$doc_owner));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}
    	else if(\$operation == 'range')
    	{
    		for(\$i=0;\$i<\$count;\$i++)
			{
			  \$this->mongo_db->select(array(\$widget_param[\$i]));
			}
			
    		\$time_from = \$from;
    		\$time_to = \$to;
    		
    		\$this->mongo_db->orderBy(array('history.last_stage.time' => -1));
    		\$this->mongo_db->limit(\$limit);
    		\$this->mongo_db->offset(\$offset);
    		\$this->mongo_db->whereBetween('history.last_stage.time',\$time_from,\$time_to);
    		\$this->mongo_db->select(array('doc_properties.doc_id'));
    		\$this->mongo_db->where(array('doc_properties.status' => 1,'doc_properties.doc_owner'=>\$doc_owner));
    		\$query = \$this->mongo_db->get('".$this->coll_name."');
    		return \$query;
    	}

    }

 
	function high_id(\$collection)
	{
		\$this->mongo_db->select('doc_properties.doc_id');
		\$this->mongo_db->orderBy(array('doc_properties.doc_id' => -1));
		\$this->mongo_db->limit(1);
		\$query = \$this->mongo_db->get(\$collection);
		
		\$obj = json_decode(json_encode(\$query), FALSE);
		\$result = array();
		foreach (\$obj as \$row)
		{
		    \$result = \$row;
		}

		if (\$result)
		{
			return \$result->doc_id;
		}
		else
		{
			return FALSE;
		}
	}

	function version_inc(\$_id)
	{
		
		\$this->mongo_db->where(array('doc_id' => \$_id+1));
		\$this->mongo_db->select(array('_version'));
		\$this->mongo_db->orderBy(array('_version' => -1));
		\$this->mongo_db->limit(1);
		\$query = \$this->mongo_db->get('".$this->coll_name."_shadow');
		
		if(empty(\$query)){
			return 0;
		}else{
		return \$query[0]['_version'];
		}
	}

    function find(\$field, \$value)
    {
    	if (\$field == 'doc_id'){
		\$val = \$value;
		\$field = \"doc_properties\".\".\".\$field; 
		
		\$this->mongo_db->where(array(\$field => \$val));
		}else{
		\$this->mongo_db->where(array(\$field => \$value));
		}
		\$query = \$this->mongo_db->get('".$this->coll_name."');
		
		return \$query[0];
    }
	

    function finduserstage(\$usercol, \$field, \$value)
    {
    	
		
		if (\$field == 'doc_id'){
		\$val = \$value;
		
		\$this->mongo_db->where(array(\$field => \$val));
		}else{
		\$this->mongo_db->where(array(\$field => \$value));
		}
		\$this->mongo_db->select(array('stage'));
		
		\$query = \$this->mongo_db->get(\$usercol);
		
		\$obj = json_decode(json_encode(\$query), FALSE);
		\$result = array();
		foreach (\$obj as \$row)
		{
		    \$result = \$row;
		}

		if (\$result)
		{
			return \$result->stage;
		}
		else
		{
			return FALSE;
		}
		
    }


    function find_all(\$order = array('_id' => 1), \$where = array() )
    {
        \$query = \$this->mongo_db->orderBy(\$order)->getWhere('".$this->coll_name."', \$where);

        \$result = json_decode(json_encode(\$query), FALSE);
		
    	return (\$result);
    }    


    function exists(\$id)
    {
    	\$query = \$this->mongo_db->getWhere('".$this->coll_name."', array('_id' => \$id));
    	
		\$result = json_decode(json_encode(\$query), FALSE);

    	if (\$result)
    		return TRUE;
    	else
    		return FALSE;
    }


    function count(".( ($this->there_is_a_relational_field)  ? "\$$this->relational_field" : "" ).")
    {
    	".( ($this->there_is_a_relational_field)  ? "\$this->mongo_db->where('".$this->relational_field."', \$$this->relational_field); " : "" )."
    	return \$this->mongo_db->count('".$this->coll_name."');
    }
    
    function doc_count()
    {
    	\$this->mongo_db->select('total_docs');
    	\$query = \$this->mongo_db->get('total_docs');
    	 
    	if (isset(\$query))
    	{
    		return \$query[0]['total_docs'];
    	}
    	else
    	{
    		return 0;
    	}
    	 
    }

	// -------------------------------------------------------------------------------

	/**
	 * Helper: Fetch all users of particular stage
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
   	 function fetch_stage_users(\$stagewise_users,\$stagename)
	 {
		  \$user_array = \$stagewise_users[\$stagename];
		  
		  if(\$user_array)
		  {
			return \$user_array;
		  }
	
	 }
	 
	 function dynamic_doc_finish_model(\$data,\$doc_linking_id,\$patient_unique_id)
    {
	     \$doc_reference = array();
		 \$attached_doc  = array();
		 
		 \$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	 \$time_doc = date('Y-m-d H:i:s');
    	 \$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
		 \$id  = get_unique_id();
		 \$_id = get_unique_id();
		\$ver = ".$this->model_name_for_calls."::version_inc(\$_id);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."_shadow', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertStut('status', '".$this->coll_name."', \$id, '".$this->appName."'); 
		\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');
		
		\$attached_doc['doc_type'] = 'app_doc';
		\$attached_doc['app_id']   = '".$this->coll_name."'; 
		\$attached_doc['doc_id']   = \$id; 
		
		\$query = \$this->mongo_db->select(array('doc_reference'),array())->where('doc_linking_id',\$doc_linking_id)->get(\$patient_unique_id);
		
		\$doc_reference = \$query[0]['doc_reference'];
		 array_push(\$doc_reference,\$attached_doc);
		 
		\$query = \$this->mongo_db->where('doc_linking_id',\$doc_linking_id)->set('doc_reference',\$doc_reference)->update(\$patient_unique_id);

    }
	
	function dynamic_doc_access_model(\$doc_linking_id,\$unique_id)
	{
	  \$query = \$this->mongo_db->select(array('doc_reference'),array())->where('doc_linking_id',\$doc_linking_id)->get(\$unique_id);
	
	}
	
	function fetch_dynamic_app_doc_model(\$appid,\$docid)
	{
	  \$app_doc = array();
	  
	  \$app_query = \$this->mongo_db->select(array('app_template'),array())->where('_id',\$appid)->get(\$this->collections['records']);
	  \$doc_query = \$this->mongo_db->select()->where('doc_properties.doc_id',\$doc_id)->get(\$appid);
	  
	  \$app_doc['app'] = \$app_query[0];
	  \$app_doc['doc'] = \$doc_query[0];
	  
	  return \$app_doc;
	
	}
	
	function dynamic_doc_forward_model(\$data,\$doc_linking_id,\$form_user_unique_id)
    {
	   \$doc_reference = array();
	   \$attached_doc  = array();
		 
	    \$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	\$time_doc = date('Y-m-d H:i:s');
    	\$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
		\$id  = get_unique_id();
		\$_id = get_unique_id();
		\$ver = ".$this->model_name_for_calls."::version_inc(\$_id);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertDocument('".$this->coll_name."_shadow', \$data, \$_id, \$id, '".$this->appName."', \$ver);
		\$query = \$this->mongo_db->insertStut('status', '".$this->coll_name."', \$id, '".$this->appName."'); 
		\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');
		
		\$attached_doc['doc_type'] = 'app_doc';
		\$attached_doc['app_id']   = '".$this->coll_name."'; 
		\$attached_doc['doc_id']   = \$id; 
		
		\$query = \$this->mongo_db->select(array('doc_reference'),array())->where('doc_linking_id',\$doc_linking_id)->get(\$form_user_unique_id);
		
		\$doc_reference = \$query[0]['doc_reference'];
		 array_push(\$doc_reference,\$attached_doc);
		 
		 \$this->mongo_db->where('doc_linking_id',\$doc_linking_id)->set('doc_reference',\$doc_reference)->update(\$form_user_unique_id);

    }
	
	function dynamic_doc_notification_model(\$unique_id,\$forwarded_from,\$forwarded_to,\$doc_linking_id)
	{
	  \$message_id = get_unique_id();
	  
	  \$insert = array(
	    \"forwarded_from\" => \$forwarded_from,
		\"sent_time\"      => Date('Y-m-d H:i:s'),
		\"unique_id\"      => \$unique_id,
		\"message_owner\"  => \"dynamic_workflow\",
		\"status\"         => \"new\",
		\"doc_linking_id\" => \$doc_linking_id,
		\"sent_source\"    => TENANT,
		\"message_id\"     => \$message_id,
		\"message\"        => \"Patient Profile Document - \".\$unique_id.\"\" );
		
		\$forwarded_to = str_replace(\"@\",\"#\",\$forwarded_to);
		\$forwarded_to = \$forwarded_to.'_push_notifications';
		
		\$insert_query = \$this->mongo_db->insert(\$forwarded_to,\$insert);
		
        if(\$insert_query)
		{
		   return TRUE;
		}
		else
        {
           return FALSE;
        } 
	
	}

    function update_attributes(\$id,\$users,\$data)
    {
        \$notification_param = array();		
		\$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	\$time_doc = date('Y-m-d H:i:s');
    	\$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
    	\$val = \$id;
    	\$_id = get_unique_id();
    	\$ver = ".$this->model_name_for_calls."::version_inc(\$val);
    	\$query = \$this->mongo_db->where('doc_properties.doc_id', \$val)->set(\$data)->update('".$this->coll_name."');
    	\$query = \$this->mongo_db->insertDocument('".$this->coll_name."_shadow', \$data, \$_id, \$val-1, '".$this->appName."', \$ver);
    	\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');

    	//notify parameters
		\$parameters = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param   = \$parameters[0]['notify_parameters'];
		foreach(\$param as \$param_data)
		{
            \$field   = \$param_data['field'];
			\$pageno  = \$param_data['page'];
			\$section = \$param_data['section'];
			\$value   = \$data['doc_data']['widget_data']['page'.\$pageno][\$section][\$field];
			if(isset(\$value) && !empty(\$value))
			{
				\$notification_param[\$field] = \$value;
			}
		}
		
		// customized sms notification
		\$final_msg          = array();
		\$mobile_number_list = array();
		
        \$sms_content_array = \$this->mongo_db->select(array('sms_content'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		
		if(isset(\$sms_content_array[0]['sms_content']))
		{
			\$sms_content = \$sms_content_array[0]['sms_content'];
			foreach(\$sms_content as \$stage_name => \$stage_data)
			{
			  if(\$stage_name === \$data['doc_data']['current_stage_name'])
			  {
				 \$send_to = \$stage_data['send_to'];
				 \$message = \$stage_data['message'];
				 
				 //send to
				 foreach(\$send_to as \$index => \$mob_path)
				 {
					 \$mobile_path = str_replace(\"#\",\" \",\$mob_path);
					 \$mobile_data = explode('.',\$mobile_path);
					 \$pagno       = \$mobile_data[0];
					 \$secname     = \$mobile_data[1];
					 \$fiename     = \$mobile_data[2];
					 \$destination_no = \$data['doc_data']['widget_data'][\$pagno][\$secname][\$fiename];
					 array_push(\$mobile_number_list,\$destination_no);
				}
				 
				 // message
				 foreach(\$message as \$index => \$msg_data)
				 {
				   if(\$msg_data['source']==='message_text')
				   {
					  \$mes = \$msg_data['text'];
					  array_push(\$final_msg,\$mes);
				   }
				   else if(\$msg_data['source']==='message_variable')
				   {
					  \$label = \$msg_data['label'];
					  \$path  = \$msg_data['path'];
					  \$path_array  = explode('.',\$path);
					  \$pagenumber  = \$path_array[0];
					  \$sectionname = \$path_array[1];
					  \$fieldname   = \$path_array[2];
					  \$sms_value_  = \$data['doc_data']['widget_data'][\$pagenumber][\$sectionname][\$fieldname];
					  array_push(\$final_msg,\$sms_value_);
					}
				 }
			  }
			}
			
			\$msg_content = implode(\"\",\$final_msg);
			
			foreach(\$mobile_number_list as \$phone_number)
			{
			  \$country_code = \$phone_number['country_code'];
			  \$number       = \$phone_number['mob_num'];
			  \$sms = \$this->bhashsms->send_sms(\$number,\$msg_content);
			}	
        }
		
		\$stagename  = \$data['doc_data']['stage_name'];
		\$from_stage = \$data['doc_data']['current_stage_name'];
		\$from_user  = \$data['doc_data']['user_name'];
		
		foreach(\$users as \$user)
		{
		  // Device Stage
		  \$device_user = \$user.'_docs';
		  \$device_available = \$this->exists_doc(\$device_user,'".$this->coll_name."',\$id);
		  if(\$device_available)
		  {
			".$this->model_name_for_calls."::processed('".$this->coll_name."',\$id,\$device_user,\$stagename);  
		  }
		  
		  // Web Stage
		  \$web_user = \$user.'_web_docs';
		  \$web_available = \$this->exists_doc(\$web_user,'".$this->coll_name."',\$id);
		  if(\$web_available)
		  {
			".$this->model_name_for_calls."::processed('".$this->coll_name."',\$id,\$web_user,\$stagename);  
		  }
		  
		  
	       
		}
		
		".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$val,\$stagename,\$from_stage,\$from_user,\$notification_param);
		
		return \$query;
    }

    // -------------------------------------------------------------------------------

	/**
	 * Helper: Document Update fom web stage
	 *
	 *  
	 * @author Selva 
	 */
	 
    function web_update_attributes(\$id,\$data,\$users)
    {
    	\$notification_param = array();
    	\$high_doc_count = ".$this->model_name_for_calls."::doc_count();
    	\$time_doc = date('Y-m-d H:i:s');
    	\$total_doc = array('total_docs' => \$high_doc_count+1, 'time' => \$time_doc);
    	\$_id = get_unique_id();
        \$ver = ".$this->model_name_for_calls."::version_inc(\$id);
        \$field = \"doc_properties\".\".\".\"doc_id\";
    	\$index = \$this->mongo_db->select(array('doc_data'))->where(\$field,\$id)->get('".$this->coll_name."');
		
    	\$newindex['widget_data']          = array_replace_recursive(\$index[0]['doc_data']['widget_data'],\$data['doc_data']['widget_data']);
    	\$newindex['user_name']            = \$user;
    	\$newindex['stage_name']           = \$data['stage_name'];
    	\$newindex['strokes_data']         = \$index[0]['doc_data']['strokes_data'];
		\$newindex['position_data']        = \$index[0]['doc_data']['position_data'];
		\$newindex['external_attachments'] = \$index[0]['doc_data']['external_attachments'];
		\$newindex['profile_settings']     = \$index[0]['doc_data']['profile_settings'];
		if(isset(\$index[0]['doc_data']['graph_data']))
		{
		  \$newindex['graph_data'] = \$index[0]['doc_data']['graph_data'];
		}

        if(isset(\$index[0]['doc_data']['chart_data']))
		{
		  \$newindex['chart_data'] = \$index[0]['doc_data']['chart_data'];
		}

        if(isset(\$index[0]['doc_data']['normal_appointment_date']))
		{
		  \$newindex['normal_appointment_date'] = \$index[0]['doc_data']['normal_appointment_date'];
		} 

        if(isset(\$index[0]['doc_data']['next_appointment_date']))
		{
		  \$newindex['next_appointment_date'] = \$index[0]['doc_data']['next_appointment_date'];
		}   		
		
		\$total_pages = \$data['doc_properties']['total_pages'];
		
    	\$query = \$this->mongo_db->where(\$field, \$id)->set(array('doc_data'=>\$newindex,'history'=>\$data['history']))->update('".$this->coll_name."');
    	\$newarrayindex['doc_data'] = \$newindex;
    	\$newarrayindex['history']  = \$data['history'];
    	\$query = \$this->mongo_db->insert_document_from_web_stage('".$this->coll_name."_shadow', \$newarrayindex, \$_id, \$id, '".$this->appName."', \$ver,'".$this->coll_name."',\$total_pages);
    	\$query = \$this->mongo_db->where('id', 1)->set(\$total_doc)->update('total_docs');

    	//notify parameters
		\$parameters = \$this->mongo_db->select(array('notify_parameters'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		\$param   = \$parameters[0]['notify_parameters'];
		foreach(\$param as \$param_data)
		{
            \$field   = \$param_data['field'];
			\$pageno  = \$param_data['page'];
			\$section = \$param_data['section'];
			\$query_field = 'doc_data.widget_data.'.'page'.\$pageno.'.'.\$section.'.'.\$field;
            
            \$value = \$this->mongo_db->select(array(\$query_field),array())->where('doc_properties.doc_id',\$id)->get('".$this->coll_name."');

			foreach(\$value as \$val)
			{
				\$field_value = \$val['doc_data']['widget_data']['page'.\$pageno][\$section][\$field];

				  if(isset(\$field_value) && !empty(\$field_value))
			      {
				    \$notification_param[\$field] = \$field_value;
			      }
		    }
		}
		
		// customized sms notification
		\$final_msg          = array();
		\$mobile_number_list = array();
		
        \$sms_content_array = \$this->mongo_db->select(array('sms_content'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		if(isset(\$sms_content_array[0]['sms_content']))
		{
			\$sms_content = \$sms_content_array[0]['sms_content'];
			foreach(\$sms_content as \$stage_name => \$stage_data)
			{
			  if(\$stage_name === \$data['stage_name'])
			  {
				 \$send_to = \$stage_data['send_to'];
				 \$message = \$stage_data['message'];
				 
				 //send to
				 foreach(\$send_to as \$index => \$mob_path)
				 {
					 \$mobile_path = str_replace(\"#\",\" \",\$mob_path);
					 \$mobile_data = explode('.',\$mobile_path);
					 \$pagno       = \$mobile_data[0];
					 \$secname     = \$mobile_data[1];
					 \$fiename     = \$mobile_data[2];
					 \$destination_no = \$data['doc_data']['widget_data'][\$pagno][\$secname][\$fiename];
					 array_push(\$mobile_number_list,\$destination_no);
				}
				 
				 // message
				 foreach(\$message as \$index => \$msg_data)
				 {
				   if(\$msg_data['source']==='message_text')
				   {
					  \$mes = \$msg_data['text'];
					  array_push(\$final_msg,\$mes);
				   }
				   else if(\$msg_data['source']==='message_variable')
				   {
					  \$label = \$msg_data['label'];
					  \$path  = \$msg_data['path'];
					  \$path_array  = explode('.',\$path);
					  \$pagenumber  = \$path_array[0];
					  \$sectionname = \$path_array[1];
					  \$fieldname   = \$path_array[2];
					  \$sms_value_  = \$data['doc_data']['widget_data'][\$pagenumber][\$sectionname][\$fieldname];
					  if(is_array(\$sms_value_))
					  {
					     foreach(\$sms_value_ as \$value)
						 {
						    array_push(\$final_msg,\$value);
						 }
					    
					  }
					  else
					  {
					    array_push(\$final_msg,\$sms_value_);
					  }
					}
				 }
			  }
			}
			
			\$msg_content = implode(\"\",\$final_msg);
			
			foreach(\$mobile_number_list as \$phone_number)
			{
			  \$country_code = \$phone_number['country_code'];
			  \$number       = \$phone_number['mob_num'];
			  \$sms = \$this->bhashsms->send_sms(\$phone_number,\$msg_content);
			}	
        }

		foreach(\$users as \$user)
		{
		  // Device Stage
		  \$device_user = \$user.'_docs';
		  \$device_available = \$this->exists_doc(\$device_user,'".$this->coll_name."',\$id);
		  if(\$device_available)
		  {
			".$this->model_name_for_calls."::processed('".$this->coll_name."',\$id,\$device_user,\$data['stageobj']);  
		  }
		  
		  // Web Stage
		  \$web_user = \$user.'_web_docs';
		  \$web_available = \$this->exists_doc(\$web_user,'".$this->coll_name."',\$id);
		  if(\$web_available)
		  {
			".$this->model_name_for_calls."::processed('".$this->coll_name."',\$id,\$web_user,\$data['stageobj']);  
		  }
		  
		  ".$this->model_name_for_calls."::user_doc_notification('".$this->coll_name."',\$id,\$data['stageobj'],\$data['stage_name'],\$user,\$notification_param); 
	       
		}
    	 
         return \$query;
		
	}

    function delete(\$id)
    {
    	\$this->mongo_db->where('_id', \$id);
		\$query = \$this->mongo_db->delete('".$this->coll_name."'); 
         return \$query;
    }


	function paginate_all(\$limit, \$page".( ($this->there_is_a_relational_field)  ? ", \$$this->relational_field" : "" ).")
	{
		\$offset = \$limit * ( \$page - 1) ;
		".( ($this->there_is_a_relational_field)  ? "\$this->mongo_db->where('".$this->relational_field."', \$$this->relational_field); " : "" )."
		\$this->mongo_db->orderBy(array('_id' => 1));
		\$this->mongo_db->limit(\$limit);
		\$this->mongo_db->offset(\$offset);
		\$query = \$this->mongo_db->where('doc_properties.status',1)->get('".$this->coll_name."');
		
		\$obj = json_decode(json_encode(\$query),TRUE);
		
		\$result = array();
		
		foreach (\$obj as \$row)
		{
		    \$result[] = \$row;
		}

		if (\$result)
		{
			return \$result;
		}
		else
		{
			return FALSE;
		}
	}

	function get_all()
	{
		\$query = \$this->mongo_db->select(array('workflow'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		return (\$query[0]['workflow']);
	}

	// ------------------------------------------------------------------------

	/**
	 * Helper: get workflow for parsing 
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function get_workflow()
	{

        \$query = \$this->mongo_db->select(array('workflow'),array())->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
		return \$query;
    }


    // -------------------------------------------------------------------------------

	/**
	 * Helper: get finished stage name in document collection for disapprove feature
	 *
	 * @return string
	 *  
	 * @author Selva 
	 */

    function get_finished_stage_name(\$doc_id)
	{
		\$query = \$this->mongo_db->where('doc_id',\$doc_id)->get('".$this->coll_name."');
		 return \$query[0]['stage_name'];
	}


	
    function get_email(\$id)
	{
		\$query = \$this->mongo_db->select(array('email'))->where('username',\$id)->get('users');
		return (\$query[0]['email']);
	}
  function user_vitals(\$user)
	{
		\$commondb = \$this->config->item('common_db');
        \$companydb = \$this->config->item('dsn');
        \$this->mongo_db->switchDatabase(\$commondb);
		\$email = str_replace(\"#\", \"@\", \$user);
	    \$query = \$this->mongo_db->select(array('first_name','phone','email'))->where('email', \$email)->get('users');
	    \$this->mongo_db->switchDatabase(\$companydb);
		 return \$query;
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Update graph values in document
	 *  
	 * @author Selva 
	 */
	 
	function update_graph_values_model(\$doc_id,\$values)
	{
	   \$query = \$this->mongo_db->where(array('doc_properties.doc_id'=>\$doc_id))->set(array('doc_data.graph_data'=>\$values))->update('".$this->coll_name."');
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: populate widgets for dropdown 
	 *
	 * @return array
	 *  
	 * @author Vikas (Modified by Selva) 
	 */

	function get_widget()
	{
		\$widget        = array();
		\$widget_labels = array();
		\$widget_name   = array();
		\$widget_type   = array();

		\$query = \$this->mongo_db->select(array('app_template'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
	
		foreach (\$query[0]['app_template'] as \$pageno => \$pages)
		{
			foreach(\$pages as \$section => \$sec)
				{
					unset(\$sec['dont_use_this_name']);
					foreach(\$sec as \$elename => \$element)
					{
					  if((\$element['key']==\"true\") OR (\$element['key']==\"TRUE\"))
					  {
					  	\$widget_label = 'page'.\$pageno.'.'.\$section.'.'.\$elename;
					    array_push(\$widget_labels,\$widget_label);
						array_push(\$widget_name,\$elename);
						array_push(\$widget_type,\$element['type']);
					  }
				    }
			    }
		    
		}

		\$widget['widget']        = \$widget_name;
		\$widget['widget_labels'] = \$widget_labels;
		\$widget['widget_types']  = \$widget_type;
		return (\$widget);
	}
	
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Fetch graph values to plot graph
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
	function fetch_graph_values_model(\$doc_id)
	{
	   \$query = \$this->mongo_db->select(array('doc_data.graph_data'),array())->where(array('doc_properties.doc_id' =>\$doc_id))->get('".$this->coll_name."');
       return \$query;
	
	}

	// -------------------------------------------------------------------------------

	/**
	 * Helper: search from web 
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function web_search(\$page_number,\$limit,\$field,\$text,\$field_type)
	{
	   \$offset = \$limit*(\$page_number - 1 );
		
		if(\$field_type==\"mobile\")
		{
		  \$field = \$field.\".mob_num\";
		}
		
		// APPLIED LIMIT N OFFSET MATCHING DOCS
	    \$this->mongo_db->offset(\$offset);
		\$this->mongo_db->limit(\$limit);
		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
		\$this->mongo_db->where('doc_properties.status',1);
		\$this->mongo_db->whereLike(\$field,\$text);
	    \$result_documents = \$this->mongo_db->get('".$this->coll_name."');
		
		// ALL MATCHING DOCS
		\$this->mongo_db->select(array('doc_data','doc_properties'),array());
		\$this->mongo_db->where('doc_properties.status',1);
		\$this->mongo_db->whereLike(\$field,\$text);
	    \$total_result_documents = \$this->mongo_db->get('".$this->coll_name."');
		\$total_count  = count(\$total_result_documents);
		
		\$total = ceil(\$total_count/\$limit);
		
		\$doc['documents']   = \$result_documents;
		\$doc['total_pages'] = \$total;

	    return \$doc;
	}
	
	function get_srch(\$field , \$text)
	{
		\$query = \$this->mongo_db->whereLike(\$field , \$text)->get('".$this->coll_name."');
	
		\$result = json_decode(json_encode(\$query), FALSE);
	
		return (\$result);
	}
	
	function get_template()
	{
		\$query = \$this->mongo_db->select(array('app_template'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
	
		return json_encode(\$query[0]['app_template']);
	}

	// -------------------------------------------------------------------------------

	/**
	 * Helper: get application template for create
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

	function get_template_for_create()
	{
		\$query = \$this->mongo_db->select(array('app_template'))->where('_id','".$this->coll_name."')->get(\$this->collections['records']);
	
		return \$query[0]['app_template'];
	}

    function get_permissions(\$email)
	{
		\$query = \$this->mongo_db->select(array('permissions'))->where('app_id','".$this->coll_name."')->get(\$email.'_web_apps');
	
		return json_encode(\$query[0]['permissions']);
	}

    // -------------------------------------------------------------------------------

	/**
	 * Helper: get permissions for create
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function get_permissions_for_create(\$appid,\$collection)
	 {
        \$this->mongo_db->select();
		\$test=\$this->mongo_db->getWhere(\$collection,array('app_id'=>\$appid)); 
		return \$test[0];
	 }

	 // -------------------------------------------------------------------------------

	/**
	 * Helper: get stage name for document access
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */

    function get_stage_for_doc_access(\$appid,\$collection,\$id)
	 {
        \$this->mongo_db->select();
		\$test=\$this->mongo_db->getWhere(\$collection,array('app_id'=>\$appid,'doc_id'=>\$id)); 
		return \$test[0];
	 }
     
	// -------------------------------------------------------------------------------

	/**
	 * Helper: Verify the user during document submission
	 *
	 * @return array
	 *  
	 * @author Selva 
	 */
	 
   	 function chk_user_new(\$stagewise_users,\$user,\$stagename)
	 {
		  \$user_array = \$stagewise_users[\$stagename];
		  
		  \$chk = in_array(\$user,\$user_array);
		  
		  if(!\$chk)
		  {
			return FALSE;
		  }
		  else
		  {
			return TRUE;
		  }
	
	 }

function chk_user(\$user,\$stagename)
	{
		\$stages = array();
		\$appid = '".$this->coll_name."';
		\$workflow_template_with_id = \$this->mongo_db->select(array('app_name','workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
		foreach(\$workflow_template_with_id as \$workflow){
			\$workflow_template = \$workflow['workflow'];
			\$workflow_appid = \$workflow['_id'];
			\$appname  = \$workflow['app_name'];
		}
		\$wtype = array();
		\$wkeys = array();
		foreach (\$workflow_template as \$stage_name => \$stage_array){
			\$wtype[\$stage_name] = \$stage_array['Workflow_Type'];
			array_push(\$wkeys, \$stage_name);
		}
		array_push(\$stages,array_keys(\$workflow_template));
		
		if(is_array(\$stagename))
		{
			foreach(\$stagename as \$stage => \$stg)
			{
				foreach(\$stg as \$conditionbranch => \$stag_nam)
				{
				  \$workflow_srch = array_search(\$stage,\$wkeys);
				  \$workflow_type = \$wtype[\$stage];
				  if(\$workflow_type == 'conditional')
				  {
					\$pos = array_search(\$stage,\$stages[0]);
					\$user_array = \$workflow_template[\$stages[0][\$pos]][\$conditionbranch][\$stag_nam[0]]['UsersList'];
				  }
				  elseif(\$workflow_type == 'parallel')
				 {
					
					foreach(\$stg as \$branchname => \$branchStage)
					{
					}

					\$pos = array_search(\$stage,\$stages[0]);
					\$user_array = \$workflow_template[\$stages[0][\$pos]][\$branchname][\$branchStage]['UsersList'];
				}
			}
			}
		}else{
			if(\$stagename != '".$this->coll_name."'){
		
				\$workflow_srch = array_search(\$stagename,\$wkeys);
				if(\$workflow_srch > 0 || \$workflow_srch <= count(\$wkeys)-1)
				{
					\$user_array = \$workflow_template[\$stages[0][\$workflow_srch]]['UsersList'];
				}
			}else{
				
				\$workflow_srch = array_search(\$wkeys[0],\$wkeys);
				\$user_array = \$workflow_template[\$stages[0][\$workflow_srch]]['UsersList'];
			}
		}
		
		\$chk = in_array(\$user,\$user_array);
		
		if(!\$chk){
			return FALSE;
		}else{
			return TRUE;
		}
	}

	function get_stage_name(\$user)
    {
      \$allstages = array();
      \$perstagedata = array();
      \$workflow_type = array();
      \$stagename = array();
	  \$appid = '".$this->coll_name."';
	  \$workflow_template_with_id = \$this->mongo_db->select(array('workflow'),array())->getWhere(\$this->collections['records'], array('_id' => \$appid));
	  foreach(\$workflow_template_with_id as \$workflow)
	   {
			\$wtemp = \$workflow['workflow'];
			
		} 
	  foreach(\$wtemp as \$worktemplate => \$template)
        {
        	 array_push(\$allstages,\$worktemplate);
             array_push(\$perstagedata,\$template);
        }

        \$count = count(\$perstagedata);
         for (\$i = 0; \$i < \$count; \$i++) 
         {
         array_push(\$workflow_type,\$perstagedata[\$i]['Workflow_Type']);
         if(\$workflow_type[\$i] == \"single\") 
        {	
        	
         \$singlestage = \$this->check_single_stage_for_stagename(\$perstagedata[\$i],\$user);
         if(\$singlestage)
         {
            \$stagename = \$allstages[\$i];
         }

        }

        if(\$workflow_type[\$i] == \"parallel\")
        {
        	\$arrayPar = \$perstagedata[\$i];
        	unset(\$arrayPar['Workflow_Type']);  
            \$parallelstage = \$this->check_parallel_stage_for_stagename(\$arrayPar,\$user);
            if(\$parallelstage)
            {
              \$stagename = \$parallelstage;
            }
        }

        if(\$workflow_type[\$i] == \"conditional\")
        {
        	\$arrayCon = \$perstagedata[\$i];
            \$conditionalstage = \$this->check_conditional_stage_for_stagename(\$arrayCon,\$user);
            if(\$conditionalstage)
            {
            	\$stagename = \$conditionalstage;
            }
        }

 }

        return \$stagename;
    }

    function check_single_stage_for_stagename(\$perstagedata,\$user)
    {
 	  \$users = array();
      array_push(\$users,\$perstagedata['UsersList']);
      \$username = str_replace(\"@\",\"#\",\$user);
      if(in_array(\$username,\$users[0]))
      {
        return true;
      }
      else
      {
      	return false;
      }
    }

     function check_conditional_stage_for_stagename(\$arrayCon,\$user)
    {
    	  \$arrayPar = array();
          \$approvedstage = array();
          \$disapprovedstage = array();
          \$conditionalperstagedata = array();
          \$conditionalapprovedwtype = array();
          \$conditionaldisapprovedwtype = array();
          \$conditionaldisapprovedperstagedata = array();
          \$conditionalperstagedata = array();
          \$approvedstagenames = array();
          \$disapprovedstagenames = array();
          \$stage = array();
          \$conditionalapprovedstagedata = array();
          \$conditionaldisapprovedstagedata = array();
          array_push(\$approvedstage,\$arrayCon['approved']);
          array_push(\$disapprovedstage,\$arrayCon['disapproved']);

//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
            
             
            foreach(\$approvedstage as \$worktemplate => \$temp){
            	
                foreach(\$temp as \$stagename => \$t){
                       array_push(\$conditionalperstagedata,\$t);
         }
        }
        
         \$conditionalperstagedatacount = count(\$conditionalperstagedata);
         for(\$ii = 0;\$ii < \$conditionalperstagedatacount; \$ii++)
         {
            array_push(\$conditionalapprovedwtype,\$conditionalperstagedata[\$ii]['Workflow_Type']);
             if(\$conditionalapprovedwtype[\$ii]==\"single\")
              {
              	foreach(\$approvedstage as \$worktemplate => \$temp){
                  foreach(\$temp as \$stagename => \$t){
                      if(\$t['Workflow_Type']==\"single\")
                      {
                      	array_push(\$approvedstagenames,\$stagename);
                      }
                   }
                  }
                  \$approvedstage = \$this->check_single_stage_for_stagename(\$conditionalperstagedata[\$ii],\$user);
                  if(\$approvedstage)
                  {
                  	\$stage = \$approvedstagenames[0];
                  }
              }
              if(\$conditionalapprovedwtype[\$ii]==\"parallel\")
               {
                   \$arrayPar = \$conditionalperstagedata[\$ii];
                   unset(\$arrayPar['Workflow_Type']);
                   \$this->check_parallel_stage_for_stagename(\$arrayPar,\$user);  
                }
              if(\$conditionalapprovedwtype[\$ii]==\"conditional\")
                {
                    \$arrayConnew = \$conditionalperstagedata[\$ii];
                    \$this->check_conditional_stage_for_stagename(\$arrayConnew,\$user);
                        
                }
         }
             
//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//      
         foreach(\$disapprovedstage as \$worktemplate => \$temp){
               foreach(\$temp as \$stagename => \$t){
                    array_push(\$conditionaldisapprovedperstagedata,\$t);
            }
         }
          
          \$conditionaldisapprovedstagescount = count(\$conditionaldisapprovedperstagedata);
         for(\$jj = 0;\$jj < \$conditionaldisapprovedstagescount; \$jj++)
         {
         
           array_push(\$conditionaldisapprovedwtype,\$conditionaldisapprovedperstagedata[\$jj]['Workflow_Type']);
                    if(\$conditionaldisapprovedwtype[\$jj]==\"single\")
                    {
                      foreach(\$disapprovedstage as \$worktemplate => \$temp){
                        foreach(\$temp as \$stagename => \$t){
                      if(\$t['Workflow_Type']==\"single\")
                      {
                      	array_push(\$disapprovedstagenames,\$stagename);
                      }
                   }
                  } 	
                      \$disapprovedstage = \$this->check_single_stage_for_stagename(\$conditionaldisapprovedperstagedata[\$jj],\$user);
                      if(\$disapprovedstage)
                      {
                      	\$stage = \$disapprovedstagenames[0];
                      }
                    }
                    if(\$conditionaldisapprovedwtype[\$jj]==\"parallel\")
                    {
                      \$arrayPar = \$conditionaldisapprovedperstagedata[\$jj];
                       unset(\$arrayPar['Workflow_Type']);
                       \$this->check_parallel_stage_for_stagename(\$arrayPar,\$user);  
                        
                    }
                    if(\$conditionaldisapprovedwtype[\$jj]==\"conditional\")
                    {
                  
                       \$arrayConnew = \$conditionaldisapprovedperstagedata[\$jj];
                       \$this->check_conditional_stage_for_stagename(\$arrayConnew,\$user);
                    }
                          

        }
        
         return \$stage;

    }

    function check_parallel_stage_for_stagename(\$arrayPar,\$user)
    {
    	\$stage = array();
        \$arrayCon = array();
        \$branchs = array();
        \$parallelperstagedata = array();
        \$parallelbranches = array();
        \$parallelbranchwtype = array();
        \$parallelstagedata = array();
        \$parallelstagedatauser = array();

  foreach(\$arrayPar as \$paral => \$para)
            {
                array_push(\$branchs,\$paral);
            }
            
            foreach (\$branchs as \$perbranch){
                \$parallelstagenames = array();
                
                if(isset(\$parallelperstagedata)) 
                   { 
                    	array_shift(\$parallelperstagedata);
                     }
                     if(isset(\$parallelbranches)) 
                     { 
                    	array_shift(\$parallelbranches);
                     }
                foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch)
                {
                    array_push(\$parallelbranches,\$branchname);
                    array_push(\$parallelperstagedata,\$branch);
                }
                
                \$parallelstagecount = count(\$parallelperstagedata);
                
                for(\$kk=0;\$kk<\$parallelstagecount;\$kk++)
                {
                    array_push(\$parallelbranchwtype,\$parallelperstagedata[\$kk]['Workflow_Type']);
                    if(\$parallelbranchwtype[\$kk]==\"single\")
                    {
                    	
                    	if(isset(\$parallelperstagedata[\$kk-1])) 
                    		{ 
                    			unset(\$parallelperstagedata[\$kk-1]);
                    		 }

                    		 if(isset(\$parallelstagenames[\$kk-1])) 
                    		{ 
                    			unset(\$parallelstagenames[\$kk-1]);
                    		 }
                    	foreach(\$arrayPar[\$perbranch] as \$branchname => \$branch){
                         if(\$branch['Workflow_Type']==\"single\")
                            {
               	                array_push(\$parallelstagenames,\$branchname);
                             }
                         }
                         
                         \$parallelstagedatastage = \$this->check_single_stage_for_stagename(\$parallelperstagedata[\$kk],\$user);
                         if(\$parallelstagedatastage)
                         {
                         	\$stage = \$parallelstagenames[0];
                         }

                     
                    }
                    if(\$parallelbranchwtype[\$kk]==\"parallel\")
                    {
                        \$arrayParnew = \$parallelperstagedata[\$kk];
                        unset(\$arrayParnew['Workflow_Type']);
                        \$this->check_parallel_stage_for_stagename(\$arrayParnew,\$user);
                    }
                    if(\$parallelbranchwtype[\$kk]==\"conditional\")
                    {
                       \$arrayCon = \$parallelperstagedata[\$kk];
                       \$this->check_conditional_stage_for_stagename(\$arrayCon,\$user);
                        
                    }
                }
       
}
             return \$stage;
    

    }

   function exists_doc(\$collectionname,\$app_id,\$doc_id)
   {
      \$query = \$this->mongo_db->getWhere(\$collectionname, array('app_id' => \$app_id,'doc_id' => \$doc_id));

		\$result = json_decode(json_encode(\$query), FALSE);

		if (\$result)
		return TRUE;
		else
		return FALSE;
    }
	
	function fetch_existing_document(\$doc_id)
	{
	  \$query = \$this->mongo_db->getWhere('".$this->coll_name."', array('doc_properties.doc_id' => \$doc_id));
	  return \$query[0];
	}
}
";
    log_message('debug','MVC based on company....model creation');
	
	$this->create_folder_if_no_exists(APPPATH.'models/'.$this->customer_folder);
	if ( $this->save_file($this->model_name, "models/".$this->customer_folder."/", trim( $data ) ) === TRUE )
		return TRUE;
	else
		return FALSE;

	} 
	



	
	function create_view_create()
	{
		$data = "";
		
		foreach ($this->arrayjson as $index => $value )
    	{
      		switch ($value['type'])
      		{
        		case 'datepicker':

$data .= "
<script src=\"js/datepicker/jquery.ui.datepicker-<?php echo \$this->config->item('prefix_language')?>
.js\" type=\"text/javascript\"></script>
<script>
	$(function() {
		$.datepicker.setDefaults($.datepicker.regional['<?php echo \$this->config->item('prefix_language')?>']);
		$('.datepicker').datepicker({dateFormat: 'dd-mm-yy'});
	});
</script>
";
        		break;
        	}
        }

		$data .= "
		<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
		//require_once(\"inc/init.php\");
		
		//require UI configuration (nav, ribbon, etc.)
        require_once(\"inc/config.ui.php\");
        /*---------------- PHP Custom Scripts ---------

         YOU CAN SET CONFIGURATION VARIABLES HERE BEFORE IT GOES TO NAV, RIBBON, ETC.
         E.G. \$page_title = \"Custom Title\" */

         \$page_title = \"Application\";

      /* ---------------- END PHP Custom Scripts ------------- */
          //include header
         //you can add your custom css in \$page_css array.
          //Note: all css files are inside css/ folder
          \$page_css[] = \"your_style.css\";
          include(\"inc/header.php\");

          //include left panel (navigation)
          //follow the tree in inc/config.ui.php
          \$page_nav[\"apps\"][\"active\"] = true;
          include(\"inc/nav.php\");

          ?>
          <!-- ==========================CONTENT STARTS HERE ========================== -->
          <!-- MAIN PANEL -->
        <div id=\"main\" role=\"main\">
	    <?php
		    //configure ribbon (breadcrumbs) array(\"name\"=>\"url\"), leave url empty if no url
		   //\$breadcrumbs[\"New Crumb\"] => \"http://url.com\"
		    \$breadcrumbs[\"Apps\"] = \"\";
		     include(\"inc/ribbon.php\");
	     ?>
           <!-- MAIN CONTENT -->
	<div id=\"content\">
     <h2>
     <?php echo (\$updType == 'create') ? langS('web_create_t', array(':name' => 'document')) : langS('web_edit_t', array(':name' => 'document'));?>
     </h2>
      <div class=\"navbar\">
						<ul class=\"nav pull-right\">
							<li class=\"dropdown hidden-phone\">	
							<!-- start: User Dropdown -->
							<li class=\"dropdown\">
								<a class=\"btn popover-toggle\" data-toggle=\"dropdown\" id=\"all\">All Stages<span class=\"caret\"></span></a>
								<ul class=\"popover-menu messages\"><span class=\"close\">&times;&nbsp;</span><div id='wrap'></div></ul>
							</li>
			                </li>
						</ul>
			        </div>

	</a> <span class='clearFix'>&nbsp;</span>
                <?php 
\$attributes = array('class' => 'tform', 'id' => ''); ?>

<?php if(\$updType == 'create') { echo form_open_multipart('".$this->customer_folder."/".$this->controller_name."/create', \$attributes); } elseif(\$updType == 'edit') { echo form_open_multipart('".$this->customer_folder."/".$this->controller_name."/edit', \$attributes);  } else { echo form_open_multipart('".$this->customer_folder."/".$this->controller_name."/doc_access', \$attributes);} 
?>
             <div class=\"row\">  
             <article class=\"col-sm-12\">	
                ";
				 foreach ($this->arrayjson as $index => $value )
                {
                switch ($value['type'])
                {
                case 'SBreak':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .="
               <p>
                  <div id='".$index."_".$prefix."'> 
                  <label style='background-color:black; color:white;' class='col-sm-12' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                ";
                }
                }
                else
                {
                $data .="
                <p>
                  <div id='".$index."'>
                  <label style='background-color:black; color:white;' class='col-sm-12' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                ";
                }
                
                break;
				
                case 'SBreak_end':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
	                </div>
					</p>
	                ";
                		}
                	}
                	else
                	{
                		$data .="
                  </div>
				  </p>
                ";
                	}
                
                	break;
				
				case 'text':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='text' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                }
                }
                else
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='text' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                }
                
                break;
				case 'number':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='number' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                }
                }
                else
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='number' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                }
                
                break;
				case 'password':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='password' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                }
                }
                else
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='password' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                }
                
                break;

           case 'date':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='date' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                		}
                	}
                	else
                	{
                		$data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='date' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                	}
                
                break;
                
                case 'time':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='time' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                		}
                	}
                	else
                	{
                		$data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='time' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                	}
                
                break;
                
                case 'range':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$value['minrange']."<input id='".$index."_".$prefix."' type='range' name='".$index."_".$prefix."' min='".$value['minrange']."' max='".$value['maxrange']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />".$value['maxrange']."
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                		}
                	}
                	else
                	{
                		$data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$value['minrange']."<input id='".$index."' type='range' name='".$index."' min='".$value['minrange']."' max='".$value['maxrange']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />".$value['maxrange']."
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                	}
                
                break;
                
                case 'color':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='color' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                		}
                	}
                	else
                	{
                		$data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='color' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                	}
                
                break;
                
                case 'month':
                
                	if ( $value['multilanguage'] == "TRUE")
                	{
                		foreach ($this->languages as $prefix=>$language)
                		{
                			$data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='month' name='".$index."_".$prefix."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? \$".$this->model_name."->".$index."_".$prefix." : ''); ?>\"  />
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                		}
                	}
                	else
                	{
                		$data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='month' name='".$index."' maxlength='".$value['maxlength']."' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                	}
                
                	break;
                
 case 'textarea':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea id=\"".$index."_".$prefix."\"  name=\"".$index."_".$prefix."\"  />
                  <?php echo set_value('".$index."_".$prefix."', (isset(\$".$this->model_name."->".$index."_".$prefix.")) ? htmlspecialchars_decode(\$".$this->model_name."->".$index."_".$prefix.") : ''); ?>
                  </textarea>
                  <?php echo form_error('".$index."_".$prefix."'); ?> <br>
                ";
                }
                }
                else
                {
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea id=\"".$index."\"  name=\"".$index."\"  />
                  <?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? htmlspecialchars_decode(\$".$this->model_name."->".$index.") : ''); ?>
                  </textarea>
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                }
                
                break;
                
                case 'checkbox1':
                $data .= "
                <br>
                  <input id='".$index."' ".(($value['checked'] == "TRUE") ?  ' checked '  :  '')."type='checkbox' name='".$index."' value='1' <?php echo preset_checkbox('".$index."', '1', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''  )?> />
                  &nbsp;
                  <label class='labelforminline' for='".$index."'>".$value['label']." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                
                break;
				
				case 'checkbox':
				$data .= "
                <br>
                  <label class='labelform'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
                  
                  $c = 0;
                  foreach($value['options'] as $index2 => $value2)
                  {
                  $data .= $this->sl.$this->tab."
                  <input type='checkbox' name='ac_".$index."[]' id='".$index."_$c' value='".$value2['value']."' <?php echo preset_checkbox('".$index."', '".$value2['value']."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : '".(($value['checked'] == "TRUE") ?  ' checked '  :  '')."'  );?> >
                  <label class='labelforminline' for='".$index."_$c'> ".$value2['label']." </label>
                  ";
                  $c++;
                  }
                  
                  $data .= " <?php echo form_error('".$index."'); ?> <br>
                ";
				break;
                
				case 'MChoice':
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple name='".$index."[]' id='".$index."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";

				  foreach($value['options'] as $index2=>$value2)
					{
					$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('".$index."', '".$value2['value']."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
					}
		

$data .="
                  </select>
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                break;
				
				
                case 'select':
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select name='".$index."' id='".$index."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";

		foreach($value['options'] as $index2=>$value2)
		{
				$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('".$index."', '".$value2['value']."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
		}
		

$data .="
                  </select>
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                break;
                
                
                case 'selectbd':
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select name='".$index."' id='".$index."' size='".$value['size']."'>
                  <option value=''>
                  <?php echo lang('web_choose_option')?>
                  </option>
                  <?php foreach (\$array_".strtolower($value['options']['model'])." as \$item): ?>
                  <option value=\"<?php echo \$item->".$value['options']['field_value'].";?>\" <?php echo preset_select('".$index."', \$item->".$value['options']['field_value'].", (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : ''  ) ?>>
                  <?php echo \$item->".$value['options']['field_text'].";?>
                  </option>
                  <?php endforeach ?>
                  ";		
                  
                  $data .="
                  </select>
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                break;
                
                case 'radio':
                $data .= "
                <br>
                  <label class='labelform'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
                  
                  $c = 0;
                  foreach($value['options'] as $index2 => $value2)
                  {
                  $data .= $this->sl.$this->tab."
                  <input type='radio' name='".$index."' id='".$index."_$c' value='".$value2['value']."' <?php echo preset_radio('".$index."', '".$value2['value']."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index." : '".$value['checked']."'  );?> >
                  <label class='labelforminline' for='".$index."_$c'> ".$value2['label']." </label>
                  ";
                  $c++;
                  }
                  
                  $data .= " <?php echo form_error('".$index."'); ?> <br>
                ";
                
                break;
                
                case 'datepicker':
                $data .="
                <br>
                  <label class='labelform' for='".$index."'>".ucfirst($index)." ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='text' name='".$index."' maxlength='' class='datepicker' value=\"<?php echo set_value('".$index."', (isset(\$".$this->model_name."->".$index.")) ? \$".$this->model_name."->".$index."->format('d-m-Y') : ''); ?>\"  />
                  <?php echo form_error('".$index."'); ?> <br>
                ";
                break;
                
                case 'image':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .= "
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    [".$index." ($prefix)] ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if (\$updType == 'edit'): ?>
                
                <br><img src='<?php echo URLC.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/img/thumbs/<?php echo \$".$this->model_name."->".$index."_".$prefix."?>' /> <br>
                <?php endif ?>
                <input id='".$index."_".$prefix."' type='file' name='".$index."_".$prefix."' />
                <br/>
                <?php echo form_error('".$index."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['".$index."_".$prefix."'])) ?  \$upload_error['".$index."_".$prefix."']  : \"\"; ?>
                <br>
                ";
                }
                
                }
                else
                {
                $data .= "
                <br>
                  <label class='labelform' for='".$index."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    (".$index.") ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if (\$updType == 'edit'): ?>
                
                <br> <img src='<?php echo URLC.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/img/thumbs/<?php echo \$".$this->model_name."->".$index."?>' /> <br>
                <?php endif ?>
                <input id='".$index."' type='file' name='".$index."' />
                <br/>
                <?php echo form_error('".$index."'); ?>
                <?php  echo ( isset(\$upload_error['".$index."'])) ?  \$upload_error['".$index."']  : \"\"; ?>
                <br>
                ";
                }
                
                break;
                
                case 'file':
				case 'photo':
                
                if ( $value['multilanguage'] == "TRUE")
                {
                foreach ($this->languages as $prefix=>$language)
                {
                $data .= "
                <br>
                  <label class='labelform' for='".$index."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."_".$prefix."' type='file' name='".$index."_".$prefix."' />
                  <?php if (\$updType == 'edit'): ?>
                
                <br> <a href='<?php echo URLC.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/files/<?php echo \$".$this->model_name."->".$index."_".$prefix."?>' />Download actual file ".$index." (".$prefix.")</a> <br>
                <?php endif ?>
                <br/>
                <?php echo form_error('".$index."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['".$index."_".$prefix."'])) ?  \$upload_error['".$index."_".$prefix."']  : \"\"; ?></br>
                <br>
                ";
                }
                
                }
                else
                {
                $data .= "
                <br>
                  <label class='labelform' for='".$index."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    (".$index.") ".(($value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input id='".$index."' type='file' name='".$index."' />
                  <?php if (\$updType == 'edit'): ?>
                  <a href='<?php echo URLC.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/files/<?php echo \$".$this->model_name."->".$index."?>' />Download actual file (".$index.")</a>
                  <?php endif ?>
                  <br/>
                  <?php echo form_error('".$index."'); ?>
                  <?php  echo ( isset(\$upload_error['".$index."'])) ?  \$upload_error['".$index."']  : \"\"; ?></br>
                <br>
                ";
                }
                
                break;
                
                case 'hidden':
                
                $data .= "
                <input id='".$index."' type='hidden' name='".$index."' value='<?php echo \$".$index."?>'/>
                ";			
                
                break;
                }
                }
                
                
                $data .= "
                <br> <?php echo form_submit( 'submit', (\$updType == 'edit') ? lang('web_edit') : lang('web_add'), ((\$updType == 'create') ? \"id='submit' class='bcreateform'\" : \"id='submit' class='beditform'\")); ?> <br>
                <br> <input type=\"button\" id=\"disapprove\" class=\"btn\" value=\"Disapprove\"></input><input type=\"button\" id=\"cancel\" class=\"btn\" value=\"Cancel\"></input>
                <br>
                 <?php echo form_hidden('docid',set_value('docid', (isset(\$id)) ? \$id : ''  )) ?>
                <?php echo form_hidden('template',set_value('template', \$template)) ?>
                <?php echo form_hidden('permissions',set_value('permissions', \$permissions)) ?>
                <?php echo form_hidden('page',set_value('page', \$page)) ?>
                <?php if (\$updType == 'edit'): ?>
                <?php echo form_hidden('id',\$".$this->model_name."->_id) ?>
                <?php endif ?>
                <?php echo form_close(); ?><div id=\"reasons\">
                    <?php 
\$attributes = array('class' => 'tform', 'id' => '');
echo (\$updType == 'create') ? form_open_multipart('".$this->customer_folder."/".$this->controller_name."/disapprove', \$attributes) : form_open_multipart('".$this->customer_folder."/".$this->controller_name."/disapprove', \$attributes); 
?>
                    <p>
                      <label class='labelform' for='reason'>Reason</label>
                      <textarea id=\"reason\"  name=\"reason\"  />
                      <?php echo set_value('reason', (isset(\$".$this->model_name."->reason)) ? htmlspecialchars_decode(\$".$this->model_name."->reason) : ''); ?>
                      </textarea>
                    <?php echo form_error('reason'); ?> </p>
                      <input id=\"disapprover\" name=\"disapprover\" type=\"hidden\" value=\"\">
                      <input id=\"stage\" name=\"stage\" type=\"hidden\" value=\"\">
                      <div class=\"navbar\">
							<ul class=\"nav\">
								<li class=\"dropdown hidden-phone\">	
								<!-- start: User Dropdown -->
								<li class=\"dropdown\">
									<a class=\"btn popover-toggle\" data-toggle=\"dropdown\" id=\"all1\">Select the stage and user<span class=\"caret\"></span></a>
									<ul class=\"popover-menu messages\"><span class=\"close1\">&times;&nbsp;</span><div id='wrap1'></div></ul>
								</li>
				                </li>
							</ul>
				        </div>
                      <?php echo form_submit( 'submit', \"Submit\"); ?>
                      <?php echo form_close(); ?> </div>
                      </article>
	</div>
</div>
	<!-- END MAIN CONTENT -->

</div>
<!-- END MAIN PANEL -->
<!-- ==========================CONTENT ENDS HERE ========================== -->
  <script src='<?php echo(JS.'jquery.js'); ?>'></script>
  <script src='<?php echo(JS.'web_view_js.js'); ?>'></script>
  <script src='<?php echo(JS.'update.js'); ?>'></script>
  <script src=\"<?php echo(JS.'tooltip.js'); ?>\" type=\"text/javascript\"></script>
  <script src=\"<?php echo(JS.'popover.js'); ?>\" type=\"text/javascript\"></script>  
  
  <?php 
	//include required scripts
	include(\"inc/scripts.php\"); 
?> 
<script type=\"text/javascript\">
	// JavaScript Document
        \$(document).ready(function() {
        	//\$('div#student').hide();
        	\$('#student').hide();
        	\$('#working').hide();
        	\$('#reasons').hide();
        	\$('#cancel').hide();
        });
        \$('#disapprove').click(function(){
        	\$('#reasons').show();
        	\$('#disapprove').hide();
        	\$('#cancel').show();
        	});
        \$('#cancel').click(function(){
        	\$('#reasons').hide();
        	\$('#disapprove').show();
        	\$('#cancel').hide();
        	});
		\$('.close').hide();
		\$('.close1').hide();
		\$(\".close\").click(function(){	
			\$('#wrap').hide();
			\$('#wrap1').hide();
			\$('.close').hide();
		});
		\$(\".close1\").click(function(){	
			\$('#wrap1').hide();
			\$('.close1').hide();
		});
		objfull = {};

         permissions = \$('input[name=\"permissions\"]').val()
		per_obj = \$.parseJSON(permissions);
		template = \$('input[name=\"template\"]').val();
		app_obj = \$.parseJSON(template);
		var sections = new Array();
		var secindex = 0;
		var sec_per = new Array();
		var sec_per_index = 0;
		for(var page in app_obj){
			for(var sec in app_obj[page]){
				if($.inArray(sec,sections) == -1){
				sections[secindex]=sec;
				secindex ++;
				}
			}
		}

		for(var stage in per_obj){
			for(var per in per_obj[stage]){
				for(var sec in per_obj[stage][per]){
				if(\$.inArray(per_obj[stage][per][sec],sec_per) == -1){
					sec_per[sec_per_index]=per_obj[stage][per][sec];
					sec_per_index ++;
				}
			  }	
			}
		}
		final_array = [];
		var final_arr = 0;
		$.grep(sections, function(el) {
		    if ($.inArray(el, sec_per) == -1){
			    $( '#'+el ).remove();
		    }
		    final_arr++;
		});
		sec_view = [];
		var view_ind = 0;
		for(var stage in per_obj){
			sec_view = per_obj[stage]['View_Permissions'];
			sec_view=$.map(sec_view, function(n)
                { 
                    return(n.toLowerCase());
                });
			for(var sec in sec_view){
			\$(\"#\"+sec_view[sec]).children().attr(\"readonly\", 'readonly');
			\$(\"#\"+sec_view[sec]).children().addClass(\"blur\");
			\$('#'+sec_view[sec]).css('background-color', 'rgb(233,233,233)');
			}
		}
		\$(\"#all\").click(function(){
			\$('#wrap').show();
			if (typeof \$('input[name=\"id\"]').val() != 'undefined'){
				var doc_id = \$('input[name=\"id\"]').val();
			}else{
				var doc_id = '';
			}

			\$.ajax({
				url: 'get_all/'+doc_id,
				type: 'POST',
				success: function (data) {
					var obj = JSON.parse(data);
					objfull = obj;
					var li = \"\";
					for( var i in obj['all'] )
					 {
						stage = obj['all'][i];
						stage_qut = '\"'+stage+'\",\"'+i+'\"';
						if (obj['match'] == obj['all'][i])
						{
							li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class='icon-arrow-left icon-red'></i><i style='color:#F00'>You are here.!</li></span></a><div id='\"+i+\"'></div></li>\";
						}else{
					  	li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"</a><div id='\"+i+\"'></div></li>\";
						}
					 }
                      sessionValue = obj['username'];
					  \$('#disapprover').val(sessionValue);
					  \$('#wrap').html(\"<div id='stagelist'><ul>\"+li+\"</ul></div>\");
					  \$('.close').show();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});	
		});
		\$(\"#all1\").click(function(){
			\$('#wrap1').show();
			if (typeof \$('input[name=\"id\"]').val() != 'undefined'){
				var doc_id = \$('input[name=\"id\"]').val();
			}else{
				var doc_id = '';
			}
			\$.ajax({
				url: 'get_all/'+doc_id,
				type: 'POST',
				success: function (data) {
					var obj = JSON.parse(data);
					objfull = obj;
					var li = \"\";
					if(obj['match'] != obj['all'][0]){
                   var key = obj['all'].indexOf(obj['match']);
                   for(var i=0; i<key; i++)
					{
					stage = obj['all'][i];
					stage_qut = '\"'+stage+'\",\"'+i+'\"';
					li = li + \"<li id='\"+stage+\"' onClick='getusers1(\"+stage_qut+\")'><a>\"+stage+\"</a><div id='\"+i+\"1'></div></li>\";
					}
					}else{
					li = \"You are the initiator of this application!\";
					}
                      sessionValue = obj['username'];
					  $('#disapprover').val(sessionValue);
					  \$('#wrap1').html(\"<div id='stagelist'><ul>\"+li+\"</ul></div>\");
					  \$('.close1').show();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});	
		});
		
		getusers = (function(stage,i){
	
		var li = \"\";
		var td = \"\";
		for( var use in objfull.vitals[stage])
		{
			
			name = objfull.vitals[stage][use][0].first_name;
			phone = objfull.vitals[stage][use][0].phone;
			email = objfull.vitals[stage][use][0].email;
			td = td + \"<li>\"+name+\" <i class='fa fa-phone'></i>:\"+phone+\" <i class='fa fa-envelope'></i>:\"+email+\"</li>\";
		}
		\$('#'+i).html(\"<ol>\"+td+\"</ol>\");
		});
		getusers1 = (function(stage,i){
			
			\$('#stage').val(stage);
			var li = \"\";
			var td = \"\";
			for( var use in objfull.vitals[stage])
			{
				name = objfull.vitals[stage][use][0].first_name;
				phone = objfull.vitals[stage][use][0].phone;
				email = objfull.vitals[stage][use][0].email;
				td = td + \"<option value='\"+email+\"' >\"+name+\" <i class='icon-phone'></i>:\"+phone+\" <i class='icon-envelope'></i>:\"+email+\"</li></option>\";}
			\$('#'+i+\"1\").html(\"<select name='drop' id='drop'>\"+td+\"</select>\");
			
			});
		
		</script>
               
<?php 
	//include footer
	include(\"inc/footer.php\"); 
?>

                
       ";
		
		log_message('debug','MVC based on company create_view_createeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee');
        $this->create_folder_if_no_exists(APPPATH.'views/'.$this->customer_folder);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$this->customer_folder."/".$this->controller_name);

		if ( $this->save_file('create', "views/".$this->customer_folder."/".$this->controller_name."/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$this->controller_name."/create.php";
			return FALSE;
		} 
}

	function create_view_list()
	{
		
$data = "
<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed'); ?>
 <!-- MAIN CONTENT -->
	<div id=\"content\">
 ";
        
        foreach ($this->arrayjson as $pageno => $pages )
    	{
    		foreach($pages as $pagedata)
    		{
    			unset($pagedata['dont_use_this_name']);
    			foreach($pagedata as $index => $value)
    			{
        switch ($value['type'])
        {
        case 'text':
        case 'textarea':
        case 'image':
		case 'number':
		case 'password':
        case 'date':
		case 'time':
		case 'range':
		case 'color':
		case 'month':
		
         if ( $value['multilanguage'] == "TRUE")
        {
        	if($value['key'] == "TRUE")
	   {
        $data .= "
        <?php \$".$index." = '".$index."_'.\$this->config->item('prefix_language'); ?>
        ".$this->sl;
        }
        }
        break;
        }
    }
}
        }
        
        
        $data .= "
        <div class=\"jarviswidget jarviswidget-sortable col-md-5 date_form\" id=\"wid-id-7\" data-widget-editbutton=\"false\" data-widget-custombutton=\"false\" role=\"widget\">
						<header role=\"heading\">
							<span class=\"widget-icon\"> <i class=\"fa fa-search\"></i> </span>
							<h2>Name Value Search </h2>				
						</header>
						<!-- widget div-->
						<div role=\"content\">
							
							<!-- widget edit box -->
							<div class=\"jarviswidget-editbox\">
								<!-- This area used as dropdown edit box -->
								
							</div>
							<!-- end widget edit box -->
							
							<!-- widget content -->
							<div class=\"widget-body no-padding\">
					 <div class=\"smart-form\">			
	<fieldset class=\"key_value_search\">
			<section>
				<label class=\"label\">Select search field</label>
				<label class=\"select\">
				<select id=\"myselect\" class=\"input-sm\"></select> <i></i> </label>
			</section>
			<section>
				<label class=\"label\">Search value</label>
				<label class=\"input\">
					<input type=\"text\" id='srchTxt' class=\"input-sm\">
				</label>
			</section>
			<footer>
								<button type=\"submit\" id='srchbutton' class=\"btn btn-primary\">
									Search
								</button>
								
			</footer>
		</fieldset></div>
								
							</div>
							<!-- end widget content -->
							
						</div>
						<!-- end widget div -->
						
					</div>
					<div class=\"jarviswidget jarviswidget-sortable col-md-5 date_form\" id=\"wid-id-7\" data-widget-editbutton=\"false\" data-widget-custombutton=\"false\" role=\"widget\">
						<header role=\"heading\">
							<span class=\"widget-icon\"> <i class=\"fa fa-search\"></i> </span>
							<h2>Date Search </h2>				
						</header>

						<!-- widget div-->
						<div role=\"content\">
							
							<!-- widget edit box -->
							<div class=\"jarviswidget-editbox\">
								<!-- This area used as dropdown edit box -->
								
							</div>
							<!-- end widget edit box -->
							
							<!-- widget content -->
							<div class=\"widget-body no-padding\">
					 <div class=\"smart-form\">			
	<fieldset class=\"key_value_search\">
			<section>
			  <label class=\"label\">From</label>
			  <label class='input'>
			  <input type=\"date\" id=\"datefrom\" name=\"\" value=\"\" class=\"datepicker hasDatepicker input-sm\"></label>
			</section>
			<section>
			  <label class=\"label\">To</label>
			  <label class='input'><input type=\"date\" id=\"dateto\" name=\"\" value=\"\" class=\"datepicker hasDatepicker input-sm\"></label>
			</section>
			<footer>
			   <button type=\"submit\" id='datesearch' op='range' class=\"btn btn-primary\">Search</button>
			</footer>
		</fieldset></div>
								
							</div>
							<!-- end widget content -->
							
						</div>
						<!-- end widget div -->
						
					</div>
					<div class=\"smart-form\">

		<fieldset class=\"col-md-10\">
<div id='result' style='margin-bottom:20px'></div>
			  <button type=\"button\" id='btnfull' class=\"btn btn-default\" style='padding:6px 12px'>List all documents</button>
			  <button type=\"button\" op='last_doc' lim='false' off='false' class=\"btn btn-default web_history\" style='padding:6px 12px'>Last document</button>
			  <button type=\"button\" op='10_doc' lim='10' off='1' class=\"btn btn-default web_history\" style='padding:6px 12px'>Last 10 documents</button>
			  <button type=\"button\" op='hr' lim='false' off='false' class=\"btn btn-default web_history\" style='padding:6px 12px'>Last hour</button>
			  <button type=\"button\" op='today' lim='false' off='false' class=\"btn btn-default web_history\" style='padding:6px 12px'>Today</button>
			<div id='allDocs'>
			<button type=\"button\" id='btnClose' class=\"btn btn-default\" style='padding:6px 12px;margin-bottom:20px;'>Close</button> 
 
      
        <div class='clear'></div>
		
		<!-- SEARCH RESULT TABLE -->
        <table class='table table-bordered' cellpadding='5' cellspacing='0'>
        <thead class=\"list_head\">
		
        </thead>
		<tbody class=\"list_body\">
		
        </tbody>
		<tfoot class=\"list_footer\">
		
		</tfoot>
        </table>
        </div><!-- end: allDocs --> 
        </fieldset>
		</div><!-- smart-form div end-->
      </div>
<!-- END MAIN PANEL -->
<!-- ==========================CONTENT ENDS HERE ========================== -->
<script type=\"text/javascript\">
var total_page  = null;
var page_number = 1;

$('.list_head').empty();
$('.list_body').empty();
$('.list_footer').empty();
$('#result').html(\"\");
$('#allDocs').hide();

// USERNAME
$.ajax({
	url: '../".$this->customer_folder."/".$this->controller_name."/username',
	type: 'POST',
	success: function (data) {
			  div = '';
			  user = jQuery.parseJSON(data);
			  div = div + '<div>'+user+'</div>';
			  $('#webuser_username').html(div);
	},
	error: function (XMLHttpRequest, textStatus, errorThrown)
	{
	   
	}
})

// LISTING WIDGETS FOR SEARCH 
var opt =\"\";
$.ajax({
url: '../".$this->customer_folder."/".$this->controller_name."/get_widget',
type: 'POST',
success: function (data) {
	var wid = JSON.parse(data);
	var widget_names   = wid.widget;
	var widget_labels  = wid.widget_labels;
	var widget_types   = wid.widget_types;
	
	for( var i in widget_names)
	 {
		widget  = widget_names[i];
		wlabels = widget_labels[i];
		wtype   = widget_types[i];
		
		wlabels = wlabels.replace(/ /g,'#');
		
		opt= opt+\"<option type=\"+wtype+\" value=\"+wlabels+\">\"+widget+\"</option>\";
		
	 }
	 $('#myselect').append(''+opt+'');
	},
	error:function(XMLHttpRequest, textStatus, errorThrown)
	{
	 console.log('error', errorThrown);
	}
});

var web_doc_search = function(page_number,operation,from,to)
{
   $('.list_head').empty();
   $('.list_body').empty();
   $('.list_footer').empty();
   
   // Variable declaration
   var current_tr         = 1;
   var current_ext_attach = 1;
   
   // ajax call to fetch documents
   $.ajax({
		url: '../".$this->customer_folder."/".$this->controller_name."/web_doc_search',
		type:'POST',
		dataType:'json',
		data:{\"page_number\":page_number,\"operation\":operation,\"from\":from,\"to\":to},
		success:function(data)
		{
			var docs  = data.documents;
			var total = data.total_pages;
		  
			if(docs != 0)
			{
			  var first        = 1;
			  var headingcount = 1;
			  
			  for( var i in docs )
			  {
			     outer_level = docs[i];
				 for(var inner_level in outer_level)
				 { 
				    if(inner_level == \"_id\" || inner_level == \"history\" || inner_level == \"app_properties\" || inner_level == \"device_properties\")
					{
						delete outer_level[inner_level];
					}
				 }
				     		
				if(first == 1)
				{
				   $('<tr class=\"thead_tr\">').appendTo('.list_head')
				   for( var inner_level in outer_level )
				   {	   
					   if(inner_level==\"doc_data\")
					   {
						  var in_lev = outer_level[inner_level];
						  var page_details = in_lev.widget_data;
						  for(var pageno in page_details)
						  {
							  pages = page_details[pageno];
							  for(var sectionname in pages)
							  {
								var eledetails = pages[sectionname];
								for(var elename in eledetails)
								{
									if(headingcount < 5)
									{
									  $('<th>'+elename+'</th>').appendTo('.thead_tr');
									}
									   headingcount++; 
								}
							  }
						  } 

						  //External attached files
						  if(in_lev.external_attachments!=\"null\")
						 {

							$('<th>Externally Attached Files</th>').appendTo('.thead_tr')
						 }	  
					   }	
					}
					 
					 $('<th colspan=\"2\">Options</th>').appendTo('.thead_tr')
					 $('</tr>').appendTo('.list_head')
					
				}
                
				$('<tr id=\"'+current_tr+'\">').appendTo('.list_body');
						 
			    for( var inner_level in outer_level )
			    {						 
				    if(inner_level==\"doc_data\")
				    {
						var valuecount = 1;
                        var in_lev = outer_level[inner_level];
                        var page_details = in_lev.widget_data;
								
                        for(var pageno in page_details)
						{
							pages = page_details[pageno];
							for(var sectionname in pages)
							{
							   	var eledetails = pages[sectionname];
							   	for(var elename in eledetails)
						   	   	{
									var elevalue = eledetails[elename];
									if(typeof(elevalue) != \"object\")
									{
									    if(valuecount < 5)
										{
										  $('<td>' + elevalue + '</td>').appendTo('#'+current_tr+'')
										}
										valuecount++;
									}
									else
									{  
									    if(valuecount < 5)
										{
										  $('<td>*Multipe entries*</td>').appendTo('#'+current_tr+'')
										}	
										valuecount++;
								   }

						   	   	}
							}
					    }

							   	  //External attached files
							   	  if(in_lev.external_attachments!=\"null\")
                                {
								 
                                	var external_attachments = in_lev.external_attachments;
                                	var bool = jQuery.isEmptyObject(external_attachments);
                                	if(!bool)
                                	{
	                                	
										$('<td id=\"ext_'+current_tr+current_ext_attach+'\">').appendTo('#'+current_tr+'');
	                                	for(var file_details in external_attachments)
	                                	{
	                                		 var external_file_info = external_attachments[file_details];
	                                		 var filevalue = external_file_info['file_client_name'];
	                                		 var filePath = external_file_info['file_path'];
	                                		 TfilePath = filePath.replace(/\//g,'=');
											 $('<a target=\"_blank\" href=\"../".$this->customer_folder."/".$this->coll_name."_con/web_file_download/'+TfilePath+'\">\"'+filevalue+'\"</a><br>').appendTo('#ext_'+current_tr+current_ext_attach+'');
                                        }
										$('</td>').appendTo('#ext_'+current_tr+current_ext_attach+'');
                                    }
                                    else
                                    {
                                		
										$('<td>No External Files Attached</td>').appendTo('#'+current_tr+'');
                                    }
                                } 	  
				    }	
			    }
							 
				$('<td width=\"60\"><a class=\"lview doc_view\" cnt='+outer_level['doc_properties']['total_pages']+' aid=\"".$this->coll_name."\" did='+outer_level['doc_properties']['doc_id']+' href=\"javascript:void(0);\">View</a></td><td width=\"60\"><a class=\"lprint print_open\" cnt=\"".$this->pages."\" aid=\"".$this->coll_name."\" did='+outer_level['doc_properties']['doc_id']+' href=\"javascript:void(0);\">Print</a></td>').appendTo('#'+current_tr+'');
						  
				$('</tr>').appendTo('.list_body');
				first ++;
				current_tr++;
				current_ext_attach++;
              }
				
				$('.date_form').hide();
			    $('.web_history').hide();
			    $('#btnfull').hide();
						 
				// FOOTER
				$('<button  id=\"previous\" class=\"btn btn-xs btn-default txt-color-bluee\" op=\"'+operation+'\">&larr; Previous</button>&nbsp;<label>Page <label id=\"page_number\"></label> of <label id=\"total_page\"></label></label>&nbsp;<button  id=\"next\" class=\"btn btn-xs btn-default txt-color-bluee\" op=\"'+operation+'\">Next &rarr;</button>').appendTo('.list_footer')
						 
		    }
			else
			{
				$('#result').html(\"<h2>No results found.</h2>\");
			}
		  
			if(page_number==1)
			{
				$(\"#previous\").prop('disabled', true);
			}
			else
			{
				$(\"#previous\").prop('disabled', false);
			}
			if(page_number == total || total == null)
			{
				$(\"#next\").prop('disabled', true);
			}
			else
			{
				$(\"#next\").prop('disabled', false);
			}
			
			$(\"#page_number\").text(page_number);
			$(\"#total_page\").text(total);
			
		} 

		});
}

var web_doc_name_value_search = function(page_number,field,value,type)
{
   $('.list_head').empty();
   $('.list_body').empty();
   $('.list_footer').empty();
   
   // Variable declaration
   var current_tr         = 1;
   var current_ext_attach = 1;
   
   // ajax call to fetch documents
   $.ajax({
        url: '../".$this->customer_folder."/".$this->controller_name."/web_search',
		type: 'POST',
		data:{\"page_number\":page_number,\"field\":field,\"value\":value,\"type\":type},
		success:function(data)
		{
			var result_data = JSON.parse(data);
			var docs  = result_data.documents;
			var total = result_data.total_pages;
		  
			if(docs != 0)
			{
			  var first        = 1;
			  var headingcount = 1;
			  var details      = [];
			  
			  for( var i in docs )
			  {
			    
				outer_level = docs[i];
				for( var inner_level in outer_level )
				{ 
					if(inner_level == \"_id\" || inner_level == \"history\" || inner_level == \"app_properties\" || inner_level == \"device_properties\")
					{
						delete outer_level[inner_level];
					}
				}
				     		
				   if(first == 1)
				   {
					
					 $('<tr class=\"thead_tr\">').appendTo('.list_head')
					 for( var inner_level in outer_level )
					 {	   
					   if(inner_level==\"doc_data\")
					   {
						var in_lev = outer_level[inner_level];
						var page_details = in_lev.widget_data;
						for(var pageno in page_details)
						 {
							  pages = page_details[pageno];
							  for(var sectionname in pages)
							  {
								var eledetails = pages[sectionname];
								for(var elename in eledetails)
								{
									   if(headingcount < 5)
									   {
										 $('<th>'+elename+'</th>').appendTo('.thead_tr');
									   }
									   headingcount++; 
								}
							  }
						  } 

						  //External attached files
						  if(in_lev.external_attachments!=\"null\")
						 {

							$('<th>Externally Attached Files</th>').appendTo('.thead_tr')
						 }	  
					   }	
					 }
					 
					 $('<th colspan=\"2\">Options</th>').appendTo('.thead_tr')
					 $('</tr>').appendTo('.list_head')
					
				   }
                         $('<tr id=\"'+current_tr+'\">').appendTo('.list_body');
						 
						   for( var inner_level in outer_level )
						   {						 
						       if(inner_level==\"doc_data\")
						       {
						       	var valuecount = 1;
                                var in_lev = outer_level[inner_level];
                                var page_details = in_lev.widget_data;
								
                                for(var pageno in page_details)
						   	     {
							   	   	  pages = page_details[pageno];
							   	   	  for(var sectionname in pages)
							   	   	  {
							   	   	  	var eledetails = pages[sectionname];
							   	   	  	for(var elename in eledetails)
						   	   	 	    {
						   	   	 		    var elevalue = eledetails[elename];
						   	   	 		    if(typeof(elevalue) != \"object\")
						   	   	 		    {
											
													if(valuecount < 5)
													{
														
														$('<td>' + elevalue + '</td>').appendTo('#'+current_tr+'')
													}
													valuecount++;
											}
											else
											{
													if(valuecount < 5)
													{
														
														$('<td>*Multipe entries*</td>').appendTo('#'+current_tr+'')
													}	
													valuecount++;
										   }

						   	   	 		}
							   	   	  }
							   	  }

							   	  //External attached files
							   	  if(in_lev.external_attachments!=\"null\")
                                {
								 
                                	var external_attachments = in_lev.external_attachments;
                                	var bool = jQuery.isEmptyObject(external_attachments);
                                	if(!bool)
                                	{
	                                	
										$('<td id=\"ext_'+current_tr+current_ext_attach+'\">').appendTo('#'+current_tr+'');
	                                	for(var file_details in external_attachments)
	                                	{
	                                		 var external_file_info = external_attachments[file_details];
	                                		 var filevalue = external_file_info['file_client_name'];
	                                		 var filePath = external_file_info['file_path'];
	                                		 TfilePath = filePath.replace(/\//g,'=');
											 $('<a target=\"_blank\" href=\"../".$this->customer_folder."/".$this->coll_name."_con/web_file_download/'+TfilePath+'\">\"'+filevalue+'\"</a><br>').appendTo('#ext_'+current_tr+current_ext_attach+'');
	                                   }
										$('</td>').appendTo('#ext_'+current_tr+current_ext_attach+'')
                                    }
                                    else
                                    {
                                	   $('<td>No External Files Attached</td>').appendTo('#'+current_tr+'');
                                    }
                                } 	  
						       }	
						     }
							 
						   $('<td width=\"60\"><a class=\"lview doc_view\" cnt=\"".$this->pages."\" aid=\"".$this->coll_name."\" did='+outer_level['doc_properties']['doc_id']+' href=\"javascript:void(0);\">View</a></td><td width=\"60\"><a class=\"lprint print_open\" cnt=\"".$this->pages."\" aid=\"".$this->coll_name."\" did='+outer_level['doc_properties']['doc_id']+' href=\"javascript:void(0);\">Print</a></td>').appendTo('#'+current_tr+'');
						  
						   $('</tr>').appendTo('.list_body');
						   first ++;
						   current_tr++;
						   current_ext_attach++;
                         }
						 $('.date_form').hide();
					     $('.web_history').hide();
					     $('#btnfull').hide();
						  
						  // FOOTER
						  $('<button  id=\"name_value_search_previous\" class=\"btn btn-xs btn-default txt-color-bluee\" >&larr; Previous</button>&nbsp;<label>Page <label id=\"page_number\"></label> of <label id=\"total_page\"></label></label>&nbsp;<button  id=\"name_value_search_next\" class=\"btn btn-xs btn-default txt-color-bluee\">Next &rarr;</button>').appendTo('.list_footer')
					     }
                         else
                         {
                         	$('#result').html(\"<h2>No results found.</h2>\");
                         }
		 
			if(page_number==1)
			{
				$(\"#name_value_search_previous\").prop('disabled', true);
			}
			else
			{
				$(\"#name_value_search_previous\").prop('disabled', false);
			}
			if(page_number == total || total == null)
			{
				$(\"#name_value_search_next\").prop('disabled', true);
			}
			else
			{
				$(\"#name_value_search_next\").prop('disabled', false);
			}
			
		    $(\"#page_number\").text(page_number);
			$(\"#total_page\").text(total);
			
		} 

		});
}

<!-- LIST ALL DOCS -->
$('#btnfull').click(function(){
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	page_number = 1;
	web_doc_search(page_number,'all_docs','','');
})

<!-- DATE SEARCH -->
$(document).on('click','#datesearch',function(){
	page_number      = 1;
	var operation    = $(this).attr('op');
	var range_from   = $('#datefrom').val();
	var range_to     = $('#dateto').val();
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	web_doc_search(page_number,operation,range_from,range_to);
	
});

$(document).on('click','.web_history',function(){
	var operation  = $(this).attr('op');
	var limit      = $(this).attr('lim');
	var offset     = $(this).attr('off');
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	
	<!-- LAST DOC, LAST 10 DOCS, LAST HR, TODAY -->
	if(operation=='last_doc')
	{
	  web_doc_search(page_number,operation,'','');
	}
    else if(operation=='10_doc')
	{
      web_doc_search(page_number,operation,'','');
	}
    else if(operation=='hr')
	{
      web_doc_search(page_number,operation,'','');
	}
	else if(operation=='today')
	{
       web_doc_search(page_number,operation,'','');
	}	
	
})

<!-- NAME VALUE SEARCH -->
$('#srchbutton').click(function(){
	var field = $('#myselect').val();
	var text  = $('#srchTxt').val();
	var type  = $('#myselect option:selected').attr('type');
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	web_doc_name_value_search(page_number,field,text,type);
})

<!-- NAME VALUE SEARCH PREV BUTTON -->
$(document).on(\"click\",\"#name_value_search_previous\", function(){
	page_number = (page_number-1);
	var field = $('#myselect').val();
	var text  = $('#srchTxt').val();
	var type  = $('#myselect option:selected').attr('type');
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	web_doc_name_value_search(page_number,field,text,type);
})

<!-- NAME VALUE SEARCH NEXT BUTTON -->
$(document).on(\"click\",\"#name_value_search_next\", function(){
	page_number = (page_number+1);
	var field = $('#myselect').val();
	var text  = $('#srchTxt').val();
	var type  = $('#myselect option:selected').attr('type');
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	web_doc_name_value_search(page_number,field,text,type);
})	
	

	
<!-- PREV BUTTON -->
$(document).on(\"click\",\"#previous\", function(){
    var op = $('#previous').attr('op');
	page_number = (page_number-1);
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	
	switch(op)
	{
	  case 'all_docs':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case '10_doc':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'last_doc':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'range':
	  var range_from = $('#datefrom').val();
	  var range_to   = $('#dateto').val();
	  web_doc_search(page_number,op,range_from,range_to);
	  break;
	  
	  case 'today':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'hr':
	  web_doc_search(page_number,op,'','');
	  break;
	
	}
});

<!-- NEXT BUTTON -->
$(document).on(\"click\",\"#next\", function(){
   var op = $('#next').attr('op');
	page_number = (page_number+1);
	
	$('#allDocs').show();
	$('#btnfull').hide();
	$('.web_history').hide();
	$('.date_form').hide();
	
	switch(op)
	{
	  case 'all_docs':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case '10_doc':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'last_doc':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'range':
	  var range_from = $('#datefrom').val();
	  var range_to   = $('#dateto').val();
	  web_doc_search(page_number,op,range_from,range_to);
	  break;
	  
	  case 'today':
	  web_doc_search(page_number,op,'','');
	  break;
	  
	  case 'hr':
	  web_doc_search(page_number,op,'','');
	  break;
	
	}
});

<!-- CLOSE BUTTON -->
$('#btnClose').click(function(){
	$('#btnfull').show();
	$('#allDocs').hide();
	$('#result').html(\"\");
	$('.date_form').show();
	$('.web_history').show();
})

</script>
<script>
$(document).ready(function() {

 $('.list_head').empty();
 $('.list_body').empty();
 $('.list_footer').empty();
   
	<?php if(\$message) { ?>
$.smallBox({
				title : \"<i class='fa fa-info-circle'></i>&nbsp;&nbsp; Message\",
				content : \"<?php echo \$message?>\",
				color : \"#296191\",
				iconSmall : \"fa fa-bell bounce animated\",
				timeout : 4000
			});
<?php } ?>
})
</script>
";
        log_message('debug','MVC based on company create_view_list');
        $this->create_folder_if_no_exists(APPPATH.'views/'.$this->customer_folder);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$this->customer_folder."/".$this->controller_name);

		if ( $this->save_file('list', "views/".$this->customer_folder."/".$this->controller_name."/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$this->controller_name."/list.php";
			return FALSE;
		} 
		
	}

	function write_config($companyname,$controllername)
	{
	
		$data = "";
		$data .= "
		<?php
	
	
\$directory = realpath(dirname(__FILE__));
\$document_root = realpath(\$_SERVER['DOCUMENT_ROOT']);
\$base_url = ( isset(\$_SERVER['HTTPS']) && \$_SERVER['HTTPS']=='on' ? 'https' : 'http' ) . '://' .
    \$_SERVER['HTTP_HOST'];
if(strpos(\$directory, \$document_root)===0) {
    \$base_url .= str_replace(DIRECTORY_SEPARATOR, '/', substr(\$directory, strlen(\$document_root)));
}
	
defined(\"APP_URL\") ? null : define(\"APP_URL\", str_replace(\"/lib\", \"\", \$base_url));
//Assets URL, location of your css, img, js, etc. files
defined(\"ASSETS_URL\") ? null : define(\"ASSETS_URL\", APP_URL);
	
?>
	
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('config', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/config.php";
			return FALSE;
		}
	}
	
   function write_config_ui($companyname,$controllername)
	{
	
		$data = "";
	
	
	
		$data .= "
	
	     <?php
	
//CONFIGURATION for SmartAdmin UI
	
	
\$breadcrumbs = array(
	\"Home\" => URL
);
	
\$page_nav = array(
    \"home\" => array(
		\"title\" => \"DashBoard\",
		\"url\" => URL.\"web/index\",
		\"icon\" => \"fa-home\"
	),
	\"Getstarted\" => array(
		\"title\" => \"Get Started\",
		\"url\" => URL.\"help/user_index\",
		\"icon\" => \"fa-thumbs-up\"
	),
	\"apps\" => array(
		\"title\" => \"Apps\",
		\"url\" => URL.\"web/apps\",
		\"icon\" => \"fa-folder-open-o\",
	),
	\"documents\" => array(
		\"title\" => \"Documents\",
		\"url\" => URL.\"web/docs\",
		\"icon\" => \"fa-pencil\",
	
	),
	\"documentsearch\" => array(
		\"title\" => \"Document Search\",
		\"url\" => URL.\"web/doc_search\",
		\"icon\" => \"fa-search\",
	
	),
	\"changepassword\" => array(
		\"title\" => \"Change Password\",
		\"url\" => URL.\"web/change_password\",
		\"icon\" => \"fa-exchange\",
	
	),
    \"logout\" => array(
		\"title\" => \"Logout\",
		\"url\" => URL.\"auth/logout\",
		\"icon\" => \"fa-sign-out\"
	)
);
	
//configuration variables
\$page_title = \"\";
\$page_css = array();
\$no_main_header = false; //set true for lock.php and login.php
\$page_body_prop = array(); //optional properties for <body>
?>
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('config.ui', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/config.ui.php";
			return FALSE;
		}
	}
	
	function write_header($companyname,$controllername)
	{
	
		$data = "";
	
	
	
		$data .= "
	
         <!DOCTYPE html>
         <html lang=\"en-us\">
	     <head>
		<meta charset=\"utf-8\">
		<!--<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">-->
	
		<title><?php echo \$page_title != \"\" ? \$page_title.\" - \" : \"\"; ?>My DashBoard</title>
		<meta name=\"description\" content=\"\">
		<meta name=\"author\" content=\"\">
		
		<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">
	
		<!-- Basic Styles -->
		<link href=\"<?php echo(CSS.'bootstrap.min.css'); ?>\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />
        <link href=\"<?php echo(CSS.'font-awesome.min.css'); ?>\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />
        <link href=\"<?php echo(CSS.'smartadmin-production.css'); ?>\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />
        <link href=\"<?php echo(CSS.'smartadmin-skins.css'); ?>\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />
        <link href=\"<?php echo(CSS.'demo.css'); ?>\" media=\"screen\" rel=\"stylesheet\" type=\"text/css\" />
	
		<!-- SmartAdmin RTL Support is under construction
		<link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"<?php /*?><?php echo ASSETS_URL; ?><?php */?>/css/smartadmin-rtl.css\"> -->
	
		<!-- We recommend you use \"your_style.css\" to override SmartAdmin
		     specific styles this will also ensure you retrain your customization with each SmartAdmin update.
		<link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"<?php /*?><?php echo ASSETS_URL; ?><?php */?>/css/your_style.css\"> -->
	
	<?php /*?>	<?php
	
			if (\$page_css) {
				foreach (\$page_css as \$css) {
					echo '<link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"'.ASSETS_URL.'/css/'.\$css.'\">';
				}
			}
		?>
<?php */?>
	
		<!-- FAVICONS -->
		<link rel=\"shortcut icon\" href=\"<?php echo IMG; ?>ico/favicon.png\" type=\"image/x-icon\">
		<link rel=\"icon\" href=\"<?php echo IMG; ?>ico/favicon.png\" type=\"image/x-icon\">
	
		<!-- GOOGLE FONT -->
		<link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700\">
	
		<!-- Specifying a Webpage Icon for Web Clip
			 Ref: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html -->
		<link rel=\"apple-touch-icon\" href=\"<?php echo IMG; ?>splash/sptouch-icon-iphone.png\">
		<link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"<?php echo IMG; ?>splash/touch-icon-ipad.png\">
		<link rel=\"apple-touch-icon\" sizes=\"120x120\" href=\"<?php echo IMG; ?>splash/touch-icon-iphone-retina.png\">
		<link rel=\"apple-touch-icon\" sizes=\"152x152\" href=\"<?php echo IMG; ?>splash/touch-icon-ipad-retina.png\">
	
		<!-- iOS web-app metas : hides Safari UI Components and Changes Status Bar Appearance -->
		<meta name=\"apple-mobile-web-app-capable\" content=\"yes\">
		<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\">
	
		<!-- Startup image for web apps -->
		<link rel=\"apple-touch-startup-image\" href=\"<?php echo IMG; ?>splash/ipad-landscape.png\" media=\"screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:landscape)\">
		<link rel=\"apple-touch-startup-image\" href=\"<?php echo IMG; ?>splash/ipad-portrait.png\" media=\"screen and (min-device-width: 481px) and (max-device-width: 1024px) and (orientation:portrait)\">
		<link rel=\"apple-touch-startup-image\" href=\"<?php echo IMG; ?>splash/iphone.png\" media=\"screen and (max-device-width: 320px)\">
	
	</head>
	<body
		<?php
			if (\$page_body_prop) {
				foreach (\$page_body_prop as \$prop_name => \$value) {
					echo \$prop_name.'=\"'.\$value.'\" ';
				}
			}
	
		?>
	>
		<!-- POSSIBLE CLASSES: minified, fixed-ribbon, fixed-header, fixed-width
			 You can also add different skin classes such as \"smart-skin-1\", \"smart-skin-2\" etc...-->
		<?php
			if (!\$no_main_header) {
	
		?>
				<!-- HEADER -->
				<header id=\"header\">
					<div id=\"logo-group\">
	
						<!-- PLACE YOUR LOGO HERE -->
						<span id=\"logo\"> <img src=\"<?php echo IMG; ?>logo-cut.png\" alt=\"SmartAdmin\"> </span>
						<!-- END LOGO PLACEHOLDER -->
	
						<!-- Note: The activity badge color changes when clicked and resets the number to 0
						Suggestion: You may want to set a flag when this happens to tick off all checked messages / notifications -->
						<span id=\"activity\" class=\"activity-dropdown\"> <i class=\"fa fa-user\"></i> <b class=\"badge\"> 21 </b> </span>
	
						<!-- AJAX-DROPDOWN : control this dropdown height, look and feel from the LESS variable file -->
						<div class=\"ajax-dropdown\">
	
							<!-- the ID links are fetched via AJAX to the ajax container \"ajax-notifications\" -->
							<div class=\"btn-group btn-group-justified\" data-toggle=\"buttons\">
								<label class=\"btn btn-default\">
									<input type=\"radio\" name=\"activity\" id=\"<?php echo URL; ?>/ajax/notify/mail.php\">
									Msgs (14) </label>
								<label class=\"btn btn-default\">
									<input type=\"radio\" name=\"activity\" id=\"<?php echo URL; ?>/ajax/notify/notifications.php\">
									notify (3) </label>
								<label class=\"btn btn-default\">
									<input type=\"radio\" name=\"activity\" id=\"<?php echo URL; ?>/ajax/notify/tasks.php\">
									Tasks (4) </label>
							</div>
	
							<!-- notification content -->
							<div class=\"ajax-notifications custom-scroll\">
	
								<div class=\"alert alert-transparent\">
									<h4>Click a button to show messages here</h4>
									This blank page message helps protect your privacy, or you can show the first message here automatically.
								</div>
	
								<i class=\"fa fa-lock fa-4x fa-border\"></i>
	
							</div>
							<!-- end notification content -->
	
							<!-- footer: refresh area -->
							<span> Last updated on: 12/12/2013 9:43AM
								<button type=\"button\" data-loading-text=\"<i class='fa fa-refresh fa-spin'></i> Loading...\" class=\"btn btn-xs btn-default pull-right\">
									<i class=\"fa fa-refresh\"></i>
								</button> </span>
							<!-- end footer -->
	
						</div>
						<!-- END AJAX-DROPDOWN -->
					</div>
	
					<div class=\"pull-right\">
	
						<!-- collapse menu button -->
						<div id=\"hide-menu\" class=\"btn-header pull-right\">
							<span> <a href=\"javascript:void(0);\" title=\"Collapse Menu\"><i class=\"fa fa-reorder\"></i></a> </span>
						</div>
						<!-- end collapse menu -->
	
						<!-- logout button -->
						<div id=\"logout\" class=\"btn-header transparent pull-right\">
							<span> <a href=\"<?php echo URL; ?>auth/logout\" title=\"Sign Out\" data-logout-msg=\"You can improve your security further after logging out by closing this opened browser\"><i class=\"fa fa-sign-out\"></i></a> </span>
						</div>
						<!-- end logout button -->
	
						<!-- search mobile button (this is hidden till mobile view port) -->
						<div id=\"search-mobile\" class=\"btn-header transparent pull-right\">
							<span> <a href=\"javascript:void(0)\" title=\"Search\"><i class=\"fa fa-search\"></i></a> </span>
						</div>
						<!-- end search mobile button -->
	
                        <!-- profile start-->
						<div id=\"my-profile\" class=\"btn-header transparent pull-right\">
						<span>
						<a href=\"<?php echo URL.\"web/profile\" ?>\"><span><i class=\"glyphicon glyphicon-user\"></i> </a>
						</span>
						</div>
						<!-- profile end -->
						<!-- fullscreen button -->
						<!--<div id=\"fullscreen\" class=\"btn-header transparent pull-right\">
							<span> <a href=\"javascript:void(0);\" onclick=\"launchFullscreen(document.documentElement);\" title=\"Full Screen\"><i class=\"fa fa-fullscreen\"></i></a> </span>
						</div>-->
						<!-- end fullscreen button -->
	
					</div>
					<!-- end pulled right: nav area -->
	
				</header>
				<!-- END HEADER -->
	
				<!-- SHORTCUT AREA : With large tiles (activated via clicking user name tag)
				Note: These tiles are completely responsive,
				you can add as many as you like
				-->
				<!-- END SHORTCUT AREA -->
	
		<?php
			}
		?>
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('header', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/header.php";
			return FALSE;
		}
	}
	
	function write_footer($companyname,$controllername)
	{
	
		$data = "";
		$data .= "
	
		<!-- Your GOOGLE ANALYTICS CODE Below -->
		<script type=\"text/javascript\">
			var _gaq = _gaq || [];
				_gaq.push(['_setAccount', 'UA-XXXXXXXX-X']);
				_gaq.push(['_trackPageview']);
		
			(function() {
				var ga = document.createElement('script');
				ga.type = 'text/javascript';
				ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(ga, s);
			})();
	
		</script>
	
	</body>
	
</html>
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('footer', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/footer.php";
			return FALSE;
		}
	}
	
	function write_nav($companyname,$controllername)
	{
	
		$data = "";
		$data .= "
	
				<!-- Left panel : Navigation area -->
		<!-- Note: This width of the aside area can be adjusted through LESS variables -->
		<aside id=\"left-panel\">
	
			<!-- User info -->
			<div class=\"login-info\">
				<span> <!-- User image size is adjusted inside CSS, it should stay as it -->
			
					<a href=\"javascript:void(0);\" id=\"show-shortcut\">
						<?php if(@getimagesize(PROFILE_IMG)) { ?>
						<img src=\"<?php echo PROFILE_IMG; ?>\" alt=\"me\" class=\"online\" /><?php } else if(@getimagesize(USR_PROFILE_IMG)){ ?>
						<img src=\"<?php echo USR_PROFILE_IMG; ?>\" alt=\"me\" class=\"online\" /><?php } else { ?>
						<img src=\"<?php echo IMG; ?>/avatars/male.png\" alt=\"me\" class=\"online\" /><?php } ?>
						<span>
						<div class=\"nav pull-right\" id=\"webuser_username\"></div>
						</span>
	
					</a>
			
				</span>
			</div>
			<!-- end user info -->
	
			<!-- NAVIGATION : This navigation is also responsive
	
			To make this navigation dynamic please make sure to link the node
			(the reference to the nav > ul) after page load. Or the navigation
			will not initialize.
			-->
			<nav>
				<!-- NOTE: Notice the gaps after each icon usage <i></i>..
				Please note that these links work a bit different than
				traditional hre=\"\" links. See documentation for details.
				-->
				<ul>
					<?php
						foreach (\$page_nav as \$key => \$nav_item) {
							//process parent nav
							\$nav_htm = '';
							\$url = isset(\$nav_item[\"url\"]) ? \$nav_item[\"url\"] : \"#\";
							\$icon_badge = isset(\$nav_item[\"icon_badge\"]) ? '<em>'.\$nav_item[\"icon_badge\"].'</em>' : '';
							\$icon = isset(\$nav_item[\"icon\"]) ? '<i class=\"fa fa-lg fa-fw '.\$nav_item[\"icon\"].'\">'.\$icon_badge.'</i>' : \"\";
							\$nav_title = isset(\$nav_item[\"title\"]) ? \$nav_item[\"title\"] : \"(No Name)\";
							\$label_htm = isset(\$nav_item[\"label_htm\"]) ? \$nav_item[\"label_htm\"] : \"\";
							\$nav_htm .= '<a href=\"'.\$url.'\" title=\"'.\$nav_title.'\">'.\$icon.' <span class=\"menu-item-parent\">'.\$nav_title.'</span>'.\$label_htm.'</a>';
	
							if (isset(\$nav_item[\"sub\"]) && \$nav_item[\"sub\"])
								\$nav_htm .= process_sub_nav(\$nav_item[\"sub\"]);
	
							echo '<li '.(isset(\$nav_item[\"active\"]) ? 'class = \"active\"' : '').'>'.\$nav_htm.'</li>';
						}
	
						function process_sub_nav(\$nav_item) {
							\$sub_item_htm = \"\";
							if (isset(\$nav_item[\"sub\"]) && \$nav_item[\"sub\"]) {
								\$sub_nav_item = \$nav_item[\"sub\"];
								\$sub_item_htm = process_sub_nav(\$sub_nav_item);
							} else {
								\$sub_item_htm .= '<ul>';
								foreach (\$nav_item as \$key => \$sub_item) {
									\$url = isset(\$sub_item[\"url\"]) ? \$sub_item[\"url\"] : \"#\";
									\$icon = isset(\$sub_item[\"icon\"]) ? '<i class=\"fa fa-lg fa-fw '.\$sub_item[\"icon\"].'\"></i>' : \"\";
									\$nav_title = isset(\$sub_item[\"title\"]) ? \$sub_item[\"title\"] : \"(No Name)\";
									\$label_htm = isset(\$sub_item[\"label_htm\"]) ? \$sub_item[\"label_htm\"] : \"\";
									\$sub_item_htm .=
										'<li '.(isset(\$sub_item[\"active\"]) ? 'class = \"active\"' : '').'>
											<a href=\"'.\$url.'\">'.\$icon.' '.\$nav_title.\$label_htm.'</a>
											'.(isset(\$sub_item[\"sub\"]) ? process_sub_nav(\$sub_item[\"sub\"]) : '').'
										</li>';
								}
								\$sub_item_htm .= '</ul>';
							}
							return \$sub_item_htm;
						}
	
	
					?>
				</ul>
	
			</nav>
			<span class=\"minifyme\"> <i class=\"fa fa-arrow-circle-left hit\"></i> </span>
	
		</aside>
		<!-- END NAVIGATION -->
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('nav', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/nav.php";
			return FALSE;
		}
	}
	
	function write_ribbon($companyname,$controllername)
	{
	
		$data = "";
		$data .= "
	
			<!-- RIBBON -->
	<div id=\"ribbon\">
	
		<span class=\"ribbon-button-alignment\"> <span id=\"refresh\" class=\"btn btn-ribbon\" data-title=\"refresh\"  rel=\"tooltip\" data-placement=\"bottom\" data-original-title=\"<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings.\" data-html=\"true\"><i class=\"fa fa-refresh\"></i></span> </span>
	
		<!-- breadcrumb -->
		<ol class=\"breadcrumb\">
			<?php
				foreach (\$breadcrumbs as \$display => \$url) {
					\$breadcrumb = \$url != \"\" ? '<a href=\"'.\$url.'\">'.\$display.'</a>' : \$display;
					echo '<li>'.\$breadcrumb.'</li>';
				}
				echo '<li>'.\$page_title.'</li>';
			?>
		</ol>
		<div class=\"pull-right btn-group dropdown dropdown-large\">
													<button class=\"btn dropdown-toggle btn-xs btn-default btn-circle\" data-toggle=\"dropdown\" style=\"margin-top:5px;\">
										 <i class=\"fa fa-question\"></i>
									</button>
													<ul class=\"dropdown-menu\">
														<li class=\"dropdown-header\">
												Apps
											</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_fill_forms\"?>\"><span><i class=\"icon-leaf\"></i> Filling Forms</span></a>
														</li>
														<li class=\"divider\"></li>
														<li class=\"dropdown-header\">
												Docs
											</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_access_documents\"?>\"><span><i class=\"icon-leaf\"></i> Accessing Documents </span></a>
														</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_view_documents\"?>\"><span><i class=\"icon-leaf\"></i> Viewing Documents </span></a>
														</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_edit_documents\"?>\"><span><i class=\"icon-leaf\"></i> Editing Documents </span></a>
														</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_search_documents\"?>\"><span><i class=\"icon-leaf\"></i> Searching Documents </span></a>
														</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_delete_documents\"?>\"><span><i class=\"icon-leaf\"></i> Deleting Documents </span></a>
														</li>
														<li class=\"divider\"></li>
														<li>
															<a href=\"<?php echo URL.\"help/user_edit_profile\"?>\"><span><i class=\"icon-leaf\"></i> Editing Profile </span></a>
														</li>
														<li>
															<a href=\"<?php echo URL.\"help/user_change_password\"?>\"><span><i class=\"icon-leaf\"></i> Changing Password </span></a>
														</li>
													</ul>
												</div><!-- /btn-group -->
		<!-- end breadcrumb -->
	
	
	</div>
	<!-- END RIBBON -->
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('ribbon', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/ribbon.php";
			return FALSE;
		}
	}
	
	function write_scripts($companyname,$controllername)
	{
	
		$data = "";
		$data .= "
	
		<script src=\"<?php echo(JS.'jquery.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery-ui.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'bootstrap.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'SmartNotification.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jarvis.widget.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.easy-pie-chart.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.sparkline.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.validate.min.js');?>\" type=\"text/javascript\"></script>
		<script src=\"<?php echo(JS.'additional-methods.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.maskedinput.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.select2.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'bootstrap-slider.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'jquery.mb.browser.min.js');?>\" type=\"text/javascript\"></script>
        <script src=\"<?php echo(JS.'fastclick.js');?>\" type=\"text/javascript\"></script>
        <!--<script src=\"<?php echo(JS.'demo.js');?>\" type=\"text/javascript\"></script>-->
        <script src=\"<?php echo(JS.'app.js');?>\" type=\"text/javascript\"></script>
		<script src=\"<?php echo(JS.'subdaysleft.js');?>\" type=\"text/javascript\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.cust.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.resize.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.fillbetween.min.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.orderBar.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.pie.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.tooltip.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.time.min.js\"></script>
		<script src=\"<?php echo JS; ?>flot/jquery.flot.axislabels.js\"></script>
		<!-- PACE LOADER - turn this on if you want ajax loading to show (caution: uses lots of memory on iDevices)-->
		<script data-pace-options='{ \"restartOnRequestAfter\": true }' src=\"<?php echo(JS.'pace.min.js');?>\"></script>
	
	
		<script type=\"text/javascript\">
	
			// DO NOT REMOVE : GLOBAL FUNCTIONS!
		
			$(document).ready(function() {
				pageSetUp();
			})
	
		</script>
	
       ";
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername.'/inc');
	
		if ( $this->save_file('scripts', "views/".$companyname."/".$controllername."/"."inc/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."inc/"."/scripts.php";
			return FALSE;
		}
	}	
	
	//
	public function create_single_stage_web_view_elements_for_both_permissions($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$coll_ref=false,$field_ref=false,$list=false)
	{
		$data = "";
		$res_data = array();
		
		switch($val['type'])
                                         {
											 
											 case 'retriever':
											  
											  if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
													$result_data = $this->create_single_stage_web_view_elements_for_both_permissions($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$val['coll_ref'],$val['field_ref'],$val['retrieve_list']);
													//$data.= $result_data;
													$data .= $result_data['data']; 
													$client_validation_rules  = $result_data['client_validation_rules']; 
													$client_validation_messages  = $result_data['client_validation_messages']; 
												}
												break;
												
											  case 'mapper':
											   if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
											      $result_data = $this->create_single_stage_web_view_elements_for_both_permissions($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,"",$val['field_ref'],"");
												  //$data.= $result_data;
												  $data .= $result_data['data']; 
												  $client_validation_rules  = $result_data['client_validation_rules']; 
												  $client_validation_messages  = $result_data['client_validation_messages']; 
												}
											  break;
											  
                                              case 'text':
											  
											  if($val['multilanguage'] == "TRUE")
											  {
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													
													if((array_key_exists('parent',$val))) {
													if($val['parent'] == "retriever")
													{
														$list = json_encode($list);
														$list = base64_encode($list);
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
													}
													else if($val['parent'] == "mapper")
													{
														$field = explode("_",$field_ref);
														$mapper_doc = 'mapper_doc';
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' rel='".$field_ref."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
													}
													}
													else
													{
													
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
								log_message('debug','client_validation_rules======13371'.print_r($client_validation_rules,true));
								
								log_message('debug','client_validation_rules======13373'.print_r($client_validation_messages,true));
                                								
				                                     }
												}
													 else
													 {
													     $data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle '></div></div></div>
													     ";
													$section_class="section_writable";
													$element_class="margin_writable";														 
													 }
												} 
												break;
											
	                                        case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
													$instruction = str_replace("\n","<br>",$val['instructions']);
										
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";

													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
											
											
											case 'number':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													if($val['key'] == "TRUE")
													{
													
													if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "retriever")
														{
															$list = json_encode($list);
														    $list = base64_encode($list);
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode("_",$field_ref);
														    $mapper_doc = 'mapper_doc';
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
													}
													else
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}				
												}
												break;
	                                        
											case 'mobile':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : ''); ?>\"  /><input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											
											        if((array_key_exists('parent',$val))) 
													{
												        if($val['parent'] == "retriever")
														{
													        $list = json_encode($list);
														    $list = base64_encode($list);
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															$country_code_ref = $field_ref."_country_code";
							                                $mob_num_ref = $field_ref."_mob_num";
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' rel='".$country_code_ref."' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['country_code'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' rel='".$mob_num_ref."' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['mob_num'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
													}
													
                                $client_validation_rules .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:1,maxlength:3},".$this->sl;
								
								$client_validation_rules .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
                                
                                $client_validation_messages .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;							
									   
												}
											break;
											
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                   <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='password' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='password' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl; 	

								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                								
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											if((array_key_exists('parent',$val))) 
											{
										        
												if($val['parent'] == "retriever")
												{
											       $list = json_encode($list);
												   $list = base64_encode($list);
															
											       $data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
												}
												else if($val['parent'] == "mapper")
												{
													$field = explode('_',$field_ref);
													$mapper_doc='mapper_doc';
													
													$data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
												}
											}
											else
											{
													$data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
											}
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;								
												}
												 
												break;
	
											case 'time':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='time' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='time' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='range' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>".$val['maxrange']."
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='range' name='page".$pgno."_".$section_name."_".$index_name."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>".$val['maxrange']."
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='color' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='color' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                 <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='month' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='month' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;													
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'  name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'/>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data .="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle '></div><div class='hr '></div><div class='hr '></div></div></div>
													";
													$section_class="section_writable";
													$element_class="margin_writable";													
													}
												}
												else
												{
												
												 if($val['key'] == "TRUE")
												 {
													 if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "retriever")
														{
															$list = json_encode($list);
														    $list = base64_encode($list);
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? htmlspecialchars_decode(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}				
												}
												else
												{
												$data .=" <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div> ";
													$section_class="section_writable";
													$element_class="margin_writable";												
												}
												
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <div class='".$element_class." inline-block'><input id='page".$pgno."_".$section_name."_".$index_name."' ".(($val['checked'] == "TRUE") ?  ' checked '  :  '')."type='checkbox' name='page".$pgno."_".$section_name."_".$index_name."' value='1' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '1', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )?> />
                  
                  <label class='labelforminline' for='".$index_name."'>".$val['label']." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
	
												break;
	
											case 'checkbox':
											if ($val['multilanguage'] == "TRUE")
												{
												
												foreach ($languages as $prefix=>$language)
													{
												$data .= "
                
                  <label class='labelform'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' name='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' id='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_".$prefix."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " <?php echo form_error('ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"'); ?> 
                ";
				                                }
				                                } 
				                              else
				                               {
												   
												if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
				                   $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div style='max-width:600px'>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'><input class='icheck_radio' type='checkbox' rel='".$field_ref."' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['".$c."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['".$c."'] : ''  );?> >
                   ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " </div><?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?></div> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";
														}
													}
													else
													{
				
				                   $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div style='max-width:600px'>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'><input class='icheck_radio' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'] : ''  );?> >
                   ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= "</div><?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?></div> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";
										}
										
								$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                    
																		
				                               }
												break;
	
	
											case 'MChoice':
											if($val['multilanguage']=="TRUE")
											{
											
											foreach ($languages as $prefix=>$language)
													{
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."[]' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
				                           }
										   } 
				                           else
				                           {
									   
									   if((array_key_exists('parent',$val))) 
									   {
											if($val['parent'] == "mapper")
											{
												$field = explode('_',$field_ref);
												$mapper_doc='mapper_doc';
												
												$data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' multiple name='page".$pgno."_".$section_name."_".$index_name."[]' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
											}
										}
										else
										{
				   $data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' multiple name='page".$pgno."_".$section_name."_".$index_name."[]' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
										}
										
                   $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				   $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
				
				                           }
												break;
	
											case 'select':
											if((array_key_exists('parent',$val))) 
											{
												if($val['parent'] == "mapper")
												{
													$field = explode('_',$field_ref);
													$mapper_doc='mapper_doc';
													
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
												}
											}
											else
											{
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
											}
											
                  $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
												break;
	
	
											case 'selectbd':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."' size='".$val['size']."'>
                  <option value=''>
                  <?php echo lang('web_choose_option')?>
                  </option>
                  <?php foreach (\$array_".strtolower($val['options']['model'])." as \$item): ?>
                  <option value=\"<?php echo \$item->".$val['options']['field_value'].";?>\" <?php echo preset_select('page".$pgno."_".$section_name."_".$index_name."', \$item->".$val['options']['field_value'].", (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                  <?php echo \$item->".$val['options']['field_text'].";?>
                  </option>
                  <?php endforeach ?>
                  ";
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
												break;
	
											case 'radio':
											if((array_key_exists('parent',$val))) 
											{
												if($val['parent'] == "mapper")
												{
													$field = explode('_',$field_ref);
													$mapper_doc='mapper_doc';
													
													$data .= "
                <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= "</div> ";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";
												}
											}
											else
											{
												$data .= "
                <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= "</div> ";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";	
											}

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
	
												break;
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                 <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='' class='datepicker' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']->format('d-m-Y') : ''); ?>\"  />
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
	
                <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']?>' /> 
                <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                     <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']?>' /> 
                
                <input id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
												}
	
												break;
	
											case 'file':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a> <?php endif ?></div>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' ".(($val['required'] == "TRUE") ? "required":"") ."/>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
													
						$max_size 	       = $val['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						$allowed_types = $val['upload']['allowed_types'];
						
						$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
                        $client_validation_rules.="filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;
						
						
                        $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                        $client_validation_messages .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;

                                    													
												}
	
												break;
											
                                               case 'photo':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])):?>
					<div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path'];?>')\" for='".$index_name."_".$prefix."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."_".$prefix."'></div>
				  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				   <?php endif ?></div>
                   <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                   <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
					<div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."'/>
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."'></div>
				  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
                                
								$min_size  = $val['upload']['min_size'];
						$min_size_in_bytes = $min_size * 1024;
						
								$max_size  = $val['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						
						$allowed_types = $val['upload']['allowed_types'];

				        $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";	
						$client_validation_rules.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;
						
                        $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
						$client_validation_messages .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						
						}
	
												break;
												
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;	

                                            case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;

								//-----PARAGRAPH ELEMENT==START-----//
                                            case 'paragraph':
											if($val['multilanguage'] == "TRUE")
											{
											  foreach($languages as $prefix=>$language)
											  {
												  foreach($val['para_text'] as $para_index =>$para_value)
												  {
													switch($para_value['source'])
													{
													   case 'para':
													   $data.="";
													   break;
													   
													   case 'new_para':
													   $data.="";
													   break;
													   
													   case 'widget':
													   switch($para_value['type'])
													   {
														  case 'text':
														  break;
													   }
													   break;
													}
												  }
											  }
											}
											else
											{
											   foreach($val['para_text'] as $para_index =>$para_value)
											  {
											    switch($para_value['source'])
												{
												   case 'para':
												   if($para_value['multilanguage'] == "TRUE")
												   {
												      foreach ($languages as $prefix=>$language)
											          {
												         $data.="".$para_value['text']."";
													  }	 
												   }
												   else
												   {
												      $data.="".$para_value['text']."";
												   }
												   break;
												   
												   case 'new_para':
												   if($para_value['multilanguage'] == "TRUE")
												   {
												     foreach ($languages as $prefix=>$language)
											         {
												       $data.="<br>&nbsp;".$para_value['text']."";
													 } 
												   }
												   else
												   {
												     $data.="<br>&nbsp;".$para_value['text']."";
												   }
												   break;
												   
												   case 'widget':
												   switch($para_value['type'])
												   {
												      case 'text':
													  if($para_value['multilanguage'] == "TRUE")
												      {
													      foreach ($languages as $prefix=>$language)
											              {
															  if($para_value['key']=="TRUE")
															  {
																$data.= '&nbsp;<input type="text" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'"/>&nbsp;';
															  }
															  else
															  {
																$data.= '&nbsp;<div class="wtext"><div class="hrsingle"></div></div>&nbsp;';
															  }
														  }
													  }
													  else
													  {
													    if($para_value['key']=="TRUE")
														{
														  $data.= '&nbsp;<input type="text" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'"/>&nbsp;';
														}
														else
														{
														  $data.= '&nbsp;<hr>&nbsp;';
														}
													  }
													  break;
													  
													  case 'date':
													  if($para_value['multilanguage'] == "TRUE")
												      {
													    foreach ($languages as $prefix=>$language)
											            {
													      $div.= '&nbsp;<input type="date" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'" />&nbsp;';
														} 
													  }
                                                      else
													  {
                                                        $div.= '&nbsp;<input type="date" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'" />&nbsp;';
													  }													  
													  break;
													  
													  case 'checkbox':
													  $c = 0;
												foreach($para_value['options'] as $index2 => $value2)
												{
													$data .= "
                  <input type='checkbox' name='para_text_".$para_index."[]' id='para_text_".$para_index."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$index_name."',''  );?> 
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
													  break;
													  
													  case 'radio':
													  $c = 0;
												foreach($para_value['options'] as $index2 => $value2)
												{
													$data .="
                  <input type='radio' name='para_text_".$para_index."' id='para_text_".$para_index."' value='".$value2['value']."' <?php echo preset_radio('page".$index_name."', '".$value2['value']."');?>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
													  break;
													  
													  case 'number':
													  break;
												   }
												   break;
												}
											  }
											}
                                            break;											
	                             //-----PARAGRAPH ELEMENT==END-----//
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
			
			break;
										}
										
										log_message('debug','$data=====13896=====NEW FN'.print_r($data,true));
										
										$res_data['data'] = $data;
										$res_data['client_validation_rules'] = $client_validation_rules;
										$res_data['client_validation_messages'] = $client_validation_messages;
										
		return $res_data;
	}
	 
    // ---------------------------------------------------------------------------------------

	/**
	 * Helper: creating view for web stages
	 *
	 * views based on permissions applied
	 *  
	 * @author Selva
	 */
	 
	function create_single_stage_web_view($application_name,$application_template,$permissions,$companyname,$controllername,$modelname)
	{
	
		$languages     			    = $this->config->item('languages');
		$loop_name     			    = array();
		$data          			    = "";
		$client_validation_rules    = "";
		$client_validation_messages = "";
		$viewperstages 			    = array();
		$editperstages 			    = array();
		$stageindex    			    = array();

		$stage_name    = array_keys($permissions);

		foreach($permissions as $per)
		{
			array_push($viewperstages,$per['View_Permissions']);
			array_push($editperstages,$per['Edit_Permissions']);
			array_push($stageindex,$per['index']);
		}


		/*
            LOG INPUT VALUES 
		*/

        log_message('debug',' CREATE_SINGLE_STAGE_WEB_VIEW============APP-TEMPLATE'.print_r($application_template,true));
        log_message('debug',' CREATE_SINGLE_STAGE_WEB_VIEW============APP-NAME'.print_r($application_name,true));
        log_message('debug',' CREATE_SINGLE_STAGE_WEB_VIEW============PERMISSIONS'.print_r($permissions,true));
		

		$data .= "
		<style>
		.lcheck_radio 
		{
			font-family: Segoe UI;
			font-size: 21px;
			font-weight: 400;
			margin-right: 10px;
			margin-bottom: 5px;
			color: black;
		}
		.icheck_radio 
		{
			height: 20px;
			width: 20px;
		}
		</style>
          <!-- ==========================CONTENT STARTS HERE ========================== -->
          <!-- MAIN PANEL -->
		  <div id=\"main\" role=\"main\" style=\"margin-left:0px;\">
           <!-- MAIN CONTENT -->
	<div id=\"content\" style=\"padding:0px;\">
      <div class=\"navbar\">
						<ul class=\"nav pull-right\">
							<li class=\"dropdown hidden-phone\">
							<!-- start: User Dropdown -->
							<li class=\"dropdown\">
								<a class=\"btn popover-toggle\" data-toggle=\"dropdown\" id=\"all\">All Stages<span class=\"caret\"></span></a>
								<ul class=\"popover-menu messages\"><span class=\"close\">&times;</span><div id='wrap'></div></ul>
							</li>
			                </li>
						</ul>
			        </div>
	
	</a> <span class='clearFix'></span>
                <?php
\$attributes = array('class' => 'tform form -horizontal', 'id' =>'web_view'); ?>
	
<?php if(\$updType == 'create') { echo form_open_multipart('".$companyname."/".$controllername."/create', \$attributes); } elseif(\$updType == 'edit') { echo form_open_multipart('".$companyname."/".$controllername."/edit', \$attributes);  } else { echo form_open_multipart('".$companyname."/".$controllername."/doc_access', \$attributes);}
?>
             <div class=\"row\">
             <article class=\"col-sm-12 indexpages\">
                ";
				
				$client_validation_rules .=" 

			   <script type=\"text/javascript\">
				runAllForms();

			   \$.validator.addMethod('fileminsize', function(value, element, param) {
				   return this.optional(element) || (element.files[0].size >= param) 
			  });

			  
			   \$.validator.addMethod('filemaxsize', function(value, element, param) {
				   return this.optional(element) || (element.files[0].size <= param) 
			  });

			   $(function() {
				// Validation
				$(\"#web_view\").validate({
				ignore: \"\",
				// Rules for form validation
					rules : {"; 

				$client_validation_rules.= $this->sl."";
				
				$client_validation_messages.="},
	   
	   //Messages for form validation
			messages : {";

            $page_data   = array();
			$pagenumber  = array();
	       
	        foreach ($application_template as $pageno => $pages)
		    {
		    	array_push($pagenumber,$pageno);
		    }

		    $pagecount = count($pagenumber);

            for($i=1;$i<=$pagecount;$i++)
		    {
		    	array_push($page_data,$application_template[$i]);
            }	

            for($ii=0;$ii<$pagecount;$ii++)
            {
                 	$pgno = $ii +1;
					$data .="<div id='$pgno' class='page$pgno page'>";
					$section_class="section";
					$element_class="margin";
				
					
				foreach($page_data[$ii] as $section => $index_array)
				{ 
				    foreach($index_array as $index => $value)
					{
					   switch ($value['type'])
						{
							case 'SBreak':
								
								$check_in_view = in_array($section,$viewperstages[0]);
						        $check_in_edit = in_array($section,$editperstages[0]);
						
					 ///////////////* Both view and edit permissions *///////////////	
					 
						       if($check_in_view && $check_in_edit)
						       {
	
	
									$data .="
                  <div id='".$section."' class='web_section sec$pgno'>
				  <div class='".$section_class."'>
                  <label style='background-color:black; color:white;' class='sec_ col-sm-12' for='".$section."'>".ucfirst($section)." </label></div>
                ";
				$element_class="margin";
                                     
									 
                                    unset($index_array['dont_use_this_name']);
                                    foreach($index_array as $index => $val)
                                    {
									    $index_name   = str_replace(' ','',$index);
										$section_name = str_replace(' ','',$section);
										$setvalue_name = "page".$pgno."_".$section_name."_".$index_name;
										
										$result_data = $this->create_single_stage_web_view_elements_for_both_permissions($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section);
									    $data .= $result_data['data'];
									    $client_validation_rules = $result_data['client_validation_rules'];
									    $client_validation_messages = $result_data['client_validation_messages'];
										
                                         /* switch($val['type'])
                                         {
											 
											 case 'retriever':
											  
											  if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
												    if($val['properties']['key'] == "TRUE")
													{
													
													log_message('debug','$val=====12059=====rules'.print_r($val,true));
													
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                								
				                                     }
													 else
													 {
													     $data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['properties']['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle '></div></div></div>
													     ";
													$section_class="section_writable";
													$element_class="margin_writable";														 
													 }
												}
												break;
                                              case 'text':
											  
											  log_message('debug','ELEMENT=====RECURSIVE FUNCTION=====13057====='.print_r($data,true));
											  if($val['multilanguage'] == "TRUE")
											  {
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													
													log_message('debug','$val=====12059=====rules'.print_r($val,true));
													
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                								
				                                     }
													 else
													 {
													     $data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle '></div></div></div>
													     ";
													$section_class="section_writable";
													$element_class="margin_writable";														 
													 }
												} 
												break;
											
	                                        case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
													$instruction = str_replace("\n","<br>",$val['instructions']);
										
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";

													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
											
											
											case 'number':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

                                								
												}
												break;
	                                        
											case 'mobile':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : ''); ?>\"  /><input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                                 
                                $client_validation_rules .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:1,maxlength:3},".$this->sl;
								
								$client_validation_rules .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
                                
                                $client_validation_messages .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;							
									   
												}
											break;
											
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                   <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='password' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='password' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl; 	

								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                								
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;								
												}
												 
												break;
	
											case 'time':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='time' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='time' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='range' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>".$val['maxrange']."
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='range' name='page".$pgno."_".$section_name."_".$index_name."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>".$val['maxrange']."
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='color' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='color' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                 <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='month' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='month' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;													
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'  name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'/>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data .="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle '></div><div class='hr '></div><div class='hr '></div></div></div>
													";
													$section_class="section_writable";
													$element_class="margin_writable";													
													}
												}
												else
												{
												
												 if($val['key'] == "TRUE")
												 {
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

                                								
												}
												else
												{
												$data .=" <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div> ";
													$section_class="section_writable";
													$element_class="margin_writable";												
												}
												
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <div class='".$element_class." inline-block'><input id='page".$pgno."_".$section_name."_".$index_name."' ".(($val['checked'] == "TRUE") ?  ' checked '  :  '')."type='checkbox' name='page".$pgno."_".$section_name."_".$index_name."' value='1' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '1', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )?> />
                  
                  <label class='labelforminline' for='".$index_name."'>".$val['label']." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
	
												break;
	
											case 'checkbox':
											if ($val['multilanguage'] == "TRUE")
												{
												
												foreach ($languages as $prefix=>$language)
													{
												$data .= "
                
                  <label class='labelform'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' name='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' id='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_".$prefix."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " <?php echo form_error('ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"'); ?> 
                ";
				                                }
				                                } 
				                              else
				                               {
				
				                   $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?></div> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";
													
								$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                    
                                    									
				                               }
												break;
	
	
											case 'MChoice':
											if($val['multilanguage']=="TRUE")
											{
											
											foreach ($languages as $prefix=>$language)
													{
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."[]' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
				                           }
										   } 
				                           else
				                           {
				   $data .="
                
                   <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' multiple name='page".$pgno."_".$section_name."_".$index_name."[]' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                   $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				   $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
				
				                           }
												break;
	
											case 'select':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                  $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
												break;
	
	
											case 'selectbd':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."' size='".$val['size']."'>
                  <option value=''>
                  <?php echo lang('web_choose_option')?>
                  </option>
                  <?php foreach (\$array_".strtolower($val['options']['model'])." as \$item): ?>
                  <option value=\"<?php echo \$item->".$val['options']['field_value'].";?>\" <?php echo preset_select('page".$pgno."_".$section_name."_".$index_name."', \$item->".$val['options']['field_value'].", (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                  <?php echo \$item->".$val['options']['field_text'].";?>
                  </option>
                  <?php endforeach ?>
                  ";
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
												break;
	
											case 'radio':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= "</div> ";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";	

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
								
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
	
												break;
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                 <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='' class='datepicker' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']->format('d-m-Y') : ''); ?>\"  />
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
	
                <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']?>' /> 
                <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                     <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']?>' /> 
                
                <input id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
												}
	
												break;
	
											case 'file':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a> <?php endif ?></div>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' ".(($val['required'] == "TRUE") ? "required":"") ."/>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
													
						$max_size 	       = $val['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						$allowed_types = $val['upload']['allowed_types'];
						
						$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
                        $client_validation_rules.="filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;
						
						
                        $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                        $client_validation_messages .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;

                                    													
												}
	
												break;
											
                                               case 'photo':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])):?>
					<div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path'];?>')\" for='".$index_name."_".$prefix."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."_".$prefix."'></div>
				  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				   <?php endif ?></div>
                   <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                   <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
					<div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."'/>
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."'></div>
				  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
                                
								$min_size  = $val['upload']['min_size'];
						$min_size_in_bytes = $min_size * 1024;
						
								$max_size  = $val['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						
						$allowed_types = $val['upload']['allowed_types'];

				        $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";	
						$client_validation_rules.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;
						
                        $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
						$client_validation_messages .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						
						}
	
												break;
												
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;	

                                            case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;

								//-----PARAGRAPH ELEMENT==START-----//
                                            case 'paragraph':
											if($val['multilanguage'] == "TRUE")
											{
											  foreach($languages as $prefix=>$language)
											  {
												  foreach($val['para_text'] as $para_index =>$para_value)
												  {
													switch($para_value['source'])
													{
													   case 'para':
													   $data.="";
													   break;
													   
													   case 'new_para':
													   $data.="";
													   break;
													   
													   case 'widget':
													   switch($para_value['type'])
													   {
														  case 'text':
														  break;
													   }
													   break;
													}
												  }
											  }
											}
											else
											{
											   foreach($val['para_text'] as $para_index =>$para_value)
											  {
											    switch($para_value['source'])
												{
												   case 'para':
												   if($para_value['multilanguage'] == "TRUE")
												   {
												      foreach ($languages as $prefix=>$language)
											          {
												         $data.="".$para_value['text']."";
													  }	 
												   }
												   else
												   {
												      $data.="".$para_value['text']."";
												   }
												   break;
												   
												   case 'new_para':
												   if($para_value['multilanguage'] == "TRUE")
												   {
												     foreach ($languages as $prefix=>$language)
											         {
												       $data.="<br>&nbsp;".$para_value['text']."";
													 } 
												   }
												   else
												   {
												     $data.="<br>&nbsp;".$para_value['text']."";
												   }
												   break;
												   
												   case 'widget':
												   switch($para_value['type'])
												   {
												      case 'text':
													  if($para_value['multilanguage'] == "TRUE")
												      {
													      foreach ($languages as $prefix=>$language)
											              {
															  if($para_value['key']=="TRUE")
															  {
																$data.= '&nbsp;<input type="text" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'"/>&nbsp;';
															  }
															  else
															  {
																$data.= '&nbsp;<div class="wtext"><div class="hrsingle"></div></div>&nbsp;';
															  }
														  }
													  }
													  else
													  {
													    if($para_value['key']=="TRUE")
														{
														  $data.= '&nbsp;<input type="text" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'"/>&nbsp;';
														}
														else
														{
														  $data.= '&nbsp;<hr>&nbsp;';
														}
													  }
													  break;
													  
													  case 'date':
													  if($para_value['multilanguage'] == "TRUE")
												      {
													    foreach ($languages as $prefix=>$language)
											            {
													      $div.= '&nbsp;<input type="date" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'" />&nbsp;';
														} 
													  }
                                                      else
													  {
                                                        $div.= '&nbsp;<input type="date" name="para_text_'.$para_index.'" id="para_text_'.$para_index.'" />&nbsp;';
													  }													  
													  break;
													  
													  case 'checkbox':
													  $c = 0;
												foreach($para_value['options'] as $index2 => $value2)
												{
													$data .= "
                  <input type='checkbox' name='para_text_".$para_index."[]' id='para_text_".$para_index."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$index_name."',''  );?> 
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
													  break;
													  
													  case 'radio':
													  $c = 0;
												foreach($para_value['options'] as $index2 => $value2)
												{
													$data .="
                  <input type='radio' name='para_text_".$para_index."' id='para_text_".$para_index."' value='".$value2['value']."' <?php echo preset_radio('page".$index_name."', '".$value2['value']."');?>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
													  break;
													  
													  case 'number':
													  break;
												   }
												   break;
												}
											  }
											}
                                            break;											
	                             //-----PARAGRAPH ELEMENT==END-----//
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
												break;
										} */
									}
	
	
								}
								
					 ///////////////* Only view permission*///////////////	
	
								if($check_in_view && !$check_in_edit)
						       {
	
									$data .="
                  <div id='".$section."' class='web_section sec$pgno'>
				  <div class='".$section_class."'>
                  <label style='background-color:black; color:white;' class='sec_ col-sm-12' for='".$section."'>".ucfirst($section)."</label></div>
                ";$element_class="margin";
									unset($index_array['dont_use_this_name']);
                                    foreach($index_array as $index => $val)
                                    {
                        	   
										 $index_name   = str_replace(' ','',$index);
										 $section_name = str_replace(' ','',$section);
										 $setvalue_name = "page".$pgno."_".$section_name."_".$index_name;
										 
										 $result_data = $this->create_single_stage_web_view_elements_for_only_view_permission($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section);
									     $data .= $result_data['data']; 
									     $client_validation_rules  = $result_data['client_validation_rules']; 
									     $client_validation_messages  = $result_data['client_validation_messages']; 
										 
	
									/*	switch($val['type'])
										{
	
	                                        case 'text':
	
												if($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
												}
												else
												{
												   if($val['key'] == "TRUE")
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";												
												
												}
												}
												break;
												
												 case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                 <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
													$instruction = str_replace("\n","<br>",$val['instructions']);
										
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
	
											case 'number':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												break;
												
											case 'mobile':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input country_code'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : '');?></label><label class='text_input mob_num'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : '');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only country_code'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?></label><label class='text_input view_only mob_num'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												break;	
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? str_repeat('*',strlen(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
												}
												 
												break;
	
											case 'time':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													
													
													}
												}
												else
												{
												  if($val['key'] == "TRUE")
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												
												
												}
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <label class='labelform'>".ucfirst($loop)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label>
				 
                ";
													$section_class="section_writable";
													$element_class="margin";				
	
												break;
	
											case 'checkbox_old':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php foreach(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] as \$key){
                  	echo \"<label class='lcheck_radio labelforminline' for='\$key'>\$key</label>\";
                  }?>
                 
				   ";

												$data .="</div>";

													$section_class="section_checkbox";
													$element_class="margin_checkbox";				  
	
	
												break;
												
											case 'checkbox':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
				  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) && !empty(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) {?>
                  <?php foreach(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] as \$key){
                  	echo \"<label class='lcheck_radio labelforminline' for='\$key'>\$key</label>\";
                  }?>
                  <?php } else { ?>";
				                           $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='checkbox_view_only' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
													}
												$data.= "<?php } ?></div>
				  
				  ";

													$section_class="section_checkbox";
													$element_class="margin_checkbox";				  
	
	
												break;	
	
											case 'MChoice':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
				   
				  ";
													$section_class="section";
													$element_class="margin";				  
												break;
	
											case 'select':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                                   
				   ";
													$section_class="section";
													$element_class="margin";				   
	
	                                         	break;
	
	
											case 'selectbd':
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label>
                  
				  ";
												break;
	
											case 'radio_old':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label></div>
				  
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";				  

	
												break;
												
										case 'radio':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>";
				  $data.="
				  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) && !empty(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) { ?>
				  
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])); ?></label><?php } else { ?>
				   ";
				  
				                                $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='radio_view_only' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
				   
				  $data.= "<?php } ?></div>
				  
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";				  

	
												break;		
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('".$loop."', (isset(\$".$modelname."['index']"."['".$loop."'])) ? \$".$modelname."['index']"."['".$loop."']->format('d-m-Y') : ''); ?></label></div>
			    
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']): ?>
	            <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']?>' /> 
                <?php endif ?></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']): ?>
	            <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']?>' /> 
                <?php endif ?></div>
                <br/>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'file':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']):?>
                  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a>
                  <?php else: ?>
				  <label class='text_input'> - - - - - - - - - - </label>
				  <?php endif ?></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])): ?>
                  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php else: ?>
				  <label class='text_input view_only'></label>
				  <?php endif ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
											
											case 'photo':
											
											if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']):?>
                  <div class='photo_elem photo_elem_view_only' style='background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path'];?>')' for='".$index_name."_".$prefix."'></div>
                  <?php else: ?>
				  <div class='photo_elem photo_elem_view_only'></div>
				  <?php endif ?></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])): ?>
				  <div class='photo_elem photo_elem_view_only' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div>
                  <?php else: ?>
				  <div class='photo_elem photo_elem_view_only'></div>
				  <?php endif ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
	
											break;
											
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;	
											
                                             case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea ' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'paragraph':
											break;
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop."' value='<?php echo \$".$loop."?>'/>
                ";
	
												break;
										} */
									}
	
								}
								
					 ///////////////* Only edit permission*///////////////	
					 
								if(!$check_in_view && $check_in_edit)
						       {
	
	
									$data .="
                  <div id='".$section."' class='web_section sec$pgno'>
				  <div class='".$section_class."'>
                  <label style='background-color:black; color:white;' class='sec_ col-sm-12' for='".$section."'>".ucfirst($section)." </label></div>
                ";$element_class="margin";
                
                                    unset($index_array['dont_use_this_name']);
                                    foreach($index_array as $index => $val)
                                    {
                        	             $index_name    = str_replace(' ','',$index);
										 $section_name  = str_replace(' ','',$section);
										 $setvalue_name = "page".$pgno."_".$section_name."_".$index_name;
										 
										 $result_data = $this->create_single_stage_web_view_elements_for_only_edit_permission($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section);
									     $data .= $result_data['data'];
										 $client_validation_rules = $result_data['client_validation_rules'];
										 $client_validation_messages = $result_data['client_validation_messages'];
										
										 /* $result_data = $this->create_single_stage_web_view_elements_for_both_permissions($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section);
									     $data .= $result_data; */
										
                                         /* switch($val['type'])
                                         {
                                              case 'text':
												
	
												if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";												
												}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                
             <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
             <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
             <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
		$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
		$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl; 

                       								}
													 else
													 {
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";													 
													 
													 }
												}
												break;
	
	                                        case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
										            $instruction = str_replace("\n","<br>",$val['instructions']);

													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
											
											
											case 'number':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

				$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
				$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
				
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                 													
												}
												break;
												
											case 'mobile':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : ''); ?>\"  /><input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                    $client_validation_rules .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
					$client_validation_rules.="minlength:1,maxlength:3},".$this->sl;
								
					$client_validation_rules .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
					$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                    				   
												}
												break;
												
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='password' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='password' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
					$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

                   													
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                 <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minlength']."' max='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  />
                  <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minlength']."' max='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
												}
												 
												break;
	
											case 'time':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='time' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='time' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='range' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  />".$val['maxrange']."</div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='range' name='page".$pgno."_".$section_name."_".$index_name."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  />".$val['maxrange']."</div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='color' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='color' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='month' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='month' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'  name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													
													
													}
												}
												else
												{
												
												 if($val['key'] == "TRUE")
												 {
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";

                   $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
				   $client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;

                   $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
					
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)."  ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												
												
												}
												
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <div class='".$element_class." inline-block'><input id='page".$pgno."_".$section_name."_".$index_name."' ".(($val['checked'] == "TRUE") ?  ' checked '  :  '')."type='checkbox' name='page".$pgno."_".$section_name."_".$index_name."' value='1' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '1', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )?> />
                  
                  <label class='labelforminline' for='".$index_name."'>".$val['label']." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
	
												break;
	
											case 'checkbox':
											if ($val['multilanguage'] == "TRUE")
												{
												
												foreach ($languages as $prefix=>$language)
													{
												$data .= "
                
                  <label class='icheck_radio'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input type='checkbox' name='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' id='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' value='".$value2['value']."' <?php echo pre_set_check_box_value('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? array_values($".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']): ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_".$prefix."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " <?php echo form_error('ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"'); ?> 
                ";
				                                }
				                                } 
				                               else
				                               {
				
				                   $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .=" </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
				
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
				
				                               }
												break;
	
	
											case 'MChoice':
											if($val['multilanguage']=="TRUE")
											{
											
											foreach ($languages as $prefix=>$language)
													{
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."[]' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
				                           }
										   } 
				                           else
				                           {
				   $data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple class='text_input' name='page".$pgno."_".$section_name."_".$index_name."[]' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
					 <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) {?>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  pre_set_select_box('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? array_values(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  <?php } else {?>";
				  
				                                 foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
												
				  $data.="<?php } ?></select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                 $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
				 
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;				 
				                           }
												break;
	
											case 'select':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
					
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;					
												break;
	
	
											case 'selectbd':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label></div>
                  <select name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."' size='".$val['size']."'>
                  <option value=''>
                  <?php echo lang('web_choose_option')?>
                  </option>
                  <?php foreach (\$array_".strtolower($val['options']['model'])." as \$item): ?>
                  <option value=\"<?php echo \$item->".$val['options']['field_value'].";?>\" <?php echo preset_select('page".$pgno."_".$section_name."_".$index_name."', \$item->".$val['options']['field_value'].", (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                  <?php echo \$item->".$val['options']['field_text'].";?>
                  </option>
                  <?php endforeach ?>
                  ";
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
												break;
	
											case 'radio':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= " </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";

                 $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;

                 $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;				 
	
												break;
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='' class='datepicker' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']->format('d-m-Y') : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
	
                <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']?>' /> 
                <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                     <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']?>' /> 
                
                <input id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'file':
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a> <?php endif ?></div></div>
               <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
				  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
		 											$section_class="section";
													$element_class="margin";
													
				  
                 $max_size 		    = $val['upload']['max_size'];
				 $max_size_in_bytes = $max_size * 1024;
				 $allowed_types     = $val['upload']['allowed_types'];
						
				$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
                $client_validation_rules.="filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
				
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                $client_validation_messages .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
				
				
										    }
	
												break;
											
                                            case 'photo':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?>
					<div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php endif ?></div>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
				   <div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div><input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
				   <?php else : ?>
				   <div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
                      
					$min_size 		   = $val['upload']['min_size'];
					$min_size_in_bytes = $min_size * 1024;
						
					$max_size 		   = $val['upload']['max_size'];
					$max_size_in_bytes = $max_size * 1024;
						
					$allowed_types = $val['upload']['allowed_types'];

				    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";	
				    $client_validation_rules.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
					
                    $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
				    $client_validation_messages .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
                 													
												}
	
												break;
												
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;
	                                        
											case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'paragraph':
											break;
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
												break;
										} */
									}
	
	
								}
	
	              ///////////////* No permissions *///////////////						

	                            if(!$check_in_view && !$check_in_edit)
								{
	
									$data .="
                  <div id='".$section."' class='web_section sec$pgno'>
				  <div class='".$section_class."'>
                  <label style='background-color:black; color:white;' class='sec_ col-sm-12' for='".$section."'>".ucfirst($section)."</label></div>
                ";$element_class="margin";
									unset($index_array['dont_use_this_name']);
                                    foreach($index_array as $index => $val)
                                    {
                        	             $index_name   = str_replace(' ','',$index);
										 $section_name = str_replace(' ','',$section);
	
										switch($val['type'])
										{
	
	
											case 'text':
	
												if ($val['multilanguage'] == "TRUE")
												{
												if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
												if($val['key'] == "TRUE")
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";
													}													
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												break;
												
												case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
										
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
	
											case 'number':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												break;
												
											case 'mobile':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												break;
												
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												 
												break;
	
											case 'time':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
												if($val['key'] == "TRUE")
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area'><?php echo lang('no_permissions')?></label></div>
               
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													
													}
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label>
                <label ><?php echo lang('no_permissions')?></label>
				
                ";
	
												break;
	
											case 'checkbox':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
				  <label><?php echo lang('no_permissions')?></label></div>
                  ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";				  
												break;
	
											case 'MChoice':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label><?php echo lang('no_permissions')?></label></div>
				  
                    ";
													$section_class="section";
													$element_class="margin";					
												break;
	
											case 'select':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
				  
                    ";
													$section_class="section";
													$element_class="margin";					
	
												break;
	
	
											case 'selectbd':
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
				  ";
	
												
												break;
	
											case 'radio':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label><?php echo lang('no_permissions')?></label></div>
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";				  
	
	                                            break;
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label>
                  <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'file':
											case 'photo':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                    <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                 <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                     <label class='text_input'><?php echo lang('no_permissions')?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
												
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;
	                                        
											case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'paragraph':
											break;
											
											case 'hidden':
	
												$data .= "
                <input id='".$index_name."' type='hidden' name='".$index_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
												break;
										}
									}
	
								} 
								
								$data .="</div>";
								break;
									
								 
						}
					}
	
				}
				$data .="</div>";
		 }
		 
		 $data .="<?php if(isset(\$".$modelname."['doc_data']['external_attachments'])): ?>
                <div class='external_file_attachments hide'>
                <?php foreach(\$".$modelname."['doc_data']['external_attachments'] as \$data): ?>	
                <?php \$pathvar = str_replace('/','=',\$data['file_path']); ?>
                <a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\" name=\"<?php echo \$data['file_client_name']?>\"></a>
                <?php endforeach ?>
                </div>
                <?php endif ?>";
				 
		$data .="<?php if(isset(\$".$modelname."['doc_data']['chart_data']) && !empty(\$".$modelname."['doc_data']['chart_data'])): ?>
                 <div id='chart_value' class='hide' chart='true'></div>
				 <?php else: ?>
				 <div id='chart_value' class='hide' chart='false'></div>
                 <?php endif ?>";		 
	
		if($stageindex[0]==1)
		{
			$data .= "
                <br> <?php echo form_submit( 'submit', (\$updType == 'edit') ? lang('web_edit') : lang('web_add'), ((\$updType == 'create') ? \"id='submit' class='bcreateform'\" : \"id='submit' class='beditform'\")); ?> <br>
	
                <br>
                 <?php echo form_hidden('docid',set_value('docid', (isset(\$id)) ? \$id : ''  )) ?>
                 <?php echo form_hidden('stagename',set_value('stagename', (isset(\$stagename)) ? \$stagename : ''  )) ?>
                <?php echo form_hidden('page',set_value('page', \$page)) ?>
				<input type=\"hidden\" name=\"create_doc_graph\" id=\"create_doc_graph\"/>
                <?php if (\$updType == 'edit'): ?>
                <?php echo form_hidden('id',\$".$modelname."['_id']) ?>
                <?php endif ?>
                <?php echo form_close(); ?><div id=\"reasons\">
                </div>
                </article>
	</div>
</div>
	<!-- END MAIN CONTENT -->
	
</div>
<!-- END MAIN PANEL -->
<!-- ==========================CONTENT ENDS HERE ========================== -->
  <script src='<?php echo(JS.'jquery.js'); ?>'></script>
  <script src=\"<?php echo(JS.'tooltip.js'); ?>\" type=\"text/javascript\"></script>
  <script src=\"<?php echo(JS.'popover.js'); ?>\" type=\"text/javascript\"></script>
	
  <?php
	//include required scripts
	include(\"inc/scripts.php\");
?>
<script type=\"text/javascript\">
	// JavaScript Document
        \$(document).ready(function() { ";
		
		$data.="
        	\$('#reasons').hide();
        	\$('#cancel').hide();
        });
    
		\$(\".close\").click(function(){
			\$('#wrap').hide();
			\$('#wrap1').hide();
			\$('.close').hide();
		});
		\$(\".close1\").click(function(){
			\$('#wrap1').hide();
			\$('.close1').hide();
		});
		objfull = {};
	
		\$(\"#all\").click(function(){
			\$('#wrap').show();
			if (typeof \$('input[name=\"id\"]').val() != 'undefined'){
				var doc_id = \$('input[name=\"id\"]').val();
			}else{
				var doc_id = '';
			}
	
			\$.ajax({
				url: 'get_all/'+doc_id,
				type: 'POST',
				success: function (data) {
					var obj = JSON.parse(data);
					objfull = obj;
					var li = \"\";
					for( var i in obj['all'] )
					 {
						stage = obj['all'][i];
						stage_qut = '\"'+stage+'\",\"'+i+'\"';
						if (obj['match'] == obj['all'][i])
						{
							li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class='icon-arrow-left icon-red'></i><i style='color:#F00'>You are here.!</li></span></a><div id='\"+i+\"'></div></li>\";
						}else{
					  	li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"</a><div id='\"+i+\"'></div></li>\";
						}
					 }
                      sessionValue = obj['username'];
					  \$('#disapprover').val(sessionValue);
					  \$('#wrap').html(\"<div id='stagelist'><ul>\"+li+\"</ul></div>\");
					  \$('.close').show();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});
		});
	
	
	    $(\".retriever_search\").click(function(){
			
			var field_ref = $(this).attr(\"field_ref\") || '';
			var query_ref = $(this).prev('input').val() || '';
			var coll_ref  = $(this).attr(\"collection_ref\") || '';
			var list      = $(this).attr(\"retrieval_list\") || '';
			
			list = atob(list);
			
			// AJAX CALL TO FETCH DATA
			$.ajax({
				url: '../".$this->customer_folder."/".$this->controller_name."/fetch_retriever_data',
				type: 'POST',
                data:{\"query_param\":field_ref,\"query_value\":query_ref,\"collection_name\":coll_ref,\"to_be_retrieved\":list},
				success: function (data) {
					data = JSON.parse(data);
					for(var i in data)
					{
						var wid_data = data[i].doc_data.widget_data;
						list = JSON.parse(list);
					for(var index in list)
					{
						var res = list[index].split(\"_\");
						if($('[rel^=\"'+list[index]+'\"]').hasClass(\"view_only\") || $('[rel^=\"'+list[index]+'\"]').hasClass(\"radio_view_only\") || $('[rel^=\"'+list[index]+'\"]').hasClass(\"checkbox_view_only\"))
						{
							if(!$('[rel=\"'+list[index]+'\"]').hasClass(\"radio_view_only\") && !$('[rel=\"'+list[index]+'\"]').hasClass(\"checkbox_view_only\"))
								{
									
									if(typeof(wid_data[res[0]][res[1]][res[2]]) == \"object\" && $('[rel=\"'+list[index]+'\"]').attr(\"type\")!=\"checkbox\")
									{
										var obj = wid_data[res[0]][res[1]][res[2]];
										if(obj.hasOwnProperty(\"country_code\"))
										{
										  var li_new = list[index]+\"_country_code\";
										  $('[rel=\"'+li_new+'\"]').text(obj['country_code']);
										}

										if(obj.hasOwnProperty(\"mob_num\"))
										{
										  var li_new = list[index]+\"_mob_num\";
										  $('[rel=\"'+li_new+'\"]').text(obj['mob_num']);
										}
									  
									  }
									  else
									  {
										$('[rel=\"'+list[index]+'\"]').text(wid_data[res[0]][res[1]][res[2]]);
									  }
								}
								else if($('[rel=\"'+list[index]+'\"]').hasClass(\"radio_view_only\"))
								{
									$('[rel=\"'+list[index]+'\"][value=\"'+wid_data[res[0]][res[1]][res[2]]+'\"]').addClass(\"add_color\");
								}
								else if($('[rel=\"'+list[index]+'\"]').hasClass(\"checkbox_view_only\"))
								{
									var value_length = wid_data[res[0]][res[1]][res[2]].length;
									for(var vl=0;vl<value_length;vl++)
									{
										$('[rel=\"'+list[index]+'\"][value=\"'+wid_data[res[0]][res[1]][res[2]][vl]+'\"]').addClass(\"add_color\");
									}
								}
						}
						else
						{
							if($('[rel=\"'+list[index]+'\"]').attr(\"type\")!=\"radio\")
							{
								if(typeof(wid_data[res[0]][res[1]][res[2]]) == \"object\" && $('[rel=\"'+list[index]+'\"]').attr(\"type\")!=\"checkbox\")
								{
									var obj = wid_data[res[0]][res[1]][res[2]];
									if(obj.hasOwnProperty(\"country_code\"))
									{
									var li_new = list[index]+\"_country_code\";
									$('[rel=\"'+li_new+'\"]').val(obj['country_code']);
									}

									if(obj.hasOwnProperty(\"mob_num\"))
									{
									var li_new = list[index]+\"_mob_num\";
									$('[rel=\"'+li_new+'\"]').val(obj['mob_num']);
									}
								  
								  }
								  else
								  {
									$('[rel=\"'+list[index]+'\"]').val(wid_data[res[0]][res[1]][res[2]]);
								  }
							}
							else if($('[rel=\"'+list[index]+'\"]').attr(\"type\")==\"radio\")
							{
								$('[rel=\"'+list[index]+'\"][value=\"'+wid_data[res[0]][res[1]][res[2]]+'\"]').prop('checked', 'checked');
							}
						}
					  
					}
					}
					/*for(var i in data)
					{
						var wid_data = data[i].doc_data.widget_data;
						list = JSON.parse(list);
						for(var index in list)
						{
						   var res = list[index].split(\"_\");
						   if(typeof(wid_data[res[0]][res[1]][res[2]]) != \"string\" && typeof(wid_data[res[0]][res[1]][res[2]]) != \"array\")
						   {
							   var obj = wid_data[res[0]][res[1]][res[2]];
							   
							   f(obj.hasOwnProperty(\"country_code\"))
							   {
								  var li = list[index]+\"_country_code\";
							     $('[rel=\"'+li+'\"]').val(obj['country_code']);
							   }
							   
							   if(obj.hasOwnProperty(\"mob_num\"))
							   {
							     var li = list[index]+\"_mob_num\";
							     $('[rel=\"'+li+'\"]').val(obj['mob_num']);
							   }
						   }
						   $('[rel=\"'+list[index]+'\"]').val(wid_data[res[0]][res[1]][res[2]]);
						}
					}*/
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});
		});
	
	
	  getusers = (function(stage,i){
	
		var li = \"\";
		var td = \"\";
		for( var use in objfull.vitals[stage])
		{
		
			name = objfull.vitals[stage][use][0].first_name;
			phone = objfull.vitals[stage][use][0].phone;
			email = objfull.vitals[stage][use][0].email;
			console.log(name);
			console.log(phone);
			td = td + \"<li>\"+name+\" <i class='fa fa-phone'></i>:\"+phone+\" <i class='fa fa-envelope'></i>:\"+email+\"</li>\";
		}
		\$('#'+i).html(\"<ol>\"+td+\"</ol>\");
		});
	
		</script>
        
<?php
	//include footer
	include(\"inc/footer.php\");
?>
	
	
       ";
	
		}
		else
		{
	
			$data .= "
				
                <br> <?php echo form_submit( 'submit', (\$updType == 'edit') ? lang('web_edit') : lang('web_add'), ((\$updType == 'create') ? \"id='submit' class='bcreateform'\" : \"id='submit' class='beditform'\")); ?> <br>
                <br> <input type=\"button\" id=\"disapprove\" class=\"btn\" value=\"Disapprove\"></input><input type=\"button\" id=\"cancel\" class=\"btn\" value=\"Cancel\"></input>
                <br>
                 <?php echo form_hidden('docid',set_value('docid', (isset(\$id)) ? \$id : ''  )) ?>
                 <?php echo form_hidden('stagename',set_value('stagename', (isset(\$stagename)) ? \$stagename : ''  )) ?>
                <?php echo form_hidden('page',set_value('page', \$page)) ?>
                <?php if (\$updType == 'edit'): ?>
                <?php echo form_hidden('id',\$".$modelname."['_id']) ?>
                <?php endif ?>
                <?php echo form_close(); ?>
                </article>
	</div>
</div>
	<!-- END MAIN CONTENT -->
	
</div>
<!-- END MAIN PANEL -->
<!-- ==========================CONTENT ENDS HERE ========================== -->
  <script src='<?php echo(JS.'jquery.js'); ?>'></script>
  <script src=\"<?php echo(JS.'tooltip.js'); ?>\" type=\"text/javascript\"></script>
  <script src=\"<?php echo(JS.'popover.js'); ?>\" type=\"text/javascript\"></script>
	
  <?php
	//include required scripts
	include(\"inc/scripts.php\");
?>
<script type=\"text/javascript\">
	// JavaScript Document
        \$(document).ready(function() {
        	\$('#reasons').hide();
        	\$('#cancel').hide();
        });
        \$('#disapprove').click(function(){
        	\$('#reasons').show();
        	\$('#disapprove').hide();
        	\$('#cancel').show();
        	});
        \$('#cancel').click(function(){
        	\$('#reasons').hide();
        	\$('#disapprove').show();
        	\$('#cancel').hide();
        	});
		\$('.close').hide();
		\$('.close1').hide();
		\$(\".close\").click(function(){
			\$('#wrap').hide();
			\$('#wrap1').hide();
			\$('.close').hide();
		});
		\$(\".close1\").click(function(){
			\$('#wrap1').hide();
			\$('.close1').hide();
		});
		objfull = {};
	
		\$(\"#all\").click(function(){
            \$('.close').show();
			\$('#wrap').show();
			if (typeof \$('input[name=\"docid\"]').val() != 'undefined'){
				doc_id = \$('input[name=\"docid\"]').val();
			}else{
				doc_id = '';
			}
	
            var url = '<?php echo URLC;?>".$controllername."/get_all/'+doc_id;
	
			\$.ajax({
				url: url,
				type: 'POST',
				success: function (data) {
					var obj = JSON.parse(data);
					objfull = obj;
					var li = \"\";
					for( var i in obj['all'] )
					 {
						stage = obj['all'][i];
						stage_qut = '\"'+stage+'\",\"'+i+'\"';
						if (obj['match'] == obj['all'][i])
						{
							li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class='icon-arrow-left icon-red'></i><i style='color:#F00'>You are here.!</li></span></a><div id='\"+i+\"'></div></li>\";
						}else{
					  	li = li + \"<li id='\"+stage+\"' onClick='getusers(\"+stage_qut+\")'><a>\"+stage+\"</a><div id='\"+i+\"'></div></li>\";
						}
					 }
                      sessionValue = obj['username'];
					  \$('#disapprover').val(sessionValue);
					  \$('#wrap').html(\"<div id='stagelist'><ul>\"+li+\"</ul></div>\");
					  \$('.close').show();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});
		});
		\$(\"#all1\").click(function(){
			\$('#wrap1').show();
      
			if (typeof \$('input[name=\"docid\"]').val() != 'undefined'){
				var doc_id = \$('input[name=\"docid\"]').val();
			}else{
				var doc_id = '';
			}
      
           	 var url = '<?php echo URLC;?>".$controllername."/list_previous_stages_for_disapprove/'+doc_id;
	
			\$.ajax({
				url: url,
				type: 'POST',
				success: function (data) {
					var obj = JSON.parse(data);
					var li = \"\";
					var count = obj.length;
					for(var i =0; i<count; i++)
					{
						li = li + \"<li id='\"+obj[i]+\"'><a>\"+obj[i]+\"</a><div id='\"+i+\"1'></div></li>\";
					}
					
                      
					  \$('#wrap1').html(\"<div id='stagelist'><ul>\"+li+\"</ul></div>\");
					  \$('.close1').show();
					},
					error:function(XMLHttpRequest, textStatus, errorThrown)
					{
					 console.log('error', errorThrown);
					}
				});
		});
	
		getusers = (function(stage,i){
	
		var li = \"\";
		var td = \"\";
		for( var use in objfull.vitals[stage])
		{
		
			name = objfull.vitals[stage][use][0].first_name;
			phone = objfull.vitals[stage][use][0].phone;
			email = objfull.vitals[stage][use][0].email;
			console.log(name);
			console.log(phone);
			td = td + \"<li>\"+name+\" <i class='fa fa-phone'></i>:\"+phone+\" <i class='fa fa-envelope'></i>:\"+email+\"</li>\";
		}
		\$('#'+i).html(\"<ol>\"+td+\"</ol>\");
		});
		getusers1 = (function(stage,i){
		
			\$('#stage').val(stage);
			var li = \"\";
			var td = \"\";
			for( var use in objfull.vitals[stage])
			{
				name = objfull.vitals[stage][use][0].first_name;
				phone = objfull.vitals[stage][use][0].phone;
				email = objfull.vitals[stage][use][0].email;
				td = td + \"<option value='\"+email+\"' >\"+name+\" <i class='icon-phone'></i>:\"+phone+\" <i class='icon-envelope'></i>:\"+email+\"</li></option>\";}
			\$('#'+i+\"1\").html(\"<select name='drop' id='drop'>\"+td+\"</select>\");
		
			});
	
		</script>
        
<?php
	//include footer
	include(\"inc/footer.php\");
?>
	
	
       ";
	
		}
		
		$client_validation_messages.="},onkeyup: false, //turn off auto validate whilst typing";
	   
	   $client_validation_messages.="
						// Do not change code below
			            errorPlacement : function(error, element) {
				            error.insertAfter(element.parent());
						}
						});

			});
</script>";
		
		//$client_validation_data = $this->create_client_side_validation_for_web_view();
		
		//$data = $data.$client_validation_data;
		
		
		
		$data = $data.$client_validation_rules;
		
		$data = $data.$client_validation_messages;
		
		log_message('debug','client_validation_data======18802=====CODE_GEN_LIB'.print_r($data,true));
	
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$companyname."/".$controllername);
	
		if ( $this->save_file($stage_name[0], "views/".$companyname."/".$controllername."/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$controllername."/".$stage_name[0].".php";
			return FALSE;
		}
	
	
	}
	
	public function create_single_stage_web_view_elements_for_only_view_permission($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$coll_ref=false,$field_ref=false,$list=false)
	{
	  $data="";
	  $res_data = array();
	  
	  switch($val['type'])
										{
	
	                                        case 'retriever':
											  
											  if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
													$result_data = $this->create_single_stage_web_view_elements_for_only_view_permission($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$val['coll_ref'],$val['field_ref'],$val['retrieve_list']);
													//$data.= $result_data;
													$data .= $result_data['data']; 
													$client_validation_rules  = $result_data['client_validation_rules']; 
													$client_validation_messages  = $result_data['client_validation_messages']; 
												}
												break;
												
											  case 'mapper':
											   if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
											      $result_data = $this->create_single_stage_web_view_elements_for_only_view_permission($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,"",$val['field_ref'],"");
												  //$data.= $result_data;
												  $data .= $result_data['data']; 
												  $client_validation_rules  = $result_data['client_validation_rules']; 
												  $client_validation_messages  = $result_data['client_validation_messages']; 
												}
											  break;
											
											case 'text':
	
											    if($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
												}
												else
												{
												   if($val['key'] == "TRUE")
													{
												     if((array_key_exists('parent',$val))) 
													 {
												        if($val['parent'] == "retriever")
														{
													       $list = json_encode($list);
														   $list = base64_encode($list);
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";
														}
													 }
													 else
													 {
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";
													 }
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";												
												
												}
												}
												break;
												
												 case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                 <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
													$instruction = str_replace("\n","<br>",$val['instructions']);
										
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
	
											case 'number':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											       if((array_key_exists('parent',$val))) 
													{
												        if($val['parent'] == "retriever")
														{
													       $list = json_encode($list);
														    $list = base64_encode($list);
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												break;
												
											case 'mobile':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input country_code'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : '');?></label><label class='text_input mob_num'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : '');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											
											        if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															$country_code_ref = $field_ref."_country_code";
															$mob_num_ref = $field_ref."_mob_num";
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only country_code' rel='".$country_code_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?></label><label class='text_input view_only mob_num' rel='".$mob_num_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";	
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only country_code'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?></label><label class='text_input view_only mob_num'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";	
													}
												}
												break;	
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? str_repeat('*',strlen(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											       if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												 
												break;
	
											case 'time':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '- - - - - - - - - -');?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													
													
													}
												}
												else
												{
												  if($val['key'] == "TRUE")
													{
												
												if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_area view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
													}				
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";		
												}
											}
	
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <label class='labelform'>".ucfirst($loop)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label>
				 
                ";
													$section_class="section_writable";
													$element_class="margin";				
	
												break;
	
											case 'checkbox_old':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php foreach(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] as \$key){
                  	echo \"<label class='lcheck_radio labelforminline' for='\$key'>\$key</label>\";
                  }?>
                 
				   ";

												$data .="</div>";

													$section_class="section_checkbox";
													$element_class="margin_checkbox";				  
	
	
												break;
												
											case 'checkbox':
											
											if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
				  <?php if(isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) && !empty(\$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) {?>
                  <?php foreach(\$".$mapper_doc."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] as \$key){
                  echo \"<label class='lcheck_radio labelforminline' for='\$key' rel='".$field_ref."'>\$key</label>\";
                  }?>
                  <?php } else { ?>";
				                           $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='checkbox_view_only' rel='".$field_ref."' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['".$c."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['".$c."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
													}
												$data.= "<?php } ?></div>
				  
				  ";

													$section_class="section_checkbox";
										$element_class="margin_checkbox";
														}
													}
													else
													{
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
				  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) && !empty(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) {?>
                  <?php foreach(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] as \$key){
                  	echo \"<label class='lcheck_radio labelforminline' for='\$key'>\$key</label>\";
                  }?>
                  <?php } else { ?>";
				                           $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='checkbox_view_only' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['".$c."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
													}
												$data.= "<?php } ?></div>
				  
				  ";

													$section_class="section_checkbox";
										$element_class="margin_checkbox";
										}				  
	
	
												break;	
	
											case 'MChoice':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
				   
				  ";
													$section_class="section";
													$element_class="margin";				  
												break;
	
											case 'select':
											if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?></label></div>
                                   
				   ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label></div>
                                   
				   ";
													$section_class="section";
													$element_class="margin";		
													}
	
	                                         	break;
	
	
											case 'selectbd':
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label>
                  
				  ";
												break;
	
											case 'radio_old':
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : '- - - - - - - - - - -'); ?></label></div>
				  
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";				  

	
												break;
												
										case 'radio':
										if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>";
				  $data.="
				  <?php if(isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']) && !empty(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) { ?>
				  
                  <label class='text_input view_only' rel='".$field_ref."'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])); ?></label><?php } else { ?>
				   ";
				  
				                                $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='radio_view_only' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
				   
				  $data.= "<?php } ?></div>
				  
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";
													
														}
													}
													else
													{
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>";
				  $data.="
				  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) && !empty(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) { ?>
				  
                  <label class='text_input view_only'><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])); ?></label><?php } else { ?>
				   ";
				  
				                                $c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <label class='radio_view_only' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> ></label>
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
				   
				  $data.= "<?php } ?></div>
				  
				  ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";				  
													}
	
												break;		
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><?php echo set_value('".$loop."', (isset(\$".$modelname."['index']"."['".$loop."'])) ? \$".$modelname."['index']"."['".$loop."']->format('d-m-Y') : ''); ?></label></div>
			    
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']): ?>
	            <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']?>' /> 
                <?php endif ?></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']): ?>
	            <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']?>' /> 
                <?php endif ?></div>
                <br/>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'file':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']):?>
                  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a>
                  <?php else: ?>
				  <label class='text_input'> - - - - - - - - - - </label>
				  <?php endif ?></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])): ?>
                  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php else: ?>
				  <label class='text_input view_only'></label>
				  <?php endif ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
											
											case 'photo':
											
											if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']):?>
                  <div class='photo_elem photo_elem_view_only' style='background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path'];?>')' for='".$index_name."_".$prefix."'></div>
                  <?php else: ?>
				  <div class='photo_elem photo_elem_view_only'></div>
				  <?php endif ?></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])): ?>
				  <div class='photo_elem photo_elem_view_only' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div>
                  <?php else: ?>
				  <div class='photo_elem photo_elem_view_only'></div>
				  <?php endif ?></div>
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
	
											break;
											
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;	
											
                                             case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea ' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'paragraph':
											break;
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop."' value='<?php echo \$".$loop."?>'/>
                ";
	
												break;
										}
										
										return $data;
	
	
	}
	
	public function create_single_stage_web_view_elements_for_only_edit_permission($val,$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$coll_ref=false,$field_ref=false,$list=false)
	{
		$data="";
		$res_data = array();
		
	   switch($val['type'])
                                         {
											  case 'retriever':
											  
											  if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
													$result_data = $this->create_single_stage_web_view_elements_for_only_edit_permission($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,$val['coll_ref'],$val['field_ref'],$val['retrieve_list']);
													//$data.= $result_data;
													$data .= $result_data['data']; 
									                $client_validation_rules  = $result_data['client_validation_rules']; 
									                $client_validation_messages  = $result_data['client_validation_messages']; 
												}
												break;
												
											  case 'mapper':
											   if($val['properties']['multilanguage'] == "TRUE")
											  {
												
												    if($val['properties']['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"/><button>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
											      $result_data = $this->create_single_stage_web_view_elements_for_only_edit_permission($val['properties'],$index_name,$section_name,$pgno,$index,$modelname,$section_class,$element_class,$client_validation_rules,$client_validation_messages,$setvalue_name,$section,"",$val['field_ref'],"");
												  //$data.= $result_data;
												  $data .= $result_data['data']; 
									              $client_validation_rules  = $result_data['client_validation_rules']; 
									              $client_validation_messages  = $result_data['client_validation_messages']; 
												}
											  break;
											  
                                              case 'text':
											  
											  if($val['multilanguage'] == "TRUE")
											  {
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block'>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='text' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";
													
												
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";
													
												}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													
													if((array_key_exists('parent',$val))) {
													if($val['parent'] == "retriever")
													{
														$list = json_encode($list);
														$list = base64_encode($list);
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
													}
													else if($val['parent'] == "mapper")
													{
														$field = explode("_",$field_ref);
														$mapper_doc = 'mapper_doc';
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' rel='".$field_ref."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
													}
													}
													else
													{
													
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."'  minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                                             $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                                								
				                                     }
												}
													 else
													 {
													     $data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='hrsingle '></div></div></div>
													     ";
													$section_class="section_writable";
													$element_class="margin_writable";														 
													 }
												} 
												break;
	
	                                        case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$instruction = str_replace("\n","<br>",$val['instructions']);

														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
               
                ";
													$section_class="section";
													$element_class="margin";				
													}
												
												}
												else
												{
										            $instruction = str_replace("\n","<br>",$val['instructions']);

													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <label class='text_input'><font>".$instruction."</font></label></div>
				
                ";
													$section_class="section";
													$element_class="margin";				
				                                     
												}
												
											break;
											
											
											case 'number':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													if($val['key'] == "TRUE")
													{
													
													if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "retriever")
														{
															$list = json_encode($list);
														    $list = base64_encode($list);
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode("_",$field_ref);
														$mapper_doc = 'mapper_doc';
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
													}
													else
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='number' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
                                        
                                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}				
												}
												break;
												
											case 'mobile':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['country_code'] : ''); ?>\"  /><input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											
											       if((array_key_exists('parent',$val))) 
													{
												        if($val['parent'] == "retriever")
														{
													        $list = json_encode($list);
														    $list = base64_encode($list);
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															$country_code_ref = $field_ref."_country_code";
							                                $mob_num_ref = $field_ref."_mob_num";
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' rel='".$country_code_ref."' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['country_code'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' rel='".$mob_num_ref."' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['mob_num'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input country_code' id='page".$pgno."_".$section_name."_".$index_name."_country_code' type='number' name='page".$pgno."_".$section_name."_".$index_name."_country_code' minlength='1' maxlength='2' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_country_code', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['country_code'] : ''); ?>\"  /><input class='text_input mob_num' id='page".$pgno."_".$section_name."_".$index_name."_mob_num' type='number' name='page".$pgno."_".$section_name."_".$index_name."_mob_num' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_mob_num', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['mob_num'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													}

                    $client_validation_rules .="".$setvalue_name."_country_code:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
					$client_validation_rules.="minlength:1,maxlength:3},".$this->sl;
								
					$client_validation_rules .="".$setvalue_name."_mob_num:{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
					$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
                    				   
												}
												break;
												
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='password' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='password' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													
					$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

                   													
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                
                 <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minlength']."' max='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  />
                  <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='date' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minlength']."' max='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
											       if((array_key_exists('parent',$val))) 
													{
												        if($val['parent'] == "retriever")
														{
													       $list = json_encode($list);
														   $list = base64_encode($list);
															
													       $data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' rel='".$field_ref."' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='date' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													}

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;													
												}
												 
												break;
	
											case 'time':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='time' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='time' name='page".$pgno."_".$section_name."_".$index_name."' minlength='".$val['minlength']."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='range' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  />".$val['maxrange']."</div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ".$val['minrange']."<input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='range' name='page".$pgno."_".$section_name."_".$index_name."' min='".$val['minrange']."' max='".$val['maxrange']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  />".$val['maxrange']."</div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='color' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='color' name='page".$pgno."_".$section_name."_".$index_name."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'month':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='month' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
													}
												}
												else
												{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='month' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='".$val['maxlength']."' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'  name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'/>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";				
													}
													}
													else
													{
													$data .="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle '></div><div class='hr '></div><div class='hr '></div></div></div>
													";
													$section_class="section_writable";
													$element_class="margin_writable";													
													}
												}
												else
												{
												
												 if($val['key'] == "TRUE")
												 {
													 if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "retriever")
														{
															$list = json_encode($list);
														    $list = base64_encode($list);
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea><button class=\"btn btn-default btn-lg retriever_search\" type=\"button\" id=\"search\" collection_ref='".$coll_ref."' field_ref='".$field_ref."' retrieval_list='".$list."'>search</button></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
														else if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? htmlspecialchars_decode(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														}
													}
													else
													{
													$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <textarea class='text_area' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'>
                  <?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? htmlspecialchars_decode(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''); ?>
                  </textarea></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_writable";
													$element_class="margin_writable";
                                
                                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
								$client_validation_rules.="minlength:".$val['minlength'].",maxlength:".$val['maxlength']."},".$this->sl;
								
								$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

													}				
												}
												else
												{
												$data .=" <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea'><div class='hrsingle'></div><div class='hr'></div><div class='hr'></div></div></div> ";
													$section_class="section_writable";
													$element_class="margin_writable";												
												}
												
												}
												break;
	
											case 'checkbox1':
												$data .= "
                
                  <div class='".$element_class." inline-block'><input id='page".$pgno."_".$section_name."_".$index_name."' ".(($val['checked'] == "TRUE") ?  ' checked '  :  '')."type='checkbox' name='page".$pgno."_".$section_name."_".$index_name."' value='1' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '1', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )?> />
                  
                  <label class='labelforminline' for='".$index_name."'>".$val['label']." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
	
												break;
	
											case 'checkbox':
											if ($val['multilanguage'] == "TRUE")
												{
												
												foreach ($languages as $prefix=>$language)
													{
												$data .= "
                
                  <label class='icheck_radio'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input type='checkbox' name='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' id='ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"[]' value='".$value2['value']."' <?php echo pre_set_check_box_value('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? array_values($".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']): ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_".$prefix."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
	
												$data .= " <?php echo form_error('ac_\"page\".\$pgno.\"_\".\$section_name.\"_\".\$index_name.\"_\".\$prefix.\"\"'); ?> 
                ";
				                                }
				                                } 
				                               else
				                               {
				
				                              if((array_key_exists('parent',$val))) 
											  {
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															 $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><label class='lcheck_radio labelforminline' for='".$index_name."_$c'>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' rel='".$field_ref."' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  );?> >
                   ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .=" </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";
														}
											  }
											  else
											  {
				                   $data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='checkbox' name='ac_page".$pgno."_".$section_name."_".$index_name."[]' id='ac_page".$pgno."_".$section_name."_".$index_name."[]' value='".$value2['value']."' <?php echo preset_checkbox('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .=" </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_checkbox";
													$element_class="margin_checkbox";
											  }

                $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
				
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
				
				                               }
												break;
	
	
											case 'MChoice':
											if($val['multilanguage']=="TRUE")
											{
											
											foreach ($languages as $prefix=>$language)
													{
												$data .="
                
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."[]' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?> 
                ";
				                           }
										   } 
				                           else
				                           {
				   $data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select multiple class='text_input' name='page".$pgno."_".$section_name."_".$index_name."[]' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
					 <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) {?>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  pre_set_select_box('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? array_values(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']) : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
	
	
												$data .="
                  <?php } else {?>";
				  
				                                 foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', ((isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  )) ?>>
                    ".$value2['text']."
                    </option>
                    ";
												}
												
				  $data.="<?php } ?></select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";

                 $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
				 
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;				 
				                           }
												break;
	
											case 'select':
											if((array_key_exists('parent',$val))) 
													{
														if($val['parent'] == "mapper")
														{
															$field = explode('_',$field_ref);
															$mapper_doc='mapper_doc';
															
															$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
					
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
														}
													}
													else
													{
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <select class='text_input' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."'>
                    <option value=''>
                    <?php echo lang('web_choose_option')?>
                    </option>
                    ";
	
												foreach($val['options'] as $index2=>$value2)
												{
													$data .= $this->sl.$this->tab."
                    <option value='".$value2['value']."' <?php echo  preset_select('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                    ".$value2['text']."
                    </option>
                    ";
					
												}
	
	
												$data .="
                  </select></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";
													}

                    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
					
					$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;					
												break;
	
	
											case 'selectbd':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label></div>
                  <select name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."' size='".$val['size']."'>
                  <option value=''>
                  <?php echo lang('web_choose_option')?>
                  </option>
                  <?php foreach (\$array_".strtolower($val['options']['model'])." as \$item): ?>
                  <option value=\"<?php echo \$item->".$val['options']['field_value'].";?>\" <?php echo preset_select('page".$pgno."_".$section_name."_".$index_name."', \$item->".$val['options']['field_value'].", (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  ) ?>>
                  <?php echo \$item->".$val['options']['field_text'].";?>
                  </option>
                  <?php endforeach ?>
                  ";
	
												$data .="
                  </select>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
												break;
	
											case 'radio':
											if((array_key_exists('parent',$val))) 
											{
												if($val['parent'] == "mapper")
												{
													$field = explode('_',$field_ref);
													$mapper_doc='mapper_doc';
													
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' rel='".$field_ref."' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'])) ? \$".$mapper_doc."['doc_data']"."['widget_data']"."['".$field[0]."']"."['".$field[1]."']"."['".$field[2]."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= " </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";
												}
											}
											else
											{
												$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  ";
	
												$c = 0;
												foreach($val['options'] as $index2 => $value2)
												{
													$data .= $this->sl.$this->tab."
                  <input class='icheck_radio' type='radio' name='page".$pgno."_".$section_name."_".$index_name."' id='page".$pgno."_".$section_name."_".$index_name."_$c' value='".$value2['value']."' <?php echo preset_radio('page".$pgno."_".$section_name."_".$index_name."', '".$value2['value']."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''  );?> >
                  <label class='lcheck_radio labelforminline' for='".$index_name."_$c'> ".$value2['label']." </label>
                  ";
													$c++;
												}
												$data .= " </div>";
												$data .= " <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section_radio_check";
													$element_class="margin_radio_check";
											}

                 $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;

                 $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;				 
	
												break;
	
											case 'datepicker':
												$data .="
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='text' name='page".$pgno."_".$section_name."_".$index_name."' maxlength='' class='datepicker' value=\"<?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']->format('d-m-Y') : ''); ?>\"  /></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?> 
                ";
													$section_class="section";
													$element_class="margin";				
												break;
	
											case 'image':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
	
                <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']?>' /> 
                <input id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?></div>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_image_edit\" : \"web_image_create\" )?>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                     <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$controllername."/img/thumbs/<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']?>' /> 
                
                <input id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' /></div>
                <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
												}
	
												break;
	
											case 'file':
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?><?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a> <?php endif ?></div></div>
               <br/>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label>
                  <input class='text_input' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
				  <?php \$pathvar = str_replace('/','=',\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path']); ?>
				  <div class='text_input'><a target='_blank' href=\"../".$this->customer_folder."/".$this->controller_name."/web_file_download/<?php echo \$pathvar;?>\">Download file (<?php echo \$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a></div>
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
		 											$section_class="section";
													$element_class="margin";
													
				  
                 $max_size 		    = $val['upload']['max_size'];
				 $max_size_in_bytes = $max_size * 1024;
				 $allowed_types     = $val['upload']['allowed_types'];
						
				$client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";
                $client_validation_rules.="filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
				
				$client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                $client_validation_messages .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
				
				
										    }
	
												break;
											
                                            case 'photo':
	
												if ( $val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>
                    <?php echo lang( (\$updType == 'edit')  ? \"web_file_edit\" : \"web_file_create\" )?>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
					<?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name'])) :?>
					<div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
				  <?php else : ?>
				  <div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' type='file' name='page".$pgno."_".$section_name."_".$index_name."_".$prefix."' />
                  <?php endif ?></div>
                <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."_".$prefix."'); ?>
                <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."_".$prefix."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";				
													}
	
												}
												else
												{
													$data .= "
                
                  <div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>
                    ".$index." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>":"") ."</label>
                  <?php if(isset(\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])):?>
				   <div class='photo_elem' style=\"background-image:url('<?php echo URLCustomer.\$".$modelname."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_path'];?>')\" for='".$index_name."'></div><input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
				   <?php else : ?>
				   <div class='photo_elem' for='".$index_name."'></div>
                  <input class='text_input hide upload_photo' id='page".$pgno."_".$section_name."_".$index_name."' type='file' name='page".$pgno."_".$section_name."_".$index_name."' />
                  <?php endif ?></div>
                  <?php echo form_error('page".$pgno."_".$section_name."_".$index_name."'); ?>  
                  <?php  echo ( isset(\$upload_error['page".$pgno."_".$section_name."_".$index_name."'])) ?  \$upload_error['page".$pgno."_".$section_name."_".$index_name."']  : \"\"; ?>
                
                ";
													$section_class="section";
													$element_class="margin";
                      
					$min_size 		   = $val['upload']['min_size'];
					$min_size_in_bytes = $min_size * 1024;
						
					$max_size 		   = $val['upload']['max_size'];
					$max_size_in_bytes = $max_size * 1024;
						
					$allowed_types = $val['upload']['allowed_types'];

				    $client_validation_rules .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:true,' : '')."";	
				    $client_validation_rules.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
					
                    $client_validation_messages .="".$setvalue_name.":{".(($val['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
				    $client_validation_messages .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
                 													
												}
	
												break;
												
											case 'newline':
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                
				<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>
                ";
													$section_class="section";
													$element_class="margin";
													}
												}
												else
												{
													
													$data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";
													
														}
												}
												else
												{
												    if($val['key'] == "TRUE")
													{
													$data .="
                  <div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div> 
                ";
													$section_class="section";
													$element_class="margin";				
				                                     }
													 else
													 {
													    $data.="<div class='".$element_class." inline-block' style='visibility: hidden;'><label class='labelform' for='".$index_name."'></label><label class='text_input' id='page".$pgno."_".$section_name."_".$index_name."'  name='page".$pgno."_".$section_name."_".$index_name."'></label></div>";
													$section_class="section";
													$element_class="margin";														 
													 }
												}
                                                break;
	                                        
											case 'block':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtext'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'multiblock':
											if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") .":</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
													}
												}
												else
												{
													$data.="<div class='".$element_class." inline-block'><label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."</label><div class='wtextarea' style='margin-top:5px;'><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div><div class='sq_wr'></div></div></div>";
													$section_class="section_writable";
													$element_class="margin_writable";															
												}
											break;
											
											case 'paragraph':
											break;
											
											case 'hidden':
	
												$data .= "
                <input id='".$loop."' type='hidden' name='".$loop_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
												break;
										}
										
										$res_data['data'] = $data;
										$res_data['client_validation_rules'] = $client_validation_rules;
										$res_data['client_validation_messages'] = $client_validation_messages;
										
                       return $res_data;										
		
	}

    // -----------------------------------------------------------------------------------------

	/**
	 * Creating client side validation rules for web stages - Initial process 
	 *
	 * @param	string	$data  Data
	 *
	 * @author  Selva
	 * 
	 */

	private function create_client_side_validation_for_web_view()
	{

	    //**************************** single **********************************************//
	 	$stages                             = array();
		$app_temp                           = array();
		$app_temp1                          = array();
		$perstagedata                       = array();
		$singlestagedata                    = array();
		$allstages                          = array();
		$single_client_data                 = array();
		$controller_data                    = '';


		//******************************** parallel **************************************//
		$parallelstageusers                 = array();
		$parallelstype                      = array();
		$parallelvp                         = array();
		$parallelep                         = array();
		$workflow_type                      = array();
		$arrayPar                           = array();
		$parallelapp_temp1                  = array();
		$branchs                            = array();
		$parallelperstagedata               = array();
		$parallelbranches                   = array();
		$parallel_client_data               = array();

	
		//******************************** conditional **************************************//
		$conditionalstageusers              = array();
		$approvedstype                      = array();
		$disapprovedstype                   = array();
		$conditionalapp_temp1               = array();
		$conditionalapp_temp2               = array();
		$conditionalstages                  = array();
		$conditionaldisapprovedstages       = array();
		$conditionaldisapprovedstageusers   = array();
		$conditionalperstagedata            = array();
		$approvedst                         = array();
		$disapprovedstage                   = array();
		$conditionaldisapprovedperstagedata = array();
		$approvedvp                         = array();
		$approvedep                         = array();
		$disapprovedvp                      = array();
		$disapprovedep                      = array();
		$arrayCon                           = array();
		$conditional_client_data            = array();
	
	
		//*********************************************************************************//
	
		foreach($this->workflow as $worktemplate => $temp)
		{
			array_push($allstages,$worktemplate);
			array_push($perstagedata,$temp);
		}

		$count = count($perstagedata);
		for ($i = 0; $i < $count; $i++)
		{
		
		array_push($workflow_type,$perstagedata[$i]['Workflow_Type']);
        
	   ///////////////////////////////////////////////////////////////////////---single---////////////////////////////////////////////////////////////////////////////////////////////////////////////
	          
	      if($workflow_type[$i] == "single")
	      {
	         $controller_data = $this->process_single_stage_for_client_side_validation_rules($perstagedata[$i],$allstages[$i]);
	         $controller_data  = $controller_data.$single_client_data;
			 
	      }

	       if($workflow_type[$i] == "parallel")
	      {
	      	 $arrayPar = $perstagedata[$i];
	         unset($arrayPar['Workflow_Type']);
	         $parallel_client_data = $this->process_parallel_stage_for_client_side_validation_rules($arrayPar);
	         $controller_data  = $controller_data.$parallel_client_data;
		  }

	       if($workflow_type[$i] == "conditional")
	      {
	      	 $arrayCon = $perstagedata[$i];
	         $conditional_client_data = $this->process_conditional_stage_for_client_side_validation_rules($arrayCon);
	         $controller_data  = $controller_data.$conditional_client_data;
	      }

	    }

	   return $controller_data;
    }

    // -------------------------------------------------------------------------------

	/**
	 * Creating client side validation rules for web stages - processing single stage
	 *
	 *
	 * @param	array	$singlestagedata  Single stage data json
	 * @param	string	$stage            Name of the stage
	 * 
	 * @author  Selva
	 *
	 */

    private function process_single_stage_for_client_side_validation_rules($singlestagedata,$stage)
    {
        $permissions  = array();
		$vp           = array();
		$ep           = array();
		$stype        = array();
		$stageindex   = array();
		$newdata      = '';

		array_push($vp,$singlestagedata['View_Permissions']);
		array_push($ep,$singlestagedata['Edit_Permissions']);
		array_push($stype,$singlestagedata['Stage_Type']);
		array_push($stageindex,$singlestagedata['index']);

		$permissions['View_Permissions'] = $vp[0];
		$permissions['Edit_Permissions'] = $ep[0];
		$permissions['index']            = $stageindex[0];
		
		if($stype[0]=="web")
		{
			$newdata = $this->set_client_side_validation_rules_for_web_view($this->arrayjsonfull,$stage,$permissions,$this->company_name,$this->controller_name);
		}

		return $newdata;

    }


    // -------------------------------------------------------------------------------

	/**
	 * Creating client side validation rules for web stages - processing parallel stage
	 *
	 * @param	array	$arrayPar  Parallel stage data 
	 *
	 * @author  Selva
	 * 
	 */

    private function process_parallel_stage_for_client_side_validation_rules($arrayPar)
    {
       $arrayCon                    = array();
	   $branchs                     = array();
	   $parallelperstagedata        = array();
	   $parallelbranches            = array();
	   $parallelbranchwtype         = array();
	   $parallelstagedata           = array();
	   $parallelstagecontrollerdata = '';
	   
	
	   foreach($arrayPar as $paral => $para)
	   {
	       array_push($branchs,$paral);
	   }
	
	   foreach ($branchs as $perbranch)
	   {
	         $parallelstagenames = array();
	
	        if(isset($parallelperstagedata))
	        {
				array_shift($parallelperstagedata);
	        }
			if(isset($parallelbranches))
			{
				array_shift($parallelbranches);
			}
			if(isset($parallelbranchwtype))
			{
				array_shift($parallelbranchwtype);
			}
			
	    foreach($arrayPar[$perbranch] as $branchname => $branch)
	    {
	       array_push($parallelbranches,$branchname);
	       array_push($parallelperstagedata,$branch);
	    }
	
	       $parallelstagecount = count($parallelperstagedata);
	
	      for($kk=0;$kk<$parallelstagecount;$kk++)
	     {
	         array_push($parallelbranchwtype,$parallelperstagedata[$kk]['Workflow_Type']);
	         if($parallelbranchwtype[$kk]=="single")
	        {
	           if(isset($parallelperstagedata[$kk-1]))
			   {
					unset($parallelperstagedata[$kk-1]);
			   }
	
			   if(isset($parallelstagenames[$kk-1]))
			   {
	                unset($parallelstagenames[$kk-1]);
	           }
	
	
	          foreach($arrayPar[$perbranch] as $branchname => $branch)
	          {
	        	if($branch['Workflow_Type']=="single")
	         	{
					array_push($parallelstagenames,$branchname);
	        	}
	      	  }
	
	      	   $stagecontrollerdata = $this->process_single_stage_for_client_side_validation_rules($parallelperstagedata[$kk],$parallelstagenames[$kk]);
	           $parallelstagecontrollerdata = $parallelstagecontrollerdata.$stagecontrollerdata;
	        }

	        if($parallelbranchwtype[$kk]=="parallel")
	        {
	
				$arrayParnew = $parallelperstagedata[$kk];
				unset($arrayParnew['Workflow_Type']);
				$this->process_parallel_stage_for_client_side_validation_rules($arrayParnew);
	        }

	       if($parallelbranchwtype[$kk]=="conditional")
	       {
	
				$arrayCon = $parallelperstagedata[$kk];
				$this->process_conditional_stage_for_client_side_validation_rules($arrayCon);
	       }
	    }

	}

	  return $parallelstagecontrollerdata;

    }


    // --------------------------------------------------------------------

	/**
	 * Creating validation rules for web stages - processing conditional stage
	 *
	 * @param	array	$arrayCon  Conditional stage data
	 *
	 * @author  Selva
	 * 
	 */

    private function process_conditional_stage_for_client_side_validation_rules($arrayCon)
    {

        $arrayPar                           = array();
		$approvedstage                      = array();
		$disapprovedstage                   = array();
		$conditionalperstagedata            = array();
		$conditionalapprovedwtype           = array();
		$conditionaldisapprovedwtype        = array();
		$conditionaldisapprovedperstagedata = array();
		$conditionalperstagedata            = array();
		$conditionalstagedata               = array();
		$approvedstagenames                 = array();
		$disapprovedstagenames              = array();
		$disapprovedconditionalstagedata    = array();
		$conditionalstagecontrollerdata     = '';
	
		array_push($approvedstage,$arrayCon['approved']);
		array_push($disapprovedstage,$arrayCon['disapproved']);

	//---------------------------------------------------------------Approved----------------------------------------------------------------------------------//
		foreach($approvedstage as $worktemplate => $temp)
		{
	      foreach($temp as $stagename => $t)
	      {
	          array_push($conditionalperstagedata,$t);
	       }
	    }
		$conditionalperstagedatacount = count($conditionalperstagedata);
	
		for($ii = 0;$ii < $conditionalperstagedatacount; $ii++)
		{
			array_push($conditionalapprovedwtype,$conditionalperstagedata[$ii]['Workflow_Type']);
	        if($conditionalapprovedwtype[$ii]=="single")
	        {
	              foreach($approvedstage as $worktemplate => $temp)
	              {
	                 foreach($temp as $stagename => $t)
	                 {
	                   if($t['Workflow_Type']=="single")
	                    {
							array_push($approvedstagenames,$stagename);
	                     }
	                 }
	              }	

			  $approvedstagecontrollerdata = $this->process_single_stage_for_client_side_validation_rules($conditionalperstagedata[$ii],$approvedstagenames[$ii]);
			  $conditionalstagecontrollerdata = $conditionalstagecontrollerdata.$approvedstagecontrollerdata;

	        } 

	       if($conditionalapprovedwtype[$ii]=="parallel")
	       {
				$arrayPar = $conditionalperstagedata[$ii];
				unset($arrayPar['Workflow_Type']);
				$this->process_parallel_stage_for_client_side_validation_rules($arrayPar);
		   }

		   if($conditionalapprovedwtype[$ii]=="conditional")
		   {
				$arrayConnew = $conditionalperstagedata[$ii];
				$this->process_conditional_stage_for_client_side_validation_rules($arrayConnew);
	
	       }
	    }
	
	//-------------------------------------------------------------Disapproved-----------------------------------------------------------------------------------//
	
		foreach($disapprovedstage as $worktemplate => $temp)
	    {
	       foreach($temp as $stagename => $t)
	       {
				array_push($conditionaldisapprovedperstagedata,$t);
	       }
	    }
			$conditionaldisapprovedstagescount = count($conditionaldisapprovedperstagedata);
			for($jj = 0;$jj < $conditionaldisapprovedstagescount; $jj++)
			{
	
				array_push($conditionaldisapprovedwtype,$conditionaldisapprovedperstagedata[$jj]['Workflow_Type']);
				if($conditionaldisapprovedwtype[$jj]=="single")
				{
					foreach($disapprovedstage as $worktemplate => $temp)
					{
						foreach($temp as $stagename => $t)
						{
							if($t['Workflow_Type']=="single")
							{
								array_push($disapprovedstagenames,$stagename);
							}
						}
					}

				  $disapprovedstagecontrollerdata = $this->process_single_stage_for_client_side_validation_rules($conditionaldisapprovedperstagedata[$jj],$disapprovedstagenames[$jj]);
				  $conditionalstagecontrollerdata = $conditionalstagecontrollerdata.$disapprovedstagecontrollerdata;

				}

				if($conditionaldisapprovedwtype[$jj]=="parallel")
				{	
					$arrayPar = $conditionaldisapprovedperstagedata[$jj];
					unset($arrayPar['Workflow_Type']);
					$this->process_parallel_stage_for_client_side_validation_rules($arrayPar);
	
			    }

				if($conditionaldisapprovedwtype[$jj]=="conditional")
				{
					$arrayCon = $conditionaldisapprovedperstagedata[$jj];
					$this->process_conditional_stage_for_client_side_validation_rules($arrayCon);
				}
	        }

	        return $conditionalstagecontrollerdata;
       
    }

    // --------------------------------------------------------------------------------------------

	/**
	 * client side validation rules for web stages - final process
	 *
	 *
	 * @param	array	$application_template  Application Template
	 * @param	string	$stage                 Name of the stage
	 * @param	array	$permissions           Permissions ( Both View and Print permissions )
	 * @param	string	$companyname           Name of the company
	 * @param	string	$controllername        Name of the controller
	 * 
	 * @author  Selva
	 *
	 */

      function set_client_side_validation_rules_for_web_view($application_template,$stage,$permissions,$companyname,$controllername)
      { 

	   $edit_sections = $permissions['Edit_Permissions'];
	   $view_sections = $permissions['View_Permissions'];
	   $stg_name = str_replace(' ','',$stage);

	   $pagenumber  = array();
	   $page_data   = array();
	       
	   foreach($application_template as $pageno => $pages)
	   {
		   array_push($pagenumber,$pageno);
	   }

       $pagecount = count($pagenumber);

       for($i=1;$i<=$pagecount;$i++)
	   {
		   array_push($page_data,$application_template[$i]);
       }
	         	 	
	         	 	
	   $data='';
	   $data .=" 

	   <script type=\"text/javascript\">
	    runAllForms();

	   \$.validator.addMethod('fileminsize', function(value, element, param) {
           return this.optional(element) || (element.files[0].size >= param) 
      });

	  
	   \$.validator.addMethod('filemaxsize', function(value, element, param) {
           return this.optional(element) || (element.files[0].size <= param) 
      });

	   $(function() {
		// Validation
		$(\"#web_view\").validate({
		ignore: \"\",
		// Rules for form validation
			rules : {"; 

	   $data.= $this->sl."";

	   for($ii=0;$ii<$pagecount;$ii++)
	   {
	   	  $pgno = $ii +1;
	   	foreach ($page_data[$ii] as $section => $index_array )
    	{
    		
    		unset($index_array['dont_use_this_name']);
    		foreach($index_array as $index => $value)
	        {
    			 $index_name    = str_replace(' ','',$index);
	         	 $sec           = str_replace(' ','',$section);
	         	 $setvalue_name = "page".$pgno."_".$sec."_".$index_name;

	         	 $edit_permission_check = in_array($section,$edit_sections);
				 $view_permission_check = in_array($section,$view_sections);

                
				// Both Edit & View Permission
    			if($edit_permission_check && $view_permission_check)
    			{
      		       switch ($value['type'])
      		       {
      			
						case 'text':


		                    if( $value['key'] == "TRUE") 
							{
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;						
							}
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{
                                foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
															
							}

						break;
						
						case 'mobile':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name."_country_code:{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:1,maxlength:3},".$this->sl;
								
								$data .="".$setvalue_name."_mob_num:{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
															
							}

						break;
						
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;      				
							}

						break;

					   case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								
							}
						
							break;

							case 'textarea':
                            
							if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
							}
							}

						    break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;
						break;
						
						case 'file':
						
						$max_size 	   = $value['upload']['max_size'];
						$max_size      = $max_size * 1024;
						$allowed_types = $value['upload']['allowed_types'];
						
						$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
                        $data.="filemaxsize:".$max_size.",accept:'".$allowed_types."'},".$this->sl;						
						break;
						
						case 'photo':
						
						$min_size          = $value['upload']['min_size'];
						$min_size_in_bytes = $min_size * 1024;
						
						$max_size = $value['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						
						$allowed_types = $value['upload']['allowed_types'];

				        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";	
						$data.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
						break;


						case 'hidden':
						break;


        	        }
                }
		
				// Only Edit Permission
    			if($edit_permission_check && !$view_permission_check)
    			{
      		        switch ($value['type'])
      		       {
      			
						case 'text':


		                    if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;	        				
							}
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
														
							}

						break;
						
						case 'mobile':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name."_country_code:{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:1,maxlength:3},".$this->sl;
								
								$data .="".$setvalue_name."_mob_num:{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
															
							}

						break;
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
														
							}

						break;

					    case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								
							}
						
							break;

					    case 'textarea':

						    if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
								$data.="minlength:".$value['minlength'].",maxlength:".$value['maxlength']."},".$this->sl;
							}
							}

						break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':

						$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true' : '')."},".$this->sl;	
							

						break;
						
						
						case 'file':
						
						$max_size 		   = $value['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						$allowed_types     = $value['upload']['allowed_types'];
						
						$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";
                        $data.="filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;						
						break;

						case 'photo':
						
						$min_size 		   = $value['upload']['min_size'];
						$min_size_in_bytes = $min_size * 1024;
						
						$max_size 		   = $value['upload']['max_size'];
						$max_size_in_bytes = $max_size * 1024;
						
						$allowed_types = $value['upload']['allowed_types'];

				        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:true,' : '')."";	
						$data.="fileminsize:".$min_size_in_bytes.",filemaxsize:".$max_size_in_bytes.",accept:'".$allowed_types."'},".$this->sl;	
						break;

        	        }
                }
            }
        }
       }
                

       $data.="},
	   
	   //Messages for form validation
			messages : {";
			
			for($jj=0;$jj<$pagecount;$jj++)
	   {
	   	  $pgno = $jj +1;
	   	foreach ($page_data[$jj] as $section => $index_array )
    	{
    		
    		unset($index_array['dont_use_this_name']);
    		foreach($index_array as $index => $value)
	        {
    			 $index_name    = str_replace(' ','',$index);
	         	 $sec           = str_replace(' ','',$section);
	         	 $setvalue_name = "page".$pgno."_".$sec."_".$index_name;

	         	 $edit_permission_check = in_array($section,$edit_sections);
				 $view_permission_check = in_array($section,$view_sections);

                
				// Both Edit & View Permission
    			if($edit_permission_check && $view_permission_check)
    			{
      		       switch ($value['type'])
      		       {
      			
						case 'text':


		                    if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;

                            }
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
															
							}

						break;
						
						case 'mobile':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name."_country_code:{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
								$data .="".$setvalue_name."_mob_num:{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
							}

						break;
						
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;      				
							}

						break;

					   case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{ 
							   $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
							}
						
							break;

							case 'textarea':

							if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
							}
							}

						    break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
						break;
						
						case 'file':
						$max_size = $value['upload']['max_size'];
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                        $data .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						break;
                        
						case 'photo':
						$min_size = $value['upload']['min_size'];
						$max_size = $value['upload']['max_size'];
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
						$data .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						break;
        	        }
                }
		
				// Only Edit Permission
    			if($edit_permission_check && !$view_permission_check)
    			{
      		        switch ($value['type'])
      		       {
      			
						case 'text':


		                    if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;        				
							}
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														
							}

						break;
						
						case 'mobile':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
														
							}

						break;
						
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
									$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;					
							}

						break;

					    case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
							  $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;
								
							}
						
							break;

					    case 'textarea':

						    if( $value['key'] == "TRUE") {
							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									
								}
							}
							else
							{
								$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;	
							}
							}

						break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':

						$data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required"' : '')."},".$this->sl;	
							

						break;
						
						
						case 'file':
						$max_size = $value['upload']['max_size'];
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
                        $data .="filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						break;
                        
						case 'photo':
						$min_size = $value['upload']['min_size'];
						$max_size = $value['upload']['max_size'];
                        $data .="".$setvalue_name.":{".(($value['required'] == 'TRUE') ? 'required:"'.$index.' field is required",' : '')."";
						$data .="fileminsize:'File uploaded for ".$index." must be greater than ".$min_size." KB',filemaxsize:'File uploaded for ".$index." must be less than ".$max_size." KB'},".$this->sl;
						break;
        	        }
                }
            }
        }
       }
	   
	   $data.="},onkeyup: false, //turn off auto validate whilst typing";
	   
	   $data.="
						// Do not change code below
			            errorPlacement : function(error, element) {
				            error.insertAfter(element.parent());
						}
						});

			});
</script>";
        		

	   return $data;
     
     }	


    // -------------------------------------------------------------------------------------

	/**
	 * validation rules for web stages - final process
	 *
	 * @author  Selva
	 *
	 * @param	array	$application_template  Application Template
	 * @param	string	$stage                 Name of the stage
	 * @param	array	$permissions           Permissions ( Both View and Print permissions )
	 * @param	string	$companyname           Name of the company
	 * @param	string	$controllername        Name of the controller
	 * 
	 */

      function set_validation_rules($application_template,$stage,$permissions,$companyname,$controllername)
      { 

	   $edit_sections = $permissions['Edit_Permissions'];
	   $view_sections = $permissions['View_Permissions'];
	   $stg_name = str_replace(' ','',$stage);

	   $pagenumber = array();
	   $page_data   = array();
	       
	   foreach($application_template as $pageno => $pages)
	   {
		   array_push($pagenumber,$pageno);
	   }

       $pagecount = count($pagenumber);

       for($i=1;$i<=$pagecount;$i++)
	   {
		   array_push($page_data,$application_template[$i]);
       }
	         	 	
	         	 	
	   $data='';
	   $data .=" 

	   private function ".$stg_name."_validation()
	   {"; 

	   $data.= $this->sl."";

	   for($ii=0;$ii<$pagecount;$ii++)
	   {
	   	  $pgno = $ii +1;
	   	foreach ($page_data[$ii] as $section => $index_array )
    	{
    		
    		unset($index_array['dont_use_this_name']);
    		foreach($index_array as $index => $value)
	        {
    			 $index_name    = str_replace(' ','',$index);
	         	 $sec           = str_replace(' ','',$section);
	         	 $setvalue_name = "page".$pgno."_".$sec."_".$index_name;

	         	 $edit_permission_check = in_array($section,$edit_sections);
				 $view_permission_check = in_array($section,$view_sections);

                
				// Both Edit & View Permission
    			if($edit_permission_check && $view_permission_check)
    			{
      		      switch ($value['type'])
      		    {
      			
        		case 'text':
 
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;

        		case 'number':
   
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .=  $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;
				case 'password':
   
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;

               case 'range':
        			 
        			if ( $value['multilanguage'] == "TRUE")
        			{
        		
        				foreach ($this->languages as $prefix=>$language)
        				{
        					$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minrange']."]|max_length[".$value['maxrange']."]');".$this->sl;
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minrange']."]|max_length[".$value['maxrange']."]');".$this->sl;
        			}
        		
        			break;

        			case 'textarea':

        			if ( $value['multilanguage'] == "TRUE")
        			{
        				foreach ($this->languages as $prefix=>$language)
        				{
							$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;
        			}

        		break;

        		case 'checkbox':
				case 'MChoice':
        		case 'select':
        		case 'selectbd':
        		case 'radio':
        		case 'date':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;
        			

        		break;
				
				case 'file':
				case 'photo':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'callback_file_required['.$setvalue_name.']|' : '')."xss_clean');".$this->sl;
        		break;


        		case 'hidden':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'requires|trim|is_numeric|xss_clean');".$this->sl;
  

        		break;


        	}
        }
		
				// Only Edit Permission
    			if($edit_permission_check && !$view_permission_check)
    			{
      		      switch ($value['type'])
      		    {
      			
        		case 'text':


   
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;

        		case 'number':
   
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .=  $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;
				case 'password':
   
        			if ( $value['multilanguage'] == "TRUE")
        			{

        				foreach ($this->languages as $prefix=>$language)
        				{
	        				$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;	        				
        			}

        		break;

               case 'range':
        			 
        			if ( $value['multilanguage'] == "TRUE")
        			{
        		
        				foreach ($this->languages as $prefix=>$language)
        				{
        					$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minrange']."]|max_length[".$value['maxrange']."]');".$this->sl;
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minrange']."]|max_length[".$value['maxrange']."]');".$this->sl;
        			}
        		
        			break;

        			case 'textarea':

        			if ( $value['multilanguage'] == "TRUE")
        			{
        				foreach ($this->languages as $prefix=>$language)
        				{
							$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;
        				}
        			}
        			else
        			{
        				$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."trim|xss_clean|min_length[".$value['minlength']."]|max_length[".$value['maxlength']."]');".$this->sl;
        			}

        		break;

        		case 'checkbox':
				case 'MChoice':
        		case 'select':
        		case 'selectbd':
        		case 'radio':
        		case 'date':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;
        			

        		break;
                
				
				case 'file':
				case 'photo':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? 'callback_file_required['.$setvalue_name.']|' : '')."xss_clean');".$this->sl;
				break;

        		case 'hidden':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'requires|trim|is_numeric|xss_clean');".$this->sl;
  

        		break;


        	}
        }
		
		    // Only View Permission
		    if(!$edit_permission_check && $view_permission_check)
    	    {
      		      switch ($value['type'])
      		      {
      			
						case 'text':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .=  $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;

					   case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							}
						
							break;

							case 'textarea':

							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							}

						break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':

							$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							
                        break;

					    case 'file':
				        case 'photo':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'xss_clean');".$this->sl;
					
					    break;

						case 'hidden':

							$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'xss_clean');".$this->sl;
		  

						break;


        	    }
            }
			
			//  No Permissions
		    if(!$edit_permission_check && !$view_permission_check)
    	    {
      		      switch ($value['type'])
      		      {
      			
						case 'text':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;

						case 'number':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .=  $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;
						case 'password':
		   
							if ( $value['multilanguage'] == "TRUE")
							{

								foreach ($this->languages as $prefix=>$language)
								{
									$data .=  $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;	        				
							}

						break;

					   case 'range':
							 
							if ( $value['multilanguage'] == "TRUE")
							{
						
								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? 'required|' : '')."xss_clean');".$this->sl;
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							}
						
							break;

							case 'textarea':

							if ( $value['multilanguage'] == "TRUE")
							{
								foreach ($this->languages as $prefix=>$language)
								{
									$data .= $this->tabx2."\$this->form_validation->set_rules('".$setvalue_name."_".$prefix."', '".ucfirst($index)." ($prefix)', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
								}
							}
							else
							{
								$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							}

						break;

						case 'checkbox':
						case 'MChoice':
						case 'select':
						case 'selectbd':
						case 'radio':
						case 'date':

							$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', '".(($value['required'] == 'TRUE') ? '' : '')."xss_clean');".$this->sl;
							

						break;
						
						case 'file':
				        case 'photo':

        	    	$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'xss_clean');".$this->sl;
					    break;


						case 'hidden':

							$data .= $this->tabx2."\$this->form_validation->set_rules('$setvalue_name', '$index', 'xss_clean');".$this->sl;
		  

						break;


        	    }
            }
        }
    }
            }
                 $data .= $this->tabx2."\$this->form_validation->set_error_delimiters(\"<br /><span class='error'>\", '</span>');";


        		 $data.="

	   }";

	   return $data;
     
     }
	
	// --------------------------------------------------------------------

	/**
	 * Creating view(print view) for respective apps 
	 *
	 * @access private
	 * @author  Selva
	 * 
	 */

	private function create_view_for_print_option()
	{
		$languages  = $this->config->item('languages');
		$data = "";
		$data .= "
		<?php
		//require_once(\"inc/init.php\");
	
		//require UI configuration (nav, ribbon, etc.)
        require_once(\"inc/config.ui.php\");
        /*---------------- PHP Custom Scripts ---------
	
         YOU CAN SET CONFIGURATION VARIABLES HERE BEFORE IT GOES TO NAV, RIBBON, ETC.
         E.G. \$page_title = \"Custom Title\" */
	
         \$page_title = \"Application\";
	
      /* ---------------- END PHP Custom Scripts ------------- */
          //include header
         //you can add your custom css in \$page_css array.
          //Note: all css files are inside css/ folder
          \$page_css[] = \"your_style.css\";
          include(\"inc/header.php\");
	
          //include left panel (navigation)
          //follow the tree in inc/config.ui.php
          \$page_nav[\"apps\"][\"active\"] = true;
          include(\"inc/nav.php\");
	
          ?>
          <!-- ==========================CONTENT STARTS HERE ========================== -->
          <!-- MAIN PANEL -->
        <div id=\"main\" role=\"main\">
	    <?php
		    //configure ribbon (breadcrumbs) array(\"name\"=>\"url\"), leave url empty if no url
		   //\$breadcrumbs[\"New Crumb\"] => \"http://url.com\"
		    \$breadcrumbs[\"Apps\"] = \"\";
		     include(\"inc/ribbon.php\");
	     ?>
           <!-- MAIN CONTENT -->
	<div id=\"content\">
      <span class='clearFix'>&nbsp;</span>
	
             <div class=\"row\">
             <article class=\"col-sm-12\">
             <label id='appname'>".$this->appName."</label>
                ";

            $page_data   = array();
			$pagenumber  = array();
		
		    log_message('debug','CREATE_SINGLE_STAGE_VIEW====-------------------APPLICATION______TEMPLATE==12056'.print_r($this->arrayjsonfull,true));
	       
	        foreach ($this->arrayjsonfull as $pageno => $pages)
		    {
		    	array_push($pagenumber,$pageno);
		    }

		    log_message('debug','CREATE_SINGLE_STAGE_VIEW====-------------------PAGENUMBER==8592'.print_r($pagenumber,true));

            $pagecount = count($pagenumber);

            log_message('debug','CREATE_SINGLE_STAGE_VIEW====-------------------PAGECOUNT==8596'.print_r($pagecount,true));

            for($i=1;$i<=$pagecount;$i++)
		    {
		    	array_push($page_data,$this->arrayjsonfull[$i]);
            }	

            log_message('debug','CREATE_SINGLE_STAGE_VIEW====-------------------PAGE_DATA==8603'.print_r($page_data,true));
		
		    for($ii=0;$ii<$pagecount;$ii++)
            {
                 	$pgno = $ii +1;
					$data .="<div id='page$pgno'>";
					
				foreach($page_data[$ii] as $section => $index_array)
				{
					foreach($index_array as $index => $value)
					{
					   switch ($value['type'])
						{
							case 'SBreak':
	
									$data .="
                  <div id='".$section."'>
                  <label style='background-color:black; color:white;' class='col-sm-12' for='".$section."'>".ucfirst($section)."</label>
                ";
									unset($index_array['dont_use_this_name']);
                                    foreach($index_array as $index => $val)
                                    {
                        	             $index_name   = str_replace(' ','',$index);
										 $section_name = str_replace(' ','',$section);
	
										switch($val['type'])
										{
	
	                                        case 'text':
	
												if($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
												   $data.="<label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>";			
												}
												}
												else
												{
												   if($val['key'] == "TRUE")
													{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
												else
												{
												
												$data.="<label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>";
												
												}
												}
												break;
												
												 case 'instruction' :
											
											if($val['multilanguage'] == "TRUE")
												{
												
												    
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><font color='red'>".$val['instructions']."</font></label>
               <br>
                ";
													}
												
												}
												else
												{
										
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><font color='red'>".$val['instructions']."</font></label>
				<br>
                ";
				                                     
												}
												
											break;
	
											case 'number':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ." &nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
												break;
	
											case 'password':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($loop_value['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? str_repeat('*',strlen(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) : ''); ?></label>
                <br>
                ";
												}
												 
												break;
	
											case 'date':
												 
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
               <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
               <br>
                ";
												}
												 
												break;
	
											case 'time':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
	
												break;
	
											case 'range':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
	
												break;
	
											case 'color':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
	
												break;
	
											case 'month':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
												}
												else
												{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
               <br>
                ";
												}
	
												break;
	
	
											case 'textarea':
	
												if ($val['multilanguage'] == "TRUE")
												{
												    if($val['key'] == "TRUE")
													{
													foreach ($languages as $prefix=>$language)
													{
														$data .="
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."_".$prefix."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."'] : '');?></label>
                <br>
                ";
													}
													}
													else
													{
													$data.="<label class='labelform' for='".$index_name."_".$prefix."'>".ucfirst($index)." ($prefix) ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>";
													}
												}
												else
												{
												  if($val['key'] == "TRUE")
													{
													$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>
                ";
												}
												else
												{
												$data.="<label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>";
												}
												}
	
												break;
	
											case 'checkbox1':
												$data .= "
                <br>
                  <label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
				 <br>
                ";
	
												break;
	
											case 'checkbox':
												$data .= "
                <br>
                  <label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
				 <br>  
				  ";
	
	
												
	
												
	
												
												break;
	
											case 'MChoice':
												$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
				 <br>  
				  ";
												break;
	
											case 'select':
												$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>                   
				   ";
	
	                                         	break;
	
	
											case 'selectbd':
												$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
                <br>  
				  ";
												break;
	
											case 'radio':
												$data .= "
                <br>
                  <label class='labelform'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'] : ''); ?></label>
				<br>  
				  ";

	
												break;
	
											case 'datepicker':
												$data .="
                <br>
                  <label class='labelform' for='".$index_name."'>".ucfirst($index)." ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <label><?php echo set_value('page".$pgno."_".$section_name."_".$index_name."', (isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."'])) ? \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']->format('d-m-Y') : ''); ?></label>
			    <br>
                ";
												break;
	
											case 'image':
	
												if ($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <?php if(isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']): ?>
	            <br><img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/img/thumbs/<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']?>' /> <br>
                <?php endif ?>
                <br>
                ";
													}
	
												}
												else
												{
													$data .= "
                <br>
                  <label class='labelform' for='".$index_name."'>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <?php if(isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']): ?>
	           <br> <img src='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/img/thumbs/<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']?>' /> <br>
                <?php endif ?>
                <br/>
                ";
												}
	
												break;
	
											case 'file':
											case 'photo':
	
												if($val['multilanguage'] == "TRUE")
												{
													foreach ($languages as $prefix=>$language)
													{
														$data .= "
                <br>
                  <label class='labelform' for='".$index_name."_".$prefix."'>
                    [".$index." ($prefix)] ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <?php if(isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']):?>
                  <a href='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/files/<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_encrypted_name']?>' />Download actual file(<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."_".$prefix."']['file_client_name']?>)</a> <br>
                  <?php else: ?>
				  <label> - - - - - - - - - - </label>
				  <?php endif ?>
				<br>
                ";
													}
	
												}
												else
												{
													$data .= "
                <br>
                  <label class='labelform' for='".$index_name."'>
                    (".$index.") ".(($val['required'] == "TRUE") ? "<span class='required'>*</span>" : "") ."&nbsp;&nbsp;:&nbsp;&nbsp;</label>
                  <?php if(isset(\$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name'])): ?>
                  <a href='<?php echo URLCustomer.UPLOADFOLDER?>/public/uploads/".$this->controller_name."/files/<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_encrypted_name']?>' />Download actual file (<?php echo \$".$this->model_name."['doc_data']"."['widget_data']"."['page".$pgno."']"."['".$section."']"."['".$index."']['file_client_name']?>)</a>
                  <?php else: ?>
				  <label> - - - - - - - - - - </label>
				  <?php endif ?>
                  <br/>
                ";
												}
	
												break;
	
											case 'hidden':
	
												$data .= "
                <input id='".$index_name."' type='hidden' name='".$index_name."' value='<?php echo \$".$index_name."?>'/>
                ";
	
												break;
										}
									}
								
					
	
								
								$data .="</div><br>";
								break;
									
								 
						}
					}
	
				}
				$data .="</div><br>";
		 }
	
		$data .= "
	
                </div>
                </article>
	</div>
</div>
	<!-- END MAIN CONTENT -->
<div align=\"center\"><a class=\"btn btn-primary btn-xs\" href='<?php echo URL?>".$this->company_name."/".$this->controller_name."/'>
                <?php echo lang('web_back_list')?>
                </a></div>
</div>
<!-- END MAIN PANEL -->
<!-- ==========================CONTENT ENDS HERE ========================== -->
  <script src='<?php echo(JS.'jquery.js'); ?>'></script>
  <script src='<?php echo(JS.'web_view_js.js'); ?>'></script>
  <script src='<?php echo(JS.'update.js'); ?>'></script>
  <script src=\"<?php echo(JS.'tooltip.js'); ?>\" type=\"text/javascript\"></script>
  <script src=\"<?php echo(JS.'popover.js'); ?>\" type=\"text/javascript\"></script>
	
  <?php
	//include required scripts
	include(\"inc/scripts.php\");
?>
        
<?php
	//include footer
	include(\"inc/footer.php\");
?>
	
	
       ";
	
	
		$this->create_folder_if_no_exists(APPPATH.'views/'.$this->company_name);
		$this->create_folder_if_no_exists(APPPATH.'views/'.$this->company_name."/".$this->controller_name);
	
		if ( $this->save_file("print_view", "views/".$this->company_name."/".$this->controller_name."/", trim( $data ) ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." view/".$this->controller_name."/print_view.php";
			return FALSE;
		}
	
	
	}


	private function modify_routes()
	{
		$data = $this->sl.$this->sl;
		$data .="//routes para ".$this->controller_name.$this->sl;
		//$data .= "\$route['".$this->controller_name."/(:num)'] = '".$this->controller_name."/index/$1';";
		$data .= "\$route['".$this->customer_folder."/".$this->controller_name."/(:num)'] = '".$this->customer_folder."/".$this->controller_name."/index/$1';";
        
		if ($this->there_is_a_relational_field)
		{
			$data .= $this->sl."\$route['".$this->controller_name."/(:num)/(:num)'] = '".$this->controller_name."/index/$1/$2';";
		}

		if ( $this->save_file('routes', "config/", $data, 'a' ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_modify')." config/routes.php";
			return FALSE;
		}
	}


	private function modify_menu()
	{
		
		//No modificamos menu si es relacion
		if ($this->there_is_a_relational_field)
			return TRUE;


		$data = $this->sl.$this->sl;
		$data .= "
		<?php  \$mactive = (\$this->uri->rsegment(1) == '".$this->controller_name."')  ? \"class='selected'\" : \"\" ?>
		".$this->sl;
		$data .= "
		<li <?php echo \$mactive?>><a href=\"".$this->controller_name."/\" style=\"background-position: 0px 0px;\">".ucfirst($this->controller_name)."</a></li>
		";

		if ( $this->save_file('_menu', "views/partials/", $data, 'a' ) === TRUE )
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_modify')." config/routes.php";
			return FALSE;
		}
	}


	private function add_relational_link_to_list()
	{
		
		if (!$this->ci->ion_auth->logged_in())
		{
			//redirect them to the login page
			redirect(URC.'auth/login');
		}
		
		
		$file = file(APPPATH."views/".$this->relational_controller."/list.php" );
		
		log_message('debug','fileeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'.print_r($file,true));

		/*
		$tds = array_keys( $file, '<td' );
		$pos_to_insert = $tds[count($tds)-1];
		*/
		$pos = count($file)-1;
		$tds_found = 0;
		while( $pos >0 and $tds_found < 2 )
		{
			if( strpos($file[$pos],'<td') !== FALSE )
			{
				$tds_found++;
			}
			$pos--;
		}

		for( $i=count($file);$i>$pos;$i--)
		{
			$file[$i] = $file[($i-1)];
		}

		if ($this->mongo_db_type == 'phpactiverecord')
			$file[$pos+1] = $this->tabx5."
			<td><a href=\"/".$this->controller_name."/
              <?php echo \$".$this->relational_model."->id?>
              \">".ucfirst($this->controller_name)." (
              <?php echo  ".$this->model_name_for_calls."::count(array('conditions' => array('".$this->relational_field." = ?', \$".$this->relational_model."->id)) )?>
              )</a></td>
			".$this->sl;
		else if ($this->mongo_db_type == 'activerecord')
			$file[$pos+1] = $this->tabx5."
			<td><a href=\"/".$this->controller_name."/
              <?php echo \$".$this->relational_model."->id?>
              \">".ucfirst($this->controller_name)." (
              <?php echo  ".$this->model_name_for_calls."::count(\$".$this->relational_model."->id)?>
              )</a></td>
			".$this->sl;

		$result = file_put_contents(APPPATH."views/".$this->relational_controller."/list.php" , $file );


		if ( $result )
			return TRUE;
		else
		{
			$this->errors = "Error modificando lista";
			return FALSE;
		}
	}


	private function create_folder_if_no_exists($path)
	{
		if (@mkdir($path))
		{
			return TRUE;
		}
		else
		{
			return FALSE;
		}
	}


	private function save_file($filename, $path, $data, $mode = "w")
	{
		$file = fopen(APPPATH.$path.$filename.".php" , $mode);
      
		if ($file)
		{
			$result = fputs ($file, $data);
		}

		fclose ($file);

		if ($result)
			return TRUE;
		else
		{
			$this->errors = lang('scaffolds_error_file')." ".APPPATH.$path.$filename.".php";
			return FALSE;
		}
	}

}